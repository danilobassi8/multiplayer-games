(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[290],{9290:(Se,$t,R)=>{"use strict";R.r($t),R.d($t,{MinesweeperModule:()=>qt});var ot=R(2362),rt=R(6895),F=R(9119),U=R(5755),Et=R(9386),Z=R(2076),A=R(4650);const Ut=["easy","medium","hard"];let Lt=(()=>{class x extends class Ft{constructor(b){this.roomGame=b,this.client=new U.Client(`ws://${Et.N.backend_url}`)}joinOrCreate(){return(0,Z.D)(this.client.joinOrCreate(this.roomGame))}}{constructor(){super("MinesweeperRoom"),this.gameConfig={easy:{bombs:10,size:9},medium:{bombs:30,size:40},hard:{bombs:95,size:50}}}}return x.\u0275fac=function(N){return new(N||x)},x.\u0275prov=A.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();class jt{constructor(b,N){this.row=b,this.column=N,this.bomb=!0,this.revealed=!1,this.flagged=!1}}class st extends Array{constructor(b,N,V){super(),this.player=N;for(let tt=0;tt<b;tt++){this[tt]=[];for(let at=0;at<b;at++)this[tt].push(new jt(tt,at))}this.generateBombs(V.bombs)}generateBombs(b){}}var lt=R(433),Ot=R(5362);function vt(x,b){1&x&&(A._uU(0),A.ALo(1,"titlecase")),2&x&&A.hij(" ",A.lcZ(1,1,b.$implicit)," ")}function It(x,b){1&x&&A.GkF(0)}function Ct(x,b){1&x&&A._UZ(0,"img",11)}function Rt(x,b){if(1&x&&(A.TgZ(0,"div",9),A.YNc(1,Ct,1,0,"img",10),A.qZA()),2&x){const N=b.$implicit;A.xp6(1),A.Q6J("ngIf",N.bomb)}}function zt(x,b){if(1&x&&(A.ynx(0),A.YNc(1,Rt,2,1,"div",8),A.BQk()),2&x){const N=b.$implicit;A.xp6(1),A.Q6J("ngForOf",N)}}function Bt(x,b){if(1&x&&(A.TgZ(0,"div",5)(1,"div",6),A.YNc(2,zt,2,1,"ng-container",7),A.qZA()()),2&x){const N=b.matrix,V=A.oxw();A.xp6(1),A.Udp("grid-template-columns","repeat("+V.currentConfig.size+",calc(min(700px, 100%) / "+V.currentConfig.size+"))"),A.xp6(1),A.Q6J("ngForOf",N)}}const it=function(x){return{matrix:x}},Ht=[{path:"",children:[{path:"",component:(()=>{class x{constructor(N){this.game=N,this.selectedDifficulty="easy",this.difficultyOptions=[...Ut],this.currentConfig=this.game.gameConfig.easy,this.userMatrix=new st(this.currentConfig.size,"userMatrix",this.currentConfig),this.enemyMatrix=new st(this.currentConfig.size,"enemyMatrix",this.currentConfig)}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new st(this.currentConfig.size,"userMatrix",this.currentConfig),this.enemyMatrix=new st(this.currentConfig.size,"enemyMatrix",this.currentConfig)}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}}return x.\u0275fac=function(N){return new(N||x)(A.Y36(Lt))},x.\u0275cmp=A.Xpm({type:x,selectors:[["app-minesweeper"]],decls:7,vars:6,consts:[[1,"d-flex","justify-content-end"],["styleClass","mt-2",3,"options","ngModel","ngModelChange","onChange"],[1,"main-double-board"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["matrixTemplate",""],[1,"matrix-wrapper","pb-2"],[1,"matrix-container"],[4,"ngFor","ngForOf"],["class","matrix-col",4,"ngFor","ngForOf"],[1,"matrix-col"],["src","/assets/bomb.png","class","bomb-image",4,"ngIf"],["src","/assets/bomb.png",1,"bomb-image"]],template:function(N,V){if(1&N&&(A.TgZ(0,"div",0)(1,"p-selectButton",1),A.NdJ("ngModelChange",function(at){return V.selectedDifficulty=at})("onChange",function(){return V.difficultyChange()}),A.YNc(2,vt,2,3,"ng-template"),A.qZA()(),A.TgZ(3,"div",2),A.YNc(4,It,1,0,"ng-container",3),A.qZA(),A.YNc(5,Bt,3,3,"ng-template",null,4,A.W1O)),2&N){const tt=A.MAs(6);A.xp6(1),A.Q6J("options",V.difficultyOptions)("ngModel",V.selectedDifficulty),A.xp6(3),A.Q6J("ngTemplateOutlet",tt)("ngTemplateOutletContext",A.VKq(4,it,V.userMatrix))}},dependencies:[rt.sg,rt.O5,rt.tP,lt.JJ,lt.On,Ot.UN,rt.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%}.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;justify-content:center}.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container[_ngcontent-%COMP%]   .matrix-col[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:relative;cursor:pointer;background-color:silver;border:1.5px solid;border-top-color:#fff;border-right-color:#7b7b7b;border-bottom-color:#7b7b7b;aspect-ratio:1}.bomb-image[_ngcontent-%COMP%]{position:absolute;width:100%;transform:translateY(-2px)}"]}),x})()}]}];let Jt=(()=>{class x{}return x.\u0275fac=function(N){return new(N||x)},x.\u0275mod=A.oAB({type:x}),x.\u0275inj=A.cJS({imports:[F.Bz.forChild(Ht),F.Bz]}),x})(),qt=(()=>{class x{}return x.\u0275fac=function(N){return new(N||x)},x.\u0275mod=A.oAB({type:x}),x.\u0275inj=A.cJS({imports:[rt.ez,Jt,ot.m]}),x})()},5755:function(Se,$t){!function(R){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(o){return null!==o&&"object"==typeof o&&o.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ot=function(o,s){return(ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])})(o,s)};function rt(o,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function r(){this.constructor=o}ot(o,s),o.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}function F(o,s,r,a){return new(r||(r=Promise))(function(h,m){function p(S){try{d(a.next(S))}catch(k){m(k)}}function l(S){try{d(a.throw(S))}catch(k){m(k)}}function d(S){S.done?h(S.value):function c(h){return h instanceof r?h:new r(function(m){m(h)})}(S.value).then(p,l)}d((a=a.apply(o,s||[])).next())})}function U(o,s){var a,c,h,m,r={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return m={next:p(0),throw:p(1),return:p(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m;function p(d){return function(S){return function l(d){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,c&&(h=2&d[0]?c.return:d[0]?c.throw||((h=c.return)&&h.call(c),0):c.next)&&!(h=h.call(c,d[1])).done)return h;switch(c=0,h&&(d=[2&d[0],h.value]),d[0]){case 0:case 1:h=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,c=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(!(h=(h=r.trys).length>0&&h[h.length-1])&&(6===d[0]||2===d[0])){r=0;continue}if(3===d[0]&&(!h||d[1]>h[0]&&d[1]<h[3])){r.label=d[1];break}if(6===d[0]&&r.label<h[1]){r.label=h[1],h=d;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(d);break}h[2]&&r.ops.pop(),r.trys.pop();continue}d=s.call(o,r)}catch(S){d=[6,S],c=0}finally{a=h=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,S])}}}function Et(o,s){s.headers=o.headers||{},s.statusMessage=o.statusText,s.statusCode=o.status,s.data=o.response}function Z(o,s,r){return new Promise(function(a,c){r=r||{};var m,p,l,h=new XMLHttpRequest,d=r.body,S=r.headers||{};for(m in r.timeout&&(h.timeout=r.timeout),h.ontimeout=h.onerror=function(k){k.timeout="timeout"==k.type,c(k)},h.open(o,s.href||s),h.onload=function(){for(l=h.getAllResponseHeaders().trim().split(/[\r\n]+/),Et(h,h);p=l.shift();)p=p.split(": "),h.headers[p.shift().toLowerCase()]=p.join(": ");if((p=h.headers["content-type"])&&~p.indexOf("application/json"))try{h.data=JSON.parse(h.data,r.reviver)}catch(k){return Et(h,k),c(k)}(h.status>=400?c:a)(h)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(S["content-type"]="application/json",d=JSON.stringify(d)),h.withCredentials=!!r.withCredentials,S)h.setRequestHeader(m,S[m]);h.send(d)})}var Ft=Z.bind(Z,"GET"),A=Z.bind(Z,"POST"),Ut=Z.bind(Z,"PATCH"),st=Z.bind(Z,"DELETE"),lt=Ft,Ot=Ut,vt=A,It=Z.bind(Z,"PUT"),Ct=Z,Rt={del:st,get:lt,patch:Ot,post:vt,put:It,send:Ct},zt=Object.freeze(Object.assign(Object.create(null),Rt,{default:Rt,del:st,get:lt,patch:Ot,post:vt,put:It,send:Ct})),Bt=function(o){function s(r,a){var c=o.call(this,a)||this;return c.name="ServerError",c.code=r,c}return rt(s,o),s}(Error);function it(o,s){if(this._offset=s,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}function Jt(o,s,r){for(var a=0,c=0,h=r.length;c<h;c++)(a=r.charCodeAt(c))<128?o.setUint8(s++,a):a<2048?(o.setUint8(s++,192|a>>6),o.setUint8(s++,128|63&a)):a<55296||a>=57344?(o.setUint8(s++,224|a>>12),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a)):(c++,a=65536+((1023&a)<<10|1023&r.charCodeAt(c)),o.setUint8(s++,240|a>>18),o.setUint8(s++,128|a>>12&63),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a))}function x(o,s,r){var a=typeof r,c=0,h=0,m=0,p=0,l=0,d=0;if("string"===a){if((l=function qt(o){for(var s=0,r=0,a=0,c=o.length;a<c;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r}(r))<32)o.push(160|l),d=1;else if(l<256)o.push(217,l),d=2;else if(l<65536)o.push(218,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("String too long");o.push(219,l>>24,l>>16,l>>8,l),d=5}return s.push({_str:r,_length:l,_offset:o.length}),d+l}if("number"===a)return Math.floor(r)===r&&isFinite(r)?r>=0?r<128?(o.push(r),1):r<256?(o.push(204,r),2):r<65536?(o.push(205,r>>8,r),3):r<4294967296?(o.push(206,r>>24,r>>16,r>>8,r),5):(m=r/Math.pow(2,32)>>0,o.push(207,m>>24,m>>16,m>>8,m,(p=r>>>0)>>24,p>>16,p>>8,p),9):r>=-32?(o.push(r),1):r>=-128?(o.push(208,r),2):r>=-32768?(o.push(209,r>>8,r),3):r>=-2147483648?(o.push(210,r>>24,r>>16,r>>8,r),5):(m=Math.floor(r/Math.pow(2,32)),o.push(211,m>>24,m>>16,m>>8,m,(p=r>>>0)>>24,p>>16,p>>8,p),9):(o.push(203),s.push({_float:r,_length:8,_offset:o.length}),9);if("object"===a){if(null===r)return o.push(192),1;if(Array.isArray(r)){if((l=r.length)<16)o.push(144|l),d=1;else if(l<65536)o.push(220,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Array too large");o.push(221,l>>24,l>>16,l>>8,l),d=5}for(c=0;c<l;c++)d+=x(o,s,r[c]);return d}if(r instanceof Date){var S=r.getTime();return m=Math.floor(S/Math.pow(2,32)),o.push(215,0,m>>24,m>>16,m>>8,m,(p=S>>>0)>>24,p>>16,p>>8,p),10}if(r instanceof ArrayBuffer){if((l=r.byteLength)<256)o.push(196,l),d=2;else if(l<65536)o.push(197,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Buffer too large");o.push(198,l>>24,l>>16,l>>8,l),d=5}return s.push({_bin:r,_length:l,_offset:o.length}),d+l}if("function"==typeof r.toJSON)return x(o,s,r.toJSON());var k=[],L="",K=Object.keys(r);for(c=0,h=K.length;c<h;c++)"function"!=typeof r[L=K[c]]&&k.push(L);if((l=k.length)<16)o.push(128|l),d=1;else if(l<65536)o.push(222,l>>8,l),d=3;else{if(!(l<4294967296))throw new Error("Object too large");o.push(223,l>>24,l>>16,l>>8,l),d=5}for(c=0;c<l;c++)d+=x(o,s,L=k[c]),d+=x(o,s,r[L]);return d}if("boolean"===a)return o.push(r?195:194),1;if("undefined"===a)return o.push(212,0,0),3;throw new Error("Could not encode")}function b(o){var s=[],r=[],a=x(s,r,o),c=new ArrayBuffer(a),h=new DataView(c),m=0,p=0,l=-1;r.length>0&&(l=r[0]._offset);for(var d,S=0,k=0,L=0,K=s.length;L<K;L++)if(h.setUint8(p+L,s[L]),L+1===l){if(S=(d=r[m])._length,k=p+l,d._bin)for(var Tt=new Uint8Array(d._bin),q=0;q<S;q++)h.setUint8(k+q,Tt[q]);else d._str?Jt(h,k,d._str):void 0!==d._float&&h.setFloat64(k,d._float);p+=S,r[++m]&&(l=r[m]._offset)}return c}it.prototype._array=function(o){for(var s=new Array(o),r=0;r<o;r++)s[r]=this._parse();return s},it.prototype._map=function(o){for(var r={},a=0;a<o;a++)r[this._parse()]=this._parse();return r},it.prototype._str=function(o){var s=function ce(o,s,r){for(var a="",c=0,h=s,m=s+r;h<m;h++){var p=o.getUint8(h);if(0!=(128&p))if(192!=(224&p))if(224!=(240&p)){if(240!=(248&p))throw new Error("Invalid byte "+p.toString(16));(c=(7&p)<<18|(63&o.getUint8(++h))<<12|(63&o.getUint8(++h))<<6|(63&o.getUint8(++h))<<0)>=65536?(c-=65536,a+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):a+=String.fromCharCode(c)}else a+=String.fromCharCode((15&p)<<12|(63&o.getUint8(++h))<<6|(63&o.getUint8(++h))<<0);else a+=String.fromCharCode((31&p)<<6|63&o.getUint8(++h));else a+=String.fromCharCode(p)}return a}(this._view,this._offset,o);return this._offset+=o,s},it.prototype._bin=function(o){var s=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,s},it.prototype._parse=function(){var s,o=this._view.getUint8(this._offset++),r=0,a=0,c=0,h=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return r=this._view.getUint8(this._offset),this._offset+=1,this._bin(r);case 197:return r=this._view.getUint16(this._offset),this._offset+=2,this._bin(r);case 198:return r=this._view.getUint32(this._offset),this._offset+=4,this._bin(r);case 199:return r=this._view.getUint8(this._offset),a=this._view.getInt8(this._offset+1),this._offset+=2,[a,this._bin(r)];case 200:return r=this._view.getUint16(this._offset),a=this._view.getInt8(this._offset+2),this._offset+=3,[a,this._bin(r)];case 201:return r=this._view.getUint32(this._offset),a=this._view.getInt8(this._offset+4),this._offset+=5,[a,this._bin(r)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,c+h;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,c+h;case 212:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?void(this._offset+=1):[a,this._bin(1)];case 213:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(2)];case 214:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(4)];case 215:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?(c=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+h)):[a,this._bin(8)];case 216:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(16)];case 217:return r=this._view.getUint8(this._offset),this._offset+=1,this._str(r);case 218:return r=this._view.getUint16(this._offset),this._offset+=2,this._str(r);case 219:return r=this._view.getUint32(this._offset),this._offset+=4,this._str(r);case 220:return r=this._view.getUint16(this._offset),this._offset+=2,this._array(r);case 221:return r=this._view.getUint32(this._offset),this._offset+=4,this._array(r);case 222:return r=this._view.getUint16(this._offset),this._offset+=2,this._map(r);case 223:return r=this._view.getUint32(this._offset),this._offset+=4,this._map(r)}throw new Error("Could not parse")};var o,V=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},tt=function(){function o(s){this.events=s}return o.prototype.send=function(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)},o.prototype.connect=function(s){this.ws=new V(s,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},o.prototype.close=function(s,r){this.ws.close(s,r)},o}(),at=function(){function o(){this.events={},this.transport=new tt(this.events)}return o.prototype.send=function(s){this.transport.send(s)},o.prototype.connect=function(s){this.transport.connect(s)},o.prototype.close=function(s,r){this.transport.close(s,r)},o}(),he={};function Wt(o,s){he[o]=s}function ue(o){var s=he[o];if(!s)throw new Error("missing serializer: "+o);return s}R.Protocol=void 0,(o=R.Protocol||(R.Protocol={}))[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",R.ErrorCode=void 0,function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(R.ErrorCode||(R.ErrorCode={}));let be=()=>({events:{},emit(o,...s){(this.events[o]||[]).forEach(r=>r(...s))},on(o,s){return(this.events[o]=this.events[o]||[]).push(s),()=>this.events[o]=(this.events[o]||[]).filter(r=>r!==s)}});var Ne=function(){function o(){this.handlers=[]}return o.prototype.register=function(s,r){return this.handlers.push(s),this},o.prototype.invoke=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];this.handlers.forEach(function(c){return c.apply(s,r)})},o.prototype.invokeAsync=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return Promise.all(this.handlers.map(function(c){return c.apply(s,r)}))},o.prototype.remove=function(s){var r=this.handlers.indexOf(s);this.handlers[r]=this.handlers[this.handlers.length-1],this.handlers.pop()},o.prototype.clear=function(){this.handlers=[]},o}();function Mt(){var o=new Ne;function s(r){return o.register(r,null===this)}return s.once=function(r){var a=function(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];r.apply(this,c),o.remove(a)};o.register(a)},s.remove=function(r){return o.remove(r)},s.invoke=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invoke.apply(o,r)},s.invokeAsync=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invokeAsync.apply(o,r)},s.clear=function(){return o.clear()},s}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var Kt,et=function Fe(o){var s={exports:{}};return o(s,s.exports),s.exports}(function(o,s){var a;a=function(r){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&(n[f]=i[f])})(e,t)};function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function h(e,t,n,i){var _,f=arguments.length,u=f<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,i);else for(var g=e.length-1;g>=0;g--)(_=e[g])&&(u=(f<3?_(u):f>3?_(t,n,u):_(t,n))||u);return f>3&&u&&Object.defineProperty(t,n,u),u}function m(e,t){for(var n=0,i=t.length,f=e.length;n<i;n++,f++)e[f]=t[n];return e}var e,p=255;r.OPERATION=void 0,(e=r.OPERATION||(r.OPERATION={}))[e.ADD=128]="ADD",e[e.REPLACE=0]="REPLACE",e[e.DELETE=64]="DELETE",e[e.DELETE_AND_ADD=192]="DELETE_AND_ADD",e[e.TOUCH=1]="TOUCH",e[e.CLEAR=10]="CLEAR";var d=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(t,n,i){void 0===i&&(i=!0),this.refs.set(t,n),i&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},e.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach(function(n){if(t.refCounts[n]<=0){var i=t.refs.get(n);if(i instanceof H)for(var f in i._definition.schema)"string"!=typeof i._definition.schema[f]&&i[f]&&i[f].$changes&&t.removeRef(i[f].$changes.refId);else{var u=i.$changes.parent._definition;"function"==typeof Object.values(u.schema[u.fieldsByIndex[i.$changes.parentIndex]])[0]&&Array.from(i.values()).forEach(function(g){return t.removeRef(g.$changes.refId)})}t.refs.delete(n),delete t.refCounts[n]}}),this.deletedRefs.clear()},e}(),S=function(){function e(t,n,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(n,i)}return e.prototype.setParent=function(t,n,i){var f=this;if(this.indexes||(this.indexes=this.ref instanceof H?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=i,n)if(this.root=n,this.ref instanceof H){var u=this.ref._definition;for(var _ in u.schema){var g=this.ref[_];g&&g.$changes&&g.$changes.setParent(this.ref,n,u.indexes[_])}}else"object"==typeof this.ref&&this.ref.forEach(function(E,v){E instanceof H&&E.$changes.setParent(f.ref,f.root,f.ref.$changes.indexes[v])})},e.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},e.prototype.change=function(t,n){void 0===n&&(n=r.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var f=this.changes.get(i);(!f||f.op===r.OPERATION.DELETE||f.op===r.OPERATION.TOUCH)&&this.changes.set(i,{op:f&&f.op===r.OPERATION.DELETE?r.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},e.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:r.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},e.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},e.prototype.getType=function(t){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[t]];var n=this.parent._definition;return Object.values(n.schema[n.fieldsByIndex[this.parentIndex]])[0]},e.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},e.prototype.getValue=function(t){return this.ref.getByIndex(t)},e.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:r.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+t+" ("+n+")")},e.prototype.discard=function(t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof H||this.changes.forEach(function(f){if(f.op===r.OPERATION.DELETE){var u=i.ref.getIndex(f.index);delete i.indexes[u]}}),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},e.prototype.discardAll=function(){var t=this;this.changes.forEach(function(n){var i=t.getValue(n.index);i&&i.$changes&&i.$changes.discardAll()}),this.discard()},e.prototype.cache=function(t,n){this.caches[t]=n},e.prototype.clone=function(){return new e(this.ref,this.parent,this.root)},e.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},e.prototype.assertValidIndex=function(t,n){if(void 0===t)throw new Error('ChangeTree: missing index for field "'+n+'"')},e}(),k=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function L(e){return e.$proxy=!0,new Proxy(e,{get:function(t,n){return"symbol"==typeof n||isNaN(n)?t[n]:t.at(n)},set:function(t,n,i){if("symbol"==typeof n||isNaN(n))t[n]=i;else{var f=Array.from(t.$items.keys()),u=parseInt(f[n]||n);null==i?t.deleteAt(u):t.setAt(u,i)}return!0},deleteProperty:function(t,n){return"number"==typeof n?t.deleteAt(n):delete t[n],!0}})}var K=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return e.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(e.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),e.prototype.push=function(){for(var t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var f;return n.forEach(function(u){f=t.$refId++,t.setAt(f,u)}),f},e.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var n=this.$items.get(t);return this.$items.delete(t),n}},e.prototype.at=function(t){var n=Array.from(this.$items.keys())[t];return this.$items.get(n)},e.prototype.setAt=function(t,n){var i,f;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var u=null!==(f=null===(i=this.$changes.indexes[t])||void 0===i?void 0:i.op)&&void 0!==f?f:r.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,u)},e.prototype.deleteAt=function(t){var n=Array.from(this.$items.keys())[t];return void 0!==n&&this.$deleteAt(n)},e.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.concat=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(e.bind.apply(e,m([void 0],(t=Array.from(this.$items.values())).concat.apply(t,n))))},e.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},e.prototype.reverse=function(){var t=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(f,u){t.setAt(n[u],f)}),this},e.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var i=this.$items.get(n);return this.$deleteAt(n),i}},e.prototype.slice=function(t,n){return new(e.bind.apply(e,m([void 0],Array.from(this.$items.values()).slice(t,n))))},e.prototype.sort=function(t){var n=this;void 0===t&&(t=k);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach(function(u,_){n.setAt(i[_],u)}),this},e.prototype.splice=function(t,n){void 0===n&&(n=this.length-t);for(var i=[],f=2;f<arguments.length;f++)i[f-2]=arguments[f];for(var u=Array.from(this.$items.keys()),_=[],g=t;g<t+n;g++)_.push(this.$items.get(u[g])),this.$deleteAt(u[g]);return _},e.prototype.unshift=function(){for(var t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var f=this.length,u=n.length,_=Array.from(this.$items.values());return n.forEach(function(g,M){t.setAt(M,g)}),_.forEach(function(g,M){t.setAt(u+M,g)}),f+u},e.prototype.indexOf=function(t,n){return Array.from(this.$items.values()).indexOf(t,n)},e.prototype.lastIndexOf=function(t,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,n)},e.prototype.every=function(t,n){return Array.from(this.$items.values()).every(t,n)},e.prototype.some=function(t,n){return Array.from(this.$items.values()).some(t,n)},e.prototype.forEach=function(t,n){Array.from(this.$items.values()).forEach(t,n)},e.prototype.map=function(t,n){return Array.from(this.$items.values()).map(t,n)},e.prototype.filter=function(t,n){return Array.from(this.$items.values()).filter(t,n)},e.prototype.reduce=function(t,n){return Array.from(this.$items.values()).reduce(t,n)},e.prototype.reduceRight=function(t,n){return Array.from(this.$items.values()).reduceRight(t,n)},e.prototype.find=function(t,n){return Array.from(this.$items.values()).find(t,n)},e.prototype.findIndex=function(t,n){return Array.from(this.$items.values()).findIndex(t,n)},e.prototype.fill=function(t,n,i){throw new Error("ArraySchema#fill() not implemented")},e.prototype.copyWithin=function(t,n,i){throw new Error("ArraySchema#copyWithin() not implemented")},e.prototype.toString=function(){return this.$items.toString()},e.prototype.toLocaleString=function(){return this.$items.toLocaleString()},e.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},e.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},e.prototype.includes=function(t,n){return Array.from(this.$items.values()).includes(t,n)},e.prototype.flatMap=function(t,n){throw new Error("ArraySchema#flatMap() is not supported.")},e.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){return this.toArray().map(function(t){return"function"==typeof t.toJSON?t.toJSON():t})},e.prototype.clone=function(t){return t?new(e.bind.apply(e,m([void 0],Array.from(this.$items.values())))):new(e.bind.apply(e,m([void 0],this.map(function(i){return i.$changes?i.clone():i}))))},e.prototype.triggerAll=function(){H.prototype.triggerAll.apply(this)},e}();function Tt(e){return e.$proxy=!0,new Proxy(e,{get:function(t,n){return"symbol"!=typeof n&&typeof t[n]>"u"?t.get(n):t[n]},set:function(t,n,i){return"symbol"!=typeof n&&-1===n.indexOf("$")&&"onAdd"!==n&&"onRemove"!==n&&"onChange"!==n?t.set(n,i):t[n]=i,!0},deleteProperty:function(t,n){return t.delete(n),!0}})}var q=function(){function e(t){var n=this;if(this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map)t.forEach(function(f,u){return n.set(u,f)});else for(var i in t)this.set(i,t[i])}return e.is=function(t){return void 0!==t.map},e.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),e.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('"+t+"', "+n+"): trying to set "+n+" value on '"+t+"'.");var i=typeof this.$changes.indexes[t]<"u",f=i?this.$changes.indexes[t]:this.$refId++,u=i?r.OPERATION.REPLACE:r.OPERATION.ADD,_=void 0!==n.$changes;return _&&n.$changes.setParent(this,this.$changes.root,f),i?_&&this.$items.get(t)!==n&&(u=r.OPERATION.ADD):(this.$changes.indexes[t]=f,this.$indexes.set(f,t)),this.$items.set(t,n),this.$changes.change(t,u),this},e.prototype.get=function(t){return this.$items.get(t)},e.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return this.$items.has(t)},e.prototype.forEach=function(t){this.$items.forEach(t)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toJSON=function(){var t={};return this.forEach(function(n,i){t[i]="function"==typeof n.toJSON?n.toJSON():n}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i,f){n.set(f,i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){H.prototype.triggerAll.apply(this)},e}(),ge={};function mt(e,t){ge[e]=t}function St(e){return ge[e]}var Qt=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(t,n){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=t,this.indexes[t]=i,this.schema[t]=Array.isArray(n)?{array:n[0]}:n},e.prototype.addFilter=function(t,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=n,this.indexesWithFilters.push(this.indexes[t]),!0},e.prototype.addChildrenFilter=function(t,n){var i=this.indexes[t];if(St(Object.keys(this.schema[t])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=n,!0;console.warn("@filterChildren: field '"+t+"' can't have children. Ignoring filter.")},e.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();var Dt=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(t){return this.schemas.has(t)},e.prototype.get=function(t){return this.types[t]},e.prototype.add=function(t,n){void 0===n&&(n=this.schemas.size),t._definition=Qt.create(t._definition),t._typeid=n,this.types[n]=t,this.schemas.set(t,n)},e.create=function(t){return void 0===t&&(t=new e),function(n){return Q(n,t)}},e}(),ve=new Dt;function Q(e,t){return void 0===t&&(t=ve),function(n,i){var f=n.constructor;f._context=t,t.has(f)||t.add(f);var u=f._definition;if(u.addField(i,e),u.descriptors[i]){if(u.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+f.name+"'.\nCheck @type() annotation")}catch(y){var _=y.stack.split("\n")[4].trim();throw new Error(y.message+" "+_)}}var g=K.is(e),M=!g&&q.is(e);if("string"!=typeof e&&!H.is(e)){var E=Object.values(e)[0];"string"!=typeof E&&!t.has(E)&&t.add(E)}var v="_"+i;u.descriptors[v]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[i]={get:function(){return this[v]},set:function(y){y!==this[v]&&(null!=y?(g&&!(y instanceof K)&&(y=new(K.bind.apply(K,m([void 0],y)))),M&&!(y instanceof q)&&(y=new q(y)),void 0===y.$proxy&&(M?y=Tt(y):g&&(y=L(y))),this.$changes.change(i),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[v]=y)},enumerable:!0,configurable:!0}}}function me(e,t,n){for(var i=0,f=0,u=n.length;f<u;f++)(i=n.charCodeAt(f))<128?e[t++]=i:i<2048?(e[t++]=192|i>>6,e[t++]=128|63&i):i<55296||i>=57344?(e[t++]=224|i>>12,e[t++]=128|i>>6&63,e[t++]=128|63&i):(f++,i=65536+((1023&i)<<10|1023&n.charCodeAt(f)),e[t++]=240|i>>18,e[t++]=128|i>>12&63,e[t++]=128|i>>6&63,e[t++]=128|63&i)}function ye(e,t){e.push(255&t)}function W(e,t){e.push(255&t)}function xe(e,t){e.push(255&t),e.push(t>>8&255)}function Vt(e,t){e.push(255&t),e.push(t>>8&255)}function yt(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function ft(e,t){var n=t>>24,i=t>>16,f=t>>8;e.push(255&t),e.push(255&f),e.push(255&i),e.push(255&n)}function _e(e,t){var n=Math.floor(t/Math.pow(2,32));ft(e,t>>>0),ft(e,n)}function we(e,t){var n=t/Math.pow(2,32)>>0;ft(e,t>>>0),ft(e,n)}var xt=new Int32Array(2),Xe=new Float32Array(xt.buffer),tn=new Float64Array(xt.buffer);function Ae(e,t){Xe[0]=t,yt(e,xt[0])}function Xt(e,t){tn[0]=t,yt(e,xt[0]),yt(e,xt[1])}function Pt(e,t){t||(t="");var n=function Ze(e){for(var t=0,n=0,i=0,f=e.length;i<f;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217),W(e,n),i=2;else if(n<65536)e.push(218),Vt(e,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),ft(e,n),i=5}return me(e,e.length,t),i+n}function G(e,t){return isNaN(t)?G(e,0):isFinite(t)?t!==(0|t)?(e.push(203),Xt(e,t),9):t>=0?t<128?(W(e,t),1):t<256?(e.push(204),W(e,t),2):t<65536?(e.push(205),Vt(e,t),3):t<4294967296?(e.push(206),ft(e,t),5):(e.push(207),we(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),ye(e,t),2):t>=-32768?(e.push(209),xe(e,t),3):t>=-2147483648?(e.push(210),yt(e,t),5):(e.push(211),_e(e,t),9):G(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var te=Object.freeze({__proto__:null,utf8Write:me,int8:ye,uint8:W,int16:xe,uint16:Vt,int32:yt,uint32:ft,int64:_e,uint64:we,float32:function Qe(e,t){Ae(e,t)},float64:function Ve(e,t){Xt(e,t)},writeFloat32:Ae,writeFloat64:Xt,boolean:function en(e,t){return W(e,t?1:0)},string:Pt,number:G});function $e(e,t){return _t(e,t)<<24>>24}function _t(e,t){return e[t.offset++]}function Ee(e,t){return bt(e,t)<<16>>16}function bt(e,t){return e[t.offset++]|e[t.offset++]<<8}function ct(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function pt(e,t){return ct(e,t)>>>0}function Oe(e,t){var n=pt(e,t);return ct(e,t)*Math.pow(2,32)+n}function Ie(e,t){var n=pt(e,t);return pt(e,t)*Math.pow(2,32)+n}var wt=new Int32Array(2),sn=new Float32Array(wt.buffer),an=new Float64Array(wt.buffer);function ee(e,t){return wt[0]=ct(e,t),sn[0]}function ne(e,t){return wt[0]=ct(e,t),wt[1]=ct(e,t),an[0]}function Ce(e,t){var i,n=e[t.offset++];n<192?i=31&n:217===n?i=_t(e,t):218===n?i=bt(e,t):219===n&&(i=pt(e,t));var f=function nn(e,t,n){for(var i="",f=0,u=t,_=t+n;u<_;u++){var g=e[u];0!=(128&g)?192!=(224&g)?224!=(240&g)?240!=(248&g)?console.error("Invalid byte "+g.toString(16)):(f=(7&g)<<18|(63&e[++u])<<12|(63&e[++u])<<6|(63&e[++u])<<0)>=65536?(f-=65536,i+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):i+=String.fromCharCode(f):i+=String.fromCharCode((15&g)<<12|(63&e[++u])<<6|(63&e[++u])<<0):i+=String.fromCharCode((31&g)<<6|63&e[++u]):i+=String.fromCharCode(g)}return i}(e,t.offset,i);return t.offset+=i,f}function ht(e,t){var n=e[t.offset++];return n<128?n:202===n?ee(e,t):203===n?ne(e,t):204===n?_t(e,t):205===n?bt(e,t):206===n?pt(e,t):207===n?Ie(e,t):208===n?$e(e,t):209===n?Ee(e,t):210===n?ct(e,t):211===n?Oe(e,t):n>223?-1*(255-n+1):void 0}function Re(e,t){return e[t.offset-1]===p&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var Me=Object.freeze({__proto__:null,int8:$e,uint8:_t,int16:Ee,uint16:bt,int32:ct,uint32:pt,float32:function rn(e,t){return ee(e,t)},float64:function on(e,t){return ne(e,t)},int64:Oe,uint64:Ie,readFloat32:ee,readFloat64:ne,boolean:function fn(e,t){return _t(e,t)>0},string:Ce,stringCheck:function cn(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},number:ht,numberCheck:function hn(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},arrayCheck:function un(e,t){return e[t.offset]<160},switchStructureCheck:Re}),re=function(){function e(t){var n=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(i){return n.add(i)})}return e.is=function(t){return void 0!==t.collection},e.prototype.add=function(t){var n=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,t),this.$changes.change(n),n},e.prototype.at=function(t){var n=Array.from(this.$items.keys())[t];return this.$items.get(n)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var i,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(t===f.value[1]){i=f.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return Array.from(this.$items.values()).some(function(n){return n===t})},e.prototype.forEach=function(t){var n=this;this.$items.forEach(function(i,f,u){return t(i,f,n)})},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach(function(n,i){t.push("function"==typeof n.toJSON?n.toJSON():n)}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){H.prototype.triggerAll.apply(this)},e}(),ie=function(){function e(t){var n=this;this.$changes=new S(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(i){return n.add(i)})}return e.is=function(t){return void 0!==t.set},e.prototype.add=function(t){var n,i;if(this.has(t))return!1;var f=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,f);var u=null!==(i=null===(n=this.$changes.indexes[f])||void 0===n?void 0:n.op)&&void 0!==i?i:r.OPERATION.ADD;return this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,t),this.$changes.change(f,u),f},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var i,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(t===f.value[1]){i=f.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){for(var f,n=this.$items.values(),i=!1;(f=n.next())&&!f.done;)if(t===f.value){i=!0;break}return i},e.prototype.forEach=function(t){var n=this;this.$items.forEach(function(i,f,u){return t(i,f,n)})},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach(function(n,i){t.push("function"==typeof n.toJSON?n.toJSON():n)}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){H.prototype.triggerAll.apply(this)},e}(),dn=function(){function e(){this.handlers=[]}return e.prototype.register=function(t,n){return this.handlers.push(t),this},e.prototype.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach(function(i){return i.apply(void 0,t)})},e.prototype.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map(function(i){return i.apply(void 0,t)}))},e.prototype.remove=function(t){var n=this.handlers.indexOf(t);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}(),ln=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t}(Error);function Te(e,t,n,i){if(!(e instanceof t))throw new oe("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function gn(e,t,n,i,f){!function pn(e,t,n,i){var f,u=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":f="number",isNaN(e)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+i);break;case"string":f="string",u=!0;break;case"boolean":return}if(typeof e!==f&&(!u||u&&null!==e)){var _="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new oe("a '"+f+"' was expected, but "+_+" was provided in "+n.constructor.name+"#"+i)}}(n,e,i,f);var u=te[e];if(!u)throw new oe("a '"+e+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+f);u(t,n)}function vn(e,t,n){return Me[e](t,n)}var H=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new S(this,void 0,new d),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),t[0]&&this.assign(t[0])}return e.onError=function(t){console.error(t)},e.is=function(t){return t._definition&&void 0!==t._definition.schema},e.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(e.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),e.prototype.listen=function(t,n){var i=this;return this.$listeners[t]||(this.$listeners[t]=new dn),this.$listeners[t].register(n),function(){return i.$listeners[t].remove(n)}},e.prototype.decode=function(t,n,i,f){void 0===n&&(n={offset:0}),void 0===i&&(i=this),void 0===f&&(f=new Map);var u=this.$changes.root,_=t.length,g=0,M=[];for(u.refs.set(g,this),f.set(g,M);n.offset<_;){var E=t[n.offset++];if(E!=p){var y=i.$changes,P=void 0!==i._definition,C=P?E>>6<<6:E;if(C!==r.OPERATION.CLEAR){var $=P?E%(C||255):ht(t,n),I=P?i._definition.fieldsByIndex[$]:"",D=y.getType($),w=void 0,T=void 0,J=void 0;if(P?T=i["_"+I]:(T=i.getByIndex($),(C&r.OPERATION.ADD)===r.OPERATION.ADD?(J=i instanceof q?Ce(t,n):$,i.setIndex($,J)):J=i.getIndex($)),(C&r.OPERATION.DELETE)===r.OPERATION.DELETE&&(C!==r.OPERATION.DELETE_AND_ADD&&i.deleteByIndex($),T&&T.$changes&&u.removeRef(T.$changes.refId),w=null),void 0!==I){if(C!==r.OPERATION.DELETE)if(e.is(D)){var j=ht(t,n);if(w=u.refs.get(j),C!==r.OPERATION.REPLACE){var X=this.getSchemaType(t,n,D);w||((w=this.createTypeInstance(X)).$changes.refId=j,T&&(w.onChange=T.onChange,w.onRemove=T.onRemove,w.$listeners=T.$listeners,T.$changes.refId&&j!==T.$changes.refId&&u.removeRef(T.$changes.refId))),u.addRef(j,w,w!==T)}}else if("string"==typeof D)w=vn(D,t,n);else{var At=St(Object.keys(D)[0]),Y=ht(t,n),z=u.refs.has(Y)?T||u.refs.get(Y):new At.constructor;if((w=z.clone(!0)).$changes.refId=Y,T&&(w.onAdd=T.onAdd,w.onRemove=T.onRemove,w.onChange=T.onChange,T.$changes.refId&&Y!==T.$changes.refId)){u.removeRef(T.$changes.refId);for(var B=[],fe=T.entries(),nt=void 0;(nt=fe.next())&&!nt.done;){var Nt=nt.value;B.push({op:r.OPERATION.DELETE,field:Nt[0],value:void 0,previousValue:Nt[1]})}f.set(T.$changes.refId,B)}u.addRef(Y,w,z!==T),At.getProxy&&(w=At.getProxy(w))}var xn=T!==w;if(null!=w)if(w.$changes&&w.$changes.setParent(y.ref,y.root,$),i instanceof e)i[I]=w;else if(i instanceof q)i.$items.set(J,w);else if(i instanceof K)i.setAt($,w);else if(i instanceof re){var kt=i.add(w);i.setIndex($,kt)}else i instanceof ie&&!1!==(kt=i.add(w))&&i.setIndex($,kt);xn&&M.push({op:C,field:I,dynamicIndex:J,value:w,previousValue:T})}else{console.warn("@colyseus/schema: definition mismatch");for(var O={offset:n.offset};n.offset<_&&(!Re(t,n)||(O.offset=n.offset+1,!u.refs.has(ht(t,O))));)n.offset++}}else i.clear(!0)}else{g=ht(t,n);var v=u.refs.get(g);if(!v)throw new Error('"refId" not found: '+g);i=v,f.set(g,M=[])}}return this._triggerChanges(f),u.garbageCollectDeletedRefs(),f},e.prototype.encode=function(t,n,i){void 0===t&&(t=!1),void 0===n&&(n=[]),void 0===i&&(i=!1);for(var f=this.$changes,u=new WeakSet,_=[f],g=1,M=0;M<g;M++){var E=_[M],v=E.ref,y=v instanceof e;E.ensureRefId(),u.add(E),E!==f&&(E.changed||t)&&(W(n,p),G(n,E.refId));for(var P=Array.from(t?E.allChanges:E.changes.values()),C=0,$=P.length;C<$;C++){var I=t?{op:r.OPERATION.ADD,index:P[C]}:P[C],D=I.index,w=y?v._definition.fieldsByIndex&&v._definition.fieldsByIndex[D]:D,T=n.length;if(I.op!==r.OPERATION.TOUCH)if(y)W(n,D|I.op);else{if(W(n,I.op),I.op===r.OPERATION.CLEAR)continue;G(n,D)}if(!y&&(I.op&r.OPERATION.ADD)==r.OPERATION.ADD&&v instanceof q&&Pt(n,E.ref.$indexes.get(D)),I.op!==r.OPERATION.DELETE){var O=E.getType(D),j=E.getValue(D);if(j&&j.$changes&&!u.has(j.$changes)&&(_.push(j.$changes),j.$changes.ensureRefId(),g++),I.op!==r.OPERATION.TOUCH){if(e.is(O))Te(j,O,v,w),G(n,j.$changes.refId),(I.op&r.OPERATION.ADD)===r.OPERATION.ADD&&this.tryEncodeTypeId(n,O,j.constructor);else if("string"==typeof O)gn(O,n,j,v,w);else{var X=St(Object.keys(O)[0]);Te(v["_"+w],X.constructor,v,w),G(n,j.$changes.refId)}i&&E.cache(D,n.slice(T))}}}!t&&!i&&E.discard()}return n},e.prototype.encodeAll=function(t){return this.encode(!0,[],t)},e.prototype.applyFilters=function(t,n){var i,f;void 0===n&&(n=!1);for(var u=this,_=new Set,g=ln.get(t),M=[this.$changes],E=1,v=[],y=function(C){var $=M[C];if(_.has($.refId))return"continue";var I=$.ref,D=I instanceof e;W(v,p),G(v,$.refId);var w=g.refIds.has($),T=n||!w;g.addRefId($);var J=g.containerIndexes.get($),O=Array.from(T?$.allChanges:$.changes.values());!n&&D&&I._definition.indexesWithFilters&&I._definition.indexesWithFilters.forEach(function(gt){!J.has(gt)&&$.allChanges.has(gt)&&O.push(T?gt:{op:r.OPERATION.ADD,index:gt})});for(var X=0,At=O.length;X<At;X++){var Y=T?{op:r.OPERATION.ADD,index:O[X]}:O[X];if(Y.op!==r.OPERATION.CLEAR){var z=Y.index;if(Y.op!==r.OPERATION.DELETE){var B=$.getValue(z),fe=$.getType(z);if(D){if((nt=I._definition.filters&&I._definition.filters[z])&&!nt.call(I,t,B,u)){B&&B.$changes&&_.add(B.$changes.refId);continue}}else{var nt,Nt=$.parent;if((nt=$.getChildrenFilter())&&!nt.call(Nt,t,I.$indexes.get(z),B,u)){B&&B.$changes&&_.add(B.$changes.refId);continue}}if(B.$changes&&(M.push(B.$changes),E++),Y.op!==r.OPERATION.TOUCH)if(Y.op===r.OPERATION.ADD||D)v.push.apply(v,null!==(i=$.caches[z])&&void 0!==i?i:[]),J.add(z);else if(J.has(z))v.push.apply(v,null!==(f=$.caches[z])&&void 0!==f?f:[]);else{if(J.add(z),W(v,r.OPERATION.ADD),G(v,z),I instanceof q){var dt=$.ref.$indexes.get(z);Pt(v,dt)}B.$changes?G(v,B.$changes.refId):te[fe](v,B)}else B.$changes&&!D&&(W(v,r.OPERATION.ADD),G(v,z),I instanceof q&&(dt=$.ref.$indexes.get(z),Pt(v,dt)),G(v,B.$changes.refId))}else D?W(v,Y.op|z):(W(v,Y.op),G(v,z))}else W(v,Y.op)}},P=0;P<E;P++)y(P);return v},e.prototype.clone=function(){var t=new this.constructor,n=this._definition.schema;for(var i in n)t[i]="object"==typeof this[i]&&"function"==typeof this[i].clone?this[i].clone():this[i];return t},e.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var t=new Map;e.prototype._triggerAllFillChanges.call(this,this,t);try{e.prototype._triggerChanges.call(this,t)}catch(n){e.onError(n)}}},e.prototype.toJSON=function(){var t=this._definition.schema,n=this._definition.deprecated,i={};for(var f in t)!n[f]&&null!==this[f]&&typeof this[f]<"u"&&(i[f]="function"==typeof this[f].toJSON?this[f].toJSON():this["_"+f]);return i},e.prototype.discardAllChanges=function(){this.$changes.discardAll()},e.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},e.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},e.prototype.tryEncodeTypeId=function(t,n,i){n._typeid!==i._typeid&&(W(t,213),G(t,i._typeid))},e.prototype.getSchemaType=function(t,n,i){var f;return 213===t[n.offset]&&(n.offset++,f=this.constructor._context.get(ht(t,n))),f||i},e.prototype.createTypeInstance=function(t){var n=new t;return n.$changes.root=this.$changes.root,n},e.prototype._triggerAllFillChanges=function(t,n){if(!n.has(t.$changes.refId)){var i=[];if(n.set(t.$changes.refId||0,i),t instanceof e){var f=t._definition.schema;for(var u in f)void 0!==(g=t["_"+u])&&(i.push({op:r.OPERATION.ADD,field:u,value:g,previousValue:void 0}),void 0!==g.$changes&&e.prototype._triggerAllFillChanges.call(this,g,n))}else for(var M=t.entries(),E=void 0;(E=M.next())&&!E.done;){var g,v=E.value,y=v[0];i.push({op:r.OPERATION.ADD,field:y,dynamicIndex:y,value:g=v[1],previousValue:void 0}),void 0!==g.$changes&&e.prototype._triggerAllFillChanges.call(this,g,n)}}},e.prototype._triggerChanges=function(t){var n=this;t.forEach(function(i,f){var u,_,g,M,E,v,y,P,C,$,I,D;if(i.length>0){for(var w=n.$changes.root.refs.get(f),T=w instanceof e,J=0;J<i.length;J++){var O=i[J],j=w.$listeners&&w.$listeners[O.field];if(T||(O.op===r.OPERATION.ADD&&void 0===O.previousValue?null===(_=(u=w).onAdd)||void 0===_||_.call(u,O.value,null!==(g=O.dynamicIndex)&&void 0!==g?g:O.field):O.op===r.OPERATION.DELETE?void 0!==O.previousValue&&(null===(E=(M=w).onRemove)||void 0===E||E.call(M,O.previousValue,null!==(v=O.dynamicIndex)&&void 0!==v?v:O.field)):O.op===r.OPERATION.DELETE_AND_ADD?(void 0!==O.previousValue&&(null===(P=(y=w).onRemove)||void 0===P||P.call(y,O.previousValue,O.dynamicIndex)),null===($=(C=w).onAdd)||void 0===$||$.call(C,O.value,O.dynamicIndex)):(O.op===r.OPERATION.REPLACE||O.value!==O.previousValue)&&(null===(D=(I=w).onChange)||void 0===D||D.call(I,O.value,O.dynamicIndex))),(O.op&r.OPERATION.DELETE)===r.OPERATION.DELETE&&O.previousValue instanceof e&&O.previousValue.onRemove&&O.previousValue.onRemove(),j)try{j.invoke(O.value,O.previousValue)}catch(X){e.onError(X)}}if(T&&w.onChange)try{w.onChange(i)}catch(X){e.onError(X)}}})},e._definition=Qt.create(),e}();var ut=new Dt,se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),h([Q("string",ut)],t.prototype,"name",void 0),h([Q("string",ut)],t.prototype,"type",void 0),h([Q("number",ut)],t.prototype,"referencedType",void 0),t}(H),ae=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.fields=new K,n}return c(t,e),h([Q("number",ut)],t.prototype,"id",void 0),h([Q([se],ut)],t.prototype,"fields",void 0),t}(H),yn=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.types=new K,n}return c(t,e),t.encode=function(n){var i=n.constructor,f=new t;f.rootType=i._typeid;var u=function(E,v){for(var y in v){var P=new se;P.name=y;var C=void 0;if("string"==typeof v[y])C=v[y];else{var $=v[y],I=void 0;H.is($)?(C="ref",I=v[y]):"string"==typeof $[C=Object.keys($)[0]]?C+=":"+$[C]:I=$[C],P.referencedType=I?I._typeid:-1}P.type=C,E.fields.push(P)}f.types.push(E)},_=i._context.types;for(var g in _){var M=new ae;M.id=Number(g),u(M,_[g]._definition.schema)}return f.encodeAll()},t.decode=function(n,i){var f=new Dt,u=new t;u.decode(n,i);var _=u.types.reduce(function(y,P){var C=function(I){function D(){return null!==I&&I.apply(this,arguments)||this}return c(D,I),D}(H),$=P.id;return y[$]=C,f.add(C,$),y},{});u.types.forEach(function(y){var P=_[y.id];y.fields.forEach(function(C){var $;if(void 0!==C.referencedType){var I=C.type,D=_[C.referencedType];if(!D){var w=C.type.split(":");I=w[0],D=w[1]}"ref"===I?Q(D,f)(P.prototype,C.name):Q((($={})[I]=D,$),f)(P.prototype,C.name)}else Q(C.type,f)(P.prototype,C.name)})});var g=_[u.rootType],M=new g;for(var E in g._definition.schema){var v=g._definition.schema[E];"string"!=typeof v&&(M[E]="function"==typeof v?new v:new(St(Object.keys(v)[0]).constructor))}return M},h([Q([ae],ut)],t.prototype,"types",void 0),h([Q("number",ut)],t.prototype,"rootType",void 0),t}(H);mt("map",{constructor:q,getProxy:Tt}),mt("array",{constructor:K,getProxy:L}),mt("set",{constructor:ie}),mt("collection",{constructor:re}),r.ArraySchema=K,r.CollectionSchema=re,r.Context=Dt,r.MapSchema=q,r.Reflection=yn,r.ReflectionField=se,r.ReflectionType=ae,r.Schema=H,r.SchemaDefinition=Qt,r.SetSchema=ie,r.decode=Me,r.defineTypes=function Ye(e,t,n){for(var i in void 0===n&&(n=e._context||ve),t)Q(t[i],n)(e.prototype,i);return e},r.deprecated=function Ge(e,t){return void 0===e&&(e=!0),function(n,i){var u=n.constructor._definition;u.deprecated[i]=!0,e&&(u.descriptors[i]={get:function(){throw new Error(i+" is deprecated.")},set:function(_){},enumerable:!1,configurable:!0})}},r.dumpChanges=function mn(e){for(var t=[e.$changes],i={},f=i,u=function(g){var M=t[g];M.changes.forEach(function(E){var v=M.ref,y=E.index,P=v._definition?v._definition.fieldsByIndex[y]:v.$indexes.get(y);f[P]=M.getValue(y)})},_=0;_<1;_++)u(_);return i},r.encode=te,r.filter=function We(e){return function(t,n){var i=t.constructor;i._definition.addFilter(n,e)&&(i._context.useFilters=!0)}},r.filterChildren=function Ke(e){return function(t,n){var i=t.constructor;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=!0)}},r.hasFilter=function qe(e){return e._context&&e._context.useFilters},r.registerType=mt,r.type=Q,Object.defineProperty(r,"__esModule",{value:!0})},a(s)}),de=function(){function o(s,r){var a=this;this.onStateChange=Mt(),this.onError=Mt(),this.onLeave=Mt(),this.onJoin=Mt(),this.hasJoined=!1,this.onMessageHandlers=be(),this.id=null,this.name=s,r&&(this.serializer=new(ue("schema")),this.rootSchema=r,this.serializer.state=new r),this.onError(function(c,h){return console.warn("colyseus.js - onError => ("+c+") "+h)}),this.onLeave(function(){return a.removeAllListeners()})}return o.prototype.connect=function(s){var r=this;this.connection=new at,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(a){if(!r.hasJoined)return console.warn("Room connection was closed unexpectedly ("+a.code+"): "+a.reason),void r.onError.invoke(a.code,a.reason);r.onLeave.invoke(a.code),r.destroy()},this.connection.events.onerror=function(a){console.warn("Room, onError ("+a.code+"): "+a.reason),r.onError.invoke(a.code,a.reason)},this.connection.connect(s)},o.prototype.leave=function(s){var r=this;return void 0===s&&(s=!0),new Promise(function(a){r.onLeave(function(c){return a(c)}),r.connection?s?r.connection.send([R.Protocol.LEAVE_ROOM]):r.connection.close():r.onLeave.invoke(4e3)})},o.prototype.onMessage=function(s,r){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),r)},o.prototype.send=function(s,r){var c,a=[R.Protocol.ROOM_DATA];if("string"==typeof s?et.encode.string(a,s):et.encode.number(a,s),void 0!==r){var h=b(r);(c=new Uint8Array(a.length+h.byteLength)).set(new Uint8Array(a),0),c.set(new Uint8Array(h),a.length)}else c=new Uint8Array(a);this.connection.send(c.buffer)},Object.defineProperty(o.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),o.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},o.prototype.onMessageCallback=function(s){var r=Array.from(new Uint8Array(s.data)),a=r[0];if(a===R.Protocol.JOIN_ROOM){var c=1;if(this.serializerId=function De(o,s){for(var r=o[s++],a="",c=0,h=s,m=s+r;h<m;h++){var p=o[h];if(0!=(128&p))if(192!=(224&p))if(224!=(240&p)){if(240!=(248&p))throw new Error("Invalid byte "+p.toString(16));(c=(7&p)<<18|(63&o[++h])<<12|(63&o[++h])<<6|(63&o[++h])<<0)>=65536?(c-=65536,a+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):a+=String.fromCharCode(c)}else a+=String.fromCharCode((15&p)<<12|(63&o[++h])<<6|(63&o[++h])<<0);else a+=String.fromCharCode((31&p)<<6|63&o[++h]);else a+=String.fromCharCode(p)}return a}(r,c),c+=function Pe(o){void 0===o&&(o="");for(var s=0,r=0,a=0,c=o.length;a<c;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r+1}(this.serializerId),!this.serializer){var h=ue(this.serializerId);this.serializer=new h}r.length>c&&this.serializer.handshake&&this.serializer.handshake(r,{offset:c}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([R.Protocol.JOIN_ROOM])}else if(a===R.Protocol.ERROR){var m={offset:1},p=et.decode.number(r,m),l=et.decode.string(r,m);this.onError.invoke(p,l)}else if(a===R.Protocol.LEAVE_ROOM)this.leave();else if(a===R.Protocol.ROOM_DATA_SCHEMA){var d={offset:1};(l=new(k=this.serializer.getState().constructor._context.get(et.decode.number(r,d)))).decode(r,d),this.dispatchMessage(k,l)}else if(a===R.Protocol.ROOM_STATE)r.shift(),this.setState(r);else if(a===R.Protocol.ROOM_STATE_PATCH)r.shift(),this.patch(r);else if(a===R.Protocol.ROOM_DATA){var L={offset:1},k=et.decode.stringCheck(r,L)?et.decode.string(r,L):et.decode.number(r,L);l=r.length>L.offset?function Ht(o,s){void 0===s&&(s=0);var r=new it(o,s),a=r._parse();if(r._offset!==o.byteLength)throw new Error(o.byteLength-r._offset+" trailing bytes");return a}(s.data,L.offset):void 0,this.dispatchMessage(k,l)}},o.prototype.setState=function(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.patch=function(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.dispatchMessage=function(s,r){var a=this.getMessageHandlerKey(s);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,r):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,r):console.warn("colyseus.js: onMessage() not registered for type '"+s+"'.")},o.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},o.prototype.getMessageHandlerKey=function(s){switch(typeof s){case"function":return"$"+s._typeid;case"string":return s;case"number":return"i"+s;default:throw new Error("invalid message type.")}},o}();function Gt(){return Kt||(Kt=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(o,s){this.cache[o]=s},getItem:function(o){},removeItem:function(o){delete this.cache[o]}}),Kt}var Yt="colyseus-auth-token";R.Platform=void 0,function(o){o.ios="ios",o.android="android"}(R.Platform||(R.Platform={}));var Zt,le=function(){function o(s){var r=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=s.replace("ws","http"),function je(o,s){var r=Gt().getItem(o);typeof Promise>"u"||!(r instanceof Promise)?s(r):r.then(function(a){return s(a)})}(Yt,function(a){return r.token=a})}return Object.defineProperty(o.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),o.prototype.login=function(s){return void 0===s&&(s={}),F(this,void 0,void 0,function(){var r,a,c;return U(this,function(h){switch(h.label){case 0:return r=Object.assign({},s),this.hasToken&&(r.token=this.token),[4,this.request("post","/auth",r)];case 1:for(c in a=h.sent(),this.token=a.token,function Ue(o,s){Gt().setItem(o,s)}(Yt,this.token),a)this.hasOwnProperty(c)&&(this[c]=a[c]);return this.registerPingService(),[2,this]}})})},o.prototype.save=function(){return F(this,void 0,void 0,function(){return U(this,function(s){switch(s.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return s.sent(),[2,this]}})})},o.prototype.getFriends=function(){return F(this,void 0,void 0,function(){return U(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,s.sent()]}})})},o.prototype.getOnlineFriends=function(){return F(this,void 0,void 0,function(){return U(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,s.sent()]}})})},o.prototype.getFriendRequests=function(){return F(this,void 0,void 0,function(){return U(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,s.sent()]}})})},o.prototype.sendFriendRequest=function(s){return F(this,void 0,void 0,function(){return U(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.acceptFriendRequest=function(s){return F(this,void 0,void 0,function(){return U(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.declineFriendRequest=function(s){return F(this,void 0,void 0,function(){return U(this,function(r){switch(r.label){case 0:return[4,this.request("del","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.blockUser=function(s){return F(this,void 0,void 0,function(){return U(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.unblockUser=function(s){return F(this,void 0,void 0,function(){return U(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.request=function(s,r,a,c,h){return void 0===a&&(a={}),void 0===h&&(h={}),F(this,void 0,void 0,function(){var m,p,l,d;return U(this,function(S){switch(S.label){case 0:for(p in h.Accept="application/json",this.hasToken&&(h.Authorization="Bearer "+this.token),m=[],a)m.push(p+"="+a[p]);return l=m.length>0?"?"+m.join("&"):"",d={headers:h},c&&(d.body=c),[4,zt[s](""+this.endpoint+r+l,d)];case 1:return[2,S.sent().data]}})})},o.prototype.logout=function(){this.token=void 0,function Le(o){Gt().removeItem(o)}(Yt),this.unregisterPingService()},o.prototype.registerPingService=function(s){var r=this;void 0===s&&(s=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return r.request("get","/auth")},s)},o.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},o}(),ze=function(o){function s(r,a){var c=o.call(this,r)||this;return c.code=a,Object.setPrototypeOf(c,s.prototype),c}return rt(s,o),s}(Error),Be=typeof window<"u"&&typeof(null===(Zt=window?.location)||void 0===Zt?void 0:Zt.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",He=function(){function o(s){void 0===s&&(s=Be),this.endpoint=s}return Object.defineProperty(o.prototype,"auth",{get:function(){return this._auth||(this._auth=new le(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),o.prototype.joinOrCreate=function(s,r,a){return void 0===r&&(r={}),F(this,void 0,void 0,function(){return U(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.create=function(s,r,a){return void 0===r&&(r={}),F(this,void 0,void 0,function(){return U(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("create",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.join=function(s,r,a){return void 0===r&&(r={}),F(this,void 0,void 0,function(){return U(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("join",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.joinById=function(s,r,a){return void 0===r&&(r={}),F(this,void 0,void 0,function(){return U(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.reconnect=function(s,r,a){return F(this,void 0,void 0,function(){return U(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,{sessionId:r},a)];case 1:return[2,c.sent()]}})})},o.prototype.getAvailableRooms=function(s){return void 0===s&&(s=""),F(this,void 0,void 0,function(){var r;return U(this,function(a){switch(a.label){case 0:return r=this.endpoint.replace("ws","http")+"/matchmake/"+s,[4,lt(r,{headers:{Accept:"application/json"}})];case 1:return[2,a.sent().data]}})})},o.prototype.consumeSeatReservation=function(s,r){return F(this,void 0,void 0,function(){var a;return U(this,function(c){return(a=this.createRoom(s.room.name,r)).id=s.room.roomId,a.sessionId=s.sessionId,a.connect(this.buildEndpoint(s.room,{sessionId:a.sessionId})),[2,new Promise(function(h,m){var p=function(l,d){return m(new Bt(l,d))};a.onError.once(p),a.onJoin.once(function(){a.onError.remove(p),h(a)})})]})})},o.prototype.createMatchMakeRequest=function(s,r,a,c){return void 0===a&&(a={}),F(this,void 0,void 0,function(){var h,m;return U(this,function(p){switch(p.label){case 0:return h=this.endpoint.replace("ws","http")+"/matchmake/"+s+"/"+r,this._auth&&this._auth.hasToken&&(a.token=this._auth.token),[4,vt(h,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})];case 1:if((m=p.sent().data).error)throw new ze(m.error,m.code);return[2,this.consumeSeatReservation(m,c)]}})})},o.prototype.createRoom=function(s,r){return new de(s,r)},o.prototype.buildEndpoint=function(s,r){void 0===r&&(r={});var a=[];for(var c in r)!r.hasOwnProperty(c)||a.push(c+"="+r[c]);return this.endpoint+"/"+s.processId+"/"+s.roomId+"?"+a.join("&")},o}(),pe=function(){function o(){}return o.prototype.setState=function(s){this.state.decode(s)},o.prototype.getState=function(){return this.state},o.prototype.patch=function(s){this.state.decode(s)},o.prototype.teardown=function(){var s,r;null===(r=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===r||r.root.clearRefs()},o.prototype.handshake=function(s,r){this.state?(new et.Reflection).decode(s,r):this.state=et.Reflection.decode(s,r)},o}(),Je=function(){function o(){}return o.prototype.setState=function(s){},o.prototype.getState=function(){return null},o.prototype.patch=function(s){},o.prototype.teardown=function(){},o.prototype.handshake=function(s){},o}();Wt("schema",pe),Wt("none",Je),R.Auth=le,R.Client=He,R.Room=de,R.SchemaSerializer=pe,R.registerSerializer=Wt,Object.defineProperty(R,"__esModule",{value:!0})}($t)}}]);