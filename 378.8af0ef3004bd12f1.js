(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{9429:(Bt,Ie,C)=>{"use strict";C.r(Ie),C.d(Ie,{MinesweeperModule:()=>f});var ne=C(5012),j=C(6895),P=C(5755),k=C(9386),ge=C(7579),Y=C(3900),Re=C(2076),o=C(4650),Se=C(3274);const he=["easy","medium","hard"];let ie=(()=>{class t extends class Ge{constructor(s,a,u={}){this.roomGame=s,this.auth=a,this.defaultGameOptions=u,this.stateChanges=new ge.x,this.roomMessages=new ge.x,this.client=new P.Client(`ws://${k.N.backend_url}`)}createRoom(s){return this.auth.user$.pipe((0,Y.w)(a=>(0,Re.D)(this.client.create(this.roomGame,{...this.defaultGameOptions,...s,player:a}).then(u=>{this.currentRoom&&this.currentRoom.leave(),this.currentRoom=u,this.currentRoom.onStateChange(l=>this.stateChanges.next(l)),this.currentRoom.onMessage("*",l=>this.roomMessages.next(l))}).catch(u=>{this.auth.loginWithRedirect()}))))}getAvailableRooms(){return(0,Re.D)(this.client.getAvailableRooms(this.roomGame))}}{constructor(a){super("MinesweeperRoom",a,{maxClients:2}),this.authService=a,this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return t.\u0275fac=function(a){return new(a||t)(o.LFG(Se.e8))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class me extends Set{add(s){super.add(s.toString())}has(s){return super.has(s.toString())}}class De{constructor({include:s=!0,onlyInteger:a=!0}){this.includeLimits=s,this.onlyInteger=a}returnOutputNumber(s){return this.onlyInteger?Math.round(s):s}between(s,a){let u;return u=this.includeLimits?Math.floor(Math.random()*(a-s+1)+s):Math.floor(Math.random()*(a-s)+s),this.returnOutputNumber(u)}}class ve{constructor(s,a){this.row=s,this.column=a,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged="no"}toggleFlaggedState(){this.flagged="no"!=this.flagged?"flag"===this.flagged?"question":"no":"flag"}}class re extends Array{constructor(s,a="player"){super(),this.status="playing",this.player=a;const u=s?.size;for(let l=0;l<u;l++){this[l]=[];for(let d=0;d<u;d++)this[l].push(new ve(l,d))}s&&this.generateBombs(s)}generateBombs(s){const a=new De({onlyInteger:!0}),u=new me;for(;u.size<s.bombs;){const l=a.between(0,s.size-1),d=a.between(0,s.size-1);u.has([l,d])||(u.add([l,d]),this[l][d].bomb=!0,this.getCellsArround(this[l][d]).forEach(g=>{g.nearBombs++}))}}getCellsArround(s){const a=[],u=s.row,l=s.column,d=(g,m)=>(this[g]&&this[g][m]&&a.push(this[g][m]),a);return d(u+1,l+1),d(u+1,l-1),d(u+1,l+0),d(u-1,l+1),d(u-1,l-1),d(u-1,l+0),d(u+0,l+1),d(u+0,l-1),a}reveal(s){if(s.bomb)return this.status="game over",void this.revealAllCells();s.revealed=!0,0===s.nearBombs&&this.getCellsArround(s).filter(a=>0==a.revealed).forEach(a=>this.reveal(a)),this.checkWinningCondition()}checkWinningCondition(){return"playing"!==this.status?"win"===this.status:0===this.flat(2).filter(u=>!(u.bomb||u.revealed)).length&&(this.status="win",!0)}revealAllCells(){this.forEach(s=>s.forEach(a=>a.revealed=!0))}toggleCellState(s){s.toggleFlaggedState(),this.checkWinningCondition()}getUsedFlags(){let s=0;return this.forEach(a=>a.forEach(u=>{s+="flag"===u.flagged?1:0})),s}}var ee=C(9119),X=C(433),_e=C(5593),Pe=C(5362);function te(t,s){1&t&&o._UZ(0,"img",7)}function Ye(t,s){if(1&t&&o._UZ(0,"span"),2&t){const a=o.oxw(2).$implicit;o.Gre("m-0 p-0 near-bombs-text near-",a.nearBombs,"")}}function Qe(t,s){if(1&t&&(o.ynx(0),o.YNc(1,te,1,0,"img",5),o.YNc(2,Ye,1,3,"span",6),o.BQk()),2&t){const a=o.oxw().$implicit;o.xp6(1),o.Q6J("ngIf",a.bomb),o.xp6(1),o.Q6J("ngIf",!a.bomb)}}function Ke(t,s){1&t&&o._UZ(0,"img",10)}function We(t,s){1&t&&o._UZ(0,"img",11)}function oe(t,s){if(1&t&&(o.ynx(0),o.YNc(1,Ke,1,0,"img",8),o.YNc(2,We,1,0,"img",9),o.BQk()),2&t){const a=o.oxw().$implicit;o.xp6(1),o.Q6J("ngIf","flag"==a.flagged),o.xp6(1),o.Q6J("ngIf","question"==a.flagged)}}function Xe(t,s){if(1&t){const a=o.EpF();o.TgZ(0,"div",3),o.NdJ("click",function(){const d=o.CHM(a).$implicit,g=o.oxw(2);return o.KtG(g.cellClicked.emit(d))})("contextmenu",function(l){const g=o.CHM(a).$implicit,m=o.oxw(2);return o.KtG(m.onRightClick(l,g))}),o.YNc(1,Qe,3,2,"ng-container",4),o.YNc(2,oe,3,2,"ng-container",4),o.qZA()}if(2&t){const a=s.$implicit,u=s.index,l=o.oxw().index;o.ekj("revealed",a.revealed)("empty",a.revealed&&0==a.nearBombs&&!a.bomb)("darker",(l%2+u)%2),o.xp6(1),o.Q6J("ngIf",a.revealed),o.xp6(1),o.Q6J("ngIf",0==a.revealed)}}function Ve(t,s){if(1&t&&(o.ynx(0),o.YNc(1,Xe,3,8,"div",2),o.BQk()),2&t){const a=s.$implicit;o.xp6(1),o.Q6J("ngForOf",a)}}function et(t,s){1&t&&o._UZ(0,"img",12),2&t&&o.MGl("src","assets/minesweeper/",s.$implicit,".png",o.LSH)}const tt=function(){return["bomb","red_flag","question_mark"]};let ke=(()=>{class t{constructor(a){this.game=a,this.cellClicked=new o.vpe,this.cellRightClicked=new o.vpe,this.currentConfig=a.gameConfig.easy,this.matrix=new re(this.currentConfig)}ngOnInit(){}onRightClick(a,u){a.preventDefault(),this.cellRightClicked.emit(u)}}return t.\u0275fac=function(a){return new(a||t)(o.Y36(ie))},t.\u0275cmp=o.Xpm({type:t,selectors:[["minesweeper-game-matrix"]],inputs:{matrix:"matrix",currentConfig:"currentConfig"},outputs:{cellClicked:"cellClicked",cellRightClicked:"cellRightClicked"},decls:3,vars:8,consts:[[4,"ngFor","ngForOf"],["class","d-none",3,"src",4,"ngFor","ngForOf"],["class","matrix-cell",3,"revealed","empty","darker","click","contextmenu",4,"ngFor","ngForOf"],[1,"matrix-cell",3,"click","contextmenu"],[4,"ngIf"],["src","assets/minesweeper/bomb.png","class","h-90 cell-image animate__animated animate__bounceIn",4,"ngIf"],[3,"class",4,"ngIf"],["src","assets/minesweeper/bomb.png",1,"h-90","cell-image","animate__animated","animate__bounceIn"],["src","assets/minesweeper/red_flag.png","class","cell-image",4,"ngIf"],["src","assets/minesweeper/question_mark.png","class","cell-image h-75",4,"ngIf"],["src","assets/minesweeper/red_flag.png",1,"cell-image"],["src","assets/minesweeper/question_mark.png",1,"cell-image","h-75"],[1,"d-none",3,"src"]],template:function(a,u){1&a&&(o.TgZ(0,"div"),o.YNc(1,Ve,2,1,"ng-container",0),o.qZA(),o.YNc(2,et,1,1,"img",1)),2&a&&(o.Gre("matrix-container matrix-sized-",u.currentConfig.size,""),o.Udp("grid-template-columns","repeat("+u.currentConfig.size+",calc(min(750px, 90vw) / "+u.currentConfig.size+"))"),o.xp6(1),o.Q6J("ngForOf",u.matrix),o.xp6(1),o.Q6J("ngForOf",o.DdM(7,tt)))},dependencies:[j.sg,j.O5],styles:['.matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;justify-content:center;font-weight:bolder}.matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:2rem}.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}@media (max-width: 992px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:7px}}@media (max-width: 768px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]:hover{background-color:currentColor}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0;filter:brightness(.92)}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.darker[_ngcontent-%COMP%]{filter:brightness(.96)}.cell-image[_ngcontent-%COMP%]{position:absolute;object-fit:scale-down;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),t})();function Ne(t,s){1&t&&(o.TgZ(0,"div",13)(1,"h1",14),o._uU(2,"You win!"),o.qZA()())}function ye(t,s){1&t&&(o.TgZ(0,"div",13)(1,"h1",15),o._uU(2,"You Loose!"),o.qZA()())}let Ue=(()=>{class t{constructor(a,u,l){this.game=a,this.route=u,this.router=l,this.allDifficulties=[...he],this.usedFlags=0,this.selectedDifficulty="easy",this.nextDifficulty=this.selectedDifficulty,this.gameConfig=this.game.gameConfig.easy,this.matrix=new re(this.gameConfig)}ngOnInit(){this.route.params.subscribe(a=>{he.includes(a.difficulty)?this.initializeGame(a.difficulty):this.initializeGame(he[1])})}initializeGame(a){a!=this.selectedDifficulty&&this.router.navigate(["minesweeper","offline",a]),this.selectedDifficulty=a,this.nextDifficulty=a,this.gameConfig=this.game.gameConfig[a],this.matrix=new re(this.gameConfig)}onCellClicked(a){this.matrix.reveal(a)}onCellRightClicked(a){this.matrix.toggleCellState(a),this.usedFlags=this.matrix.getUsedFlags()}}return t.\u0275fac=function(a){return new(a||t)(o.Y36(ie),o.Y36(ee.gz),o.Y36(ee.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-offline"]],decls:22,vars:18,consts:[[1,"offline-game-container","py-4","w-100"],[1,"game",3,"matrix","currentConfig","cellClicked","cellRightClicked"],[1,"side-panel"],[1,"flags-used","d-flex","mx-2"],["src","assets/minesweeper/red_flag.png","alt","flags-used","width","30px","height","30px"],[1,"mx-2"],[1,"d-flex"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Restart",1,"p-button","ml-2",3,"click"],[1,"mt-1","animate__animated","animate__faster",2,"color","var(--yellow)"],[3,"ngSwitch"],[1,""],["class","animate__animated animate__bounceIn",4,"ngSwitchCase"],[1,"animate__animated","animate__bounceIn"],[2,"color","var(--green)"],[2,"color","var(--red)"]],template:function(a,u){1&a&&(o.TgZ(0,"div",0)(1,"minesweeper-game-matrix",1),o.NdJ("cellClicked",function(d){return u.onCellClicked(d)})("cellRightClicked",function(d){return u.onCellRightClicked(d)}),o.qZA(),o.TgZ(2,"div",2)(3,"div",3),o._UZ(4,"img",4),o.TgZ(5,"h3"),o._uU(6),o.qZA()(),o.TgZ(7,"h3",5),o._uU(8," Difficulty: "),o.TgZ(9,"span"),o._uU(10),o.ALo(11,"titlecase"),o.qZA()(),o.TgZ(12,"div",5)(13,"div",6)(14,"p-selectButton",7),o.NdJ("ngModelChange",function(d){return u.nextDifficulty=d}),o.qZA(),o.TgZ(15,"button",8),o.NdJ("click",function(){return u.initializeGame(u.nextDifficulty)}),o.qZA()(),o.TgZ(16,"div",9),o._uU(17," Click restart to change difficulty "),o.qZA()(),o.ynx(18,10),o.TgZ(19,"div",11),o.YNc(20,Ne,3,0,"div",12),o.YNc(21,ye,3,0,"div",12),o.qZA(),o.BQk(),o.qZA()()),2&a&&(o.xp6(1),o.Q6J("matrix",u.matrix)("currentConfig",u.gameConfig),o.xp6(5),o.hij(": ",u.gameConfig.bombs-u.usedFlags,""),o.xp6(3),o.Gre("difficulty-color-",u.selectedDifficulty,""),o.xp6(1),o.Oqu(o.lcZ(11,16,u.selectedDifficulty)),o.xp6(4),o.Q6J("options",u.allDifficulties)("ngModel",u.nextDifficulty),o.xp6(2),o.ekj("animate__fadeIn",u.nextDifficulty!==u.selectedDifficulty)("animate__fadeOut",u.nextDifficulty==u.selectedDifficulty),o.xp6(2),o.Q6J("ngSwitch",u.matrix.status),o.xp6(2),o.Q6J("ngSwitchCase","win"),o.xp6(1),o.Q6J("ngSwitchCase","game over"))},dependencies:[j.RF,j.n9,X.JJ,X.On,_e.Hq,Pe.UN,ke,j.rS],styles:[".offline-game-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:center}.side-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:50px;min-width:350px;flex-grow:0}@media (max-width: 1200px){.side-panel[_ngcontent-%COMP%]{flex-direction:row;min-width:none;justify-content:space-evenly;align-items:center;flex-wrap:wrap;padding:0;width:100%}}"]}),t})();var nt=C(4247),it=C(8625);function rt(t,s){1&t&&o.GkF(0)}function ot(t,s){1&t&&o.GkF(0)}function le(t,s){if(1&t){const a=o.EpF();o.TgZ(0,"div",5)(1,"minesweeper-game-matrix",6),o.NdJ("cellClicked",function(l){const g=o.CHM(a).matrix;return o.KtG(g.reveal(l))}),o.qZA()()}if(2&t){const a=s.matrix,u=o.oxw();o.xp6(1),o.Q6J("matrix",a)("currentConfig",u.currentConfig)}}function st(t,s){1&t&&(o._uU(0),o.ALo(1,"titlecase")),2&t&&o.hij(" ",o.lcZ(1,1,s.$implicit)," ")}function at(t,s){if(1&t){const a=o.EpF();o.TgZ(0,"div",18)(1,"p-password",19),o.NdJ("ngModelChange",function(l){o.CHM(a);const d=o.oxw(2);return o.KtG(d.roomPassword=l)}),o.qZA()()}if(2&t){const a=o.oxw(2);o.xp6(1),o.Q6J("ngModel",a.roomPassword)("feedback",!1)("toggleMask",!0)}}const K=function(){return["Multiplayer","Offline"]};function Fe(t,s){if(1&t){const a=o.EpF();o.TgZ(0,"div",7)(1,"div",8)(2,"p-selectButton",9),o.NdJ("ngModelChange",function(l){o.CHM(a);const d=o.oxw();return o.KtG(d.selectedDifficulty=l)})("onChange",function(){o.CHM(a);const l=o.oxw();return o.KtG(l.difficultyChange())}),o.YNc(3,st,2,3,"ng-template"),o.qZA()(),o.TgZ(4,"div",10)(5,"div",11)(6,"h3",12),o._uU(7," Configuration: "),o.TgZ(8,"span",13),o._uU(9),o.ALo(10,"titlecase"),o.qZA()()(),o.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),o._uU(15," Size: "),o.TgZ(16,"span"),o._uU(17),o.qZA()()(),o.TgZ(18,"li")(19,"h4"),o._uU(20," Cells: "),o.TgZ(21,"span"),o._uU(22),o.qZA()()(),o.TgZ(23,"li")(24,"h4"),o._uU(25," Bombs: "),o.TgZ(26,"span"),o._uU(27),o.qZA()()()(),o.TgZ(28,"div",14)(29,"p-selectButton",15),o.NdJ("ngModelChange",function(l){o.CHM(a);const d=o.oxw();return o.KtG(d.networkGamemode=l)}),o.qZA()(),o.YNc(30,at,2,3,"div",16),o.qZA(),o.TgZ(31,"div",8)(32,"button",17),o.NdJ("click",function(){o.CHM(a);const l=o.oxw();return o.KtG(l.onPlayButton())}),o.qZA()()()()}if(2&t){const a=o.oxw();o.xp6(2),o.Q6J("options",a.difficultyOptions)("ngModel",a.selectedDifficulty),o.xp6(7),o.Oqu(o.lcZ(10,19,a.selectedDifficulty)),o.xp6(7),o.Gre("difficulty-color-",a.selectedDifficulty,""),o.xp6(1),o.AsE("",a.currentConfig.size," x ",a.currentConfig.size,""),o.xp6(4),o.Gre("difficulty-color-",a.selectedDifficulty,""),o.xp6(1),o.Oqu(a.currentConfig.size*a.currentConfig.size),o.xp6(4),o.Gre("difficulty-color-",a.selectedDifficulty,""),o.xp6(1),o.Oqu(a.currentConfig.bombs),o.xp6(2),o.Q6J("options",o.DdM(21,K))("ngModel",a.networkGamemode),o.xp6(1),o.Q6J("ngIf","Multiplayer"==a.networkGamemode)}}const xe=function(t){return{matrix:t}};let we=(()=>{class t{constructor(a,u){this.game=a,this.router=u,this.selectedDifficulty="easy",this.difficultyOptions=[...he],this.networkGamemode="Offline",this.roomPassword="",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new re(this.currentConfig),this.userMatrix.forEach(a=>a.forEach(u=>{u.bomb&&(u.revealed=!0)}))}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}onPlayButton(){"Offline"==this.networkGamemode?this.router.navigate(["minesweeper","offline",this.selectedDifficulty]):this.game.createRoom({password:this.roomPassword}).subscribe(a=>{console.log(a)})}}return t.\u0275fac=function(a){return new(a||t)(o.Y36(ie),o.Y36(ee.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-difficulty-selector"]],decls:7,vars:5,consts:[[1,"main-double-board","py-5"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["optionMenuTemplate",""],[1,"matrix-container"],[3,"matrix","currentConfig","cellClicked"],[1,"option-menu-container"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"config-manager"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-center"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["class","d-flex",4,"ngIf"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg",3,"click"],[1,"d-flex"],["placeholder","Password for private rooms only","styleClass","password-room-creation w-100",1,"w-100","mt-3","animate__animated","animate__bounceIn","animate__faster",3,"ngModel","feedback","toggleMask","ngModelChange"]],template:function(a,u){if(1&a&&(o.TgZ(0,"div",0),o.YNc(1,rt,1,0,"ng-container",1),o.YNc(2,ot,1,0,"ng-container",2),o.qZA(),o.YNc(3,le,2,2,"ng-template",null,3,o.W1O),o.YNc(5,Fe,33,22,"ng-template",null,4,o.W1O)),2&a){const l=o.MAs(4),d=o.MAs(6);o.xp6(1),o.Q6J("ngTemplateOutlet",l)("ngTemplateOutletContext",o.VKq(3,xe,u.userMatrix)),o.xp6(1),o.Q6J("ngTemplateOutlet",d)}},dependencies:[j.O5,j.tP,X.JJ,X.On,_e.Hq,nt.Z,it.ro,Pe.UN,ke,j.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;flex-wrap:wrap-reverse}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.matrix-container[_ngcontent-%COMP%]{min-width:700px;margin-right:50px}.option-menu-container[_ngcontent-%COMP%]{min-width:500px}@media (max-width: 768px){.matrix-container[_ngcontent-%COMP%]{min-width:100%;margin-right:0}.option-menu-container[_ngcontent-%COMP%]{min-width:100%}}[_nghost-%COMP%]     .password-room-creation{width:100%}[_nghost-%COMP%]     .password-room-creation input{width:100%}"]}),t})();var ct=C(805),ft=C(8271),ut=C(5722),Ce=C(1383);function Le(t,s){if(1&t&&(o.TgZ(0,"div",12)(1,"p",12),o._uU(2),o.ALo(3,"titlecase"),o.qZA()()),2&t){const a=s.$implicit,u=s.index,l=o.oxw(2);o.xp6(2),o.AsE(" ",o.lcZ(3,2,a.difficulty),"",u==l.selectedDificulties.length-1?".":", "," ")}}function Ae(t,s){1&t&&(o.TgZ(0,"div"),o._uU(1," Select a difficulty. "),o.qZA())}function ht(t,s){if(1&t&&(o.YNc(0,Le,4,4,"div",10),o.YNc(1,Ae,2,0,"div",11)),2&t){const a=o.oxw();o.Q6J("ngForOf",a.selectedDificulties),o.xp6(1),o.Q6J("ngIf",0===a.selectedDificulties.length)}}function lt(t,s){1&t&&(o._uU(0),o.ALo(1,"titlecase")),2&t&&o.hij(" ",o.lcZ(1,1,s.$implicit.difficulty)," ")}function dt(t,s){if(1&t){const a=o.EpF();o.TgZ(0,"div",13)(1,"p-toolbar",14)(2,"div",15),o._UZ(3,"p-avatar",16),o.TgZ(4,"div",17)(5,"span",18),o._uU(6,"Creator: "),o.TgZ(7,"p",19),o._uU(8),o.qZA()(),o.TgZ(9,"span",18),o._uU(10,"Players: "),o.TgZ(11,"p",19),o._uU(12),o.qZA()()()(),o.TgZ(13,"div",20)(14,"button",21),o.NdJ("click",function(){o.CHM(a);const l=o.oxw();return o.KtG(l.getRooms())}),o.qZA()()()()}if(2&t){const a=s.$implicit;o.xp6(3),o.Q6J("image",(null==a.metadata||null==a.metadata.creator?null:a.metadata.creator.picture)||""),o.xp6(5),o.Oqu(a.metadata.creator.given_name),o.xp6(4),o.AsE("",a.clients,"/",a.maxClients||"x","")}}const gt=[{path:"",children:[{path:"",component:(()=>{class t{constructor(a,u){this.auth=a,this.game=u,this.sortMenuItems=[{label:"File",items:[{label:"New",icon:"pi pi-fw pi-plus"},{label:"Download",icon:"pi pi-fw pi-download"}]},{label:"Edit",items:[{label:"Add User",icon:"pi pi-fw pi-user-plus"},{label:"Remove User",icon:"pi pi-fw pi-user-minus"}]}],this.dificulties=[],this.selectedDificulties=[],this.filteredRooms=[],this.loading=!0,this.dificulties=Object.entries(this.game.gameConfig).map(([l,d])=>({difficulty:l,config:d})),this.selectedDificulties=this.dificulties}ngOnInit(){this.getRooms()}getRooms(){this.game.getAvailableRooms().subscribe(a=>{this.filteredRooms=a,this.loading=!1})}onDifficultyChange(){console.log("difficulties",this.selectedDificulties)}}return t.\u0275fac=function(a){return new(a||t)(o.Y36(Se.e8),o.Y36(ie))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-lobby"]],decls:13,vars:6,consts:[[1,"d-flex","align-items-center","flex-wrap","py-2",2,"background-color","var(--primary)"],["src","assets/minesweeper/bomb.png","alt","minesweeper bomb","height","45px",1,"ml-2"],[1,"m-1"],["optionLabel","difficulty","placeholder","Select a difficulty.",3,"ngModel","options","maxSelectedLabels","filter","showHeader","onChange","ngModelChange"],["pTemplate","selectedItems"],["pTemplate","item"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Refresh",1,"p-button-warning",3,"click"],["pButton","","type","button",1,"p-button-raised","p-button-primary"],[1,"container","pb-2"],["class","room",4,"ngFor","ngForOf"],["class","d-inline",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-inline"],[1,"room"],["styleClass","m-2 p-2 room-toolbar"],[1,"p-toolbar-group-left"],["size","large","shape","circle",3,"image"],[1,"d-flex","flex-column"],[1,"m-0","ml-2"],[1,"d-inline","text-primary"],[1,"p-toolbar-group-right"],["pButton","","type","button","icon","pi pi-arrow-up","iconPos","left","label","Join",1,"p-button-primary","p-button-sm",3,"click"]],template:function(a,u){1&a&&(o.TgZ(0,"div",0),o._UZ(1,"img",1),o.TgZ(2,"div",2)(3,"p-multiSelect",3),o.NdJ("onChange",function(){return u.onDifficultyChange()})("ngModelChange",function(d){return u.selectedDificulties=d}),o.YNc(4,ht,2,2,"ng-template",4),o.YNc(5,lt,2,3,"ng-template",5),o.qZA()(),o.TgZ(6,"div",2)(7,"button",6),o.NdJ("click",function(){return u.getRooms()}),o.qZA()(),o.TgZ(8,"div",2)(9,"button",7),o._uU(10," Create room "),o.qZA()()(),o.TgZ(11,"div",8),o.YNc(12,dt,15,4,"div",9),o.qZA()),2&a&&(o.xp6(3),o.Q6J("ngModel",u.selectedDificulties)("options",u.dificulties)("maxSelectedLabels",0)("filter",!1)("showHeader",!1),o.xp6(9),o.Q6J("ngForOf",u.filteredRooms))},dependencies:[j.sg,j.O5,X.JJ,X.On,_e.Hq,ct.jx,ft.q,ut.NU,Ce.o,j.rS],styles:[".room[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]     .room-toolbar:hover{background-color:var(--cyan-900);transition:background-color .2s ease}"]}),t})()},{path:"create",component:we},{path:"offline/:difficulty",component:Ue},{path:"offline",redirectTo:"offline/medium"}]}];let c=(()=>{class t{}return t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[ee.Bz.forChild(gt),ee.Bz]}),t})(),f=(()=>{class t{}return t.\u0275fac=function(a){return new(a||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[j.ez,c,ne.m]}),t})()},5755:function(Bt,Ie){!function(C){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(c){return null!==c&&"object"==typeof c&&c.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ne=function(c,f){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a])})(c,f)};function j(c,f){if("function"!=typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function t(){this.constructor=c}ne(c,f),c.prototype=null===f?Object.create(f):(t.prototype=f.prototype,new t)}function P(c,f,t,s){return new(t||(t=Promise))(function(u,l){function d(I){try{m(s.next(I))}catch(D){l(D)}}function g(I){try{m(s.throw(I))}catch(D){l(D)}}function m(I){I.done?u(I.value):function a(u){return u instanceof t?u:new t(function(l){l(u)})}(I.value).then(d,g)}m((s=s.apply(c,f||[])).next())})}function k(c,f){var s,a,u,l,t={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return l={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function d(m){return function(I){return function g(m){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,a&&(u=2&m[0]?a.return:m[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,m[1])).done)return u;switch(a=0,u&&(m=[2&m[0],u.value]),m[0]){case 0:case 1:u=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,a=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(!(u=(u=t.trys).length>0&&u[u.length-1])&&(6===m[0]||2===m[0])){t=0;continue}if(3===m[0]&&(!u||m[1]>u[0]&&m[1]<u[3])){t.label=m[1];break}if(6===m[0]&&t.label<u[1]){t.label=u[1],u=m;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(m);break}u[2]&&t.ops.pop(),t.trys.pop();continue}m=f.call(c,t)}catch(I){m=[6,I],a=0}finally{s=u=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,I])}}}function ge(c,f){f.headers=c.headers||{},f.statusMessage=c.statusText,f.statusCode=c.status,f.data=c.response}function Y(c,f,t){return new Promise(function(s,a){t=t||{};var l,d,g,u=new XMLHttpRequest,m=t.body,I=t.headers||{};for(l in t.timeout&&(u.timeout=t.timeout),u.ontimeout=u.onerror=function(D){D.timeout="timeout"==D.type,a(D)},u.open(c,f.href||f),u.onload=function(){for(g=u.getAllResponseHeaders().trim().split(/[\r\n]+/),ge(u,u);d=g.shift();)d=d.split(": "),u.headers[d.shift().toLowerCase()]=d.join(": ");if((d=u.headers["content-type"])&&~d.indexOf("application/json"))try{u.data=JSON.parse(u.data,t.reviver)}catch(D){return ge(u,D),a(D)}(u.status>=400?a:s)(u)},typeof FormData<"u"&&m instanceof FormData||m&&"object"==typeof m&&(I["content-type"]="application/json",m=JSON.stringify(m)),u.withCredentials=!!t.withCredentials,I)u.setRequestHeader(l,I[l]);u.send(m)})}var Re=Y.bind(Y,"GET"),Ge=Y.bind(Y,"POST"),o=Y.bind(Y,"PATCH"),ie=Y.bind(Y,"DELETE"),me=Re,De=o,ve=Ge,re=Y.bind(Y,"PUT"),ee=Y,X={del:ie,get:me,patch:De,post:ve,put:re,send:ee},_e=Object.freeze(Object.assign(Object.create(null),X,{default:X,del:ie,get:me,patch:De,post:ve,put:re,send:ee})),Pe=function(c){function f(t,s){var a=c.call(this,s)||this;return a.name="ServerError",a.code=t,a}return j(f,c),f}(Error);function te(c,f){if(this._offset=f,c instanceof ArrayBuffer)this._buffer=c,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(c))throw new Error("Invalid argument");this._buffer=c.buffer,this._view=new DataView(this._buffer,c.byteOffset,c.byteLength)}}function Ke(c,f,t){for(var s=0,a=0,u=t.length;a<u;a++)(s=t.charCodeAt(a))<128?c.setUint8(f++,s):s<2048?(c.setUint8(f++,192|s>>6),c.setUint8(f++,128|63&s)):s<55296||s>=57344?(c.setUint8(f++,224|s>>12),c.setUint8(f++,128|s>>6&63),c.setUint8(f++,128|63&s)):(a++,s=65536+((1023&s)<<10|1023&t.charCodeAt(a)),c.setUint8(f++,240|s>>18),c.setUint8(f++,128|s>>12&63),c.setUint8(f++,128|s>>6&63),c.setUint8(f++,128|63&s))}function oe(c,f,t){var s=typeof t,a=0,u=0,l=0,d=0,g=0,m=0;if("string"===s){if((g=function We(c){for(var f=0,t=0,s=0,a=c.length;s<a;s++)(f=c.charCodeAt(s))<128?t+=1:f<2048?t+=2:f<55296||f>=57344?t+=3:(s++,t+=4);return t}(t))<32)c.push(160|g),m=1;else if(g<256)c.push(217,g),m=2;else if(g<65536)c.push(218,g>>8,g),m=3;else{if(!(g<4294967296))throw new Error("String too long");c.push(219,g>>24,g>>16,g>>8,g),m=5}return f.push({_str:t,_length:g,_offset:c.length}),m+g}if("number"===s)return Math.floor(t)===t&&isFinite(t)?t>=0?t<128?(c.push(t),1):t<256?(c.push(204,t),2):t<65536?(c.push(205,t>>8,t),3):t<4294967296?(c.push(206,t>>24,t>>16,t>>8,t),5):(l=t/Math.pow(2,32)>>0,c.push(207,l>>24,l>>16,l>>8,l,(d=t>>>0)>>24,d>>16,d>>8,d),9):t>=-32?(c.push(t),1):t>=-128?(c.push(208,t),2):t>=-32768?(c.push(209,t>>8,t),3):t>=-2147483648?(c.push(210,t>>24,t>>16,t>>8,t),5):(l=Math.floor(t/Math.pow(2,32)),c.push(211,l>>24,l>>16,l>>8,l,(d=t>>>0)>>24,d>>16,d>>8,d),9):(c.push(203),f.push({_float:t,_length:8,_offset:c.length}),9);if("object"===s){if(null===t)return c.push(192),1;if(Array.isArray(t)){if((g=t.length)<16)c.push(144|g),m=1;else if(g<65536)c.push(220,g>>8,g),m=3;else{if(!(g<4294967296))throw new Error("Array too large");c.push(221,g>>24,g>>16,g>>8,g),m=5}for(a=0;a<g;a++)m+=oe(c,f,t[a]);return m}if(t instanceof Date){var I=t.getTime();return l=Math.floor(I/Math.pow(2,32)),c.push(215,0,l>>24,l>>16,l>>8,l,(d=I>>>0)>>24,d>>16,d>>8,d),10}if(t instanceof ArrayBuffer){if((g=t.byteLength)<256)c.push(196,g),m=2;else if(g<65536)c.push(197,g>>8,g),m=3;else{if(!(g<4294967296))throw new Error("Buffer too large");c.push(198,g>>24,g>>16,g>>8,g),m=5}return f.push({_bin:t,_length:g,_offset:c.length}),m+g}if("function"==typeof t.toJSON)return oe(c,f,t.toJSON());var D=[],N="",H=Object.keys(t);for(a=0,u=H.length;a<u;a++)"function"!=typeof t[N=H[a]]&&D.push(N);if((g=D.length)<16)c.push(128|g),m=1;else if(g<65536)c.push(222,g>>8,g),m=3;else{if(!(g<4294967296))throw new Error("Object too large");c.push(223,g>>24,g>>16,g>>8,g),m=5}for(a=0;a<g;a++)m+=oe(c,f,N=D[a]),m+=oe(c,f,t[N]);return m}if("boolean"===s)return c.push(t?195:194),1;if("undefined"===s)return c.push(212,0,0),3;throw new Error("Could not encode")}function Xe(c){var f=[],t=[],s=oe(f,t,c),a=new ArrayBuffer(s),u=new DataView(a),l=0,d=0,g=-1;t.length>0&&(g=t[0]._offset);for(var m,I=0,D=0,N=0,H=f.length;N<H;N++)if(u.setUint8(d+N,f[N]),N+1===g){if(I=(m=t[l])._length,D=d+g,m._bin)for(var ze=new Uint8Array(m._bin),J=0;J<I;J++)u.setUint8(D+J,ze[J]);else m._str?Ke(u,D,m._str):void 0!==m._float&&u.setFloat64(D,m._float);d+=I,t[++l]&&(g=t[l]._offset)}return a}te.prototype._array=function(c){for(var f=new Array(c),t=0;t<c;t++)f[t]=this._parse();return f},te.prototype._map=function(c){for(var t={},s=0;s<c;s++)t[this._parse()]=this._parse();return t},te.prototype._str=function(c){var f=function Ye(c,f,t){for(var s="",a=0,u=f,l=f+t;u<l;u++){var d=c.getUint8(u);if(0!=(128&d))if(192!=(224&d))if(224!=(240&d)){if(240!=(248&d))throw new Error("Invalid byte "+d.toString(16));(a=(7&d)<<18|(63&c.getUint8(++u))<<12|(63&c.getUint8(++u))<<6|(63&c.getUint8(++u))<<0)>=65536?(a-=65536,s+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):s+=String.fromCharCode(a)}else s+=String.fromCharCode((15&d)<<12|(63&c.getUint8(++u))<<6|(63&c.getUint8(++u))<<0);else s+=String.fromCharCode((31&d)<<6|63&c.getUint8(++u));else s+=String.fromCharCode(d)}return s}(this._view,this._offset,c);return this._offset+=c,f},te.prototype._bin=function(c){var f=this._buffer.slice(this._offset,this._offset+c);return this._offset+=c,f},te.prototype._parse=function(){var f,c=this._view.getUint8(this._offset++),t=0,s=0,a=0,u=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return t=this._view.getUint8(this._offset),this._offset+=1,this._bin(t);case 197:return t=this._view.getUint16(this._offset),this._offset+=2,this._bin(t);case 198:return t=this._view.getUint32(this._offset),this._offset+=4,this._bin(t);case 199:return t=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,[s,this._bin(t)];case 200:return t=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(t)];case 201:return t=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(t)];case 202:return f=this._view.getFloat32(this._offset),this._offset+=4,f;case 203:return f=this._view.getFloat64(this._offset),this._offset+=8,f;case 204:return f=this._view.getUint8(this._offset),this._offset+=1,f;case 205:return f=this._view.getUint16(this._offset),this._offset+=2,f;case 206:return f=this._view.getUint32(this._offset),this._offset+=4,f;case 207:return a=this._view.getUint32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,a+u;case 208:return f=this._view.getInt8(this._offset),this._offset+=1,f;case 209:return f=this._view.getInt16(this._offset),this._offset+=2,f;case 210:return f=this._view.getInt32(this._offset),this._offset+=4,f;case 211:return a=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,a+u;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(a=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(a+u)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return t=this._view.getUint8(this._offset),this._offset+=1,this._str(t);case 218:return t=this._view.getUint16(this._offset),this._offset+=2,this._str(t);case 219:return t=this._view.getUint32(this._offset),this._offset+=4,this._str(t);case 220:return t=this._view.getUint16(this._offset),this._offset+=2,this._array(t);case 221:return t=this._view.getUint32(this._offset),this._offset+=4,this._array(t);case 222:return t=this._view.getUint16(this._offset),this._offset+=2,this._map(t);case 223:return t=this._view.getUint32(this._offset),this._offset+=4,this._map(t)}throw new Error("Could not parse")};var c,et=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},tt=function(){function c(f){this.events=f}return c.prototype.send=function(f){f instanceof ArrayBuffer?this.ws.send(f):Array.isArray(f)&&this.ws.send(new Uint8Array(f).buffer)},c.prototype.connect=function(f){this.ws=new et(f,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},c.prototype.close=function(f,t){this.ws.close(f,t)},c}(),ke=function(){function c(){this.events={},this.transport=new tt(this.events)}return c.prototype.send=function(f){this.transport.send(f)},c.prototype.connect=function(f){this.transport.connect(f)},c.prototype.close=function(f,t){this.transport.close(f,t)},c}(),Ne={};function ye(c,f){Ne[c]=f}function Ue(c){var f=Ne[c];if(!f)throw new Error("missing serializer: "+c);return f}C.Protocol=void 0,(c=C.Protocol||(C.Protocol={}))[c.HANDSHAKE=9]="HANDSHAKE",c[c.JOIN_ROOM=10]="JOIN_ROOM",c[c.ERROR=11]="ERROR",c[c.LEAVE_ROOM=12]="LEAVE_ROOM",c[c.ROOM_DATA=13]="ROOM_DATA",c[c.ROOM_STATE=14]="ROOM_STATE",c[c.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",c[c.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",C.ErrorCode=void 0,function(c){c[c.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",c[c.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",c[c.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",c[c.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",c[c.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",c[c.AUTH_FAILED=4215]="AUTH_FAILED",c[c.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(C.ErrorCode||(C.ErrorCode={}));let rt=()=>({events:{},emit(c,...f){(this.events[c]||[]).forEach(t=>t(...f))},on(c,f){return(this.events[c]=this.events[c]||[]).push(f),()=>this.events[c]=(this.events[c]||[]).filter(t=>t!==f)}});var ot=function(){function c(){this.handlers=[]}return c.prototype.register=function(f,t){return this.handlers.push(f),this},c.prototype.invoke=function(){for(var f=this,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];this.handlers.forEach(function(a){return a.apply(f,t)})},c.prototype.invokeAsync=function(){for(var f=this,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return Promise.all(this.handlers.map(function(a){return a.apply(f,t)}))},c.prototype.remove=function(f){var t=this.handlers.indexOf(f);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},c.prototype.clear=function(){this.handlers=[]},c}();function le(){var c=new ot;function f(t){return c.register(t,null===this)}return f.once=function(t){var s=function(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];t.apply(this,a),c.remove(s)};c.register(s)},f.remove=function(t){return c.remove(t)},f.invoke=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return c.invoke.apply(c,t)},f.invokeAsync=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return c.invokeAsync.apply(c,t)},f.clear=function(){return c.clear()},f}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var xe,K=function at(c){var f={exports:{}};return c(f,f.exports),f.exports}(function(c,f){var s;s=function(t){var s=function(n,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&(i[h]=r[h])})(n,e)};function a(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=n}s(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function u(n,e,i,r){var x,h=arguments.length,p=h<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(n,e,i,r);else for(var v=n.length-1;v>=0;v--)(x=n[v])&&(p=(h<3?x(p):h>3?x(e,i,p):x(e,i))||p);return h>3&&p&&Object.defineProperty(e,i,p),p}function l(n,e){for(var i=0,r=e.length,h=n.length;i<r;i++,h++)n[h]=e[i];return n}var n,d=255;t.OPERATION=void 0,(n=t.OPERATION||(t.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var m=function(){function n(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return n.prototype.getNextUniqueId=function(){return this.nextUniqueId++},n.prototype.addRef=function(e,i,r){void 0===r&&(r=!0),this.refs.set(e,i),r&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},n.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},n.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},n.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(i){if(e.refCounts[i]<=0){var r=e.refs.get(i);if(r instanceof z)for(var h in r._definition.schema)"string"!=typeof r._definition.schema[h]&&r[h]&&r[h].$changes&&e.removeRef(r[h].$changes.refId);else{var p=r.$changes.parent._definition;"function"==typeof Object.values(p.schema[p.fieldsByIndex[r.$changes.parentIndex]])[0]&&Array.from(r.values()).forEach(function(v){return e.removeRef(v.$changes.refId)})}e.refs.delete(i),delete e.refCounts[i]}}),this.deletedRefs.clear()},n}(),I=function(){function n(e,i,r){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(i,r)}return n.prototype.setParent=function(e,i,r){var h=this;if(this.indexes||(this.indexes=this.ref instanceof z?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=r,i)if(this.root=i,this.ref instanceof z){var p=this.ref._definition;for(var x in p.schema){var v=this.ref[x];v&&v.$changes&&v.$changes.setParent(this.ref,i,p.indexes[x])}}else"object"==typeof this.ref&&this.ref.forEach(function(O,_){O instanceof z&&O.$changes.setParent(h.ref,h.root,h.ref.$changes.indexes[_])})},n.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},n.prototype.change=function(e,i){void 0===i&&(i=t.OPERATION.ADD);var r="number"==typeof e?e:this.indexes[e];this.assertValidIndex(r,e);var h=this.changes.get(r);(!h||h.op===t.OPERATION.DELETE||h.op===t.OPERATION.TOUCH)&&this.changes.set(r,{op:h&&h.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:i,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},n.prototype.touch=function(e){var i="number"==typeof e?e:this.indexes[e];this.assertValidIndex(i,e),this.changes.has(i)||this.changes.set(i,{op:t.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},n.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},n.prototype.getType=function(e){if(this.ref._definition)return(i=this.ref._definition).schema[i.fieldsByIndex[e]];var i=this.parent._definition;return Object.values(i.schema[i.fieldsByIndex[this.parentIndex]])[0]},n.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},n.prototype.getValue=function(e){return this.ref.getByIndex(e)},n.prototype.delete=function(e){var i="number"==typeof e?e:this.indexes[e];if(void 0!==i){var r=this.getValue(i);this.changes.set(i,{op:t.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+i+")")},n.prototype.discard=function(e,i){var r=this;void 0===e&&(e=!1),void 0===i&&(i=!1),this.ref instanceof z||this.changes.forEach(function(h){if(h.op===t.OPERATION.DELETE){var p=r.ref.getIndex(h.index);delete r.indexes[p]}}),this.changes.clear(),this.changed=e,i&&this.allChanges.clear(),this.currentCustomOperation=0},n.prototype.discardAll=function(){var e=this;this.changes.forEach(function(i){var r=e.getValue(i.index);r&&r.$changes&&r.$changes.discardAll()}),this.discard()},n.prototype.cache=function(e,i){this.caches[e]=i},n.prototype.clone=function(){return new n(this.ref,this.parent,this.root)},n.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},n.prototype.assertValidIndex=function(e,i){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+i+'"')},n}(),D=function(n,e){var i=n.toString(),r=e.toString();return i<r?-1:i>r?1:0};function N(n){return n.$proxy=!0,new Proxy(n,{get:function(e,i){return"symbol"==typeof i||isNaN(i)?e[i]:e.at(i)},set:function(e,i,r){if("symbol"==typeof i||isNaN(i))e[i]=r;else{var h=Array.from(e.$items.keys()),p=parseInt(h[i]||i);null==r?e.deleteAt(p):e.setAt(p,r)}return!0},deleteProperty:function(e,i){return"number"==typeof i?e.deleteAt(i):delete e[i],!0}})}var H=function(){function n(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.$changes=new I(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return n.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(n.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),n.prototype.push=function(){for(var e=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var h;return i.forEach(function(p){h=e.$refId++,e.setAt(h,p)}),h},n.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var i=this.$items.get(e);return this.$items.delete(e),i}},n.prototype.at=function(e){var i=Array.from(this.$items.keys())[e];return this.$items.get(i)},n.prototype.setAt=function(e,i){var r,h;void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,e);var p=null!==(h=null===(r=this.$changes.indexes[e])||void 0===r?void 0:r.op)&&void 0!==h?h:t.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,i),this.$changes.change(e,p)},n.prototype.deleteAt=function(e){var i=Array.from(this.$items.keys())[e];return void 0!==i&&this.$deleteAt(i)},n.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){i.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.concat=function(){for(var e,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return new(n.bind.apply(n,l([void 0],(e=Array.from(this.$items.values())).concat.apply(e,i))))},n.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},n.prototype.reverse=function(){var e=this,i=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(h,p){e.setAt(i[p],h)}),this},n.prototype.shift=function(){var i=Array.from(this.$items.keys()).shift();if(void 0!==i){var r=this.$items.get(i);return this.$deleteAt(i),r}},n.prototype.slice=function(e,i){return new(n.bind.apply(n,l([void 0],Array.from(this.$items.values()).slice(e,i))))},n.prototype.sort=function(e){var i=this;void 0===e&&(e=D);var r=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(p,x){i.setAt(r[x],p)}),this},n.prototype.splice=function(e,i){void 0===i&&(i=this.length-e);for(var r=[],h=2;h<arguments.length;h++)r[h-2]=arguments[h];for(var p=Array.from(this.$items.keys()),x=[],v=e;v<e+i;v++)x.push(this.$items.get(p[v])),this.$deleteAt(p[v]);return x},n.prototype.unshift=function(){for(var e=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var h=this.length,p=i.length,x=Array.from(this.$items.values());return i.forEach(function(v,M){e.setAt(M,v)}),x.forEach(function(v,M){e.setAt(p+M,v)}),h+p},n.prototype.indexOf=function(e,i){return Array.from(this.$items.values()).indexOf(e,i)},n.prototype.lastIndexOf=function(e,i){return void 0===i&&(i=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,i)},n.prototype.every=function(e,i){return Array.from(this.$items.values()).every(e,i)},n.prototype.some=function(e,i){return Array.from(this.$items.values()).some(e,i)},n.prototype.forEach=function(e,i){Array.from(this.$items.values()).forEach(e,i)},n.prototype.map=function(e,i){return Array.from(this.$items.values()).map(e,i)},n.prototype.filter=function(e,i){return Array.from(this.$items.values()).filter(e,i)},n.prototype.reduce=function(e,i){return Array.from(this.$items.values()).reduce(e,i)},n.prototype.reduceRight=function(e,i){return Array.from(this.$items.values()).reduceRight(e,i)},n.prototype.find=function(e,i){return Array.from(this.$items.values()).find(e,i)},n.prototype.findIndex=function(e,i){return Array.from(this.$items.values()).findIndex(e,i)},n.prototype.fill=function(e,i,r){throw new Error("ArraySchema#fill() not implemented")},n.prototype.copyWithin=function(e,i,r){throw new Error("ArraySchema#copyWithin() not implemented")},n.prototype.toString=function(){return this.$items.toString()},n.prototype.toLocaleString=function(){return this.$items.toLocaleString()},n.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},n.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},n.prototype.includes=function(e,i){return Array.from(this.$items.values()).includes(e,i)},n.prototype.flatMap=function(e,i){throw new Error("ArraySchema#flatMap() is not supported.")},n.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},n.prototype.clone=function(e){return e?new(n.bind.apply(n,l([void 0],Array.from(this.$items.values())))):new(n.bind.apply(n,l([void 0],this.map(function(r){return r.$changes?r.clone():r}))))},n.prototype.triggerAll=function(){z.prototype.triggerAll.apply(this)},n}();function ze(n){return n.$proxy=!0,new Proxy(n,{get:function(e,i){return"symbol"!=typeof i&&typeof e[i]>"u"?e.get(i):e[i]},set:function(e,i,r){return"symbol"!=typeof i&&-1===i.indexOf("$")&&"onAdd"!==i&&"onRemove"!==i&&"onChange"!==i?e.set(i,r):e[i]=r,!0},deleteProperty:function(e,i){return e.delete(i),!0}})}var J=function(){function n(e){var i=this;if(this.$changes=new I(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(h,p){return i.set(p,h)});else for(var r in e)this.set(r,e[r])}return n.is=function(e){return void 0!==e.map},n.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),n.prototype.set=function(e,i){if(null==i)throw new Error("MapSchema#set('"+e+"', "+i+"): trying to set "+i+" value on '"+e+"'.");var r=typeof this.$changes.indexes[e]<"u",h=r?this.$changes.indexes[e]:this.$refId++,p=r?t.OPERATION.REPLACE:t.OPERATION.ADD,x=void 0!==i.$changes;return x&&i.$changes.setParent(this,this.$changes.root,h),r?x&&this.$items.get(e)!==i&&(p=t.OPERATION.ADD):(this.$changes.indexes[e]=h,this.$indexes.set(h,e)),this.$items.set(e,i),this.$changes.change(e,p),this},n.prototype.get=function(e){return this.$items.get(e)},n.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){i.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){return this.$items.has(e)},n.prototype.forEach=function(e){this.$items.forEach(e)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toJSON=function(){var e={};return this.forEach(function(i,r){e[r]="function"==typeof i.toJSON?i.toJSON():i}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(r,h){i.set(h,r.$changes?r.clone():r)})),i},n.prototype.triggerAll=function(){z.prototype.triggerAll.apply(this)},n}(),Mt={};function Oe(n,e){Mt[n]=e}function Ze(n){return Mt[n]}var mt=function(){function n(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return n.create=function(e){var i=new n;return i.schema=Object.assign({},e&&e.schema||{}),i.indexes=Object.assign({},e&&e.indexes||{}),i.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),i.descriptors=Object.assign({},e&&e.descriptors||{}),i.deprecated=Object.assign({},e&&e.deprecated||{}),i},n.prototype.addField=function(e,i){var r=this.getNextFieldIndex();this.fieldsByIndex[r]=e,this.indexes[e]=r,this.schema[e]=Array.isArray(i)?{array:i[0]}:i},n.prototype.addFilter=function(e,i){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=i,this.indexesWithFilters.push(this.indexes[e]),!0},n.prototype.addChildrenFilter=function(e,i){var r=this.indexes[e];if(Ze(Object.keys(this.schema[e])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[r]=i,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},n.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},n.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},n}();var je=function(){function n(){this.types={},this.schemas=new Map,this.useFilters=!1}return n.prototype.has=function(e){return this.schemas.has(e)},n.prototype.get=function(e){return this.types[e]},n.prototype.add=function(e,i){void 0===i&&(i=this.schemas.size),e._definition=mt.create(e._definition),e._typeid=i,this.types[i]=e,this.schemas.set(e,i)},n.create=function(e){return void 0===e&&(e=new n),function(i){return Q(i,e)}},n}(),Tt=new je;function Q(n,e){return void 0===e&&(e=Tt),function(i,r){var h=i.constructor;h._context=e,e.has(h)||e.add(h);var p=h._definition;if(p.addField(r,n),p.descriptors[r]){if(p.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '"+r+"' definition on '"+h.name+"'.\nCheck @type() annotation")}catch(y){var x=y.stack.split("\n")[4].trim();throw new Error(y.message+" "+x)}}var v=H.is(n),M=!v&&J.is(n);if("string"!=typeof n&&!z.is(n)){var O=Object.values(n)[0];"string"!=typeof O&&!e.has(O)&&e.add(O)}var _="_"+r;p.descriptors[_]={enumerable:!1,configurable:!1,writable:!0},p.descriptors[r]={get:function(){return this[_]},set:function(y){y!==this[_]&&(null!=y?(v&&!(y instanceof H)&&(y=new(H.bind.apply(H,l([void 0],y)))),M&&!(y instanceof J)&&(y=new J(y)),void 0===y.$proxy&&(M?y=ze(y):v&&(y=N(y))),this.$changes.change(r),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this.$changes.delete(r),this[_]=y)},enumerable:!0,configurable:!0}}}function It(n,e,i){for(var r=0,h=0,p=i.length;h<p;h++)(r=i.charCodeAt(h))<128?n[e++]=r:r<2048?(n[e++]=192|r>>6,n[e++]=128|63&r):r<55296||r>=57344?(n[e++]=224|r>>12,n[e++]=128|r>>6&63,n[e++]=128|63&r):(h++,r=65536+((1023&r)<<10|1023&i.charCodeAt(h)),n[e++]=240|r>>18,n[e++]=128|r>>12&63,n[e++]=128|r>>6&63,n[e++]=128|63&r)}function Rt(n,e){n.push(255&e)}function B(n,e){n.push(255&e)}function St(n,e){n.push(255&e),n.push(e>>8&255)}function vt(n,e){n.push(255&e),n.push(e>>8&255)}function $e(n,e){n.push(255&e),n.push(e>>8&255),n.push(e>>16&255),n.push(e>>24&255)}function se(n,e){var i=e>>24,r=e>>16,h=e>>8;n.push(255&e),n.push(255&h),n.push(255&r),n.push(255&i)}function Dt(n,e){var i=Math.floor(e/Math.pow(2,32));se(n,e>>>0),se(n,i)}function Pt(n,e){var i=e/Math.pow(2,32)>>0;se(n,e>>>0),se(n,i)}var Ee=new Int32Array(2),Vt=new Float32Array(Ee.buffer),en=new Float64Array(Ee.buffer);function kt(n,e){Vt[0]=e,$e(n,Ee[0])}function _t(n,e){en[0]=e,$e(n,Ee[0]),$e(n,Ee[1])}function Je(n,e){e||(e="");var i=function Kt(n){for(var e=0,i=0,r=0,h=n.length;r<h;r++)(e=n.charCodeAt(r))<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(r++,i+=4);return i}(e),r=0;if(i<32)n.push(160|i),r=1;else if(i<256)n.push(217),B(n,i),r=2;else if(i<65536)n.push(218),vt(n,i),r=3;else{if(!(i<4294967296))throw new Error("String too long");n.push(219),se(n,i),r=5}return It(n,n.length,e),r+i}function q(n,e){return isNaN(e)?q(n,0):isFinite(e)?e!==(0|e)?(n.push(203),_t(n,e),9):e>=0?e<128?(B(n,e),1):e<256?(n.push(204),B(n,e),2):e<65536?(n.push(205),vt(n,e),3):e<4294967296?(n.push(206),se(n,e),5):(n.push(207),Pt(n,e),9):e>=-32?(n.push(224|e+32),1):e>=-128?(n.push(208),Rt(n,e),2):e>=-32768?(n.push(209),St(n,e),3):e>=-2147483648?(n.push(210),$e(n,e),5):(n.push(211),Dt(n,e),9):q(n,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var yt=Object.freeze({__proto__:null,utf8Write:It,int8:Rt,uint8:B,int16:St,uint16:vt,int32:$e,uint32:se,int64:Dt,uint64:Pt,float32:function Wt(n,e){kt(n,e)},float64:function Xt(n,e){_t(n,e)},writeFloat32:kt,writeFloat64:_t,boolean:function tn(n,e){return B(n,e?1:0)},string:Je,number:q});function Nt(n,e){return be(n,e)<<24>>24}function be(n,e){return n[e.offset++]}function Ut(n,e){return Be(n,e)<<16>>16}function Be(n,e){return n[e.offset++]|n[e.offset++]<<8}function ae(n,e){return n[e.offset++]|n[e.offset++]<<8|n[e.offset++]<<16|n[e.offset++]<<24}function de(n,e){return ae(n,e)>>>0}function Ft(n,e){var i=de(n,e);return ae(n,e)*Math.pow(2,32)+i}function Lt(n,e){var i=de(n,e);return de(n,e)*Math.pow(2,32)+i}var Me=new Int32Array(2),sn=new Float32Array(Me.buffer),an=new Float64Array(Me.buffer);function xt(n,e){return Me[0]=ae(n,e),sn[0]}function wt(n,e){return Me[0]=ae(n,e),Me[1]=ae(n,e),an[0]}function zt(n,e){var r,i=n[e.offset++];i<192?r=31&i:217===i?r=be(n,e):218===i?r=Be(n,e):219===i&&(r=de(n,e));var h=function nn(n,e,i){for(var r="",h=0,p=e,x=e+i;p<x;p++){var v=n[p];0!=(128&v)?192!=(224&v)?224!=(240&v)?240!=(248&v)?console.error("Invalid byte "+v.toString(16)):(h=(7&v)<<18|(63&n[++p])<<12|(63&n[++p])<<6|(63&n[++p])<<0)>=65536?(h-=65536,r+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):r+=String.fromCharCode(h):r+=String.fromCharCode((15&v)<<12|(63&n[++p])<<6|(63&n[++p])<<0):r+=String.fromCharCode((31&v)<<6|63&n[++p]):r+=String.fromCharCode(v)}return r}(n,e.offset,r);return e.offset+=r,h}function ce(n,e){var i=n[e.offset++];return i<128?i:202===i?xt(n,e):203===i?wt(n,e):204===i?be(n,e):205===i?Be(n,e):206===i?de(n,e):207===i?Lt(n,e):208===i?Nt(n,e):209===i?Ut(n,e):210===i?ae(n,e):211===i?Ft(n,e):i>223?-1*(255-i+1):void 0}function Zt(n,e){return n[e.offset-1]===d&&(n[e.offset]<128||n[e.offset]>=202&&n[e.offset]<=211)}var jt=Object.freeze({__proto__:null,int8:Nt,uint8:be,int16:Ut,uint16:Be,int32:ae,uint32:de,float32:function rn(n,e){return xt(n,e)},float64:function on(n,e){return wt(n,e)},int64:Ft,uint64:Lt,readFloat32:xt,readFloat64:wt,boolean:function cn(n,e){return be(n,e)>0},string:zt,stringCheck:function fn(n,e){var i=n[e.offset];return i<192&&i>160||217===i||218===i||219===i},number:ce,numberCheck:function un(n,e){var i=n[e.offset];return i<128||i>=202&&i<=211},arrayCheck:function hn(n,e){return n[e.offset]<160},switchStructureCheck:Zt}),Ct=function(){function n(e){var i=this;this.$changes=new I(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return i.add(r)})}return n.is=function(e){return void 0!==e.collection},n.prototype.add=function(e){var i=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,i),this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,e),this.$changes.change(i),i},n.prototype.at=function(e){var i=Array.from(this.$items.keys())[e];return this.$items.get(i)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(e){for(var r,h,i=this.$items.entries();(h=i.next())&&!h.done;)if(e===h.value[1]){r=h.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){i.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){return Array.from(this.$items.values()).some(function(i){return i===e})},n.prototype.forEach=function(e){var i=this;this.$items.forEach(function(r,h,p){return e(r,h,i)})},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var e=[];return this.forEach(function(i,r){e.push("function"==typeof i.toJSON?i.toJSON():i)}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(r){i.add(r.$changes?r.clone():r)})),i},n.prototype.triggerAll=function(){z.prototype.triggerAll.apply(this)},n}(),At=function(){function n(e){var i=this;this.$changes=new I(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return i.add(r)})}return n.is=function(e){return void 0!==e.set},n.prototype.add=function(e){var i,r;if(this.has(e))return!1;var h=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,h);var p=null!==(r=null===(i=this.$changes.indexes[h])||void 0===i?void 0:i.op)&&void 0!==r?r:t.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,e),this.$changes.change(h,p),h},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(e){for(var r,h,i=this.$items.entries();(h=i.next())&&!h.done;)if(e===h.value[1]){r=h.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){i.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){for(var h,i=this.$items.values(),r=!1;(h=i.next())&&!h.done;)if(e===h.value){r=!0;break}return r},n.prototype.forEach=function(e){var i=this;this.$items.forEach(function(r,h,p){return e(r,h,i)})},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var e=[];return this.forEach(function(i,r){e.push("function"==typeof i.toJSON?i.toJSON():i)}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(r){i.add(r.$changes?r.clone():r)})),i},n.prototype.triggerAll=function(){z.prototype.triggerAll.apply(this)},n}(),ln=function(){function n(){this.handlers=[]}return n.prototype.register=function(e,i){return this.handlers.push(e),this},n.prototype.invoke=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.handlers.forEach(function(r){return r.apply(void 0,e)})},n.prototype.invokeAsync=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return Promise.all(this.handlers.map(function(r){return r.apply(void 0,e)}))},n.prototype.remove=function(e){var i=this.handlers.indexOf(e);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()},n.prototype.clear=function(){this.handlers=[]},n}(),dn=function(){function n(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return n.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},n.get=function(e){return void 0===e.$filterState&&(e.$filterState=new n),e.$filterState},n}(),Ot=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return a(e,n),e}(Error);function Jt(n,e,i,r){if(!(n instanceof e))throw new Ot("a '"+e.name+"' was expected, but '"+n.constructor.name+"' was provided in "+i.constructor.name+"#"+r)}function gn(n,e,i,r,h){!function pn(n,e,i,r){var h,p=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(n)&&console.log('trying to encode "NaN" in '+i.constructor.name+"#"+r);break;case"string":h="string",p=!0;break;case"boolean":return}if(typeof n!==h&&(!p||p&&null!==n)){var x="'"+JSON.stringify(n)+"'"+(n&&n.constructor&&" ("+n.constructor.name+")"||"");throw new Ot("a '"+h+"' was expected, but "+x+" was provided in "+i.constructor.name+"#"+r)}}(i,n,r,h);var p=yt[n];if(!p)throw new Ot("a '"+n+"' was expected, but "+i+" was provided in "+r.constructor.name+"#"+h);p(e,i)}function mn(n,e,i){return jt[n](e,i)}var z=function(){function n(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];Object.defineProperties(this,{$changes:{value:new I(this,void 0,new m),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var r=this._definition.descriptors;r&&Object.defineProperties(this,r),e[0]&&this.assign(e[0])}return n.onError=function(e){console.error(e)},n.is=function(e){return e._definition&&void 0!==e._definition.schema},n.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(n.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),n.prototype.listen=function(e,i){var r=this;return this.$listeners[e]||(this.$listeners[e]=new ln),this.$listeners[e].register(i),function(){return r.$listeners[e].remove(i)}},n.prototype.decode=function(e,i,r,h){void 0===i&&(i={offset:0}),void 0===r&&(r=this),void 0===h&&(h=new Map);var p=this.$changes.root,x=e.length,v=0,M=[];for(p.refs.set(v,this),h.set(v,M);i.offset<x;){var O=e[i.offset++];if(O!=d){var y=r.$changes,S=void 0!==r._definition,b=S?O>>6<<6:O;if(b!==t.OPERATION.CLEAR){var A=S?O%(b||255):ce(e,i),E=S?r._definition.fieldsByIndex[A]:"",R=y.getType(A),w=void 0,T=void 0,Z=void 0;if(S?T=r["_"+E]:(T=r.getByIndex(A),(b&t.OPERATION.ADD)===t.OPERATION.ADD?(Z=r instanceof J?zt(e,i):A,r.setIndex(A,Z)):Z=r.getIndex(A)),(b&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(b!==t.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(A),T&&T.$changes&&p.removeRef(T.$changes.refId),w=null),void 0!==E){if(b!==t.OPERATION.DELETE)if(n.is(R)){var U=ce(e,i);if(w=p.refs.get(U),b!==t.OPERATION.REPLACE){var W=this.getSchemaType(e,i,R);w||((w=this.createTypeInstance(W)).$changes.refId=U,T&&(w.onChange=T.onChange,w.onRemove=T.onRemove,w.$listeners=T.$listeners,T.$changes.refId&&U!==T.$changes.refId&&p.removeRef(T.$changes.refId))),p.addRef(U,w,w!==T)}}else if("string"==typeof R)w=mn(R,e,i);else{var Te=Ze(Object.keys(R)[0]),G=ce(e,i),F=p.refs.has(G)?T||p.refs.get(G):new Te.constructor;if((w=F.clone(!0)).$changes.refId=G,T&&(w.onAdd=T.onAdd,w.onRemove=T.onRemove,w.onChange=T.onChange,T.$changes.refId&&G!==T.$changes.refId)){p.removeRef(T.$changes.refId);for(var L=[],bt=T.entries(),V=void 0;(V=bt.next())&&!V.done;){var He=V.value;L.push({op:t.OPERATION.DELETE,field:He[0],value:void 0,previousValue:He[1]})}h.set(T.$changes.refId,L)}p.addRef(G,w,F!==T),Te.getProxy&&(w=Te.getProxy(w))}var yn=T!==w;if(null!=w)if(w.$changes&&w.$changes.setParent(y.ref,y.root,A),r instanceof n)r[E]=w;else if(r instanceof J)r.$items.set(Z,w);else if(r instanceof H)r.setAt(A,w);else if(r instanceof Ct){var qe=r.add(w);r.setIndex(A,qe)}else r instanceof At&&!1!==(qe=r.add(w))&&r.setIndex(A,qe);yn&&M.push({op:b,field:E,dynamicIndex:Z,value:w,previousValue:T})}else{console.warn("@colyseus/schema: definition mismatch");for(var $={offset:i.offset};i.offset<x&&(!Zt(e,i)||($.offset=i.offset+1,!p.refs.has(ce(e,$))));)i.offset++}}else r.clear(!0)}else{v=ce(e,i);var _=p.refs.get(v);if(!_)throw new Error('"refId" not found: '+v);r=_,h.set(v,M=[])}}return this._triggerChanges(h),p.garbageCollectDeletedRefs(),h},n.prototype.encode=function(e,i,r){void 0===e&&(e=!1),void 0===i&&(i=[]),void 0===r&&(r=!1);for(var h=this.$changes,p=new WeakSet,x=[h],v=1,M=0;M<v;M++){var O=x[M],_=O.ref,y=_ instanceof n;O.ensureRefId(),p.add(O),O!==h&&(O.changed||e)&&(B(i,d),q(i,O.refId));for(var S=Array.from(e?O.allChanges:O.changes.values()),b=0,A=S.length;b<A;b++){var E=e?{op:t.OPERATION.ADD,index:S[b]}:S[b],R=E.index,w=y?_._definition.fieldsByIndex&&_._definition.fieldsByIndex[R]:R,T=i.length;if(E.op!==t.OPERATION.TOUCH)if(y)B(i,R|E.op);else{if(B(i,E.op),E.op===t.OPERATION.CLEAR)continue;q(i,R)}if(!y&&(E.op&t.OPERATION.ADD)==t.OPERATION.ADD&&_ instanceof J&&Je(i,O.ref.$indexes.get(R)),E.op!==t.OPERATION.DELETE){var $=O.getType(R),U=O.getValue(R);if(U&&U.$changes&&!p.has(U.$changes)&&(x.push(U.$changes),U.$changes.ensureRefId(),v++),E.op!==t.OPERATION.TOUCH){if(n.is($))Jt(U,$,_,w),q(i,U.$changes.refId),(E.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(i,$,U.constructor);else if("string"==typeof $)gn($,i,U,_,w);else{var W=Ze(Object.keys($)[0]);Jt(_["_"+w],W.constructor,_,w),q(i,U.$changes.refId)}r&&O.cache(R,i.slice(T))}}}!e&&!r&&O.discard()}return i},n.prototype.encodeAll=function(e){return this.encode(!0,[],e)},n.prototype.applyFilters=function(e,i){var r,h;void 0===i&&(i=!1);for(var p=this,x=new Set,v=dn.get(e),M=[this.$changes],O=1,_=[],y=function(b){var A=M[b];if(x.has(A.refId))return"continue";var E=A.ref,R=E instanceof n;B(_,d),q(_,A.refId);var w=v.refIds.has(A),T=i||!w;v.addRefId(A);var Z=v.containerIndexes.get(A),$=Array.from(T?A.allChanges:A.changes.values());!i&&R&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach(function(pe){!Z.has(pe)&&A.allChanges.has(pe)&&$.push(T?pe:{op:t.OPERATION.ADD,index:pe})});for(var W=0,Te=$.length;W<Te;W++){var G=T?{op:t.OPERATION.ADD,index:$[W]}:$[W];if(G.op!==t.OPERATION.CLEAR){var F=G.index;if(G.op!==t.OPERATION.DELETE){var L=A.getValue(F),bt=A.getType(F);if(R){if((V=E._definition.filters&&E._definition.filters[F])&&!V.call(E,e,L,p)){L&&L.$changes&&x.add(L.$changes.refId);continue}}else{var V,He=A.parent;if((V=A.getChildrenFilter())&&!V.call(He,e,E.$indexes.get(F),L,p)){L&&L.$changes&&x.add(L.$changes.refId);continue}}if(L.$changes&&(M.push(L.$changes),O++),G.op!==t.OPERATION.TOUCH)if(G.op===t.OPERATION.ADD||R)_.push.apply(_,null!==(r=A.caches[F])&&void 0!==r?r:[]),Z.add(F);else if(Z.has(F))_.push.apply(_,null!==(h=A.caches[F])&&void 0!==h?h:[]);else{if(Z.add(F),B(_,t.OPERATION.ADD),q(_,F),E instanceof J){var ue=A.ref.$indexes.get(F);Je(_,ue)}L.$changes?q(_,L.$changes.refId):yt[bt](_,L)}else L.$changes&&!R&&(B(_,t.OPERATION.ADD),q(_,F),E instanceof J&&(ue=A.ref.$indexes.get(F),Je(_,ue)),q(_,L.$changes.refId))}else R?B(_,G.op|F):(B(_,G.op),q(_,F))}else B(_,G.op)}},S=0;S<O;S++)y(S);return _},n.prototype.clone=function(){var e=new this.constructor,i=this._definition.schema;for(var r in i)e[r]="object"==typeof this[r]&&"function"==typeof this[r].clone?this[r].clone():this[r];return e},n.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;n.prototype._triggerAllFillChanges.call(this,this,e);try{n.prototype._triggerChanges.call(this,e)}catch(i){n.onError(i)}}},n.prototype.toJSON=function(){var e=this._definition.schema,i=this._definition.deprecated,r={};for(var h in e)!i[h]&&null!==this[h]&&typeof this[h]<"u"&&(r[h]="function"==typeof this[h].toJSON?this[h].toJSON():this["_"+h]);return r},n.prototype.discardAllChanges=function(){this.$changes.discardAll()},n.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},n.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},n.prototype.tryEncodeTypeId=function(e,i,r){i._typeid!==r._typeid&&(B(e,213),q(e,r._typeid))},n.prototype.getSchemaType=function(e,i,r){var h;return 213===e[i.offset]&&(i.offset++,h=this.constructor._context.get(ce(e,i))),h||r},n.prototype.createTypeInstance=function(e){var i=new e;return i.$changes.root=this.$changes.root,i},n.prototype._triggerAllFillChanges=function(e,i){if(!i.has(e.$changes.refId)){var r=[];if(i.set(e.$changes.refId||0,r),e instanceof n){var h=e._definition.schema;for(var p in h)void 0!==(v=e["_"+p])&&(r.push({op:t.OPERATION.ADD,field:p,value:v,previousValue:void 0}),void 0!==v.$changes&&n.prototype._triggerAllFillChanges.call(this,v,i))}else for(var M=e.entries(),O=void 0;(O=M.next())&&!O.done;){var v,_=O.value,y=_[0];r.push({op:t.OPERATION.ADD,field:y,dynamicIndex:y,value:v=_[1],previousValue:void 0}),void 0!==v.$changes&&n.prototype._triggerAllFillChanges.call(this,v,i)}}},n.prototype._triggerChanges=function(e){var i=this;e.forEach(function(r,h){var p,x,v,M,O,_,y,S,b,A,E,R;if(r.length>0){for(var w=i.$changes.root.refs.get(h),T=w instanceof n,Z=0;Z<r.length;Z++){var $=r[Z],U=w.$listeners&&w.$listeners[$.field];if(T||($.op===t.OPERATION.ADD&&void 0===$.previousValue?null===(x=(p=w).onAdd)||void 0===x||x.call(p,$.value,null!==(v=$.dynamicIndex)&&void 0!==v?v:$.field):$.op===t.OPERATION.DELETE?void 0!==$.previousValue&&(null===(O=(M=w).onRemove)||void 0===O||O.call(M,$.previousValue,null!==(_=$.dynamicIndex)&&void 0!==_?_:$.field)):$.op===t.OPERATION.DELETE_AND_ADD?(void 0!==$.previousValue&&(null===(S=(y=w).onRemove)||void 0===S||S.call(y,$.previousValue,$.dynamicIndex)),null===(A=(b=w).onAdd)||void 0===A||A.call(b,$.value,$.dynamicIndex)):($.op===t.OPERATION.REPLACE||$.value!==$.previousValue)&&(null===(R=(E=w).onChange)||void 0===R||R.call(E,$.value,$.dynamicIndex))),($.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&$.previousValue instanceof n&&$.previousValue.onRemove&&$.previousValue.onRemove(),U)try{U.invoke($.value,$.previousValue)}catch(W){n.onError(W)}}if(T&&w.onChange)try{w.onChange(r)}catch(W){n.onError(W)}}})},n._definition=mt.create(),n}();var fe=new je,$t=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return a(e,n),u([Q("string",fe)],e.prototype,"name",void 0),u([Q("string",fe)],e.prototype,"type",void 0),u([Q("number",fe)],e.prototype,"referencedType",void 0),e}(z),Et=function(n){function e(){var i=null!==n&&n.apply(this,arguments)||this;return i.fields=new H,i}return a(e,n),u([Q("number",fe)],e.prototype,"id",void 0),u([Q([$t],fe)],e.prototype,"fields",void 0),e}(z),_n=function(n){function e(){var i=null!==n&&n.apply(this,arguments)||this;return i.types=new H,i}return a(e,n),e.encode=function(i){var r=i.constructor,h=new e;h.rootType=r._typeid;var p=function(O,_){for(var y in _){var S=new $t;S.name=y;var b=void 0;if("string"==typeof _[y])b=_[y];else{var A=_[y],E=void 0;z.is(A)?(b="ref",E=_[y]):"string"==typeof A[b=Object.keys(A)[0]]?b+=":"+A[b]:E=A[b],S.referencedType=E?E._typeid:-1}S.type=b,O.fields.push(S)}h.types.push(O)},x=r._context.types;for(var v in x){var M=new Et;M.id=Number(v),p(M,x[v]._definition.schema)}return h.encodeAll()},e.decode=function(i,r){var h=new je,p=new e;p.decode(i,r);var x=p.types.reduce(function(y,S){var b=function(E){function R(){return null!==E&&E.apply(this,arguments)||this}return a(R,E),R}(z),A=S.id;return y[A]=b,h.add(b,A),y},{});p.types.forEach(function(y){var S=x[y.id];y.fields.forEach(function(b){var A;if(void 0!==b.referencedType){var E=b.type,R=x[b.referencedType];if(!R){var w=b.type.split(":");E=w[0],R=w[1]}"ref"===E?Q(R,h)(S.prototype,b.name):Q(((A={})[E]=R,A),h)(S.prototype,b.name)}else Q(b.type,h)(S.prototype,b.name)})});var v=x[p.rootType],M=new v;for(var O in v._definition.schema){var _=v._definition.schema[O];"string"!=typeof _&&(M[O]="function"==typeof _?new _:new(Ze(Object.keys(_)[0]).constructor))}return M},u([Q([Et],fe)],e.prototype,"types",void 0),u([Q("number",fe)],e.prototype,"rootType",void 0),e}(z);Oe("map",{constructor:J,getProxy:ze}),Oe("array",{constructor:H,getProxy:N}),Oe("set",{constructor:At}),Oe("collection",{constructor:Ct}),t.ArraySchema=H,t.CollectionSchema=Ct,t.Context=je,t.MapSchema=J,t.Reflection=_n,t.ReflectionField=$t,t.ReflectionType=Et,t.Schema=z,t.SchemaDefinition=mt,t.SetSchema=At,t.decode=jt,t.defineTypes=function Qt(n,e,i){for(var r in void 0===i&&(i=n._context||Tt),e)Q(e[r],i)(n.prototype,r);return n},t.deprecated=function Yt(n,e){return void 0===n&&(n=!0),function(i,r){var p=i.constructor._definition;p.deprecated[r]=!0,n&&(p.descriptors[r]={get:function(){throw new Error(r+" is deprecated.")},set:function(x){},enumerable:!1,configurable:!0})}},t.dumpChanges=function vn(n){for(var e=[n.$changes],r={},h=r,p=function(v){var M=e[v];M.changes.forEach(function(O){var _=M.ref,y=O.index,S=_._definition?_._definition.fieldsByIndex[y]:_.$indexes.get(y);h[S]=M.getValue(y)})},x=0;x<1;x++)p(x);return r},t.encode=yt,t.filter=function qt(n){return function(e,i){var r=e.constructor;r._definition.addFilter(i,n)&&(r._context.useFilters=!0)}},t.filterChildren=function Gt(n){return function(e,i){var r=e.constructor;r._definition.addChildrenFilter(i,n)&&(r._context.useFilters=!0)}},t.hasFilter=function Ht(n){return n._context&&n._context.useFilters},t.registerType=Oe,t.type=Q,Object.defineProperty(t,"__esModule",{value:!0})},s(f)}),Fe=function(){function c(f,t){var s=this;this.onStateChange=le(),this.onError=le(),this.onLeave=le(),this.onJoin=le(),this.hasJoined=!1,this.onMessageHandlers=rt(),this.id=null,this.name=f,t&&(this.serializer=new(Ue("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(function(a,u){return console.warn("colyseus.js - onError => ("+a+") "+u)}),this.onLeave(function(){return s.removeAllListeners()})}return c.prototype.connect=function(f){var t=this;this.connection=new ke,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(s){if(!t.hasJoined)return console.warn("Room connection was closed unexpectedly ("+s.code+"): "+s.reason),void t.onError.invoke(s.code,s.reason);t.onLeave.invoke(s.code),t.destroy()},this.connection.events.onerror=function(s){console.warn("Room, onError ("+s.code+"): "+s.reason),t.onError.invoke(s.code,s.reason)},this.connection.connect(f)},c.prototype.leave=function(f){var t=this;return void 0===f&&(f=!0),new Promise(function(s){t.onLeave(function(a){return s(a)}),t.connection?f?t.connection.send([C.Protocol.LEAVE_ROOM]):t.connection.close():t.onLeave.invoke(4e3)})},c.prototype.onMessage=function(f,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(f),t)},c.prototype.send=function(f,t){var a,s=[C.Protocol.ROOM_DATA];if("string"==typeof f?K.encode.string(s,f):K.encode.number(s,f),void 0!==t){var u=Xe(t);(a=new Uint8Array(s.length+u.byteLength)).set(new Uint8Array(s),0),a.set(new Uint8Array(u),s.length)}else a=new Uint8Array(s);this.connection.send(a.buffer)},Object.defineProperty(c.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),c.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},c.prototype.onMessageCallback=function(f){var t=Array.from(new Uint8Array(f.data)),s=t[0];if(s===C.Protocol.JOIN_ROOM){var a=1;if(this.serializerId=function nt(c,f){for(var t=c[f++],s="",a=0,u=f,l=f+t;u<l;u++){var d=c[u];if(0!=(128&d))if(192!=(224&d))if(224!=(240&d)){if(240!=(248&d))throw new Error("Invalid byte "+d.toString(16));(a=(7&d)<<18|(63&c[++u])<<12|(63&c[++u])<<6|(63&c[++u])<<0)>=65536?(a-=65536,s+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):s+=String.fromCharCode(a)}else s+=String.fromCharCode((15&d)<<12|(63&c[++u])<<6|(63&c[++u])<<0);else s+=String.fromCharCode((31&d)<<6|63&c[++u]);else s+=String.fromCharCode(d)}return s}(t,a),a+=function it(c){void 0===c&&(c="");for(var f=0,t=0,s=0,a=c.length;s<a;s++)(f=c.charCodeAt(s))<128?t+=1:f<2048?t+=2:f<55296||f>=57344?t+=3:(s++,t+=4);return t+1}(this.serializerId),!this.serializer){var u=Ue(this.serializerId);this.serializer=new u}t.length>a&&this.serializer.handshake&&this.serializer.handshake(t,{offset:a}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(s===C.Protocol.ERROR){var l={offset:1},d=K.decode.number(t,l),g=K.decode.string(t,l);this.onError.invoke(d,g)}else if(s===C.Protocol.LEAVE_ROOM)this.leave();else if(s===C.Protocol.ROOM_DATA_SCHEMA){var m={offset:1};(g=new(D=this.serializer.getState().constructor._context.get(K.decode.number(t,m)))).decode(t,m),this.dispatchMessage(D,g)}else if(s===C.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(s===C.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(s===C.Protocol.ROOM_DATA){var N={offset:1},D=K.decode.stringCheck(t,N)?K.decode.string(t,N):K.decode.number(t,N);g=t.length>N.offset?function Qe(c,f){void 0===f&&(f=0);var t=new te(c,f),s=t._parse();if(t._offset!==c.byteLength)throw new Error(c.byteLength-t._offset+" trailing bytes");return s}(f.data,N.offset):void 0,this.dispatchMessage(D,g)}},c.prototype.setState=function(f){this.serializer.setState(f),this.onStateChange.invoke(this.serializer.getState())},c.prototype.patch=function(f){this.serializer.patch(f),this.onStateChange.invoke(this.serializer.getState())},c.prototype.dispatchMessage=function(f,t){var s=this.getMessageHandlerKey(f);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",f,t):console.warn("colyseus.js: onMessage() not registered for type '"+f+"'.")},c.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},c.prototype.getMessageHandlerKey=function(f){switch(typeof f){case"function":return"$"+f._typeid;case"string":return f;case"number":return"i"+f;default:throw new Error("invalid message type.")}},c}();function we(){return xe||(xe=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(c,f){this.cache[c]=f},getItem:function(c){},removeItem:function(c){delete this.cache[c]}}),xe}var Ce="colyseus-auth-token";C.Platform=void 0,function(c){c.ios="ios",c.android="android"}(C.Platform||(C.Platform={}));var Ae,Le=function(){function c(f){var t=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=f.replace("ws","http"),function ut(c,f){var t=we().getItem(c);typeof Promise>"u"||!(t instanceof Promise)?f(t):t.then(function(s){return f(s)})}(Ce,function(s){return t.token=s})}return Object.defineProperty(c.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),c.prototype.login=function(f){return void 0===f&&(f={}),P(this,void 0,void 0,function(){var t,s,a;return k(this,function(u){switch(u.label){case 0:return t=Object.assign({},f),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(a in s=u.sent(),this.token=s.token,function ct(c,f){we().setItem(c,f)}(Ce,this.token),s)this.hasOwnProperty(a)&&(this[a]=s[a]);return this.registerPingService(),[2,this]}})})},c.prototype.save=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return f.sent(),[2,this]}})})},c.prototype.getFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,f.sent()]}})})},c.prototype.getOnlineFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,f.sent()]}})})},c.prototype.getFriendRequests=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,f.sent()]}})})},c.prototype.sendFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:f})];case 1:return[2,t.sent()]}})})},c.prototype.acceptFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:f})];case 1:return[2,t.sent()]}})})},c.prototype.declineFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:f})];case 1:return[2,t.sent()]}})})},c.prototype.blockUser=function(f){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:f})];case 1:return[2,t.sent()]}})})},c.prototype.unblockUser=function(f){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:f})];case 1:return[2,t.sent()]}})})},c.prototype.request=function(f,t,s,a,u){return void 0===s&&(s={}),void 0===u&&(u={}),P(this,void 0,void 0,function(){var l,d,g,m;return k(this,function(I){switch(I.label){case 0:for(d in u.Accept="application/json",this.hasToken&&(u.Authorization="Bearer "+this.token),l=[],s)l.push(d+"="+s[d]);return g=l.length>0?"?"+l.join("&"):"",m={headers:u},a&&(m.body=a),[4,_e[f](""+this.endpoint+t+g,m)];case 1:return[2,I.sent().data]}})})},c.prototype.logout=function(){this.token=void 0,function ft(c){we().removeItem(c)}(Ce),this.unregisterPingService()},c.prototype.registerPingService=function(f){var t=this;void 0===f&&(f=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return t.request("get","/auth")},f)},c.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},c}(),ht=function(c){function f(t,s){var a=c.call(this,t)||this;return a.code=s,Object.setPrototypeOf(a,f.prototype),a}return j(f,c),f}(Error),lt=typeof window<"u"&&typeof(null===(Ae=window?.location)||void 0===Ae?void 0:Ae.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",dt=function(){function c(f){void 0===f&&(f=lt),this.endpoint=f}return Object.defineProperty(c.prototype,"auth",{get:function(){return this._auth||(this._auth=new Le(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),c.prototype.joinOrCreate=function(f,t,s){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",f,t,s)];case 1:return[2,a.sent()]}})})},c.prototype.create=function(f,t,s){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return[4,this.createMatchMakeRequest("create",f,t,s)];case 1:return[2,a.sent()]}})})},c.prototype.join=function(f,t,s){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return[4,this.createMatchMakeRequest("join",f,t,s)];case 1:return[2,a.sent()]}})})},c.prototype.joinById=function(f,t,s){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return[4,this.createMatchMakeRequest("joinById",f,t,s)];case 1:return[2,a.sent()]}})})},c.prototype.reconnect=function(f,t,s){return P(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return[4,this.createMatchMakeRequest("joinById",f,{sessionId:t},s)];case 1:return[2,a.sent()]}})})},c.prototype.getAvailableRooms=function(f){return void 0===f&&(f=""),P(this,void 0,void 0,function(){var t;return k(this,function(s){switch(s.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+f,[4,me(t,{headers:{Accept:"application/json"}})];case 1:return[2,s.sent().data]}})})},c.prototype.consumeSeatReservation=function(f,t){return P(this,void 0,void 0,function(){var s;return k(this,function(a){return(s=this.createRoom(f.room.name,t)).id=f.room.roomId,s.sessionId=f.sessionId,s.connect(this.buildEndpoint(f.room,{sessionId:s.sessionId})),[2,new Promise(function(u,l){var d=function(g,m){return l(new Pe(g,m))};s.onError.once(d),s.onJoin.once(function(){s.onError.remove(d),u(s)})})]})})},c.prototype.createMatchMakeRequest=function(f,t,s,a){return void 0===s&&(s={}),P(this,void 0,void 0,function(){var u,l;return k(this,function(d){switch(d.label){case 0:return u=this.endpoint.replace("ws","http")+"/matchmake/"+f+"/"+t,this._auth&&this._auth.hasToken&&(s.token=this._auth.token),[4,ve(u,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})];case 1:if((l=d.sent().data).error)throw new ht(l.error,l.code);return[2,this.consumeSeatReservation(l,a)]}})})},c.prototype.createRoom=function(f,t){return new Fe(f,t)},c.prototype.buildEndpoint=function(f,t){void 0===t&&(t={});var s=[];for(var a in t)!t.hasOwnProperty(a)||s.push(a+"="+t[a]);return this.endpoint+"/"+f.processId+"/"+f.roomId+"?"+s.join("&")},c}(),pt=function(){function c(){}return c.prototype.setState=function(f){this.state.decode(f)},c.prototype.getState=function(){return this.state},c.prototype.patch=function(f){this.state.decode(f)},c.prototype.teardown=function(){var f,t;null===(t=null===(f=this.state)||void 0===f?void 0:f.$changes)||void 0===t||t.root.clearRefs()},c.prototype.handshake=function(f,t){this.state?(new K.Reflection).decode(f,t):this.state=K.Reflection.decode(f,t)},c}(),gt=function(){function c(){}return c.prototype.setState=function(f){},c.prototype.getState=function(){return null},c.prototype.patch=function(f){},c.prototype.teardown=function(){},c.prototype.handshake=function(f){},c}();ye("schema",pt),ye("none",gt),C.Auth=Le,C.Client=dt,C.Room=Fe,C.SchemaSerializer=pt,C.registerSerializer=ye,Object.defineProperty(C,"__esModule",{value:!0})}(Ie)}}]);