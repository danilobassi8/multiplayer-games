(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{9429:(Bt,Ie,C)=>{"use strict";C.r(Ie),C.d(Ie,{MinesweeperModule:()=>i});var ne=C(5012),J=C(6895),P=C(5755),k=C(9386),ge=C(7579),Y=C(3900),Re=C(2076),r=C(4650),Se=C(3274);const he=["easy","medium","hard"];let ie=(()=>{class s extends class Ye{constructor(u,c,l={}){this.roomGame=u,this.auth=c,this.defaultGameOptions=l,this.stateChanges=new ge.x,this.roomMessages=new ge.x,this.client=new P.Client(`ws://${k.N.backend_url}`)}createRoom(u){return this.auth.user$.pipe((0,Y.w)(c=>(0,Re.D)(this.client.create(this.roomGame,{...this.defaultGameOptions,...u,player:c}).then(l=>{this.currentRoom&&this.currentRoom.leave(),this.currentRoom=l,this.currentRoom.onStateChange(d=>this.stateChanges.next(d)),this.currentRoom.onMessage("*",d=>this.roomMessages.next(d))}).catch(l=>{this.auth.loginWithRedirect()}))))}getAvailableRooms(){return(0,Re.D)(this.client.getAvailableRooms(this.roomGame))}}{constructor(c){super("MinesweeperRoom",c,{maxClients:2}),this.authService=c,this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return s.\u0275fac=function(c){return new(c||s)(r.LFG(Se.e8))},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();class me extends Set{add(u){super.add(u.toString())}has(u){return super.has(u.toString())}}class De{constructor({include:u=!0,onlyInteger:c=!0}){this.includeLimits=u,this.onlyInteger=c}returnOutputNumber(u){return this.onlyInteger?Math.round(u):u}between(u,c){let l;return l=this.includeLimits?Math.floor(Math.random()*(c-u+1)+u):Math.floor(Math.random()*(c-u)+u),this.returnOutputNumber(l)}}class ve{constructor(u,c){this.row=u,this.column=c,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged="no"}toggleFlaggedState(){this.flagged="no"!=this.flagged?"flag"===this.flagged?"question":"no":"flag"}}class re extends Array{constructor(u,c="player"){super(),this.status="playing",this.player=c;const l=u?.size;for(let d=0;d<l;d++){this[d]=[];for(let p=0;p<l;p++)this[d].push(new ve(d,p))}u&&this.generateBombs(u)}generateBombs(u){const c=new De({onlyInteger:!0}),l=new me;for(;l.size<u.bombs;){const d=c.between(0,u.size-1),p=c.between(0,u.size-1);l.has([d,p])||(l.add([d,p]),this[d][p].bomb=!0,this.getCellsArround(this[d][p]).forEach(m=>{m.nearBombs++}))}}getCellsArround(u){const c=[],l=u.row,d=u.column,p=(m,M)=>(this[m]&&this[m][M]&&c.push(this[m][M]),c);return p(l+1,d+1),p(l+1,d-1),p(l+1,d+0),p(l-1,d+1),p(l-1,d-1),p(l-1,d+0),p(l+0,d+1),p(l+0,d-1),c}reveal(u){if(u.bomb)return this.status="game over",void this.revealAllCells();u.revealed=!0,0===u.nearBombs&&this.getCellsArround(u).filter(c=>0==c.revealed).forEach(c=>this.reveal(c)),this.checkWinningCondition()}checkWinningCondition(){return"playing"!==this.status?"win"===this.status:0===this.flat(2).filter(l=>!(l.bomb||l.revealed)).length&&(this.status="win",!0)}revealAllCells(){this.forEach(u=>u.forEach(c=>c.revealed=!0))}toggleCellState(u){u.toggleFlaggedState(),this.checkWinningCondition()}getUsedFlags(){let u=0;return this.forEach(c=>c.forEach(l=>{u+="flag"===l.flagged?1:0})),u}}var X=C(9119),V=C(433),_e=C(5593),Pe=C(5362);function te(s,u){1&s&&r._UZ(0,"img",7)}function Qe(s,u){if(1&s&&r._UZ(0,"span"),2&s){const c=r.oxw(2).$implicit;r.Gre("m-0 p-0 near-bombs-text near-",c.nearBombs,"")}}function Ke(s,u){if(1&s&&(r.ynx(0),r.YNc(1,te,1,0,"img",5),r.YNc(2,Qe,1,3,"span",6),r.BQk()),2&s){const c=r.oxw().$implicit;r.xp6(1),r.Q6J("ngIf",c.bomb),r.xp6(1),r.Q6J("ngIf",!c.bomb)}}function We(s,u){1&s&&r._UZ(0,"img",10)}function Xe(s,u){1&s&&r._UZ(0,"img",11)}function oe(s,u){if(1&s&&(r.ynx(0),r.YNc(1,We,1,0,"img",8),r.YNc(2,Xe,1,0,"img",9),r.BQk()),2&s){const c=r.oxw().$implicit;r.xp6(1),r.Q6J("ngIf","flag"==c.flagged),r.xp6(1),r.Q6J("ngIf","question"==c.flagged)}}function Ve(s,u){if(1&s){const c=r.EpF();r.TgZ(0,"div",3),r.NdJ("click",function(){const p=r.CHM(c).$implicit,m=r.oxw(2);return r.KtG(m.cellClicked.emit(p))})("contextmenu",function(d){const m=r.CHM(c).$implicit,M=r.oxw(2);return r.KtG(M.onRightClick(d,m))}),r.YNc(1,Ke,3,2,"ng-container",4),r.YNc(2,oe,3,2,"ng-container",4),r.qZA()}if(2&s){const c=u.$implicit,l=u.index,d=r.oxw().index;r.ekj("revealed",c.revealed)("empty",c.revealed&&0==c.nearBombs&&!c.bomb)("darker",(d%2+l)%2),r.xp6(1),r.Q6J("ngIf",c.revealed),r.xp6(1),r.Q6J("ngIf",0==c.revealed)}}function et(s,u){if(1&s&&(r.ynx(0),r.YNc(1,Ve,3,8,"div",2),r.BQk()),2&s){const c=u.$implicit;r.xp6(1),r.Q6J("ngForOf",c)}}function tt(s,u){1&s&&r._UZ(0,"img",12),2&s&&r.MGl("src","assets/minesweeper/",u.$implicit,".png",r.LSH)}const nt=function(){return["bomb","red_flag","question_mark"]};let ke=(()=>{class s{constructor(c){this.game=c,this.maxHeightInPixels=750,this.cellClicked=new r.vpe,this.cellRightClicked=new r.vpe,this.gridTemplateFrString="",this.currentConfig=c.gameConfig.easy,this.matrix=new re(this.currentConfig)}ngOnChanges(c){c.currentConfig&&(this.gridTemplateFrString=`repeat(${this.currentConfig.size},calc(min(${this.maxHeightInPixels}px, 90vw) / ${this.currentConfig.size}))`)}ngOnInit(){}onRightClick(c,l){c.preventDefault(),this.cellRightClicked.emit(l)}}return s.\u0275fac=function(c){return new(c||s)(r.Y36(ie))},s.\u0275cmp=r.Xpm({type:s,selectors:[["minesweeper-game-matrix"]],inputs:{matrix:"matrix",currentConfig:"currentConfig",maxHeightInPixels:"maxHeightInPixels"},outputs:{cellClicked:"cellClicked",cellRightClicked:"cellRightClicked"},features:[r.TTD],decls:3,vars:8,consts:[[4,"ngFor","ngForOf"],["class","d-none",3,"src",4,"ngFor","ngForOf"],["class","matrix-cell",3,"revealed","empty","darker","click","contextmenu",4,"ngFor","ngForOf"],[1,"matrix-cell",3,"click","contextmenu"],[4,"ngIf"],["src","assets/minesweeper/bomb.png","class","h-90 cell-image animate__animated animate__bounceIn",4,"ngIf"],[3,"class",4,"ngIf"],["src","assets/minesweeper/bomb.png",1,"h-90","cell-image","animate__animated","animate__bounceIn"],["src","assets/minesweeper/red_flag.png","class","cell-image",4,"ngIf"],["src","assets/minesweeper/question_mark.png","class","cell-image h-75",4,"ngIf"],["src","assets/minesweeper/red_flag.png",1,"cell-image"],["src","assets/minesweeper/question_mark.png",1,"cell-image","h-75"],[1,"d-none",3,"src"]],template:function(c,l){1&c&&(r.TgZ(0,"div"),r.YNc(1,et,2,1,"ng-container",0),r.qZA(),r.YNc(2,tt,1,1,"img",1)),2&c&&(r.Gre("matrix-container matrix-sized-",l.currentConfig.size,""),r.Udp("grid-template-columns",l.gridTemplateFrString),r.xp6(1),r.Q6J("ngForOf",l.matrix),r.xp6(1),r.Q6J("ngForOf",r.DdM(7,nt)))},dependencies:[J.sg,J.O5],styles:['.matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;justify-content:center;font-weight:bolder}.matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:2rem}.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}@media (max-width: 992px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:7px}}@media (max-width: 768px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]:hover{background-color:currentColor}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0;filter:brightness(.92)}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.darker[_ngcontent-%COMP%]{filter:brightness(.96)}.cell-image[_ngcontent-%COMP%]{position:absolute;object-fit:scale-down;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),s})();function Ne(s,u){1&s&&(r.TgZ(0,"div",13)(1,"h1",14),r._uU(2,"You win!"),r.qZA()())}function xe(s,u){1&s&&(r.TgZ(0,"div",13)(1,"h1",15),r._uU(2,"You Lose!"),r.qZA()())}let Ue=(()=>{class s{constructor(c,l,d){this.game=c,this.route=l,this.router=d,this.allDifficulties=[...he],this.usedFlags=0,this.selectedDifficulty="easy",this.nextDifficulty=this.selectedDifficulty,this.gameConfig=this.game.gameConfig.easy,this.matrix=new re(this.gameConfig)}ngOnInit(){this.route.params.subscribe(c=>{he.includes(c.difficulty)?this.initializeGame(c.difficulty):this.initializeGame(he[1])})}initializeGame(c){c!=this.selectedDifficulty&&this.router.navigate(["minesweeper","offline",c]),this.selectedDifficulty=c,this.nextDifficulty=c,this.gameConfig=this.game.gameConfig[c],this.matrix=new re(this.gameConfig)}onCellClicked(c){this.matrix.reveal(c)}onCellRightClicked(c){this.matrix.toggleCellState(c),this.usedFlags=this.matrix.getUsedFlags()}}return s.\u0275fac=function(c){return new(c||s)(r.Y36(ie),r.Y36(X.gz),r.Y36(X.F0))},s.\u0275cmp=r.Xpm({type:s,selectors:[["app-offline"]],decls:22,vars:18,consts:[[1,"offline-game-container","py-4","w-100"],[1,"game",3,"matrix","currentConfig","cellClicked","cellRightClicked"],[1,"side-panel"],[1,"flags-used","d-flex","mx-2"],["src","assets/minesweeper/red_flag.png","alt","flags-used","width","30px","height","30px"],[1,"mx-2"],[1,"d-flex"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Restart",1,"p-button","ml-2",3,"click"],[1,"mt-1","animate__animated","animate__faster",2,"color","var(--yellow)"],[3,"ngSwitch"],[1,""],["class","animate__animated animate__bounceIn",4,"ngSwitchCase"],[1,"animate__animated","animate__bounceIn"],[2,"color","var(--green)"],[2,"color","var(--red)"]],template:function(c,l){1&c&&(r.TgZ(0,"div",0)(1,"minesweeper-game-matrix",1),r.NdJ("cellClicked",function(p){return l.onCellClicked(p)})("cellRightClicked",function(p){return l.onCellRightClicked(p)}),r.qZA(),r.TgZ(2,"div",2)(3,"div",3),r._UZ(4,"img",4),r.TgZ(5,"h3"),r._uU(6),r.qZA()(),r.TgZ(7,"h3",5),r._uU(8," Difficulty: "),r.TgZ(9,"span"),r._uU(10),r.ALo(11,"titlecase"),r.qZA()(),r.TgZ(12,"div",5)(13,"div",6)(14,"p-selectButton",7),r.NdJ("ngModelChange",function(p){return l.nextDifficulty=p}),r.qZA(),r.TgZ(15,"button",8),r.NdJ("click",function(){return l.initializeGame(l.nextDifficulty)}),r.qZA()(),r.TgZ(16,"div",9),r._uU(17," Click restart to change difficulty "),r.qZA()(),r.ynx(18,10),r.TgZ(19,"div",11),r.YNc(20,Ne,3,0,"div",12),r.YNc(21,xe,3,0,"div",12),r.qZA(),r.BQk(),r.qZA()()),2&c&&(r.xp6(1),r.Q6J("matrix",l.matrix)("currentConfig",l.gameConfig),r.xp6(5),r.hij(": ",l.gameConfig.bombs-l.usedFlags,""),r.xp6(3),r.Gre("difficulty-color-",l.selectedDifficulty,""),r.xp6(1),r.Oqu(r.lcZ(11,16,l.selectedDifficulty)),r.xp6(4),r.Q6J("options",l.allDifficulties)("ngModel",l.nextDifficulty),r.xp6(2),r.ekj("animate__fadeIn",l.nextDifficulty!==l.selectedDifficulty)("animate__fadeOut",l.nextDifficulty==l.selectedDifficulty),r.xp6(2),r.Q6J("ngSwitch",l.matrix.status),r.xp6(2),r.Q6J("ngSwitchCase","win"),r.xp6(1),r.Q6J("ngSwitchCase","game over"))},dependencies:[J.RF,J.n9,V.JJ,V.On,_e.Hq,Pe.UN,ke,J.rS],styles:[".offline-game-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:center}.side-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:50px;min-width:350px;flex-grow:0}@media (max-width: 1200px){.side-panel[_ngcontent-%COMP%]{flex-direction:row;min-width:none;justify-content:space-evenly;align-items:center;flex-wrap:wrap;padding:0;width:100%}}"]}),s})();var it=C(4247),rt=C(8625);function ot(s,u){1&s&&r.GkF(0)}function st(s,u){1&s&&r.GkF(0)}function le(s,u){if(1&s){const c=r.EpF();r.TgZ(0,"div",5)(1,"minesweeper-game-matrix",6),r.NdJ("cellClicked",function(d){const m=r.CHM(c).matrix;return r.KtG(m.reveal(d))}),r.qZA()()}if(2&s){const c=u.matrix,l=r.oxw();r.xp6(1),r.Q6J("matrix",c)("currentConfig",l.currentConfig)("maxHeightInPixels",600)}}function at(s,u){1&s&&(r._uU(0),r.ALo(1,"titlecase")),2&s&&r.hij(" ",r.lcZ(1,1,u.$implicit)," ")}function ct(s,u){if(1&s){const c=r.EpF();r.TgZ(0,"div",18)(1,"p-password",19),r.NdJ("ngModelChange",function(d){r.CHM(c);const p=r.oxw(2);return r.KtG(p.roomPassword=d)}),r.qZA()()}if(2&s){const c=r.oxw(2);r.xp6(1),r.Q6J("ngModel",c.roomPassword)("feedback",!1)("toggleMask",!0)}}const K=function(){return["Multiplayer","Offline"]};function Fe(s,u){if(1&s){const c=r.EpF();r.TgZ(0,"div",7)(1,"div",8)(2,"p-selectButton",9),r.NdJ("ngModelChange",function(d){r.CHM(c);const p=r.oxw();return r.KtG(p.selectedDifficulty=d)})("onChange",function(){r.CHM(c);const d=r.oxw();return r.KtG(d.difficultyChange())}),r.YNc(3,at,2,3,"ng-template"),r.qZA()(),r.TgZ(4,"div",10)(5,"div",11)(6,"h3",12),r._uU(7," Configuration: "),r.TgZ(8,"span",13),r._uU(9),r.ALo(10,"titlecase"),r.qZA()()(),r.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),r._uU(15," Size: "),r.TgZ(16,"span"),r._uU(17),r.qZA()()(),r.TgZ(18,"li")(19,"h4"),r._uU(20," Cells: "),r.TgZ(21,"span"),r._uU(22),r.qZA()()(),r.TgZ(23,"li")(24,"h4"),r._uU(25," Bombs: "),r.TgZ(26,"span"),r._uU(27),r.qZA()()()(),r.TgZ(28,"div",14)(29,"p-selectButton",15),r.NdJ("ngModelChange",function(d){r.CHM(c);const p=r.oxw();return r.KtG(p.networkGamemode=d)}),r.qZA()(),r.YNc(30,ct,2,3,"div",16),r.qZA(),r.TgZ(31,"div",8)(32,"button",17),r.NdJ("click",function(){r.CHM(c);const d=r.oxw();return r.KtG(d.onPlayButton())}),r.qZA()()()()}if(2&s){const c=r.oxw();r.xp6(2),r.Q6J("options",c.difficultyOptions)("ngModel",c.selectedDifficulty),r.xp6(7),r.Oqu(r.lcZ(10,19,c.selectedDifficulty)),r.xp6(7),r.Gre("difficulty-color-",c.selectedDifficulty,""),r.xp6(1),r.AsE("",c.currentConfig.size," x ",c.currentConfig.size,""),r.xp6(4),r.Gre("difficulty-color-",c.selectedDifficulty,""),r.xp6(1),r.Oqu(c.currentConfig.size*c.currentConfig.size),r.xp6(4),r.Gre("difficulty-color-",c.selectedDifficulty,""),r.xp6(1),r.Oqu(c.currentConfig.bombs),r.xp6(2),r.Q6J("options",r.DdM(21,K))("ngModel",c.networkGamemode),r.xp6(1),r.Q6J("ngIf","Multiplayer"==c.networkGamemode)}}const ye=function(s){return{matrix:s}};let we=(()=>{class s{constructor(c,l){this.game=c,this.router=l,this.selectedDifficulty="easy",this.difficultyOptions=[...he],this.networkGamemode="Offline",this.roomPassword="",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new re(this.currentConfig),this.userMatrix.forEach(c=>c.forEach(l=>{l.bomb&&(l.revealed=!0)}))}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}onPlayButton(){"Offline"==this.networkGamemode?this.router.navigate(["minesweeper","offline",this.selectedDifficulty]):this.game.createRoom({password:this.roomPassword}).subscribe(c=>{console.log(c)})}}return s.\u0275fac=function(c){return new(c||s)(r.Y36(ie),r.Y36(X.F0))},s.\u0275cmp=r.Xpm({type:s,selectors:[["app-difficulty-selector"]],decls:7,vars:5,consts:[[1,"main-double-board","py-4"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["optionMenuTemplate",""],[1,"matrix-container"],[3,"matrix","currentConfig","maxHeightInPixels","cellClicked"],[1,"option-menu-container"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"config-manager"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-center"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["class","d-flex",4,"ngIf"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg",3,"click"],[1,"d-flex"],["placeholder","Password for private rooms only","styleClass","password-room-creation w-100",1,"w-100","mt-3","animate__animated","animate__bounceIn","animate__faster",3,"ngModel","feedback","toggleMask","ngModelChange"]],template:function(c,l){if(1&c&&(r.TgZ(0,"div",0),r.YNc(1,ot,1,0,"ng-container",1),r.YNc(2,st,1,0,"ng-container",2),r.qZA(),r.YNc(3,le,2,3,"ng-template",null,3,r.W1O),r.YNc(5,Fe,33,22,"ng-template",null,4,r.W1O)),2&c){const d=r.MAs(4),p=r.MAs(6);r.xp6(1),r.Q6J("ngTemplateOutlet",d)("ngTemplateOutletContext",r.VKq(3,ye,l.userMatrix)),r.xp6(1),r.Q6J("ngTemplateOutlet",p)}},dependencies:[J.O5,J.tP,V.JJ,V.On,_e.Hq,it.Z,rt.ro,Pe.UN,ke,J.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;flex-wrap:wrap-reverse}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.matrix-container[_ngcontent-%COMP%]{min-width:700px;margin-right:50px}.option-menu-container[_ngcontent-%COMP%]{min-width:500px}@media (max-width: 768px){.matrix-container[_ngcontent-%COMP%]{min-width:100%;margin-right:0}.option-menu-container[_ngcontent-%COMP%]{min-width:100%}}[_nghost-%COMP%]     .password-room-creation{width:100%}[_nghost-%COMP%]     .password-room-creation input{width:100%}"]}),s})();var ft=C(805),ut=C(8271),ht=C(5722),Ce=C(1383);function Le(s,u){if(1&s&&(r.TgZ(0,"div",12)(1,"p",12),r._uU(2),r.ALo(3,"titlecase"),r.qZA()()),2&s){const c=u.$implicit,l=u.index,d=r.oxw(2);r.xp6(2),r.AsE(" ",r.lcZ(3,2,c.difficulty),"",l==d.selectedDificulties.length-1?".":", "," ")}}function Ae(s,u){1&s&&(r.TgZ(0,"div"),r._uU(1," Select a difficulty. "),r.qZA())}function lt(s,u){if(1&s&&(r.YNc(0,Le,4,4,"div",10),r.YNc(1,Ae,2,0,"div",11)),2&s){const c=r.oxw();r.Q6J("ngForOf",c.selectedDificulties),r.xp6(1),r.Q6J("ngIf",0===c.selectedDificulties.length)}}function dt(s,u){1&s&&(r._uU(0),r.ALo(1,"titlecase")),2&s&&r.hij(" ",r.lcZ(1,1,u.$implicit.difficulty)," ")}function pt(s,u){1&s&&r._UZ(0,"button",23)}function Ze(s,u){if(1&s){const c=r.EpF();r.TgZ(0,"div",13)(1,"p-toolbar",14)(2,"div",15),r._UZ(3,"p-avatar",16),r.TgZ(4,"div",17)(5,"span",18),r._uU(6,"Creator: "),r.TgZ(7,"p",19),r._uU(8),r.qZA()(),r.TgZ(9,"span",18),r._uU(10,"Players: "),r.TgZ(11,"p",19),r._uU(12),r.qZA()()()(),r.TgZ(13,"div",20),r.YNc(14,pt,1,0,"button",21),r.TgZ(15,"button",22),r.NdJ("click",function(){r.CHM(c);const d=r.oxw();return r.KtG(d.getRooms())}),r.qZA()()()()}if(2&s){const c=u.$implicit;r.xp6(3),r.Q6J("image",(null==c.metadata||null==c.metadata.creator?null:c.metadata.creator.picture)||""),r.xp6(5),r.Oqu(c.metadata.creator.given_name),r.xp6(4),r.AsE("",c.clients,"/",c.maxClients||"x",""),r.xp6(2),r.Q6J("ngIf",c.metadata.isPrivate)}}const a=[{path:"",children:[{path:"",component:(()=>{class s{constructor(c,l){this.auth=c,this.game=l,this.sortMenuItems=[{label:"File",items:[{label:"New",icon:"pi pi-fw pi-plus"},{label:"Download",icon:"pi pi-fw pi-download"}]},{label:"Edit",items:[{label:"Add User",icon:"pi pi-fw pi-user-plus"},{label:"Remove User",icon:"pi pi-fw pi-user-minus"}]}],this.dificulties=[],this.selectedDificulties=[],this.filteredRooms=[],this.loading=!0,this.dificulties=Object.entries(this.game.gameConfig).map(([d,p])=>({difficulty:d,config:p})),this.selectedDificulties=this.dificulties}ngOnInit(){this.getRooms()}getRooms(){this.game.getAvailableRooms().subscribe(c=>{this.filteredRooms=c,this.loading=!1})}onDifficultyChange(){console.log("difficulties",this.selectedDificulties)}}return s.\u0275fac=function(c){return new(c||s)(r.Y36(Se.e8),r.Y36(ie))},s.\u0275cmp=r.Xpm({type:s,selectors:[["app-lobby"]],decls:13,vars:6,consts:[[1,"d-flex","align-items-center","flex-wrap","py-2",2,"background-color","var(--primary)"],["src","assets/minesweeper/bomb.png","alt","minesweeper bomb","height","45px",1,"ml-2"],[1,"m-1"],["optionLabel","difficulty","placeholder","Select a difficulty.",3,"ngModel","options","maxSelectedLabels","filter","showHeader","onChange","ngModelChange"],["pTemplate","selectedItems"],["pTemplate","item"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Refresh",1,"p-button-raised","p-button-warning",3,"click"],["pButton","","type","button","routerLink","/minesweeper/create",1,"p-button-raised","p-button-primary"],[1,"container","pb-2"],["class","room",4,"ngFor","ngForOf"],["class","d-inline",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-inline"],[1,"room"],["styleClass","m-2 p-2 room-toolbar"],[1,"p-toolbar-group-left"],["size","large","shape","circle",3,"image"],[1,"d-flex","flex-column"],[1,"m-0","ml-2"],[1,"d-inline","text-primary"],[1,"p-toolbar-group-right"],["pButton","","type","button","class","p-button-warning p-button-outlined p-button-rounded p-button-sm mr-2","icon","pi pi-unlock",4,"ngIf"],["pButton","","type","button","icon","pi pi-arrow-up","iconPos","left","label","Join",1,"p-button-primary","p-button-sm",3,"click"],["pButton","","type","button","icon","pi pi-unlock",1,"p-button-warning","p-button-outlined","p-button-rounded","p-button-sm","mr-2"]],template:function(c,l){1&c&&(r.TgZ(0,"div",0),r._UZ(1,"img",1),r.TgZ(2,"div",2)(3,"p-multiSelect",3),r.NdJ("onChange",function(){return l.onDifficultyChange()})("ngModelChange",function(p){return l.selectedDificulties=p}),r.YNc(4,lt,2,2,"ng-template",4),r.YNc(5,dt,2,3,"ng-template",5),r.qZA()(),r.TgZ(6,"div",2)(7,"button",6),r.NdJ("click",function(){return l.getRooms()}),r.qZA()(),r.TgZ(8,"div",2)(9,"button",7),r._uU(10," Create room "),r.qZA()()(),r.TgZ(11,"div",8),r.YNc(12,Ze,16,5,"div",9),r.qZA()),2&c&&(r.xp6(3),r.Q6J("ngModel",l.selectedDificulties)("options",l.dificulties)("maxSelectedLabels",0)("filter",!1)("showHeader",!1),r.xp6(9),r.Q6J("ngForOf",l.filteredRooms))},dependencies:[J.sg,J.O5,X.rH,V.JJ,V.On,_e.Hq,ft.jx,ut.q,ht.NU,Ce.o,J.rS],styles:[".room[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]     .room-toolbar:hover{background-color:var(--cyan-900);transition:background-color .2s ease}"]}),s})()},{path:"create",component:we},{path:"offline/:difficulty",component:Ue},{path:"offline",redirectTo:"offline/medium"}]}];let f=(()=>{class s{}return s.\u0275fac=function(c){return new(c||s)},s.\u0275mod=r.oAB({type:s}),s.\u0275inj=r.cJS({imports:[X.Bz.forChild(a),X.Bz]}),s})(),i=(()=>{class s{}return s.\u0275fac=function(c){return new(c||s)},s.\u0275mod=r.oAB({type:s}),s.\u0275inj=r.cJS({imports:[J.ez,f,ne.m]}),s})()},5755:function(Bt,Ie){!function(C){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(a){return null!==a&&"object"==typeof a&&a.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ne=function(a,f){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(i[u]=s[u])})(a,f)};function J(a,f){if("function"!=typeof f&&null!==f)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function i(){this.constructor=a}ne(a,f),a.prototype=null===f?Object.create(f):(i.prototype=f.prototype,new i)}function P(a,f,i,s){return new(i||(i=Promise))(function(c,l){function d(M){try{m(s.next(M))}catch(D){l(D)}}function p(M){try{m(s.throw(M))}catch(D){l(D)}}function m(M){M.done?c(M.value):function u(c){return c instanceof i?c:new i(function(l){l(c)})}(M.value).then(d,p)}m((s=s.apply(a,f||[])).next())})}function k(a,f){var s,u,c,l,i={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return l={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function d(m){return function(M){return function p(m){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,u&&(c=2&m[0]?u.return:m[0]?u.throw||((c=u.return)&&c.call(u),0):u.next)&&!(c=c.call(u,m[1])).done)return c;switch(u=0,c&&(m=[2&m[0],c.value]),m[0]){case 0:case 1:c=m;break;case 4:return i.label++,{value:m[1],done:!1};case 5:i.label++,u=m[1],m=[0];continue;case 7:m=i.ops.pop(),i.trys.pop();continue;default:if(!(c=(c=i.trys).length>0&&c[c.length-1])&&(6===m[0]||2===m[0])){i=0;continue}if(3===m[0]&&(!c||m[1]>c[0]&&m[1]<c[3])){i.label=m[1];break}if(6===m[0]&&i.label<c[1]){i.label=c[1],c=m;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(m);break}c[2]&&i.ops.pop(),i.trys.pop();continue}m=f.call(a,i)}catch(M){m=[6,M],u=0}finally{s=c=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,M])}}}function ge(a,f){f.headers=a.headers||{},f.statusMessage=a.statusText,f.statusCode=a.status,f.data=a.response}function Y(a,f,i){return new Promise(function(s,u){i=i||{};var l,d,p,c=new XMLHttpRequest,m=i.body,M=i.headers||{};for(l in i.timeout&&(c.timeout=i.timeout),c.ontimeout=c.onerror=function(D){D.timeout="timeout"==D.type,u(D)},c.open(a,f.href||f),c.onload=function(){for(p=c.getAllResponseHeaders().trim().split(/[\r\n]+/),ge(c,c);d=p.shift();)d=d.split(": "),c.headers[d.shift().toLowerCase()]=d.join(": ");if((d=c.headers["content-type"])&&~d.indexOf("application/json"))try{c.data=JSON.parse(c.data,i.reviver)}catch(D){return ge(c,D),u(D)}(c.status>=400?u:s)(c)},typeof FormData<"u"&&m instanceof FormData||m&&"object"==typeof m&&(M["content-type"]="application/json",m=JSON.stringify(m)),c.withCredentials=!!i.withCredentials,M)c.setRequestHeader(l,M[l]);c.send(m)})}var Re=Y.bind(Y,"GET"),Ye=Y.bind(Y,"POST"),r=Y.bind(Y,"PATCH"),ie=Y.bind(Y,"DELETE"),me=Re,De=r,ve=Ye,re=Y.bind(Y,"PUT"),X=Y,V={del:ie,get:me,patch:De,post:ve,put:re,send:X},_e=Object.freeze(Object.assign(Object.create(null),V,{default:V,del:ie,get:me,patch:De,post:ve,put:re,send:X})),Pe=function(a){function f(i,s){var u=a.call(this,s)||this;return u.name="ServerError",u.code=i,u}return J(f,a),f}(Error);function te(a,f){if(this._offset=f,a instanceof ArrayBuffer)this._buffer=a,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(a))throw new Error("Invalid argument");this._buffer=a.buffer,this._view=new DataView(this._buffer,a.byteOffset,a.byteLength)}}function We(a,f,i){for(var s=0,u=0,c=i.length;u<c;u++)(s=i.charCodeAt(u))<128?a.setUint8(f++,s):s<2048?(a.setUint8(f++,192|s>>6),a.setUint8(f++,128|63&s)):s<55296||s>=57344?(a.setUint8(f++,224|s>>12),a.setUint8(f++,128|s>>6&63),a.setUint8(f++,128|63&s)):(u++,s=65536+((1023&s)<<10|1023&i.charCodeAt(u)),a.setUint8(f++,240|s>>18),a.setUint8(f++,128|s>>12&63),a.setUint8(f++,128|s>>6&63),a.setUint8(f++,128|63&s))}function oe(a,f,i){var s=typeof i,u=0,c=0,l=0,d=0,p=0,m=0;if("string"===s){if((p=function Xe(a){for(var f=0,i=0,s=0,u=a.length;s<u;s++)(f=a.charCodeAt(s))<128?i+=1:f<2048?i+=2:f<55296||f>=57344?i+=3:(s++,i+=4);return i}(i))<32)a.push(160|p),m=1;else if(p<256)a.push(217,p),m=2;else if(p<65536)a.push(218,p>>8,p),m=3;else{if(!(p<4294967296))throw new Error("String too long");a.push(219,p>>24,p>>16,p>>8,p),m=5}return f.push({_str:i,_length:p,_offset:a.length}),m+p}if("number"===s)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(a.push(i),1):i<256?(a.push(204,i),2):i<65536?(a.push(205,i>>8,i),3):i<4294967296?(a.push(206,i>>24,i>>16,i>>8,i),5):(l=i/Math.pow(2,32)>>0,a.push(207,l>>24,l>>16,l>>8,l,(d=i>>>0)>>24,d>>16,d>>8,d),9):i>=-32?(a.push(i),1):i>=-128?(a.push(208,i),2):i>=-32768?(a.push(209,i>>8,i),3):i>=-2147483648?(a.push(210,i>>24,i>>16,i>>8,i),5):(l=Math.floor(i/Math.pow(2,32)),a.push(211,l>>24,l>>16,l>>8,l,(d=i>>>0)>>24,d>>16,d>>8,d),9):(a.push(203),f.push({_float:i,_length:8,_offset:a.length}),9);if("object"===s){if(null===i)return a.push(192),1;if(Array.isArray(i)){if((p=i.length)<16)a.push(144|p),m=1;else if(p<65536)a.push(220,p>>8,p),m=3;else{if(!(p<4294967296))throw new Error("Array too large");a.push(221,p>>24,p>>16,p>>8,p),m=5}for(u=0;u<p;u++)m+=oe(a,f,i[u]);return m}if(i instanceof Date){var M=i.getTime();return l=Math.floor(M/Math.pow(2,32)),a.push(215,0,l>>24,l>>16,l>>8,l,(d=M>>>0)>>24,d>>16,d>>8,d),10}if(i instanceof ArrayBuffer){if((p=i.byteLength)<256)a.push(196,p),m=2;else if(p<65536)a.push(197,p>>8,p),m=3;else{if(!(p<4294967296))throw new Error("Buffer too large");a.push(198,p>>24,p>>16,p>>8,p),m=5}return f.push({_bin:i,_length:p,_offset:a.length}),m+p}if("function"==typeof i.toJSON)return oe(a,f,i.toJSON());var D=[],N="",H=Object.keys(i);for(u=0,c=H.length;u<c;u++)"function"!=typeof i[N=H[u]]&&D.push(N);if((p=D.length)<16)a.push(128|p),m=1;else if(p<65536)a.push(222,p>>8,p),m=3;else{if(!(p<4294967296))throw new Error("Object too large");a.push(223,p>>24,p>>16,p>>8,p),m=5}for(u=0;u<p;u++)m+=oe(a,f,N=D[u]),m+=oe(a,f,i[N]);return m}if("boolean"===s)return a.push(i?195:194),1;if("undefined"===s)return a.push(212,0,0),3;throw new Error("Could not encode")}function Ve(a){var f=[],i=[],s=oe(f,i,a),u=new ArrayBuffer(s),c=new DataView(u),l=0,d=0,p=-1;i.length>0&&(p=i[0]._offset);for(var m,M=0,D=0,N=0,H=f.length;N<H;N++)if(c.setUint8(d+N,f[N]),N+1===p){if(M=(m=i[l])._length,D=d+p,m._bin)for(var ze=new Uint8Array(m._bin),j=0;j<M;j++)c.setUint8(D+j,ze[j]);else m._str?We(c,D,m._str):void 0!==m._float&&c.setFloat64(D,m._float);d+=M,i[++l]&&(p=i[l]._offset)}return u}te.prototype._array=function(a){for(var f=new Array(a),i=0;i<a;i++)f[i]=this._parse();return f},te.prototype._map=function(a){for(var i={},s=0;s<a;s++)i[this._parse()]=this._parse();return i},te.prototype._str=function(a){var f=function Qe(a,f,i){for(var s="",u=0,c=f,l=f+i;c<l;c++){var d=a.getUint8(c);if(0!=(128&d))if(192!=(224&d))if(224!=(240&d)){if(240!=(248&d))throw new Error("Invalid byte "+d.toString(16));(u=(7&d)<<18|(63&a.getUint8(++c))<<12|(63&a.getUint8(++c))<<6|(63&a.getUint8(++c))<<0)>=65536?(u-=65536,s+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):s+=String.fromCharCode(u)}else s+=String.fromCharCode((15&d)<<12|(63&a.getUint8(++c))<<6|(63&a.getUint8(++c))<<0);else s+=String.fromCharCode((31&d)<<6|63&a.getUint8(++c));else s+=String.fromCharCode(d)}return s}(this._view,this._offset,a);return this._offset+=a,f},te.prototype._bin=function(a){var f=this._buffer.slice(this._offset,this._offset+a);return this._offset+=a,f},te.prototype._parse=function(){var f,a=this._view.getUint8(this._offset++),i=0,s=0,u=0,c=0;if(a<192)return a<128?a:a<144?this._map(15&a):a<160?this._array(15&a):this._str(31&a);if(a>223)return-1*(255-a+1);switch(a){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,[s,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(i)];case 202:return f=this._view.getFloat32(this._offset),this._offset+=4,f;case 203:return f=this._view.getFloat64(this._offset),this._offset+=8,f;case 204:return f=this._view.getUint8(this._offset),this._offset+=1,f;case 205:return f=this._view.getUint16(this._offset),this._offset+=2,f;case 206:return f=this._view.getUint32(this._offset),this._offset+=4,f;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),c=this._view.getUint32(this._offset+4),this._offset+=8,u+c;case 208:return f=this._view.getInt8(this._offset),this._offset+=1,f;case 209:return f=this._view.getInt16(this._offset),this._offset+=2,f;case 210:return f=this._view.getInt32(this._offset),this._offset+=4,f;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),c=this._view.getUint32(this._offset+4),this._offset+=8,u+c;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(u=this._view.getInt32(this._offset)*Math.pow(2,32),c=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+c)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")};var a,tt=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},nt=function(){function a(f){this.events=f}return a.prototype.send=function(f){f instanceof ArrayBuffer?this.ws.send(f):Array.isArray(f)&&this.ws.send(new Uint8Array(f).buffer)},a.prototype.connect=function(f){this.ws=new tt(f,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},a.prototype.close=function(f,i){this.ws.close(f,i)},a}(),ke=function(){function a(){this.events={},this.transport=new nt(this.events)}return a.prototype.send=function(f){this.transport.send(f)},a.prototype.connect=function(f){this.transport.connect(f)},a.prototype.close=function(f,i){this.transport.close(f,i)},a}(),Ne={};function xe(a,f){Ne[a]=f}function Ue(a){var f=Ne[a];if(!f)throw new Error("missing serializer: "+a);return f}C.Protocol=void 0,(a=C.Protocol||(C.Protocol={}))[a.HANDSHAKE=9]="HANDSHAKE",a[a.JOIN_ROOM=10]="JOIN_ROOM",a[a.ERROR=11]="ERROR",a[a.LEAVE_ROOM=12]="LEAVE_ROOM",a[a.ROOM_DATA=13]="ROOM_DATA",a[a.ROOM_STATE=14]="ROOM_STATE",a[a.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",a[a.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",C.ErrorCode=void 0,function(a){a[a.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",a[a.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",a[a.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",a[a.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",a[a.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",a[a.AUTH_FAILED=4215]="AUTH_FAILED",a[a.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(C.ErrorCode||(C.ErrorCode={}));let ot=()=>({events:{},emit(a,...f){(this.events[a]||[]).forEach(i=>i(...f))},on(a,f){return(this.events[a]=this.events[a]||[]).push(f),()=>this.events[a]=(this.events[a]||[]).filter(i=>i!==f)}});var st=function(){function a(){this.handlers=[]}return a.prototype.register=function(f,i){return this.handlers.push(f),this},a.prototype.invoke=function(){for(var f=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];this.handlers.forEach(function(u){return u.apply(f,i)})},a.prototype.invokeAsync=function(){for(var f=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Promise.all(this.handlers.map(function(u){return u.apply(f,i)}))},a.prototype.remove=function(f){var i=this.handlers.indexOf(f);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()},a.prototype.clear=function(){this.handlers=[]},a}();function le(){var a=new st;function f(i){return a.register(i,null===this)}return f.once=function(i){var s=function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];i.apply(this,u),a.remove(s)};a.register(s)},f.remove=function(i){return a.remove(i)},f.invoke=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return a.invoke.apply(a,i)},f.invokeAsync=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return a.invokeAsync.apply(a,i)},f.clear=function(){return a.clear()},f}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var ye,K=function ct(a){var f={exports:{}};return a(f,f.exports),f.exports}(function(a,f){var s;s=function(i){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var h in o)Object.prototype.hasOwnProperty.call(o,h)&&(n[h]=o[h])})(t,e)};function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function c(t,e,n,o){var y,h=arguments.length,g=h<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,e,n,o);else for(var v=t.length-1;v>=0;v--)(y=t[v])&&(g=(h<3?y(g):h>3?y(e,n,g):y(e,n))||g);return h>3&&g&&Object.defineProperty(e,n,g),g}function l(t,e){for(var n=0,o=e.length,h=t.length;n<o;n++,h++)t[h]=e[n];return t}var t,d=255;i.OPERATION=void 0,(t=i.OPERATION||(i.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var m=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(e,n,o){void 0===o&&(o=!0),this.refs.set(e,n),o&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},t.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(n){if(e.refCounts[n]<=0){var o=e.refs.get(n);if(o instanceof Z)for(var h in o._definition.schema)"string"!=typeof o._definition.schema[h]&&o[h]&&o[h].$changes&&e.removeRef(o[h].$changes.refId);else{var g=o.$changes.parent._definition;"function"==typeof Object.values(g.schema[g.fieldsByIndex[o.$changes.parentIndex]])[0]&&Array.from(o.values()).forEach(function(v){return e.removeRef(v.$changes.refId)})}e.refs.delete(n),delete e.refCounts[n]}}),this.deletedRefs.clear()},t}(),M=function(){function t(e,n,o){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(n,o)}return t.prototype.setParent=function(e,n,o){var h=this;if(this.indexes||(this.indexes=this.ref instanceof Z?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=o,n)if(this.root=n,this.ref instanceof Z){var g=this.ref._definition;for(var y in g.schema){var v=this.ref[y];v&&v.$changes&&v.$changes.setParent(this.ref,n,g.indexes[y])}}else"object"==typeof this.ref&&this.ref.forEach(function(O,_){O instanceof Z&&O.$changes.setParent(h.ref,h.root,h.ref.$changes.indexes[_])})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(e,n){void 0===n&&(n=i.OPERATION.ADD);var o="number"==typeof e?e:this.indexes[e];this.assertValidIndex(o,e);var h=this.changes.get(o);(!h||h.op===i.OPERATION.DELETE||h.op===i.OPERATION.TOUCH)&&this.changes.set(o,{op:h&&h.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:n,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},t.prototype.touch=function(e){var n="number"==typeof e?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:i.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[e]];var n=this.parent._definition;return Object.values(n.schema[n.fieldsByIndex[this.parentIndex]])[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(e){var n="number"==typeof e?e:this.indexes[e];if(void 0!==n){var o=this.getValue(n);this.changes.set(n,{op:i.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+n+")")},t.prototype.discard=function(e,n){var o=this;void 0===e&&(e=!1),void 0===n&&(n=!1),this.ref instanceof Z||this.changes.forEach(function(h){if(h.op===i.OPERATION.DELETE){var g=o.ref.getIndex(h.index);delete o.indexes[g]}}),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(n){var o=e.getValue(n.index);o&&o.$changes&&o.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,n){this.caches[e]=n},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,n){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+n+'"')},t}(),D=function(t,e){var n=t.toString(),o=e.toString();return n<o?-1:n>o?1:0};function N(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"==typeof n||isNaN(n)?e[n]:e.at(n)},set:function(e,n,o){if("symbol"==typeof n||isNaN(n))e[n]=o;else{var h=Array.from(e.$items.keys()),g=parseInt(h[n]||n);null==o?e.deleteAt(g):e.setAt(g,o)}return!0},deleteProperty:function(e,n){return"number"==typeof n?e.deleteAt(n):delete e[n],!0}})}var H=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.$changes=new M(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var h;return n.forEach(function(g){h=e.$refId++,e.setAt(h,g)}),h},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var n=this.$items.get(e);return this.$items.delete(e),n}},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.setAt=function(e,n){var o,h;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,e);var g=null!==(h=null===(o=this.$changes.indexes[e])||void 0===o?void 0:o.op)&&void 0!==h?h:i.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,g)},t.prototype.deleteAt=function(e){var n=Array.from(this.$items.keys())[e];return void 0!==n&&this.$deleteAt(n)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(o){n.$changes.root.removeRef(o.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new(t.bind.apply(t,l([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(h,g){e.setAt(n[g],h)}),this},t.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var o=this.$items.get(n);return this.$deleteAt(n),o}},t.prototype.slice=function(e,n){return new(t.bind.apply(t,l([void 0],Array.from(this.$items.values()).slice(e,n))))},t.prototype.sort=function(e){var n=this;void 0===e&&(e=D);var o=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(g,y){n.setAt(o[y],g)}),this},t.prototype.splice=function(e,n){void 0===n&&(n=this.length-e);for(var o=[],h=2;h<arguments.length;h++)o[h-2]=arguments[h];for(var g=Array.from(this.$items.keys()),y=[],v=e;v<e+n;v++)y.push(this.$items.get(g[v])),this.$deleteAt(g[v]);return y},t.prototype.unshift=function(){for(var e=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var h=this.length,g=n.length,y=Array.from(this.$items.values());return n.forEach(function(v,T){e.setAt(T,v)}),y.forEach(function(v,T){e.setAt(g+T,v)}),h+g},t.prototype.indexOf=function(e,n){return Array.from(this.$items.values()).indexOf(e,n)},t.prototype.lastIndexOf=function(e,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,n)},t.prototype.every=function(e,n){return Array.from(this.$items.values()).every(e,n)},t.prototype.some=function(e,n){return Array.from(this.$items.values()).some(e,n)},t.prototype.forEach=function(e,n){Array.from(this.$items.values()).forEach(e,n)},t.prototype.map=function(e,n){return Array.from(this.$items.values()).map(e,n)},t.prototype.filter=function(e,n){return Array.from(this.$items.values()).filter(e,n)},t.prototype.reduce=function(e,n){return Array.from(this.$items.values()).reduce(e,n)},t.prototype.reduceRight=function(e,n){return Array.from(this.$items.values()).reduceRight(e,n)},t.prototype.find=function(e,n){return Array.from(this.$items.values()).find(e,n)},t.prototype.findIndex=function(e,n){return Array.from(this.$items.values()).findIndex(e,n)},t.prototype.fill=function(e,n,o){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,n,o){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,n){return Array.from(this.$items.values()).includes(e,n)},t.prototype.flatMap=function(e,n){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},t.prototype.clone=function(e){return e?new(t.bind.apply(t,l([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,l([void 0],this.map(function(o){return o.$changes?o.clone():o}))))},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}();function ze(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"!=typeof n&&typeof e[n]>"u"?e.get(n):e[n]},set:function(e,n,o){return"symbol"!=typeof n&&-1===n.indexOf("$")&&"onAdd"!==n&&"onRemove"!==n&&"onChange"!==n?e.set(n,o):e[n]=o,!0},deleteProperty:function(e,n){return e.delete(n),!0}})}var j=function(){function t(e){var n=this;if(this.$changes=new M(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(h,g){return n.set(g,h)});else for(var o in e)this.set(o,e[o])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(e,n){if(null==n)throw new Error("MapSchema#set('"+e+"', "+n+"): trying to set "+n+" value on '"+e+"'.");var o=typeof this.$changes.indexes[e]<"u",h=o?this.$changes.indexes[e]:this.$refId++,g=o?i.OPERATION.REPLACE:i.OPERATION.ADD,y=void 0!==n.$changes;return y&&n.$changes.setParent(this,this.$changes.root,h),o?y&&this.$items.get(e)!==n&&(g=i.OPERATION.ADD):(this.$changes.indexes[e]=h,this.$indexes.set(h,e)),this.$items.set(e,n),this.$changes.change(e,g),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(o){n.$changes.root.removeRef(o.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(n,o){e[o]="function"==typeof n.toJSON?n.toJSON():n}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(o,h){n.set(h,o.$changes?o.clone():o)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),Mt={};function Oe(t,e){Mt[t]=e}function Je(t){return Mt[t]}var gt=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(e,n){var o=this.getNextFieldIndex();this.fieldsByIndex[o]=e,this.indexes[e]=o,this.schema[e]=Array.isArray(n)?{array:n[0]}:n},t.prototype.addFilter=function(e,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=n,this.indexesWithFilters.push(this.indexes[e]),!0},t.prototype.addChildrenFilter=function(e,n){var o=this.indexes[e];if(Je(Object.keys(this.schema[e])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[o]=n,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},t.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();var je=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(e){return this.schemas.has(e)},t.prototype.get=function(e){return this.types[e]},t.prototype.add=function(e,n){void 0===n&&(n=this.schemas.size),e._definition=gt.create(e._definition),e._typeid=n,this.types[n]=e,this.schemas.set(e,n)},t.create=function(e){return void 0===e&&(e=new t),function(n){return Q(n,e)}},t}(),Tt=new je;function Q(t,e){return void 0===e&&(e=Tt),function(n,o){var h=n.constructor;h._context=e,e.has(h)||e.add(h);var g=h._definition;if(g.addField(o,t),g.descriptors[o]){if(g.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '"+o+"' definition on '"+h.name+"'.\nCheck @type() annotation")}catch(x){var y=x.stack.split("\n")[4].trim();throw new Error(x.message+" "+y)}}var v=H.is(t),T=!v&&j.is(t);if("string"!=typeof t&&!Z.is(t)){var O=Object.values(t)[0];"string"!=typeof O&&!e.has(O)&&e.add(O)}var _="_"+o;g.descriptors[_]={enumerable:!1,configurable:!1,writable:!0},g.descriptors[o]={get:function(){return this[_]},set:function(x){x!==this[_]&&(null!=x?(v&&!(x instanceof H)&&(x=new(H.bind.apply(H,l([void 0],x)))),T&&!(x instanceof j)&&(x=new j(x)),void 0===x.$proxy&&(T?x=ze(x):v&&(x=N(x))),this.$changes.change(o),x.$changes&&x.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this.$changes.delete(o),this[_]=x)},enumerable:!0,configurable:!0}}}function It(t,e,n){for(var o=0,h=0,g=n.length;h<g;h++)(o=n.charCodeAt(h))<128?t[e++]=o:o<2048?(t[e++]=192|o>>6,t[e++]=128|63&o):o<55296||o>=57344?(t[e++]=224|o>>12,t[e++]=128|o>>6&63,t[e++]=128|63&o):(h++,o=65536+((1023&o)<<10|1023&n.charCodeAt(h)),t[e++]=240|o>>18,t[e++]=128|o>>12&63,t[e++]=128|o>>6&63,t[e++]=128|63&o)}function Rt(t,e){t.push(255&e)}function B(t,e){t.push(255&e)}function St(t,e){t.push(255&e),t.push(e>>8&255)}function mt(t,e){t.push(255&e),t.push(e>>8&255)}function $e(t,e){t.push(255&e),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function se(t,e){var n=e>>24,o=e>>16,h=e>>8;t.push(255&e),t.push(255&h),t.push(255&o),t.push(255&n)}function Dt(t,e){var n=Math.floor(e/Math.pow(2,32));se(t,e>>>0),se(t,n)}function Pt(t,e){var n=e/Math.pow(2,32)>>0;se(t,e>>>0),se(t,n)}var be=new Int32Array(2),Vt=new Float32Array(be.buffer),en=new Float64Array(be.buffer);function kt(t,e){Vt[0]=e,$e(t,be[0])}function vt(t,e){en[0]=e,$e(t,be[0]),$e(t,be[1])}function Be(t,e){e||(e="");var n=function Kt(t){for(var e=0,n=0,o=0,h=t.length;o<h;o++)(e=t.charCodeAt(o))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(o++,n+=4);return n}(e),o=0;if(n<32)t.push(160|n),o=1;else if(n<256)t.push(217),B(t,n),o=2;else if(n<65536)t.push(218),mt(t,n),o=3;else{if(!(n<4294967296))throw new Error("String too long");t.push(219),se(t,n),o=5}return It(t,t.length,e),o+n}function q(t,e){return isNaN(e)?q(t,0):isFinite(e)?e!==(0|e)?(t.push(203),vt(t,e),9):e>=0?e<128?(B(t,e),1):e<256?(t.push(204),B(t,e),2):e<65536?(t.push(205),mt(t,e),3):e<4294967296?(t.push(206),se(t,e),5):(t.push(207),Pt(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),Rt(t,e),2):e>=-32768?(t.push(209),St(t,e),3):e>=-2147483648?(t.push(210),$e(t,e),5):(t.push(211),Dt(t,e),9):q(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var _t=Object.freeze({__proto__:null,utf8Write:It,int8:Rt,uint8:B,int16:St,uint16:mt,int32:$e,uint32:se,int64:Dt,uint64:Pt,float32:function Wt(t,e){kt(t,e)},float64:function Xt(t,e){vt(t,e)},writeFloat32:kt,writeFloat64:vt,boolean:function tn(t,e){return B(t,e?1:0)},string:Be,number:q});function Nt(t,e){return Ee(t,e)<<24>>24}function Ee(t,e){return t[e.offset++]}function Ut(t,e){return He(t,e)<<16>>16}function He(t,e){return t[e.offset++]|t[e.offset++]<<8}function ae(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function de(t,e){return ae(t,e)>>>0}function Ft(t,e){var n=de(t,e);return ae(t,e)*Math.pow(2,32)+n}function Lt(t,e){var n=de(t,e);return de(t,e)*Math.pow(2,32)+n}var Me=new Int32Array(2),sn=new Float32Array(Me.buffer),an=new Float64Array(Me.buffer);function xt(t,e){return Me[0]=ae(t,e),sn[0]}function yt(t,e){return Me[0]=ae(t,e),Me[1]=ae(t,e),an[0]}function Zt(t,e){var o,n=t[e.offset++];n<192?o=31&n:217===n?o=Ee(t,e):218===n?o=He(t,e):219===n&&(o=de(t,e));var h=function nn(t,e,n){for(var o="",h=0,g=e,y=e+n;g<y;g++){var v=t[g];0!=(128&v)?192!=(224&v)?224!=(240&v)?240!=(248&v)?console.error("Invalid byte "+v.toString(16)):(h=(7&v)<<18|(63&t[++g])<<12|(63&t[++g])<<6|(63&t[++g])<<0)>=65536?(h-=65536,o+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):o+=String.fromCharCode(h):o+=String.fromCharCode((15&v)<<12|(63&t[++g])<<6|(63&t[++g])<<0):o+=String.fromCharCode((31&v)<<6|63&t[++g]):o+=String.fromCharCode(v)}return o}(t,e.offset,o);return e.offset+=o,h}function ce(t,e){var n=t[e.offset++];return n<128?n:202===n?xt(t,e):203===n?yt(t,e):204===n?Ee(t,e):205===n?He(t,e):206===n?de(t,e):207===n?Lt(t,e):208===n?Nt(t,e):209===n?Ut(t,e):210===n?ae(t,e):211===n?Ft(t,e):n>223?-1*(255-n+1):void 0}function zt(t,e){return t[e.offset-1]===d&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var Jt=Object.freeze({__proto__:null,int8:Nt,uint8:Ee,int16:Ut,uint16:He,int32:ae,uint32:de,float32:function rn(t,e){return xt(t,e)},float64:function on(t,e){return yt(t,e)},int64:Ft,uint64:Lt,readFloat32:xt,readFloat64:yt,boolean:function cn(t,e){return Ee(t,e)>0},string:Zt,stringCheck:function fn(t,e){var n=t[e.offset];return n<192&&n>160||217===n||218===n||219===n},number:ce,numberCheck:function un(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211},arrayCheck:function hn(t,e){return t[e.offset]<160},switchStructureCheck:zt}),wt=function(){function t(e){var n=this;this.$changes=new M(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(o){return n.add(o)})}return t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var n=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,e),this.$changes.change(n),n},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var o,h,n=this.$items.entries();(h=n.next())&&!h.done;)if(e===h.value[1]){o=h.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(o){n.$changes.root.removeRef(o.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(n){return n===e})},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(o,h,g){return e(o,h,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,o){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(o){n.add(o.$changes?o.clone():o)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),Ct=function(){function t(e){var n=this;this.$changes=new M(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(o){return n.add(o)})}return t.is=function(e){return void 0!==e.set},t.prototype.add=function(e){var n,o;if(this.has(e))return!1;var h=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,h);var g=null!==(o=null===(n=this.$changes.indexes[h])||void 0===n?void 0:n.op)&&void 0!==o?o:i.OPERATION.ADD;return this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,e),this.$changes.change(h,g),h},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var o,h,n=this.$items.entries();(h=n.next())&&!h.done;)if(e===h.value[1]){o=h.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(o){n.$changes.root.removeRef(o.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var h,n=this.$items.values(),o=!1;(h=n.next())&&!h.done;)if(e===h.value){o=!0;break}return o},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(o,h,g){return e(o,h,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,o){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(o){n.add(o.$changes?o.clone():o)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),ln=function(){function t(){this.handlers=[]}return t.prototype.register=function(e,n){return this.handlers.push(e),this},t.prototype.invoke=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.handlers.forEach(function(o){return o.apply(void 0,e)})},t.prototype.invokeAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Promise.all(this.handlers.map(function(o){return o.apply(void 0,e)}))},t.prototype.remove=function(e){var n=this.handlers.indexOf(e);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}(),dn=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return void 0===e.$filterState&&(e.$filterState=new t),e.$filterState},t}(),At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e}(Error);function jt(t,e,n,o){if(!(t instanceof e))throw new At("a '"+e.name+"' was expected, but '"+t.constructor.name+"' was provided in "+n.constructor.name+"#"+o)}function gn(t,e,n,o,h){!function pn(t,e,n,o){var h,g=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":h="number",isNaN(t)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+o);break;case"string":h="string",g=!0;break;case"boolean":return}if(typeof t!==h&&(!g||g&&null!==t)){var y="'"+JSON.stringify(t)+"'"+(t&&t.constructor&&" ("+t.constructor.name+")"||"");throw new At("a '"+h+"' was expected, but "+y+" was provided in "+n.constructor.name+"#"+o)}}(n,t,o,h);var g=_t[t];if(!g)throw new At("a '"+t+"' was expected, but "+n+" was provided in "+o.constructor.name+"#"+h);g(e,n)}function mn(t,e,n){return Jt[t](e,n)}var Z=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new M(this,void 0,new m),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var o=this._definition.descriptors;o&&Object.defineProperties(this,o),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.listen=function(e,n){var o=this;return this.$listeners[e]||(this.$listeners[e]=new ln),this.$listeners[e].register(n),function(){return o.$listeners[e].remove(n)}},t.prototype.decode=function(e,n,o,h){void 0===n&&(n={offset:0}),void 0===o&&(o=this),void 0===h&&(h=new Map);var g=this.$changes.root,y=e.length,v=0,T=[];for(g.refs.set(v,this),h.set(v,T);n.offset<y;){var O=e[n.offset++];if(O!=d){var x=o.$changes,S=void 0!==o._definition,E=S?O>>6<<6:O;if(E!==i.OPERATION.CLEAR){var A=S?O%(E||255):ce(e,n),b=S?o._definition.fieldsByIndex[A]:"",R=x.getType(A),w=void 0,I=void 0,z=void 0;if(S?I=o["_"+b]:(I=o.getByIndex(A),(E&i.OPERATION.ADD)===i.OPERATION.ADD?(z=o instanceof j?Zt(e,n):A,o.setIndex(A,z)):z=o.getIndex(A)),(E&i.OPERATION.DELETE)===i.OPERATION.DELETE&&(E!==i.OPERATION.DELETE_AND_ADD&&o.deleteByIndex(A),I&&I.$changes&&g.removeRef(I.$changes.refId),w=null),void 0!==b){if(E!==i.OPERATION.DELETE)if(t.is(R)){var U=ce(e,n);if(w=g.refs.get(U),E!==i.OPERATION.REPLACE){var W=this.getSchemaType(e,n,R);w||((w=this.createTypeInstance(W)).$changes.refId=U,I&&(w.onChange=I.onChange,w.onRemove=I.onRemove,w.$listeners=I.$listeners,I.$changes.refId&&U!==I.$changes.refId&&g.removeRef(I.$changes.refId))),g.addRef(U,w,w!==I)}}else if("string"==typeof R)w=mn(R,e,n);else{var Te=Je(Object.keys(R)[0]),G=ce(e,n),F=g.refs.has(G)?I||g.refs.get(G):new Te.constructor;if((w=F.clone(!0)).$changes.refId=G,I&&(w.onAdd=I.onAdd,w.onRemove=I.onRemove,w.onChange=I.onChange,I.$changes.refId&&G!==I.$changes.refId)){g.removeRef(I.$changes.refId);for(var L=[],bt=I.entries(),ee=void 0;(ee=bt.next())&&!ee.done;){var qe=ee.value;L.push({op:i.OPERATION.DELETE,field:qe[0],value:void 0,previousValue:qe[1]})}h.set(I.$changes.refId,L)}g.addRef(G,w,F!==I),Te.getProxy&&(w=Te.getProxy(w))}var xn=I!==w;if(null!=w)if(w.$changes&&w.$changes.setParent(x.ref,x.root,A),o instanceof t)o[b]=w;else if(o instanceof j)o.$items.set(z,w);else if(o instanceof H)o.setAt(A,w);else if(o instanceof wt){var Ge=o.add(w);o.setIndex(A,Ge)}else o instanceof Ct&&!1!==(Ge=o.add(w))&&o.setIndex(A,Ge);xn&&T.push({op:E,field:b,dynamicIndex:z,value:w,previousValue:I})}else{console.warn("@colyseus/schema: definition mismatch");for(var $={offset:n.offset};n.offset<y&&(!zt(e,n)||($.offset=n.offset+1,!g.refs.has(ce(e,$))));)n.offset++}}else o.clear(!0)}else{v=ce(e,n);var _=g.refs.get(v);if(!_)throw new Error('"refId" not found: '+v);o=_,h.set(v,T=[])}}return this._triggerChanges(h),g.garbageCollectDeletedRefs(),h},t.prototype.encode=function(e,n,o){void 0===e&&(e=!1),void 0===n&&(n=[]),void 0===o&&(o=!1);for(var h=this.$changes,g=new WeakSet,y=[h],v=1,T=0;T<v;T++){var O=y[T],_=O.ref,x=_ instanceof t;O.ensureRefId(),g.add(O),O!==h&&(O.changed||e)&&(B(n,d),q(n,O.refId));for(var S=Array.from(e?O.allChanges:O.changes.values()),E=0,A=S.length;E<A;E++){var b=e?{op:i.OPERATION.ADD,index:S[E]}:S[E],R=b.index,w=x?_._definition.fieldsByIndex&&_._definition.fieldsByIndex[R]:R,I=n.length;if(b.op!==i.OPERATION.TOUCH)if(x)B(n,R|b.op);else{if(B(n,b.op),b.op===i.OPERATION.CLEAR)continue;q(n,R)}if(!x&&(b.op&i.OPERATION.ADD)==i.OPERATION.ADD&&_ instanceof j&&Be(n,O.ref.$indexes.get(R)),b.op!==i.OPERATION.DELETE){var $=O.getType(R),U=O.getValue(R);if(U&&U.$changes&&!g.has(U.$changes)&&(y.push(U.$changes),U.$changes.ensureRefId(),v++),b.op!==i.OPERATION.TOUCH){if(t.is($))jt(U,$,_,w),q(n,U.$changes.refId),(b.op&i.OPERATION.ADD)===i.OPERATION.ADD&&this.tryEncodeTypeId(n,$,U.constructor);else if("string"==typeof $)gn($,n,U,_,w);else{var W=Je(Object.keys($)[0]);jt(_["_"+w],W.constructor,_,w),q(n,U.$changes.refId)}o&&O.cache(R,n.slice(I))}}}!e&&!o&&O.discard()}return n},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(e,n){var o,h;void 0===n&&(n=!1);for(var g=this,y=new Set,v=dn.get(e),T=[this.$changes],O=1,_=[],x=function(E){var A=T[E];if(y.has(A.refId))return"continue";var b=A.ref,R=b instanceof t;B(_,d),q(_,A.refId);var w=v.refIds.has(A),I=n||!w;v.addRefId(A);var z=v.containerIndexes.get(A),$=Array.from(I?A.allChanges:A.changes.values());!n&&R&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach(function(pe){!z.has(pe)&&A.allChanges.has(pe)&&$.push(I?pe:{op:i.OPERATION.ADD,index:pe})});for(var W=0,Te=$.length;W<Te;W++){var G=I?{op:i.OPERATION.ADD,index:$[W]}:$[W];if(G.op!==i.OPERATION.CLEAR){var F=G.index;if(G.op!==i.OPERATION.DELETE){var L=A.getValue(F),bt=A.getType(F);if(R){if((ee=b._definition.filters&&b._definition.filters[F])&&!ee.call(b,e,L,g)){L&&L.$changes&&y.add(L.$changes.refId);continue}}else{var ee,qe=A.parent;if((ee=A.getChildrenFilter())&&!ee.call(qe,e,b.$indexes.get(F),L,g)){L&&L.$changes&&y.add(L.$changes.refId);continue}}if(L.$changes&&(T.push(L.$changes),O++),G.op!==i.OPERATION.TOUCH)if(G.op===i.OPERATION.ADD||R)_.push.apply(_,null!==(o=A.caches[F])&&void 0!==o?o:[]),z.add(F);else if(z.has(F))_.push.apply(_,null!==(h=A.caches[F])&&void 0!==h?h:[]);else{if(z.add(F),B(_,i.OPERATION.ADD),q(_,F),b instanceof j){var ue=A.ref.$indexes.get(F);Be(_,ue)}L.$changes?q(_,L.$changes.refId):_t[bt](_,L)}else L.$changes&&!R&&(B(_,i.OPERATION.ADD),q(_,F),b instanceof j&&(ue=A.ref.$indexes.get(F),Be(_,ue)),q(_,L.$changes.refId))}else R?B(_,G.op|F):(B(_,G.op),q(_,F))}else B(_,G.op)}},S=0;S<O;S++)x(S);return _},t.prototype.clone=function(){var e=new this.constructor,n=this._definition.schema;for(var o in n)e[o]="object"==typeof this[o]&&"function"==typeof this[o].clone?this[o].clone():this[o];return e},t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(n){t.onError(n)}}},t.prototype.toJSON=function(){var e=this._definition.schema,n=this._definition.deprecated,o={};for(var h in e)!n[h]&&null!==this[h]&&typeof this[h]<"u"&&(o[h]="function"==typeof this[h].toJSON?this[h].toJSON():this["_"+h]);return o},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,n,o){n._typeid!==o._typeid&&(B(e,213),q(e,o._typeid))},t.prototype.getSchemaType=function(e,n,o){var h;return 213===e[n.offset]&&(n.offset++,h=this.constructor._context.get(ce(e,n))),h||o},t.prototype.createTypeInstance=function(e){var n=new e;return n.$changes.root=this.$changes.root,n},t.prototype._triggerAllFillChanges=function(e,n){if(!n.has(e.$changes.refId)){var o=[];if(n.set(e.$changes.refId||0,o),e instanceof t){var h=e._definition.schema;for(var g in h)void 0!==(v=e["_"+g])&&(o.push({op:i.OPERATION.ADD,field:g,value:v,previousValue:void 0}),void 0!==v.$changes&&t.prototype._triggerAllFillChanges.call(this,v,n))}else for(var T=e.entries(),O=void 0;(O=T.next())&&!O.done;){var v,_=O.value,x=_[0];o.push({op:i.OPERATION.ADD,field:x,dynamicIndex:x,value:v=_[1],previousValue:void 0}),void 0!==v.$changes&&t.prototype._triggerAllFillChanges.call(this,v,n)}}},t.prototype._triggerChanges=function(e){var n=this;e.forEach(function(o,h){var g,y,v,T,O,_,x,S,E,A,b,R;if(o.length>0){for(var w=n.$changes.root.refs.get(h),I=w instanceof t,z=0;z<o.length;z++){var $=o[z],U=w.$listeners&&w.$listeners[$.field];if(I||($.op===i.OPERATION.ADD&&void 0===$.previousValue?null===(y=(g=w).onAdd)||void 0===y||y.call(g,$.value,null!==(v=$.dynamicIndex)&&void 0!==v?v:$.field):$.op===i.OPERATION.DELETE?void 0!==$.previousValue&&(null===(O=(T=w).onRemove)||void 0===O||O.call(T,$.previousValue,null!==(_=$.dynamicIndex)&&void 0!==_?_:$.field)):$.op===i.OPERATION.DELETE_AND_ADD?(void 0!==$.previousValue&&(null===(S=(x=w).onRemove)||void 0===S||S.call(x,$.previousValue,$.dynamicIndex)),null===(A=(E=w).onAdd)||void 0===A||A.call(E,$.value,$.dynamicIndex)):($.op===i.OPERATION.REPLACE||$.value!==$.previousValue)&&(null===(R=(b=w).onChange)||void 0===R||R.call(b,$.value,$.dynamicIndex))),($.op&i.OPERATION.DELETE)===i.OPERATION.DELETE&&$.previousValue instanceof t&&$.previousValue.onRemove&&$.previousValue.onRemove(),U)try{U.invoke($.value,$.previousValue)}catch(W){t.onError(W)}}if(I&&w.onChange)try{w.onChange(o)}catch(W){t.onError(W)}}})},t._definition=gt.create(),t}();var fe=new je,Ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),c([Q("string",fe)],e.prototype,"name",void 0),c([Q("string",fe)],e.prototype,"type",void 0),c([Q("number",fe)],e.prototype,"referencedType",void 0),e}(Z),$t=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.fields=new H,n}return u(e,t),c([Q("number",fe)],e.prototype,"id",void 0),c([Q([Ot],fe)],e.prototype,"fields",void 0),e}(Z),_n=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.types=new H,n}return u(e,t),e.encode=function(n){var o=n.constructor,h=new e;h.rootType=o._typeid;var g=function(O,_){for(var x in _){var S=new Ot;S.name=x;var E=void 0;if("string"==typeof _[x])E=_[x];else{var A=_[x],b=void 0;Z.is(A)?(E="ref",b=_[x]):"string"==typeof A[E=Object.keys(A)[0]]?E+=":"+A[E]:b=A[E],S.referencedType=b?b._typeid:-1}S.type=E,O.fields.push(S)}h.types.push(O)},y=o._context.types;for(var v in y){var T=new $t;T.id=Number(v),g(T,y[v]._definition.schema)}return h.encodeAll()},e.decode=function(n,o){var h=new je,g=new e;g.decode(n,o);var y=g.types.reduce(function(x,S){var E=function(b){function R(){return null!==b&&b.apply(this,arguments)||this}return u(R,b),R}(Z),A=S.id;return x[A]=E,h.add(E,A),x},{});g.types.forEach(function(x){var S=y[x.id];x.fields.forEach(function(E){var A;if(void 0!==E.referencedType){var b=E.type,R=y[E.referencedType];if(!R){var w=E.type.split(":");b=w[0],R=w[1]}"ref"===b?Q(R,h)(S.prototype,E.name):Q(((A={})[b]=R,A),h)(S.prototype,E.name)}else Q(E.type,h)(S.prototype,E.name)})});var v=y[g.rootType],T=new v;for(var O in v._definition.schema){var _=v._definition.schema[O];"string"!=typeof _&&(T[O]="function"==typeof _?new _:new(Je(Object.keys(_)[0]).constructor))}return T},c([Q([$t],fe)],e.prototype,"types",void 0),c([Q("number",fe)],e.prototype,"rootType",void 0),e}(Z);Oe("map",{constructor:j,getProxy:ze}),Oe("array",{constructor:H,getProxy:N}),Oe("set",{constructor:Ct}),Oe("collection",{constructor:wt}),i.ArraySchema=H,i.CollectionSchema=wt,i.Context=je,i.MapSchema=j,i.Reflection=_n,i.ReflectionField=Ot,i.ReflectionType=$t,i.Schema=Z,i.SchemaDefinition=gt,i.SetSchema=Ct,i.decode=Jt,i.defineTypes=function Qt(t,e,n){for(var o in void 0===n&&(n=t._context||Tt),e)Q(e[o],n)(t.prototype,o);return t},i.deprecated=function Yt(t,e){return void 0===t&&(t=!0),function(n,o){var g=n.constructor._definition;g.deprecated[o]=!0,t&&(g.descriptors[o]={get:function(){throw new Error(o+" is deprecated.")},set:function(y){},enumerable:!1,configurable:!0})}},i.dumpChanges=function vn(t){for(var e=[t.$changes],o={},h=o,g=function(v){var T=e[v];T.changes.forEach(function(O){var _=T.ref,x=O.index,S=_._definition?_._definition.fieldsByIndex[x]:_.$indexes.get(x);h[S]=T.getValue(x)})},y=0;y<1;y++)g(y);return o},i.encode=_t,i.filter=function qt(t){return function(e,n){var o=e.constructor;o._definition.addFilter(n,t)&&(o._context.useFilters=!0)}},i.filterChildren=function Gt(t){return function(e,n){var o=e.constructor;o._definition.addChildrenFilter(n,t)&&(o._context.useFilters=!0)}},i.hasFilter=function Ht(t){return t._context&&t._context.useFilters},i.registerType=Oe,i.type=Q,Object.defineProperty(i,"__esModule",{value:!0})},s(f)}),Fe=function(){function a(f,i){var s=this;this.onStateChange=le(),this.onError=le(),this.onLeave=le(),this.onJoin=le(),this.hasJoined=!1,this.onMessageHandlers=ot(),this.id=null,this.name=f,i&&(this.serializer=new(Ue("schema")),this.rootSchema=i,this.serializer.state=new i),this.onError(function(u,c){return console.warn("colyseus.js - onError => ("+u+") "+c)}),this.onLeave(function(){return s.removeAllListeners()})}return a.prototype.connect=function(f){var i=this;this.connection=new ke,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(s){if(!i.hasJoined)return console.warn("Room connection was closed unexpectedly ("+s.code+"): "+s.reason),void i.onError.invoke(s.code,s.reason);i.onLeave.invoke(s.code),i.destroy()},this.connection.events.onerror=function(s){console.warn("Room, onError ("+s.code+"): "+s.reason),i.onError.invoke(s.code,s.reason)},this.connection.connect(f)},a.prototype.leave=function(f){var i=this;return void 0===f&&(f=!0),new Promise(function(s){i.onLeave(function(u){return s(u)}),i.connection?f?i.connection.send([C.Protocol.LEAVE_ROOM]):i.connection.close():i.onLeave.invoke(4e3)})},a.prototype.onMessage=function(f,i){return this.onMessageHandlers.on(this.getMessageHandlerKey(f),i)},a.prototype.send=function(f,i){var u,s=[C.Protocol.ROOM_DATA];if("string"==typeof f?K.encode.string(s,f):K.encode.number(s,f),void 0!==i){var c=Ve(i);(u=new Uint8Array(s.length+c.byteLength)).set(new Uint8Array(s),0),u.set(new Uint8Array(c),s.length)}else u=new Uint8Array(s);this.connection.send(u.buffer)},Object.defineProperty(a.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),a.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},a.prototype.onMessageCallback=function(f){var i=Array.from(new Uint8Array(f.data)),s=i[0];if(s===C.Protocol.JOIN_ROOM){var u=1;if(this.serializerId=function it(a,f){for(var i=a[f++],s="",u=0,c=f,l=f+i;c<l;c++){var d=a[c];if(0!=(128&d))if(192!=(224&d))if(224!=(240&d)){if(240!=(248&d))throw new Error("Invalid byte "+d.toString(16));(u=(7&d)<<18|(63&a[++c])<<12|(63&a[++c])<<6|(63&a[++c])<<0)>=65536?(u-=65536,s+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):s+=String.fromCharCode(u)}else s+=String.fromCharCode((15&d)<<12|(63&a[++c])<<6|(63&a[++c])<<0);else s+=String.fromCharCode((31&d)<<6|63&a[++c]);else s+=String.fromCharCode(d)}return s}(i,u),u+=function rt(a){void 0===a&&(a="");for(var f=0,i=0,s=0,u=a.length;s<u;s++)(f=a.charCodeAt(s))<128?i+=1:f<2048?i+=2:f<55296||f>=57344?i+=3:(s++,i+=4);return i+1}(this.serializerId),!this.serializer){var c=Ue(this.serializerId);this.serializer=new c}i.length>u&&this.serializer.handshake&&this.serializer.handshake(i,{offset:u}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(s===C.Protocol.ERROR){var l={offset:1},d=K.decode.number(i,l),p=K.decode.string(i,l);this.onError.invoke(d,p)}else if(s===C.Protocol.LEAVE_ROOM)this.leave();else if(s===C.Protocol.ROOM_DATA_SCHEMA){var m={offset:1};(p=new(D=this.serializer.getState().constructor._context.get(K.decode.number(i,m)))).decode(i,m),this.dispatchMessage(D,p)}else if(s===C.Protocol.ROOM_STATE)i.shift(),this.setState(i);else if(s===C.Protocol.ROOM_STATE_PATCH)i.shift(),this.patch(i);else if(s===C.Protocol.ROOM_DATA){var N={offset:1},D=K.decode.stringCheck(i,N)?K.decode.string(i,N):K.decode.number(i,N);p=i.length>N.offset?function Ke(a,f){void 0===f&&(f=0);var i=new te(a,f),s=i._parse();if(i._offset!==a.byteLength)throw new Error(a.byteLength-i._offset+" trailing bytes");return s}(f.data,N.offset):void 0,this.dispatchMessage(D,p)}},a.prototype.setState=function(f){this.serializer.setState(f),this.onStateChange.invoke(this.serializer.getState())},a.prototype.patch=function(f){this.serializer.patch(f),this.onStateChange.invoke(this.serializer.getState())},a.prototype.dispatchMessage=function(f,i){var s=this.getMessageHandlerKey(f);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,i):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",f,i):console.warn("colyseus.js: onMessage() not registered for type '"+f+"'.")},a.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},a.prototype.getMessageHandlerKey=function(f){switch(typeof f){case"function":return"$"+f._typeid;case"string":return f;case"number":return"i"+f;default:throw new Error("invalid message type.")}},a}();function we(){return ye||(ye=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(a,f){this.cache[a]=f},getItem:function(a){},removeItem:function(a){delete this.cache[a]}}),ye}var Ce="colyseus-auth-token";C.Platform=void 0,function(a){a.ios="ios",a.android="android"}(C.Platform||(C.Platform={}));var Ae,Le=function(){function a(f){var i=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=f.replace("ws","http"),function ht(a,f){var i=we().getItem(a);typeof Promise>"u"||!(i instanceof Promise)?f(i):i.then(function(s){return f(s)})}(Ce,function(s){return i.token=s})}return Object.defineProperty(a.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),a.prototype.login=function(f){return void 0===f&&(f={}),P(this,void 0,void 0,function(){var i,s,u;return k(this,function(c){switch(c.label){case 0:return i=Object.assign({},f),this.hasToken&&(i.token=this.token),[4,this.request("post","/auth",i)];case 1:for(u in s=c.sent(),this.token=s.token,function ft(a,f){we().setItem(a,f)}(Ce,this.token),s)this.hasOwnProperty(u)&&(this[u]=s[u]);return this.registerPingService(),[2,this]}})})},a.prototype.save=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return f.sent(),[2,this]}})})},a.prototype.getFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,f.sent()]}})})},a.prototype.getOnlineFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,f.sent()]}})})},a.prototype.getFriendRequests=function(){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,f.sent()]}})})},a.prototype.sendFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(i){switch(i.label){case 0:return[4,this.request("post","/friends/requests",{userId:f})];case 1:return[2,i.sent()]}})})},a.prototype.acceptFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(i){switch(i.label){case 0:return[4,this.request("put","/friends/requests",{userId:f})];case 1:return[2,i.sent()]}})})},a.prototype.declineFriendRequest=function(f){return P(this,void 0,void 0,function(){return k(this,function(i){switch(i.label){case 0:return[4,this.request("del","/friends/requests",{userId:f})];case 1:return[2,i.sent()]}})})},a.prototype.blockUser=function(f){return P(this,void 0,void 0,function(){return k(this,function(i){switch(i.label){case 0:return[4,this.request("post","/friends/block",{userId:f})];case 1:return[2,i.sent()]}})})},a.prototype.unblockUser=function(f){return P(this,void 0,void 0,function(){return k(this,function(i){switch(i.label){case 0:return[4,this.request("put","/friends/block",{userId:f})];case 1:return[2,i.sent()]}})})},a.prototype.request=function(f,i,s,u,c){return void 0===s&&(s={}),void 0===c&&(c={}),P(this,void 0,void 0,function(){var l,d,p,m;return k(this,function(M){switch(M.label){case 0:for(d in c.Accept="application/json",this.hasToken&&(c.Authorization="Bearer "+this.token),l=[],s)l.push(d+"="+s[d]);return p=l.length>0?"?"+l.join("&"):"",m={headers:c},u&&(m.body=u),[4,_e[f](""+this.endpoint+i+p,m)];case 1:return[2,M.sent().data]}})})},a.prototype.logout=function(){this.token=void 0,function ut(a){we().removeItem(a)}(Ce),this.unregisterPingService()},a.prototype.registerPingService=function(f){var i=this;void 0===f&&(f=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return i.request("get","/auth")},f)},a.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},a}(),lt=function(a){function f(i,s){var u=a.call(this,i)||this;return u.code=s,Object.setPrototypeOf(u,f.prototype),u}return J(f,a),f}(Error),dt=typeof window<"u"&&typeof(null===(Ae=window?.location)||void 0===Ae?void 0:Ae.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",pt=function(){function a(f){void 0===f&&(f=dt),this.endpoint=f}return Object.defineProperty(a.prototype,"auth",{get:function(){return this._auth||(this._auth=new Le(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),a.prototype.joinOrCreate=function(f,i,s){return void 0===i&&(i={}),P(this,void 0,void 0,function(){return k(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",f,i,s)];case 1:return[2,u.sent()]}})})},a.prototype.create=function(f,i,s){return void 0===i&&(i={}),P(this,void 0,void 0,function(){return k(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("create",f,i,s)];case 1:return[2,u.sent()]}})})},a.prototype.join=function(f,i,s){return void 0===i&&(i={}),P(this,void 0,void 0,function(){return k(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("join",f,i,s)];case 1:return[2,u.sent()]}})})},a.prototype.joinById=function(f,i,s){return void 0===i&&(i={}),P(this,void 0,void 0,function(){return k(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinById",f,i,s)];case 1:return[2,u.sent()]}})})},a.prototype.reconnect=function(f,i,s){return P(this,void 0,void 0,function(){return k(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinById",f,{sessionId:i},s)];case 1:return[2,u.sent()]}})})},a.prototype.getAvailableRooms=function(f){return void 0===f&&(f=""),P(this,void 0,void 0,function(){var i;return k(this,function(s){switch(s.label){case 0:return i=this.endpoint.replace("ws","http")+"/matchmake/"+f,[4,me(i,{headers:{Accept:"application/json"}})];case 1:return[2,s.sent().data]}})})},a.prototype.consumeSeatReservation=function(f,i){return P(this,void 0,void 0,function(){var s;return k(this,function(u){return(s=this.createRoom(f.room.name,i)).id=f.room.roomId,s.sessionId=f.sessionId,s.connect(this.buildEndpoint(f.room,{sessionId:s.sessionId})),[2,new Promise(function(c,l){var d=function(p,m){return l(new Pe(p,m))};s.onError.once(d),s.onJoin.once(function(){s.onError.remove(d),c(s)})})]})})},a.prototype.createMatchMakeRequest=function(f,i,s,u){return void 0===s&&(s={}),P(this,void 0,void 0,function(){var c,l;return k(this,function(d){switch(d.label){case 0:return c=this.endpoint.replace("ws","http")+"/matchmake/"+f+"/"+i,this._auth&&this._auth.hasToken&&(s.token=this._auth.token),[4,ve(c,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})];case 1:if((l=d.sent().data).error)throw new lt(l.error,l.code);return[2,this.consumeSeatReservation(l,u)]}})})},a.prototype.createRoom=function(f,i){return new Fe(f,i)},a.prototype.buildEndpoint=function(f,i){void 0===i&&(i={});var s=[];for(var u in i)!i.hasOwnProperty(u)||s.push(u+"="+i[u]);return this.endpoint+"/"+f.processId+"/"+f.roomId+"?"+s.join("&")},a}(),Ze=function(){function a(){}return a.prototype.setState=function(f){this.state.decode(f)},a.prototype.getState=function(){return this.state},a.prototype.patch=function(f){this.state.decode(f)},a.prototype.teardown=function(){var f,i;null===(i=null===(f=this.state)||void 0===f?void 0:f.$changes)||void 0===i||i.root.clearRefs()},a.prototype.handshake=function(f,i){this.state?(new K.Reflection).decode(f,i):this.state=K.Reflection.decode(f,i)},a}(),Et=function(){function a(){}return a.prototype.setState=function(f){},a.prototype.getState=function(){return null},a.prototype.patch=function(f){},a.prototype.teardown=function(){},a.prototype.handshake=function(f){},a}();xe("schema",Ze),xe("none",Et),C.Auth=Le,C.Client=pt,C.Room=Fe,C.SchemaSerializer=Ze,C.registerSerializer=xe,Object.defineProperty(C,"__esModule",{value:!0})}(Ie)}}]);