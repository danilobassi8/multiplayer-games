(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{9429:(Jt,Pe,T)=>{"use strict";T.r(Pe),T.d(Pe,{MinesweeperModule:()=>dt});var ue=T(8198),ne=T(6895),z=T(5755),j=T(9386),ke=T(2076),a=T(4650);const ve=["easy","medium","hard"];let Ce=(()=>{class p extends class V{constructor(g,u={}){this.roomGame=g,this.defaultGameOptions=u,this.client=new z.Client(`ws://${j.N.backend_url}`)}createRoom(g){return(0,ke.D)(this.client.create(this.roomGame,{...this.defaultGameOptions,...g}).then(u=>{this.currentRoom&&this.currentRoom.leave(),console.log("Connected to new room:",u),this.currentRoom=u}))}getAvailableRooms(){return this.client.getAvailableRooms(this.roomGame)}}{constructor(){super("MinesweeperRoom",{maxClients:2}),this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();class Ye extends Set{add(g){super.add(g.toString())}has(g){return super.has(g.toString())}}class Qe{constructor({include:g=!0,onlyInteger:u=!0}){this.includeLimits=g,this.onlyInteger=u}returnOutputNumber(g){return this.onlyInteger?Math.round(g):g}between(g,u){let _;return _=this.includeLimits?Math.floor(Math.random()*(u-g+1)+g):Math.floor(Math.random()*(u-g)+g),this.returnOutputNumber(_)}}class Ne{constructor(g,u){this.row=g,this.column=u,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged="no"}toggleFlaggedState(){this.flagged="no"!=this.flagged?"flag"===this.flagged?"question":"no":"flag"}}class se extends Array{constructor(g,u="player"){super(),this.status="playing",this.player=u;const _=g?.size;for(let E=0;E<_;E++){this[E]=[];for(let D=0;D<_;D++)this[E].push(new Ne(E,D))}g&&this.generateBombs(g)}generateBombs(g){const u=new Qe({onlyInteger:!0}),_=new Ye;for(;_.size<g.bombs;){const E=u.between(0,g.size-1),D=u.between(0,g.size-1);_.has([E,D])||(_.add([E,D]),this[E][D].bomb=!0,this.getCellsArround(this[E][D]).forEach(ee=>{ee.nearBombs++}))}}getCellsArround(g){const u=[],_=g.row,E=g.column,D=(ee,ye)=>(this[ee]&&this[ee][ye]&&u.push(this[ee][ye]),u);return D(_+1,E+1),D(_+1,E-1),D(_+1,E+0),D(_-1,E+1),D(_-1,E-1),D(_-1,E+0),D(_+0,E+1),D(_+0,E-1),u}reveal(g){if(g.bomb)return this.status="game over",void this.revealAllCells();g.revealed=!0,0===g.nearBombs&&this.getCellsArround(g).filter(u=>0==u.revealed).forEach(u=>this.reveal(u)),this.checkWinningCondition()}checkWinningCondition(){return"playing"!==this.status?"win"===this.status:0===this.flat(2).filter(_=>!(_.bomb||_.revealed)).length&&(this.status="win",!0)}revealAllCells(){this.forEach(g=>g.forEach(u=>u.revealed=!0))}toggleCellState(g){g.toggleFlaggedState(),this.checkWinningCondition()}getUsedFlags(){let g=0;return this.forEach(u=>u.forEach(_=>{g+="flag"===_.flagged?1:0})),g}}var ae=T(9119),ce=T(433),Ae=T(5593),Oe=T(5362);function Ue(p,g){1&p&&a._UZ(0,"img",7)}function Ke(p,g){if(1&p&&a._UZ(0,"span"),2&p){const u=a.oxw(2).$implicit;a.Gre("m-0 p-0 near-bombs-text near-",u.nearBombs,"")}}function We(p,g){if(1&p&&(a.ynx(0),a.YNc(1,Ue,1,0,"img",5),a.YNc(2,Ke,1,3,"span",6),a.BQk()),2&p){const u=a.oxw().$implicit;a.xp6(1),a.Q6J("ngIf",u.bomb),a.xp6(1),a.Q6J("ngIf",!u.bomb)}}function fe(p,g){1&p&&a._UZ(0,"img",10)}function Xe(p,g){1&p&&a._UZ(0,"img",11)}function Ve(p,g){if(1&p&&(a.ynx(0),a.YNc(1,fe,1,0,"img",8),a.YNc(2,Xe,1,0,"img",9),a.BQk()),2&p){const u=a.oxw().$implicit;a.xp6(1),a.Q6J("ngIf","flag"==u.flagged),a.xp6(1),a.Q6J("ngIf","question"==u.flagged)}}function et(p,g){if(1&p){const u=a.EpF();a.TgZ(0,"div",3),a.NdJ("click",function(){const D=a.CHM(u).$implicit,ee=a.oxw(2);return a.KtG(ee.cellClicked.emit(D))})("contextmenu",function(E){const ee=a.CHM(u).$implicit,ye=a.oxw(2);return a.KtG(ye.onRightClick(E,ee))}),a.YNc(1,We,3,2,"ng-container",4),a.YNc(2,Ve,3,2,"ng-container",4),a.qZA()}if(2&p){const u=g.$implicit,_=g.index,E=a.oxw().index;a.ekj("revealed",u.revealed)("empty",u.revealed&&0==u.nearBombs&&!u.bomb)("darker",(E%2+_)%2),a.xp6(1),a.Q6J("ngIf",u.revealed),a.xp6(1),a.Q6J("ngIf",0==u.revealed)}}function tt(p,g){if(1&p&&(a.ynx(0),a.YNc(1,et,3,8,"div",2),a.BQk()),2&p){const u=g.$implicit;a.xp6(1),a.Q6J("ngForOf",u)}}function he(p,g){1&p&&a._UZ(0,"img",12),2&p&&a.MGl("src","assets/minesweeper/",g.$implicit,".png",a.LSH)}const nt=function(){return["bomb","red_flag","question_mark"]};let Fe=(()=>{class p{constructor(u){this.game=u,this.cellClicked=new a.vpe,this.cellRightClicked=new a.vpe,this.currentConfig=u.gameConfig.easy,this.matrix=new se(this.currentConfig)}ngOnInit(){}onRightClick(u,_){u.preventDefault(),this.cellRightClicked.emit(_)}}return p.\u0275fac=function(u){return new(u||p)(a.Y36(Ce))},p.\u0275cmp=a.Xpm({type:p,selectors:[["minesweeper-game-matrix"]],inputs:{matrix:"matrix",currentConfig:"currentConfig"},outputs:{cellClicked:"cellClicked",cellRightClicked:"cellRightClicked"},decls:3,vars:8,consts:[[4,"ngFor","ngForOf"],["class","d-none",3,"src",4,"ngFor","ngForOf"],["class","matrix-cell",3,"revealed","empty","darker","click","contextmenu",4,"ngFor","ngForOf"],[1,"matrix-cell",3,"click","contextmenu"],[4,"ngIf"],["src","assets/minesweeper/bomb.png","class","h-90 cell-image animate__animated animate__bounceIn",4,"ngIf"],[3,"class",4,"ngIf"],["src","assets/minesweeper/bomb.png",1,"h-90","cell-image","animate__animated","animate__bounceIn"],["src","assets/minesweeper/red_flag.png","class","cell-image",4,"ngIf"],["src","assets/minesweeper/question_mark.png","class","cell-image h-75",4,"ngIf"],["src","assets/minesweeper/red_flag.png",1,"cell-image"],["src","assets/minesweeper/question_mark.png",1,"cell-image","h-75"],[1,"d-none",3,"src"]],template:function(u,_){1&u&&(a.TgZ(0,"div"),a.YNc(1,tt,2,1,"ng-container",0),a.qZA(),a.YNc(2,he,1,1,"img",1)),2&u&&(a.Gre("matrix-container matrix-sized-",_.currentConfig.size,""),a.Udp("grid-template-columns","repeat("+_.currentConfig.size+",calc(min(750px, 90vw) / "+_.currentConfig.size+"))"),a.xp6(1),a.Q6J("ngForOf",_.matrix),a.xp6(1),a.Q6J("ngForOf",a.DdM(7,nt)))},dependencies:[ne.sg,ne.O5],styles:['.matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;justify-content:center;font-weight:bolder}.matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:2rem}.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}@media (max-width: 992px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:7px}}@media (max-width: 768px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]:hover{background-color:currentColor}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0;filter:brightness(.92)}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.darker[_ngcontent-%COMP%]{filter:brightness(.96)}.cell-image[_ngcontent-%COMP%]{position:absolute;object-fit:scale-down;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),p})();function it(p,g){1&p&&(a.TgZ(0,"div",13)(1,"h1",14),a._uU(2,"You win!"),a.qZA()())}function rt(p,g){1&p&&(a.TgZ(0,"div",13)(1,"h1",15),a._uU(2,"You Loose!"),a.qZA()())}let ot=(()=>{class p{constructor(u,_,E){this.game=u,this.route=_,this.router=E,this.allDifficulties=[...ve],this.usedFlags=0,this.selectedDifficulty="easy",this.nextDifficulty=this.selectedDifficulty,this.gameConfig=this.game.gameConfig.easy,this.matrix=new se(this.gameConfig)}ngOnInit(){this.route.params.subscribe(u=>{ve.includes(u.difficulty)?this.initializeGame(u.difficulty):this.initializeGame(ve[1])})}initializeGame(u){u!=this.selectedDifficulty&&this.router.navigate(["minesweeper","offline",u]),this.selectedDifficulty=u,this.nextDifficulty=u,this.gameConfig=this.game.gameConfig[u],this.matrix=new se(this.gameConfig)}onCellClicked(u){this.matrix.reveal(u)}onCellRightClicked(u){this.matrix.toggleCellState(u),this.usedFlags=this.matrix.getUsedFlags()}}return p.\u0275fac=function(u){return new(u||p)(a.Y36(Ce),a.Y36(ae.gz),a.Y36(ae.F0))},p.\u0275cmp=a.Xpm({type:p,selectors:[["app-offline"]],decls:22,vars:18,consts:[[1,"offline-game-container","py-4","w-100"],[1,"game",3,"matrix","currentConfig","cellClicked","cellRightClicked"],[1,"side-panel"],[1,"flags-used","d-flex","mx-2"],["src","assets/minesweeper/red_flag.png","alt","flags-used","width","30px","height","30px"],[1,"mx-2"],[1,"d-flex"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Restart",1,"p-button","ml-2",3,"click"],[1,"mt-1","animate__animated","animate__faster",2,"color","var(--yellow)"],[3,"ngSwitch"],[1,""],["class","animate__animated animate__bounceIn",4,"ngSwitchCase"],[1,"animate__animated","animate__bounceIn"],[2,"color","var(--green)"],[2,"color","var(--red)"]],template:function(u,_){1&u&&(a.TgZ(0,"div",0)(1,"minesweeper-game-matrix",1),a.NdJ("cellClicked",function(D){return _.onCellClicked(D)})("cellRightClicked",function(D){return _.onCellRightClicked(D)}),a.qZA(),a.TgZ(2,"div",2)(3,"div",3),a._UZ(4,"img",4),a.TgZ(5,"h3"),a._uU(6),a.qZA()(),a.TgZ(7,"h3",5),a._uU(8," Difficulty: "),a.TgZ(9,"span"),a._uU(10),a.ALo(11,"titlecase"),a.qZA()(),a.TgZ(12,"div",5)(13,"div",6)(14,"p-selectButton",7),a.NdJ("ngModelChange",function(D){return _.nextDifficulty=D}),a.qZA(),a.TgZ(15,"button",8),a.NdJ("click",function(){return _.initializeGame(_.nextDifficulty)}),a.qZA()(),a.TgZ(16,"div",9),a._uU(17," Click restart to change difficulty "),a.qZA()(),a.ynx(18,10),a.TgZ(19,"div",11),a.YNc(20,it,3,0,"div",12),a.YNc(21,rt,3,0,"div",12),a.qZA(),a.BQk(),a.qZA()()),2&u&&(a.xp6(1),a.Q6J("matrix",_.matrix)("currentConfig",_.gameConfig),a.xp6(5),a.hij(": ",_.gameConfig.bombs-_.usedFlags,""),a.xp6(3),a.Gre("difficulty-color-",_.selectedDifficulty,""),a.xp6(1),a.Oqu(a.lcZ(11,16,_.selectedDifficulty)),a.xp6(4),a.Q6J("options",_.allDifficulties)("ngModel",_.nextDifficulty),a.xp6(2),a.ekj("animate__fadeIn",_.nextDifficulty!==_.selectedDifficulty)("animate__fadeOut",_.nextDifficulty==_.selectedDifficulty),a.xp6(2),a.Q6J("ngSwitch",_.matrix.status),a.xp6(2),a.Q6J("ngSwitchCase","win"),a.xp6(1),a.Q6J("ngSwitchCase","game over"))},dependencies:[ne.RF,ne.n9,ce.JJ,ce.On,Ae.Hq,Oe.UN,Fe,ne.rS],styles:[".offline-game-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:center}.side-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:50px;min-width:350px;flex-grow:0}@media (max-width: 1200px){.side-panel[_ngcontent-%COMP%]{flex-direction:row;min-width:none;justify-content:space-evenly;align-items:center;flex-wrap:wrap;padding:0;width:100%}}"]}),p})();var Le=T(4247),$e=T(8625);function ze(p,g){1&p&&a.GkF(0)}function st(p,g){1&p&&a.GkF(0)}function at(p,g){if(1&p){const u=a.EpF();a.TgZ(0,"div",5)(1,"minesweeper-game-matrix",6),a.NdJ("cellClicked",function(E){const ee=a.CHM(u).matrix;return a.KtG(ee.reveal(E))}),a.qZA()()}if(2&p){const u=g.matrix,_=a.oxw();a.xp6(1),a.Q6J("matrix",u)("currentConfig",_.currentConfig)}}function ct(p,g){1&p&&(a._uU(0),a.ALo(1,"titlecase")),2&p&&a.hij(" ",a.lcZ(1,1,g.$implicit)," ")}function ft(p,g){if(1&p){const u=a.EpF();a.TgZ(0,"div",18)(1,"p-password",19),a.NdJ("ngModelChange",function(E){a.CHM(u);const D=a.oxw(2);return a.KtG(D.roomPassword=E)}),a.qZA()()}if(2&p){const u=a.oxw(2);a.xp6(1),a.Q6J("ngModel",u.roomPassword)("feedback",!1)("toggleMask",!0)}}const _e=function(){return["Multiplayer","Offline"]};function ut(p,g){if(1&p){const u=a.EpF();a.TgZ(0,"div",7)(1,"div",8)(2,"p-selectButton",9),a.NdJ("ngModelChange",function(E){a.CHM(u);const D=a.oxw();return a.KtG(D.selectedDifficulty=E)})("onChange",function(){a.CHM(u);const E=a.oxw();return a.KtG(E.difficultyChange())}),a.YNc(3,ct,2,3,"ng-template"),a.qZA()(),a.TgZ(4,"div",10)(5,"div",11)(6,"h3",12),a._uU(7," Configuration: "),a.TgZ(8,"span",13),a._uU(9),a.ALo(10,"titlecase"),a.qZA()()(),a.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),a._uU(15," Size: "),a.TgZ(16,"span"),a._uU(17),a.qZA()()(),a.TgZ(18,"li")(19,"h4"),a._uU(20," Cells: "),a.TgZ(21,"span"),a._uU(22),a.qZA()()(),a.TgZ(23,"li")(24,"h4"),a._uU(25," Bombs: "),a.TgZ(26,"span"),a._uU(27),a.qZA()()()(),a.TgZ(28,"div",14)(29,"p-selectButton",15),a.NdJ("ngModelChange",function(E){a.CHM(u);const D=a.oxw();return a.KtG(D.networkGamemode=E)}),a.qZA()(),a.YNc(30,ft,2,3,"div",16),a.qZA(),a.TgZ(31,"div",8)(32,"button",17),a.NdJ("click",function(){a.CHM(u);const E=a.oxw();return a.KtG(E.onPlayButton())}),a.qZA()()()()}if(2&p){const u=a.oxw();a.xp6(2),a.Q6J("options",u.difficultyOptions)("ngModel",u.selectedDifficulty),a.xp6(7),a.Oqu(a.lcZ(10,19,u.selectedDifficulty)),a.xp6(7),a.Gre("difficulty-color-",u.selectedDifficulty,""),a.xp6(1),a.AsE("",u.currentConfig.size," x ",u.currentConfig.size,""),a.xp6(4),a.Gre("difficulty-color-",u.selectedDifficulty,""),a.xp6(1),a.Oqu(u.currentConfig.size*u.currentConfig.size),a.xp6(4),a.Gre("difficulty-color-",u.selectedDifficulty,""),a.xp6(1),a.Oqu(u.currentConfig.bombs),a.xp6(2),a.Q6J("options",a.DdM(21,_e))("ngModel",u.networkGamemode),a.xp6(1),a.Q6J("ngIf","Multiplayer"==u.networkGamemode)}}const ht=function(p){return{matrix:p}},Ee=[{path:"",children:[{path:"",component:(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(u){return new(u||p)},p.\u0275cmp=a.Xpm({type:p,selectors:[["app-lobby"]],decls:2,vars:0,template:function(u,_){1&u&&(a.TgZ(0,"p"),a._uU(1,"lobby works!"),a.qZA())}}),p})()},{path:"create",component:(()=>{class p{constructor(u,_){this.game=u,this.router=_,this.selectedDifficulty="easy",this.difficultyOptions=[...ve],this.networkGamemode="Offline",this.roomPassword="",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new se(this.currentConfig),this.userMatrix.forEach(u=>u.forEach(_=>{_.bomb&&(_.revealed=!0)}))}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}onPlayButton(){"Offline"==this.networkGamemode?this.router.navigate(["minesweeper","offline",this.selectedDifficulty]):this.game.createRoom({password:this.roomPassword}).subscribe(u=>{console.log(u)})}}return p.\u0275fac=function(u){return new(u||p)(a.Y36(Ce),a.Y36(ae.F0))},p.\u0275cmp=a.Xpm({type:p,selectors:[["app-difficulty-selector"]],decls:7,vars:5,consts:[[1,"main-double-board","py-5"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["optionMenuTemplate",""],[1,"matrix-container"],[3,"matrix","currentConfig","cellClicked"],[1,"option-menu-container"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"config-manager"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-center"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["class","d-flex",4,"ngIf"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg",3,"click"],[1,"d-flex"],["placeholder","Insert a password if you want a private room!","styleClass","password-room-creation w-100",1,"w-100","mt-3","animate__animated","animate__bounceIn","animate__faster",3,"ngModel","feedback","toggleMask","ngModelChange"]],template:function(u,_){if(1&u&&(a.TgZ(0,"div",0),a.YNc(1,ze,1,0,"ng-container",1),a.YNc(2,st,1,0,"ng-container",2),a.qZA(),a.YNc(3,at,2,2,"ng-template",null,3,a.W1O),a.YNc(5,ut,33,22,"ng-template",null,4,a.W1O)),2&u){const E=a.MAs(4),D=a.MAs(6);a.xp6(1),a.Q6J("ngTemplateOutlet",E)("ngTemplateOutletContext",a.VKq(3,ht,_.userMatrix)),a.xp6(1),a.Q6J("ngTemplateOutlet",D)}},dependencies:[ne.O5,ne.tP,ce.JJ,ce.On,Ae.Hq,Le.Z,$e.ro,Oe.UN,Fe,ne.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;flex-wrap:wrap-reverse}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.matrix-container[_ngcontent-%COMP%]{min-width:700px;margin-right:50px}.option-menu-container[_ngcontent-%COMP%]{min-width:500px}@media (max-width: 768px){.matrix-container[_ngcontent-%COMP%]{min-width:100%;margin-right:0}.option-menu-container[_ngcontent-%COMP%]{min-width:100%}}[_nghost-%COMP%]     .password-room-creation{width:100%}[_nghost-%COMP%]     .password-room-creation input{width:100%}"]}),p})()},{path:"offline/:difficulty",component:ot},{path:"offline",redirectTo:"offline/medium"}]}];let Me=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=a.oAB({type:p}),p.\u0275inj=a.cJS({imports:[ae.Bz.forChild(Ee),ae.Bz]}),p})(),dt=(()=>{class p{}return p.\u0275fac=function(u){return new(u||p)},p.\u0275mod=a.oAB({type:p}),p.\u0275inj=a.cJS({imports:[ne.ez,Me,ue.m]}),p})()},5755:function(Jt,Pe){!function(T){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(o){return null!==o&&"object"==typeof o&&o.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ue=function(o,s){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,c){i.__proto__=c}||function(i,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(i[h]=c[h])})(o,s)};function ne(o,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=o}ue(o,s),o.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}function z(o,s,i,c){return new(i||(i=Promise))(function(l,C){function y(N){try{m(c.next(N))}catch(L){C(L)}}function v(N){try{m(c.throw(N))}catch(L){C(L)}}function m(N){N.done?l(N.value):function h(l){return l instanceof i?l:new i(function(C){C(l)})}(N.value).then(y,v)}m((c=c.apply(o,s||[])).next())})}function j(o,s){var c,h,l,C,i={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return C={next:y(0),throw:y(1),return:y(2)},"function"==typeof Symbol&&(C[Symbol.iterator]=function(){return this}),C;function y(m){return function(N){return function v(m){if(c)throw new TypeError("Generator is already executing.");for(;i;)try{if(c=1,h&&(l=2&m[0]?h.return:m[0]?h.throw||((l=h.return)&&l.call(h),0):h.next)&&!(l=l.call(h,m[1])).done)return l;switch(h=0,l&&(m=[2&m[0],l.value]),m[0]){case 0:case 1:l=m;break;case 4:return i.label++,{value:m[1],done:!1};case 5:i.label++,h=m[1],m=[0];continue;case 7:m=i.ops.pop(),i.trys.pop();continue;default:if(!(l=(l=i.trys).length>0&&l[l.length-1])&&(6===m[0]||2===m[0])){i=0;continue}if(3===m[0]&&(!l||m[1]>l[0]&&m[1]<l[3])){i.label=m[1];break}if(6===m[0]&&i.label<l[1]){i.label=l[1],l=m;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(m);break}l[2]&&i.ops.pop(),i.trys.pop();continue}m=s.call(o,i)}catch(N){m=[6,N],h=0}finally{c=l=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,N])}}}function ke(o,s){s.headers=o.headers||{},s.statusMessage=o.statusText,s.statusCode=o.status,s.data=o.response}function V(o,s,i){return new Promise(function(c,h){i=i||{};var C,y,v,l=new XMLHttpRequest,m=i.body,N=i.headers||{};for(C in i.timeout&&(l.timeout=i.timeout),l.ontimeout=l.onerror=function(L){L.timeout="timeout"==L.type,h(L)},l.open(o,s.href||s),l.onload=function(){for(v=l.getAllResponseHeaders().trim().split(/[\r\n]+/),ke(l,l);y=v.shift();)y=y.split(": "),l.headers[y.shift().toLowerCase()]=y.join(": ");if((y=l.headers["content-type"])&&~y.indexOf("application/json"))try{l.data=JSON.parse(l.data,i.reviver)}catch(L){return ke(l,L),h(L)}(l.status>=400?h:c)(l)},typeof FormData<"u"&&m instanceof FormData||m&&"object"==typeof m&&(N["content-type"]="application/json",m=JSON.stringify(m)),l.withCredentials=!!i.withCredentials,N)l.setRequestHeader(C,N[C]);l.send(m)})}var a=V.bind(V,"GET"),ve=V.bind(V,"POST"),Ce=V.bind(V,"PATCH"),Ne=V.bind(V,"DELETE"),se=a,ae=Ce,ce=ve,Ae=V.bind(V,"PUT"),Oe=V,Ue={del:Ne,get:se,patch:ae,post:ce,put:Ae,send:Oe},Ke=Object.freeze(Object.assign(Object.create(null),Ue,{default:Ue,del:Ne,get:se,patch:ae,post:ce,put:Ae,send:Oe})),We=function(o){function s(i,c){var h=o.call(this,c)||this;return h.name="ServerError",h.code=i,h}return ne(s,o),s}(Error);function fe(o,s){if(this._offset=s,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}function et(o,s,i){for(var c=0,h=0,l=i.length;h<l;h++)(c=i.charCodeAt(h))<128?o.setUint8(s++,c):c<2048?(o.setUint8(s++,192|c>>6),o.setUint8(s++,128|63&c)):c<55296||c>=57344?(o.setUint8(s++,224|c>>12),o.setUint8(s++,128|c>>6&63),o.setUint8(s++,128|63&c)):(h++,c=65536+((1023&c)<<10|1023&i.charCodeAt(h)),o.setUint8(s++,240|c>>18),o.setUint8(s++,128|c>>12&63),o.setUint8(s++,128|c>>6&63),o.setUint8(s++,128|63&c))}function he(o,s,i){var c=typeof i,h=0,l=0,C=0,y=0,v=0,m=0;if("string"===c){if((v=function tt(o){for(var s=0,i=0,c=0,h=o.length;c<h;c++)(s=o.charCodeAt(c))<128?i+=1:s<2048?i+=2:s<55296||s>=57344?i+=3:(c++,i+=4);return i}(i))<32)o.push(160|v),m=1;else if(v<256)o.push(217,v),m=2;else if(v<65536)o.push(218,v>>8,v),m=3;else{if(!(v<4294967296))throw new Error("String too long");o.push(219,v>>24,v>>16,v>>8,v),m=5}return s.push({_str:i,_length:v,_offset:o.length}),m+v}if("number"===c)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(o.push(i),1):i<256?(o.push(204,i),2):i<65536?(o.push(205,i>>8,i),3):i<4294967296?(o.push(206,i>>24,i>>16,i>>8,i),5):(C=i/Math.pow(2,32)>>0,o.push(207,C>>24,C>>16,C>>8,C,(y=i>>>0)>>24,y>>16,y>>8,y),9):i>=-32?(o.push(i),1):i>=-128?(o.push(208,i),2):i>=-32768?(o.push(209,i>>8,i),3):i>=-2147483648?(o.push(210,i>>24,i>>16,i>>8,i),5):(C=Math.floor(i/Math.pow(2,32)),o.push(211,C>>24,C>>16,C>>8,C,(y=i>>>0)>>24,y>>16,y>>8,y),9):(o.push(203),s.push({_float:i,_length:8,_offset:o.length}),9);if("object"===c){if(null===i)return o.push(192),1;if(Array.isArray(i)){if((v=i.length)<16)o.push(144|v),m=1;else if(v<65536)o.push(220,v>>8,v),m=3;else{if(!(v<4294967296))throw new Error("Array too large");o.push(221,v>>24,v>>16,v>>8,v),m=5}for(h=0;h<v;h++)m+=he(o,s,i[h]);return m}if(i instanceof Date){var N=i.getTime();return C=Math.floor(N/Math.pow(2,32)),o.push(215,0,C>>24,C>>16,C>>8,C,(y=N>>>0)>>24,y>>16,y>>8,y),10}if(i instanceof ArrayBuffer){if((v=i.byteLength)<256)o.push(196,v),m=2;else if(v<65536)o.push(197,v>>8,v),m=3;else{if(!(v<4294967296))throw new Error("Buffer too large");o.push(198,v>>24,v>>16,v>>8,v),m=5}return s.push({_bin:i,_length:v,_offset:o.length}),m+v}if("function"==typeof i.toJSON)return he(o,s,i.toJSON());var L=[],B="",K=Object.keys(i);for(h=0,l=K.length;h<l;h++)"function"!=typeof i[B=K[h]]&&L.push(B);if((v=L.length)<16)o.push(128|v),m=1;else if(v<65536)o.push(222,v>>8,v),m=3;else{if(!(v<4294967296))throw new Error("Object too large");o.push(223,v>>24,v>>16,v>>8,v),m=5}for(h=0;h<v;h++)m+=he(o,s,B=L[h]),m+=he(o,s,i[B]);return m}if("boolean"===c)return o.push(i?195:194),1;if("undefined"===c)return o.push(212,0,0),3;throw new Error("Could not encode")}function nt(o){var s=[],i=[],c=he(s,i,o),h=new ArrayBuffer(c),l=new DataView(h),C=0,y=0,v=-1;i.length>0&&(v=i[0]._offset);for(var m,N=0,L=0,B=0,K=s.length;B<K;B++)if(l.setUint8(y+B,s[B]),B+1===v){if(N=(m=i[C])._length,L=y+v,m._bin)for(var je=new Uint8Array(m._bin),Y=0;Y<N;Y++)l.setUint8(L+Y,je[Y]);else m._str?et(l,L,m._str):void 0!==m._float&&l.setFloat64(L,m._float);y+=N,i[++C]&&(v=i[C]._offset)}return h}fe.prototype._array=function(o){for(var s=new Array(o),i=0;i<o;i++)s[i]=this._parse();return s},fe.prototype._map=function(o){for(var i={},c=0;c<o;c++)i[this._parse()]=this._parse();return i},fe.prototype._str=function(o){var s=function Xe(o,s,i){for(var c="",h=0,l=s,C=s+i;l<C;l++){var y=o.getUint8(l);if(0!=(128&y))if(192!=(224&y))if(224!=(240&y)){if(240!=(248&y))throw new Error("Invalid byte "+y.toString(16));(h=(7&y)<<18|(63&o.getUint8(++l))<<12|(63&o.getUint8(++l))<<6|(63&o.getUint8(++l))<<0)>=65536?(h-=65536,c+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):c+=String.fromCharCode(h)}else c+=String.fromCharCode((15&y)<<12|(63&o.getUint8(++l))<<6|(63&o.getUint8(++l))<<0);else c+=String.fromCharCode((31&y)<<6|63&o.getUint8(++l));else c+=String.fromCharCode(y)}return c}(this._view,this._offset,o);return this._offset+=o,s},fe.prototype._bin=function(o){var s=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,s},fe.prototype._parse=function(){var s,o=this._view.getUint8(this._offset++),i=0,c=0,h=0,l=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),c=this._view.getInt8(this._offset+1),this._offset+=2,[c,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),c=this._view.getInt8(this._offset+2),this._offset+=3,[c,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),c=this._view.getInt8(this._offset+4),this._offset+=5,[c,this._bin(i)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,h+l;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,h+l;case 212:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?void(this._offset+=1):[c,this._bin(1)];case 213:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(2)];case 214:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(4)];case 215:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?(h=this._view.getInt32(this._offset)*Math.pow(2,32),l=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+l)):[c,this._bin(8)];case 216:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")};var o,it=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},rt=function(){function o(s){this.events=s}return o.prototype.send=function(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)},o.prototype.connect=function(s){this.ws=new it(s,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},o.prototype.close=function(s,i){this.ws.close(s,i)},o}(),ot=function(){function o(){this.events={},this.transport=new rt(this.events)}return o.prototype.send=function(s){this.transport.send(s)},o.prototype.connect=function(s){this.transport.connect(s)},o.prototype.close=function(s,i){this.transport.close(s,i)},o}(),Le={};function $e(o,s){Le[o]=s}function ze(o){var s=Le[o];if(!s)throw new Error("missing serializer: "+o);return s}T.Protocol=void 0,(o=T.Protocol||(T.Protocol={}))[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",T.ErrorCode=void 0,function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(T.ErrorCode||(T.ErrorCode={}));let ct=()=>({events:{},emit(o,...s){(this.events[o]||[]).forEach(i=>i(...s))},on(o,s){return(this.events[o]=this.events[o]||[]).push(s),()=>this.events[o]=(this.events[o]||[]).filter(i=>i!==s)}});var ft=function(){function o(){this.handlers=[]}return o.prototype.register=function(s,i){return this.handlers.push(s),this},o.prototype.invoke=function(){for(var s=this,i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];this.handlers.forEach(function(h){return h.apply(s,i)})},o.prototype.invokeAsync=function(){for(var s=this,i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];return Promise.all(this.handlers.map(function(h){return h.apply(s,i)}))},o.prototype.remove=function(s){var i=this.handlers.indexOf(s);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()},o.prototype.clear=function(){this.handlers=[]},o}();function _e(){var o=new ft;function s(i){return o.register(i,null===this)}return s.once=function(i){var c=function(){for(var h=[],l=0;l<arguments.length;l++)h[l]=arguments[l];i.apply(this,h),o.remove(c)};o.register(c)},s.remove=function(i){return o.remove(i)},s.invoke=function(){for(var i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];return o.invoke.apply(o,i)},s.invokeAsync=function(){for(var i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];return o.invokeAsync.apply(o,i)},s.clear=function(){return o.clear()},s}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var Ee,re=function ht(o){var s={exports:{}};return o(s,s.exports),s.exports}(function(o,s){var c;c=function(i){var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(n[f]=r[f])})(t,e)};function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function l(t,e,n,r){var O,f=arguments.length,d=f<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(t,e,n,r);else for(var x=t.length-1;x>=0;x--)(O=t[x])&&(d=(f<3?O(d):f>3?O(e,n,d):O(e,n))||d);return f>3&&d&&Object.defineProperty(e,n,d),d}function C(t,e){for(var n=0,r=e.length,f=t.length;n<r;n++,f++)t[f]=e[n];return t}var t,y=255;i.OPERATION=void 0,(t=i.OPERATION||(i.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var m=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(e,n,r){void 0===r&&(r=!0),this.refs.set(e,n),r&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},t.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(n){if(e.refCounts[n]<=0){var r=e.refs.get(n);if(r instanceof q)for(var f in r._definition.schema)"string"!=typeof r._definition.schema[f]&&r[f]&&r[f].$changes&&e.removeRef(r[f].$changes.refId);else{var d=r.$changes.parent._definition;"function"==typeof Object.values(d.schema[d.fieldsByIndex[r.$changes.parentIndex]])[0]&&Array.from(r.values()).forEach(function(x){return e.removeRef(x.$changes.refId)})}e.refs.delete(n),delete e.refCounts[n]}}),this.deletedRefs.clear()},t}(),N=function(){function t(e,n,r){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(n,r)}return t.prototype.setParent=function(e,n,r){var f=this;if(this.indexes||(this.indexes=this.ref instanceof q?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=r,n)if(this.root=n,this.ref instanceof q){var d=this.ref._definition;for(var O in d.schema){var x=this.ref[O];x&&x.$changes&&x.$changes.setParent(this.ref,n,d.indexes[O])}}else"object"==typeof this.ref&&this.ref.forEach(function(I,w){I instanceof q&&I.$changes.setParent(f.ref,f.root,f.ref.$changes.indexes[w])})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(e,n){void 0===n&&(n=i.OPERATION.ADD);var r="number"==typeof e?e:this.indexes[e];this.assertValidIndex(r,e);var f=this.changes.get(r);(!f||f.op===i.OPERATION.DELETE||f.op===i.OPERATION.TOUCH)&&this.changes.set(r,{op:f&&f.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:n,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},t.prototype.touch=function(e){var n="number"==typeof e?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:i.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[e]];var n=this.parent._definition;return Object.values(n.schema[n.fieldsByIndex[this.parentIndex]])[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(e){var n="number"==typeof e?e:this.indexes[e];if(void 0!==n){var r=this.getValue(n);this.changes.set(n,{op:i.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+n+")")},t.prototype.discard=function(e,n){var r=this;void 0===e&&(e=!1),void 0===n&&(n=!1),this.ref instanceof q||this.changes.forEach(function(f){if(f.op===i.OPERATION.DELETE){var d=r.ref.getIndex(f.index);delete r.indexes[d]}}),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(n){var r=e.getValue(n.index);r&&r.$changes&&r.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,n){this.caches[e]=n},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,n){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+n+'"')},t}(),L=function(t,e){var n=t.toString(),r=e.toString();return n<r?-1:n>r?1:0};function B(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"==typeof n||isNaN(n)?e[n]:e.at(n)},set:function(e,n,r){if("symbol"==typeof n||isNaN(n))e[n]=r;else{var f=Array.from(e.$items.keys()),d=parseInt(f[n]||n);null==r?e.deleteAt(d):e.setAt(d,r)}return!0},deleteProperty:function(e,n){return"number"==typeof n?e.deleteAt(n):delete e[n],!0}})}var K=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var f;return n.forEach(function(d){f=e.$refId++,e.setAt(f,d)}),f},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var n=this.$items.get(e);return this.$items.delete(e),n}},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.setAt=function(e,n){var r,f;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,e);var d=null!==(f=null===(r=this.$changes.indexes[e])||void 0===r?void 0:r.op)&&void 0!==f?f:i.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,d)},t.prototype.deleteAt=function(e){var n=Array.from(this.$items.keys())[e];return void 0!==n&&this.$deleteAt(n)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){n.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new(t.bind.apply(t,C([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(f,d){e.setAt(n[d],f)}),this},t.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var r=this.$items.get(n);return this.$deleteAt(n),r}},t.prototype.slice=function(e,n){return new(t.bind.apply(t,C([void 0],Array.from(this.$items.values()).slice(e,n))))},t.prototype.sort=function(e){var n=this;void 0===e&&(e=L);var r=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(d,O){n.setAt(r[O],d)}),this},t.prototype.splice=function(e,n){void 0===n&&(n=this.length-e);for(var r=[],f=2;f<arguments.length;f++)r[f-2]=arguments[f];for(var d=Array.from(this.$items.keys()),O=[],x=e;x<e+n;x++)O.push(this.$items.get(d[x])),this.$deleteAt(d[x]);return O},t.prototype.unshift=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var f=this.length,d=n.length,O=Array.from(this.$items.values());return n.forEach(function(x,P){e.setAt(P,x)}),O.forEach(function(x,P){e.setAt(d+P,x)}),f+d},t.prototype.indexOf=function(e,n){return Array.from(this.$items.values()).indexOf(e,n)},t.prototype.lastIndexOf=function(e,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,n)},t.prototype.every=function(e,n){return Array.from(this.$items.values()).every(e,n)},t.prototype.some=function(e,n){return Array.from(this.$items.values()).some(e,n)},t.prototype.forEach=function(e,n){Array.from(this.$items.values()).forEach(e,n)},t.prototype.map=function(e,n){return Array.from(this.$items.values()).map(e,n)},t.prototype.filter=function(e,n){return Array.from(this.$items.values()).filter(e,n)},t.prototype.reduce=function(e,n){return Array.from(this.$items.values()).reduce(e,n)},t.prototype.reduceRight=function(e,n){return Array.from(this.$items.values()).reduceRight(e,n)},t.prototype.find=function(e,n){return Array.from(this.$items.values()).find(e,n)},t.prototype.findIndex=function(e,n){return Array.from(this.$items.values()).findIndex(e,n)},t.prototype.fill=function(e,n,r){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,n,r){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,n){return Array.from(this.$items.values()).includes(e,n)},t.prototype.flatMap=function(e,n){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},t.prototype.clone=function(e){return e?new(t.bind.apply(t,C([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,C([void 0],this.map(function(r){return r.$changes?r.clone():r}))))},t.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},t}();function je(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"!=typeof n&&typeof e[n]>"u"?e.get(n):e[n]},set:function(e,n,r){return"symbol"!=typeof n&&-1===n.indexOf("$")&&"onAdd"!==n&&"onRemove"!==n&&"onChange"!==n?e.set(n,r):e[n]=r,!0},deleteProperty:function(e,n){return e.delete(n),!0}})}var Y=function(){function t(e){var n=this;if(this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(f,d){return n.set(d,f)});else for(var r in e)this.set(r,e[r])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(e,n){if(null==n)throw new Error("MapSchema#set('"+e+"', "+n+"): trying to set "+n+" value on '"+e+"'.");var r=typeof this.$changes.indexes[e]<"u",f=r?this.$changes.indexes[e]:this.$refId++,d=r?i.OPERATION.REPLACE:i.OPERATION.ADD,O=void 0!==n.$changes;return O&&n.$changes.setParent(this,this.$changes.root,f),r?O&&this.$items.get(e)!==n&&(d=i.OPERATION.ADD):(this.$changes.indexes[e]=f,this.$indexes.set(f,e)),this.$items.set(e,n),this.$changes.change(e,d),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){n.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(n,r){e[r]="function"==typeof n.toJSON?n.toJSON():n}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r,f){n.set(f,r.$changes?r.clone():r)})),n},t.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},t}(),Mt={};function Ie(t,e){Mt[t]=e}function Be(t){return Mt[t]}var pt=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(e,n){var r=this.getNextFieldIndex();this.fieldsByIndex[r]=e,this.indexes[e]=r,this.schema[e]=Array.isArray(n)?{array:n[0]}:n},t.prototype.addFilter=function(e,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=n,this.indexesWithFilters.push(this.indexes[e]),!0},t.prototype.addChildrenFilter=function(e,n){var r=this.indexes[e];if(Be(Object.keys(this.schema[e])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[r]=n,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},t.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();var Je=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(e){return this.schemas.has(e)},t.prototype.get=function(e){return this.types[e]},t.prototype.add=function(e,n){void 0===n&&(n=this.schemas.size),e._definition=pt.create(e._definition),e._typeid=n,this.types[n]=e,this.schemas.set(e,n)},t.create=function(e){return void 0===e&&(e=new t),function(n){return te(n,e)}},t}(),It=new Je;function te(t,e){return void 0===e&&(e=It),function(n,r){var f=n.constructor;f._context=e,e.has(f)||e.add(f);var d=f._definition;if(d.addField(r,t),d.descriptors[r]){if(d.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '"+r+"' definition on '"+f.name+"'.\nCheck @type() annotation")}catch(A){var O=A.stack.split("\n")[4].trim();throw new Error(A.message+" "+O)}}var x=K.is(t),P=!x&&Y.is(t);if("string"!=typeof t&&!q.is(t)){var I=Object.values(t)[0];"string"!=typeof I&&!e.has(I)&&e.add(I)}var w="_"+r;d.descriptors[w]={enumerable:!1,configurable:!1,writable:!0},d.descriptors[r]={get:function(){return this[w]},set:function(A){A!==this[w]&&(null!=A?(x&&!(A instanceof K)&&(A=new(K.bind.apply(K,C([void 0],A)))),P&&!(A instanceof Y)&&(A=new Y(A)),void 0===A.$proxy&&(P?A=je(A):x&&(A=B(A))),this.$changes.change(r),A.$changes&&A.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this.$changes.delete(r),this[w]=A)},enumerable:!0,configurable:!0}}}function bt(t,e,n){for(var r=0,f=0,d=n.length;f<d;f++)(r=n.charCodeAt(f))<128?t[e++]=r:r<2048?(t[e++]=192|r>>6,t[e++]=128|63&r):r<55296||r>=57344?(t[e++]=224|r>>12,t[e++]=128|r>>6&63,t[e++]=128|63&r):(f++,r=65536+((1023&r)<<10|1023&n.charCodeAt(f)),t[e++]=240|r>>18,t[e++]=128|r>>12&63,t[e++]=128|r>>6&63,t[e++]=128|63&r)}function Tt(t,e){t.push(255&e)}function Q(t,e){t.push(255&e)}function Rt(t,e){t.push(255&e),t.push(e>>8&255)}function gt(t,e){t.push(255&e),t.push(e>>8&255)}function be(t,e){t.push(255&e),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function le(t,e){var n=e>>24,r=e>>16,f=e>>8;t.push(255&e),t.push(255&f),t.push(255&r),t.push(255&n)}function St(t,e){var n=Math.floor(e/Math.pow(2,32));le(t,e>>>0),le(t,n)}function Dt(t,e){var n=e/Math.pow(2,32)>>0;le(t,e>>>0),le(t,n)}var Te=new Int32Array(2),Vt=new Float32Array(Te.buffer),en=new Float64Array(Te.buffer);function Pt(t,e){Vt[0]=e,be(t,Te[0])}function mt(t,e){en[0]=e,be(t,Te[0]),be(t,Te[1])}function Ze(t,e){e||(e="");var n=function Kt(t){for(var e=0,n=0,r=0,f=t.length;r<f;r++)(e=t.charCodeAt(r))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}(e),r=0;if(n<32)t.push(160|n),r=1;else if(n<256)t.push(217),Q(t,n),r=2;else if(n<65536)t.push(218),gt(t,n),r=3;else{if(!(n<4294967296))throw new Error("String too long");t.push(219),le(t,n),r=5}return bt(t,t.length,e),r+n}function W(t,e){return isNaN(e)?W(t,0):isFinite(e)?e!==(0|e)?(t.push(203),mt(t,e),9):e>=0?e<128?(Q(t,e),1):e<256?(t.push(204),Q(t,e),2):e<65536?(t.push(205),gt(t,e),3):e<4294967296?(t.push(206),le(t,e),5):(t.push(207),Dt(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),Tt(t,e),2):e>=-32768?(t.push(209),Rt(t,e),3):e>=-2147483648?(t.push(210),be(t,e),5):(t.push(211),St(t,e),9):W(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var vt=Object.freeze({__proto__:null,utf8Write:bt,int8:Tt,uint8:Q,int16:Rt,uint16:gt,int32:be,uint32:le,int64:St,uint64:Dt,float32:function Wt(t,e){Pt(t,e)},float64:function Xt(t,e){mt(t,e)},writeFloat32:Pt,writeFloat64:mt,boolean:function tn(t,e){return Q(t,e?1:0)},string:Ze,number:W});function kt(t,e){return Re(t,e)<<24>>24}function Re(t,e){return t[e.offset++]}function Nt(t,e){return He(t,e)<<16>>16}function He(t,e){return t[e.offset++]|t[e.offset++]<<8}function de(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function xe(t,e){return de(t,e)>>>0}function Ut(t,e){var n=xe(t,e);return de(t,e)*Math.pow(2,32)+n}function Ft(t,e){var n=xe(t,e);return xe(t,e)*Math.pow(2,32)+n}var Se=new Int32Array(2),sn=new Float32Array(Se.buffer),an=new Float64Array(Se.buffer);function _t(t,e){return Se[0]=de(t,e),sn[0]}function yt(t,e){return Se[0]=de(t,e),Se[1]=de(t,e),an[0]}function Lt(t,e){var r,n=t[e.offset++];n<192?r=31&n:217===n?r=Re(t,e):218===n?r=He(t,e):219===n&&(r=xe(t,e));var f=function nn(t,e,n){for(var r="",f=0,d=e,O=e+n;d<O;d++){var x=t[d];0!=(128&x)?192!=(224&x)?224!=(240&x)?240!=(248&x)?console.error("Invalid byte "+x.toString(16)):(f=(7&x)<<18|(63&t[++d])<<12|(63&t[++d])<<6|(63&t[++d])<<0)>=65536?(f-=65536,r+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):r+=String.fromCharCode(f):r+=String.fromCharCode((15&x)<<12|(63&t[++d])<<6|(63&t[++d])<<0):r+=String.fromCharCode((31&x)<<6|63&t[++d]):r+=String.fromCharCode(x)}return r}(t,e.offset,r);return e.offset+=r,f}function pe(t,e){var n=t[e.offset++];return n<128?n:202===n?_t(t,e):203===n?yt(t,e):204===n?Re(t,e):205===n?He(t,e):206===n?xe(t,e):207===n?Ft(t,e):208===n?kt(t,e):209===n?Nt(t,e):210===n?de(t,e):211===n?Ut(t,e):n>223?-1*(255-n+1):void 0}function zt(t,e){return t[e.offset-1]===y&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var jt=Object.freeze({__proto__:null,int8:kt,uint8:Re,int16:Nt,uint16:He,int32:de,uint32:xe,float32:function rn(t,e){return _t(t,e)},float64:function on(t,e){return yt(t,e)},int64:Ut,uint64:Ft,readFloat32:_t,readFloat64:yt,boolean:function cn(t,e){return Re(t,e)>0},string:Lt,stringCheck:function fn(t,e){var n=t[e.offset];return n<192&&n>160||217===n||218===n||219===n},number:pe,numberCheck:function un(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211},arrayCheck:function hn(t,e){return t[e.offset]<160},switchStructureCheck:zt}),xt=function(){function t(e){var n=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var n=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,e),this.$changes.change(n),n},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var r,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(e===f.value[1]){r=f.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){n.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(n){return n===e})},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,f,d){return e(r,f,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){n.add(r.$changes?r.clone():r)})),n},t.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},t}(),wt=function(){function t(e){var n=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.is=function(e){return void 0!==e.set},t.prototype.add=function(e){var n,r;if(this.has(e))return!1;var f=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,f);var d=null!==(r=null===(n=this.$changes.indexes[f])||void 0===n?void 0:n.op)&&void 0!==r?r:i.OPERATION.ADD;return this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,e),this.$changes.change(f,d),f},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var r,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(e===f.value[1]){r=f.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(r){n.$changes.root.removeRef(r.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var f,n=this.$items.values(),r=!1;(f=n.next())&&!f.done;)if(e===f.value){r=!0;break}return r},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,f,d){return e(r,f,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){n.add(r.$changes?r.clone():r)})),n},t.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},t}(),ln=function(){function t(){this.handlers=[]}return t.prototype.register=function(e,n){return this.handlers.push(e),this},t.prototype.invoke=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.handlers.forEach(function(r){return r.apply(void 0,e)})},t.prototype.invokeAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Promise.all(this.handlers.map(function(r){return r.apply(void 0,e)}))},t.prototype.remove=function(e){var n=this.handlers.indexOf(e);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}(),dn=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return void 0===e.$filterState&&(e.$filterState=new t),e.$filterState},t}(),Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e}(Error);function Bt(t,e,n,r){if(!(t instanceof e))throw new Ct("a '"+e.name+"' was expected, but '"+t.constructor.name+"' was provided in "+n.constructor.name+"#"+r)}function gn(t,e,n,r,f){!function pn(t,e,n,r){var f,d=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":f="number",isNaN(t)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+r);break;case"string":f="string",d=!0;break;case"boolean":return}if(typeof t!==f&&(!d||d&&null!==t)){var O="'"+JSON.stringify(t)+"'"+(t&&t.constructor&&" ("+t.constructor.name+")"||"");throw new Ct("a '"+f+"' was expected, but "+O+" was provided in "+n.constructor.name+"#"+r)}}(n,t,r,f);var d=vt[t];if(!d)throw new Ct("a '"+t+"' was expected, but "+n+" was provided in "+r.constructor.name+"#"+f);d(e,n)}function mn(t,e,n){return jt[t](e,n)}var q=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new N(this,void 0,new m),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var r=this._definition.descriptors;r&&Object.defineProperties(this,r),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.listen=function(e,n){var r=this;return this.$listeners[e]||(this.$listeners[e]=new ln),this.$listeners[e].register(n),function(){return r.$listeners[e].remove(n)}},t.prototype.decode=function(e,n,r,f){void 0===n&&(n={offset:0}),void 0===r&&(r=this),void 0===f&&(f=new Map);var d=this.$changes.root,O=e.length,x=0,P=[];for(d.refs.set(x,this),f.set(x,P);n.offset<O;){var I=e[n.offset++];if(I!=y){var A=r.$changes,F=void 0!==r._definition,S=F?I>>6<<6:I;if(S!==i.OPERATION.CLEAR){var M=F?I%(S||255):pe(e,n),R=F?r._definition.fieldsByIndex[M]:"",U=A.getType(M),$=void 0,k=void 0,G=void 0;if(F?k=r["_"+R]:(k=r.getByIndex(M),(S&i.OPERATION.ADD)===i.OPERATION.ADD?(G=r instanceof Y?Lt(e,n):M,r.setIndex(M,G)):G=r.getIndex(M)),(S&i.OPERATION.DELETE)===i.OPERATION.DELETE&&(S!==i.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(M),k&&k.$changes&&d.removeRef(k.$changes.refId),$=null),void 0!==R){if(S!==i.OPERATION.DELETE)if(t.is(U)){var J=pe(e,n);if($=d.refs.get(J),S!==i.OPERATION.REPLACE){var ie=this.getSchemaType(e,n,U);$||(($=this.createTypeInstance(ie)).$changes.refId=J,k&&($.onChange=k.onChange,$.onRemove=k.onRemove,$.$listeners=k.$listeners,k.$changes.refId&&J!==k.$changes.refId&&d.removeRef(k.$changes.refId))),d.addRef(J,$,$!==k)}}else if("string"==typeof U)$=mn(U,e,n);else{var De=Be(Object.keys(U)[0]),X=pe(e,n),Z=d.refs.has(X)?k||d.refs.get(X):new De.constructor;if(($=Z.clone(!0)).$changes.refId=X,k&&($.onAdd=k.onAdd,$.onRemove=k.onRemove,$.onChange=k.onChange,k.$changes.refId&&X!==k.$changes.refId)){d.removeRef(k.$changes.refId);for(var H=[],$t=k.entries(),oe=void 0;(oe=$t.next())&&!oe.done;){var qe=oe.value;H.push({op:i.OPERATION.DELETE,field:qe[0],value:void 0,previousValue:qe[1]})}f.set(k.$changes.refId,H)}d.addRef(X,$,Z!==k),De.getProxy&&($=De.getProxy($))}var yn=k!==$;if(null!=$)if($.$changes&&$.$changes.setParent(A.ref,A.root,M),r instanceof t)r[R]=$;else if(r instanceof Y)r.$items.set(G,$);else if(r instanceof K)r.setAt(M,$);else if(r instanceof xt){var Ge=r.add($);r.setIndex(M,Ge)}else r instanceof wt&&!1!==(Ge=r.add($))&&r.setIndex(M,Ge);yn&&P.push({op:S,field:R,dynamicIndex:G,value:$,previousValue:k})}else{console.warn("@colyseus/schema: definition mismatch");for(var b={offset:n.offset};n.offset<O&&(!zt(e,n)||(b.offset=n.offset+1,!d.refs.has(pe(e,b))));)n.offset++}}else r.clear(!0)}else{x=pe(e,n);var w=d.refs.get(x);if(!w)throw new Error('"refId" not found: '+x);r=w,f.set(x,P=[])}}return this._triggerChanges(f),d.garbageCollectDeletedRefs(),f},t.prototype.encode=function(e,n,r){void 0===e&&(e=!1),void 0===n&&(n=[]),void 0===r&&(r=!1);for(var f=this.$changes,d=new WeakSet,O=[f],x=1,P=0;P<x;P++){var I=O[P],w=I.ref,A=w instanceof t;I.ensureRefId(),d.add(I),I!==f&&(I.changed||e)&&(Q(n,y),W(n,I.refId));for(var F=Array.from(e?I.allChanges:I.changes.values()),S=0,M=F.length;S<M;S++){var R=e?{op:i.OPERATION.ADD,index:F[S]}:F[S],U=R.index,$=A?w._definition.fieldsByIndex&&w._definition.fieldsByIndex[U]:U,k=n.length;if(R.op!==i.OPERATION.TOUCH)if(A)Q(n,U|R.op);else{if(Q(n,R.op),R.op===i.OPERATION.CLEAR)continue;W(n,U)}if(!A&&(R.op&i.OPERATION.ADD)==i.OPERATION.ADD&&w instanceof Y&&Ze(n,I.ref.$indexes.get(U)),R.op!==i.OPERATION.DELETE){var b=I.getType(U),J=I.getValue(U);if(J&&J.$changes&&!d.has(J.$changes)&&(O.push(J.$changes),J.$changes.ensureRefId(),x++),R.op!==i.OPERATION.TOUCH){if(t.is(b))Bt(J,b,w,$),W(n,J.$changes.refId),(R.op&i.OPERATION.ADD)===i.OPERATION.ADD&&this.tryEncodeTypeId(n,b,J.constructor);else if("string"==typeof b)gn(b,n,J,w,$);else{var ie=Be(Object.keys(b)[0]);Bt(w["_"+$],ie.constructor,w,$),W(n,J.$changes.refId)}r&&I.cache(U,n.slice(k))}}}!e&&!r&&I.discard()}return n},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(e,n){var r,f;void 0===n&&(n=!1);for(var d=this,O=new Set,x=dn.get(e),P=[this.$changes],I=1,w=[],A=function(S){var M=P[S];if(O.has(M.refId))return"continue";var R=M.ref,U=R instanceof t;Q(w,y),W(w,M.refId);var $=x.refIds.has(M),k=n||!$;x.addRefId(M);var G=x.containerIndexes.get(M),b=Array.from(k?M.allChanges:M.changes.values());!n&&U&&R._definition.indexesWithFilters&&R._definition.indexesWithFilters.forEach(function(we){!G.has(we)&&M.allChanges.has(we)&&b.push(k?we:{op:i.OPERATION.ADD,index:we})});for(var ie=0,De=b.length;ie<De;ie++){var X=k?{op:i.OPERATION.ADD,index:b[ie]}:b[ie];if(X.op!==i.OPERATION.CLEAR){var Z=X.index;if(X.op!==i.OPERATION.DELETE){var H=M.getValue(Z),$t=M.getType(Z);if(U){if((oe=R._definition.filters&&R._definition.filters[Z])&&!oe.call(R,e,H,d)){H&&H.$changes&&O.add(H.$changes.refId);continue}}else{var oe,qe=M.parent;if((oe=M.getChildrenFilter())&&!oe.call(qe,e,R.$indexes.get(Z),H,d)){H&&H.$changes&&O.add(H.$changes.refId);continue}}if(H.$changes&&(P.push(H.$changes),I++),X.op!==i.OPERATION.TOUCH)if(X.op===i.OPERATION.ADD||U)w.push.apply(w,null!==(r=M.caches[Z])&&void 0!==r?r:[]),G.add(Z);else if(G.has(Z))w.push.apply(w,null!==(f=M.caches[Z])&&void 0!==f?f:[]);else{if(G.add(Z),Q(w,i.OPERATION.ADD),W(w,Z),R instanceof Y){var me=M.ref.$indexes.get(Z);Ze(w,me)}H.$changes?W(w,H.$changes.refId):vt[$t](w,H)}else H.$changes&&!U&&(Q(w,i.OPERATION.ADD),W(w,Z),R instanceof Y&&(me=M.ref.$indexes.get(Z),Ze(w,me)),W(w,H.$changes.refId))}else U?Q(w,X.op|Z):(Q(w,X.op),W(w,Z))}else Q(w,X.op)}},F=0;F<I;F++)A(F);return w},t.prototype.clone=function(){var e=new this.constructor,n=this._definition.schema;for(var r in n)e[r]="object"==typeof this[r]&&"function"==typeof this[r].clone?this[r].clone():this[r];return e},t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(n){t.onError(n)}}},t.prototype.toJSON=function(){var e=this._definition.schema,n=this._definition.deprecated,r={};for(var f in e)!n[f]&&null!==this[f]&&typeof this[f]<"u"&&(r[f]="function"==typeof this[f].toJSON?this[f].toJSON():this["_"+f]);return r},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,n,r){n._typeid!==r._typeid&&(Q(e,213),W(e,r._typeid))},t.prototype.getSchemaType=function(e,n,r){var f;return 213===e[n.offset]&&(n.offset++,f=this.constructor._context.get(pe(e,n))),f||r},t.prototype.createTypeInstance=function(e){var n=new e;return n.$changes.root=this.$changes.root,n},t.prototype._triggerAllFillChanges=function(e,n){if(!n.has(e.$changes.refId)){var r=[];if(n.set(e.$changes.refId||0,r),e instanceof t){var f=e._definition.schema;for(var d in f)void 0!==(x=e["_"+d])&&(r.push({op:i.OPERATION.ADD,field:d,value:x,previousValue:void 0}),void 0!==x.$changes&&t.prototype._triggerAllFillChanges.call(this,x,n))}else for(var P=e.entries(),I=void 0;(I=P.next())&&!I.done;){var x,w=I.value,A=w[0];r.push({op:i.OPERATION.ADD,field:A,dynamicIndex:A,value:x=w[1],previousValue:void 0}),void 0!==x.$changes&&t.prototype._triggerAllFillChanges.call(this,x,n)}}},t.prototype._triggerChanges=function(e){var n=this;e.forEach(function(r,f){var d,O,x,P,I,w,A,F,S,M,R,U;if(r.length>0){for(var $=n.$changes.root.refs.get(f),k=$ instanceof t,G=0;G<r.length;G++){var b=r[G],J=$.$listeners&&$.$listeners[b.field];if(k||(b.op===i.OPERATION.ADD&&void 0===b.previousValue?null===(O=(d=$).onAdd)||void 0===O||O.call(d,b.value,null!==(x=b.dynamicIndex)&&void 0!==x?x:b.field):b.op===i.OPERATION.DELETE?void 0!==b.previousValue&&(null===(I=(P=$).onRemove)||void 0===I||I.call(P,b.previousValue,null!==(w=b.dynamicIndex)&&void 0!==w?w:b.field)):b.op===i.OPERATION.DELETE_AND_ADD?(void 0!==b.previousValue&&(null===(F=(A=$).onRemove)||void 0===F||F.call(A,b.previousValue,b.dynamicIndex)),null===(M=(S=$).onAdd)||void 0===M||M.call(S,b.value,b.dynamicIndex)):(b.op===i.OPERATION.REPLACE||b.value!==b.previousValue)&&(null===(U=(R=$).onChange)||void 0===U||U.call(R,b.value,b.dynamicIndex))),(b.op&i.OPERATION.DELETE)===i.OPERATION.DELETE&&b.previousValue instanceof t&&b.previousValue.onRemove&&b.previousValue.onRemove(),J)try{J.invoke(b.value,b.previousValue)}catch(ie){t.onError(ie)}}if(k&&$.onChange)try{$.onChange(r)}catch(ie){t.onError(ie)}}})},t._definition=pt.create(),t}();var ge=new Je,At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),l([te("string",ge)],e.prototype,"name",void 0),l([te("string",ge)],e.prototype,"type",void 0),l([te("number",ge)],e.prototype,"referencedType",void 0),e}(q),Ot=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.fields=new K,n}return h(e,t),l([te("number",ge)],e.prototype,"id",void 0),l([te([At],ge)],e.prototype,"fields",void 0),e}(q),_n=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.types=new K,n}return h(e,t),e.encode=function(n){var r=n.constructor,f=new e;f.rootType=r._typeid;var d=function(I,w){for(var A in w){var F=new At;F.name=A;var S=void 0;if("string"==typeof w[A])S=w[A];else{var M=w[A],R=void 0;q.is(M)?(S="ref",R=w[A]):"string"==typeof M[S=Object.keys(M)[0]]?S+=":"+M[S]:R=M[S],F.referencedType=R?R._typeid:-1}F.type=S,I.fields.push(F)}f.types.push(I)},O=r._context.types;for(var x in O){var P=new Ot;P.id=Number(x),d(P,O[x]._definition.schema)}return f.encodeAll()},e.decode=function(n,r){var f=new Je,d=new e;d.decode(n,r);var O=d.types.reduce(function(A,F){var S=function(R){function U(){return null!==R&&R.apply(this,arguments)||this}return h(U,R),U}(q),M=F.id;return A[M]=S,f.add(S,M),A},{});d.types.forEach(function(A){var F=O[A.id];A.fields.forEach(function(S){var M;if(void 0!==S.referencedType){var R=S.type,U=O[S.referencedType];if(!U){var $=S.type.split(":");R=$[0],U=$[1]}"ref"===R?te(U,f)(F.prototype,S.name):te(((M={})[R]=U,M),f)(F.prototype,S.name)}else te(S.type,f)(F.prototype,S.name)})});var x=O[d.rootType],P=new x;for(var I in x._definition.schema){var w=x._definition.schema[I];"string"!=typeof w&&(P[I]="function"==typeof w?new w:new(Be(Object.keys(w)[0]).constructor))}return P},l([te([Ot],ge)],e.prototype,"types",void 0),l([te("number",ge)],e.prototype,"rootType",void 0),e}(q);Ie("map",{constructor:Y,getProxy:je}),Ie("array",{constructor:K,getProxy:B}),Ie("set",{constructor:wt}),Ie("collection",{constructor:xt}),i.ArraySchema=K,i.CollectionSchema=xt,i.Context=Je,i.MapSchema=Y,i.Reflection=_n,i.ReflectionField=At,i.ReflectionType=Ot,i.Schema=q,i.SchemaDefinition=pt,i.SetSchema=wt,i.decode=jt,i.defineTypes=function Qt(t,e,n){for(var r in void 0===n&&(n=t._context||It),e)te(e[r],n)(t.prototype,r);return t},i.deprecated=function Yt(t,e){return void 0===t&&(t=!0),function(n,r){var d=n.constructor._definition;d.deprecated[r]=!0,t&&(d.descriptors[r]={get:function(){throw new Error(r+" is deprecated.")},set:function(O){},enumerable:!1,configurable:!0})}},i.dumpChanges=function vn(t){for(var e=[t.$changes],r={},f=r,d=function(x){var P=e[x];P.changes.forEach(function(I){var w=P.ref,A=I.index,F=w._definition?w._definition.fieldsByIndex[A]:w.$indexes.get(A);f[F]=P.getValue(A)})},O=0;O<1;O++)d(O);return r},i.encode=vt,i.filter=function qt(t){return function(e,n){var r=e.constructor;r._definition.addFilter(n,t)&&(r._context.useFilters=!0)}},i.filterChildren=function Gt(t){return function(e,n){var r=e.constructor;r._definition.addChildrenFilter(n,t)&&(r._context.useFilters=!0)}},i.hasFilter=function Ht(t){return t._context&&t._context.useFilters},i.registerType=Ie,i.type=te,Object.defineProperty(i,"__esModule",{value:!0})},c(s)}),lt=function(){function o(s,i){var c=this;this.onStateChange=_e(),this.onError=_e(),this.onLeave=_e(),this.onJoin=_e(),this.hasJoined=!1,this.onMessageHandlers=ct(),this.id=null,this.name=s,i&&(this.serializer=new(ze("schema")),this.rootSchema=i,this.serializer.state=new i),this.onError(function(h,l){return console.warn("colyseus.js - onError => ("+h+") "+l)}),this.onLeave(function(){return c.removeAllListeners()})}return o.prototype.connect=function(s){var i=this;this.connection=new ot,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(c){if(!i.hasJoined)return console.warn("Room connection was closed unexpectedly ("+c.code+"): "+c.reason),void i.onError.invoke(c.code,c.reason);i.onLeave.invoke(c.code),i.destroy()},this.connection.events.onerror=function(c){console.warn("Room, onError ("+c.code+"): "+c.reason),i.onError.invoke(c.code,c.reason)},this.connection.connect(s)},o.prototype.leave=function(s){var i=this;return void 0===s&&(s=!0),new Promise(function(c){i.onLeave(function(h){return c(h)}),i.connection?s?i.connection.send([T.Protocol.LEAVE_ROOM]):i.connection.close():i.onLeave.invoke(4e3)})},o.prototype.onMessage=function(s,i){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),i)},o.prototype.send=function(s,i){var h,c=[T.Protocol.ROOM_DATA];if("string"==typeof s?re.encode.string(c,s):re.encode.number(c,s),void 0!==i){var l=nt(i);(h=new Uint8Array(c.length+l.byteLength)).set(new Uint8Array(c),0),h.set(new Uint8Array(l),c.length)}else h=new Uint8Array(c);this.connection.send(h.buffer)},Object.defineProperty(o.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),o.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},o.prototype.onMessageCallback=function(s){var i=Array.from(new Uint8Array(s.data)),c=i[0];if(c===T.Protocol.JOIN_ROOM){var h=1;if(this.serializerId=function st(o,s){for(var i=o[s++],c="",h=0,l=s,C=s+i;l<C;l++){var y=o[l];if(0!=(128&y))if(192!=(224&y))if(224!=(240&y)){if(240!=(248&y))throw new Error("Invalid byte "+y.toString(16));(h=(7&y)<<18|(63&o[++l])<<12|(63&o[++l])<<6|(63&o[++l])<<0)>=65536?(h-=65536,c+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):c+=String.fromCharCode(h)}else c+=String.fromCharCode((15&y)<<12|(63&o[++l])<<6|(63&o[++l])<<0);else c+=String.fromCharCode((31&y)<<6|63&o[++l]);else c+=String.fromCharCode(y)}return c}(i,h),h+=function at(o){void 0===o&&(o="");for(var s=0,i=0,c=0,h=o.length;c<h;c++)(s=o.charCodeAt(c))<128?i+=1:s<2048?i+=2:s<55296||s>=57344?i+=3:(c++,i+=4);return i+1}(this.serializerId),!this.serializer){var l=ze(this.serializerId);this.serializer=new l}i.length>h&&this.serializer.handshake&&this.serializer.handshake(i,{offset:h}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([T.Protocol.JOIN_ROOM])}else if(c===T.Protocol.ERROR){var C={offset:1},y=re.decode.number(i,C),v=re.decode.string(i,C);this.onError.invoke(y,v)}else if(c===T.Protocol.LEAVE_ROOM)this.leave();else if(c===T.Protocol.ROOM_DATA_SCHEMA){var m={offset:1};(v=new(L=this.serializer.getState().constructor._context.get(re.decode.number(i,m)))).decode(i,m),this.dispatchMessage(L,v)}else if(c===T.Protocol.ROOM_STATE)i.shift(),this.setState(i);else if(c===T.Protocol.ROOM_STATE_PATCH)i.shift(),this.patch(i);else if(c===T.Protocol.ROOM_DATA){var B={offset:1},L=re.decode.stringCheck(i,B)?re.decode.string(i,B):re.decode.number(i,B);v=i.length>B.offset?function Ve(o,s){void 0===s&&(s=0);var i=new fe(o,s),c=i._parse();if(i._offset!==o.byteLength)throw new Error(o.byteLength-i._offset+" trailing bytes");return c}(s.data,B.offset):void 0,this.dispatchMessage(L,v)}},o.prototype.setState=function(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.patch=function(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.dispatchMessage=function(s,i){var c=this.getMessageHandlerKey(s);this.onMessageHandlers.events[c]?this.onMessageHandlers.emit(c,i):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,i):console.warn("colyseus.js: onMessage() not registered for type '"+s+"'.")},o.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},o.prototype.getMessageHandlerKey=function(s){switch(typeof s){case"function":return"$"+s._typeid;case"string":return s;case"number":return"i"+s;default:throw new Error("invalid message type.")}},o}();function Me(){return Ee||(Ee=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(o,s){this.cache[o]=s},getItem:function(o){},removeItem:function(o){delete this.cache[o]}}),Ee}var u="colyseus-auth-token";T.Platform=void 0,function(o){o.ios="ios",o.android="android"}(T.Platform||(T.Platform={}));var E,_=function(){function o(s){var i=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=s.replace("ws","http"),function g(o,s){var i=Me().getItem(o);typeof Promise>"u"||!(i instanceof Promise)?s(i):i.then(function(c){return s(c)})}(u,function(c){return i.token=c})}return Object.defineProperty(o.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),o.prototype.login=function(s){return void 0===s&&(s={}),z(this,void 0,void 0,function(){var i,c,h;return j(this,function(l){switch(l.label){case 0:return i=Object.assign({},s),this.hasToken&&(i.token=this.token),[4,this.request("post","/auth",i)];case 1:for(h in c=l.sent(),this.token=c.token,function dt(o,s){Me().setItem(o,s)}(u,this.token),c)this.hasOwnProperty(h)&&(this[h]=c[h]);return this.registerPingService(),[2,this]}})})},o.prototype.save=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return s.sent(),[2,this]}})})},o.prototype.getFriends=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,s.sent()]}})})},o.prototype.getOnlineFriends=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,s.sent()]}})})},o.prototype.getFriendRequests=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,s.sent()]}})})},o.prototype.sendFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(i){switch(i.label){case 0:return[4,this.request("post","/friends/requests",{userId:s})];case 1:return[2,i.sent()]}})})},o.prototype.acceptFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(i){switch(i.label){case 0:return[4,this.request("put","/friends/requests",{userId:s})];case 1:return[2,i.sent()]}})})},o.prototype.declineFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(i){switch(i.label){case 0:return[4,this.request("del","/friends/requests",{userId:s})];case 1:return[2,i.sent()]}})})},o.prototype.blockUser=function(s){return z(this,void 0,void 0,function(){return j(this,function(i){switch(i.label){case 0:return[4,this.request("post","/friends/block",{userId:s})];case 1:return[2,i.sent()]}})})},o.prototype.unblockUser=function(s){return z(this,void 0,void 0,function(){return j(this,function(i){switch(i.label){case 0:return[4,this.request("put","/friends/block",{userId:s})];case 1:return[2,i.sent()]}})})},o.prototype.request=function(s,i,c,h,l){return void 0===c&&(c={}),void 0===l&&(l={}),z(this,void 0,void 0,function(){var C,y,v,m;return j(this,function(N){switch(N.label){case 0:for(y in l.Accept="application/json",this.hasToken&&(l.Authorization="Bearer "+this.token),C=[],c)C.push(y+"="+c[y]);return v=C.length>0?"?"+C.join("&"):"",m={headers:l},h&&(m.body=h),[4,Ke[s](""+this.endpoint+i+v,m)];case 1:return[2,N.sent().data]}})})},o.prototype.logout=function(){this.token=void 0,function p(o){Me().removeItem(o)}(u),this.unregisterPingService()},o.prototype.registerPingService=function(s){var i=this;void 0===s&&(s=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return i.request("get","/auth")},s)},o.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},o}(),D=function(o){function s(i,c){var h=o.call(this,i)||this;return h.code=c,Object.setPrototypeOf(h,s.prototype),h}return ne(s,o),s}(Error),ee=typeof window<"u"&&typeof(null===(E=window?.location)||void 0===E?void 0:E.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",ye=function(){function o(s){void 0===s&&(s=ee),this.endpoint=s}return Object.defineProperty(o.prototype,"auth",{get:function(){return this._auth||(this._auth=new _(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),o.prototype.joinOrCreate=function(s,i,c){return void 0===i&&(i={}),z(this,void 0,void 0,function(){return j(this,function(h){switch(h.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",s,i,c)];case 1:return[2,h.sent()]}})})},o.prototype.create=function(s,i,c){return void 0===i&&(i={}),z(this,void 0,void 0,function(){return j(this,function(h){switch(h.label){case 0:return[4,this.createMatchMakeRequest("create",s,i,c)];case 1:return[2,h.sent()]}})})},o.prototype.join=function(s,i,c){return void 0===i&&(i={}),z(this,void 0,void 0,function(){return j(this,function(h){switch(h.label){case 0:return[4,this.createMatchMakeRequest("join",s,i,c)];case 1:return[2,h.sent()]}})})},o.prototype.joinById=function(s,i,c){return void 0===i&&(i={}),z(this,void 0,void 0,function(){return j(this,function(h){switch(h.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,i,c)];case 1:return[2,h.sent()]}})})},o.prototype.reconnect=function(s,i,c){return z(this,void 0,void 0,function(){return j(this,function(h){switch(h.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,{sessionId:i},c)];case 1:return[2,h.sent()]}})})},o.prototype.getAvailableRooms=function(s){return void 0===s&&(s=""),z(this,void 0,void 0,function(){var i;return j(this,function(c){switch(c.label){case 0:return i=this.endpoint.replace("ws","http")+"/matchmake/"+s,[4,se(i,{headers:{Accept:"application/json"}})];case 1:return[2,c.sent().data]}})})},o.prototype.consumeSeatReservation=function(s,i){return z(this,void 0,void 0,function(){var c;return j(this,function(h){return(c=this.createRoom(s.room.name,i)).id=s.room.roomId,c.sessionId=s.sessionId,c.connect(this.buildEndpoint(s.room,{sessionId:c.sessionId})),[2,new Promise(function(l,C){var y=function(v,m){return C(new We(v,m))};c.onError.once(y),c.onJoin.once(function(){c.onError.remove(y),l(c)})})]})})},o.prototype.createMatchMakeRequest=function(s,i,c,h){return void 0===c&&(c={}),z(this,void 0,void 0,function(){var l,C;return j(this,function(y){switch(y.label){case 0:return l=this.endpoint.replace("ws","http")+"/matchmake/"+s+"/"+i,this._auth&&this._auth.hasToken&&(c.token=this._auth.token),[4,ce(l,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)})];case 1:if((C=y.sent().data).error)throw new D(C.error,C.code);return[2,this.consumeSeatReservation(C,h)]}})})},o.prototype.createRoom=function(s,i){return new lt(s,i)},o.prototype.buildEndpoint=function(s,i){void 0===i&&(i={});var c=[];for(var h in i)!i.hasOwnProperty(h)||c.push(h+"="+i[h]);return this.endpoint+"/"+s.processId+"/"+s.roomId+"?"+c.join("&")},o}(),Et=function(){function o(){}return o.prototype.setState=function(s){this.state.decode(s)},o.prototype.getState=function(){return this.state},o.prototype.patch=function(s){this.state.decode(s)},o.prototype.teardown=function(){var s,i;null===(i=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===i||i.root.clearRefs()},o.prototype.handshake=function(s,i){this.state?(new re.Reflection).decode(s,i):this.state=re.Reflection.decode(s,i)},o}(),Zt=function(){function o(){}return o.prototype.setState=function(s){},o.prototype.getState=function(){return null},o.prototype.patch=function(s){},o.prototype.teardown=function(){},o.prototype.handshake=function(s){},o}();$e("schema",Et),$e("none",Zt),T.Auth=_,T.Client=ye,T.Room=lt,T.SchemaSerializer=Et,T.registerSerializer=$e,Object.defineProperty(T,"__esModule",{value:!0})}(Pe)}}]);