(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{9429:(Ue,Mt,T)=>{"use strict";T.r(Mt),T.d(Mt,{MinesweeperModule:()=>ie});var ct=T(8198),rt=T(6895),L=T(5755),j=T(9386),Tt=T(2076),f=T(4650);const mt=["easy","medium","hard"];let _t=(()=>{class p extends class V{constructor(v){this.roomGame=v,this.client=new L.Client(`ws://${j.N.backend_url}`)}joinOrCreate(){return(0,Tt.D)(this.client.joinOrCreate(this.roomGame))}}{constructor(){super("MinesweeperRoom"),this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275prov=f.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();class Jt extends Set{add(v){super.add(v.toString())}has(v){return super.has(v.toString())}}class Ht{constructor({include:v=!0,onlyInteger:d=!0}){this.includeLimits=v,this.onlyInteger=d}returnOutputNumber(v){return this.onlyInteger?Math.round(v):v}between(v,d){let A;return A=this.includeLimits?Math.floor(Math.random()*(d-v+1)+v):Math.floor(Math.random()*(d-v)+v),this.returnOutputNumber(A)}}class Rt{constructor(v,d){this.row=v,this.column=d,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged=!1}}class ot extends Array{constructor(v,d="player"){super(),this.status="playing",this.player=d;const A=v?.size;for(let E=0;E<A;E++){this[E]=[];for(let k=0;k<A;k++)this[E].push(new Rt(E,k))}v&&this.generateBombs(v)}generateBombs(v){const d=new Ht({onlyInteger:!0}),A=new Jt;for(;A.size<v.bombs;){const E=d.between(0,v.size-1),k=d.between(0,v.size-1);A.has([E,k])||(A.add([E,k]),this[E][k].bomb=!0,this.getCellsArround(this[E][k]).forEach(tt=>{tt.nearBombs++}))}}getCellsArround(v){const d=[],A=v.row,E=v.column,k=(tt,vt)=>(this[tt]&&this[tt][vt]&&d.push(this[tt][vt]),d);return k(A+1,E+1),k(A+1,E-1),k(A+1,E+0),k(A-1,E+1),k(A-1,E-1),k(A-1,E+0),k(A+0,E+1),k(A+0,E-1),d}reveal(v){if(v.bomb)return this.status="game over",void this.revealAllCells();v.revealed=!0,0===v.nearBombs&&this.getCellsArround(v).filter(d=>0==d.revealed).forEach(d=>this.reveal(d))}revealAllCells(){this.forEach(v=>v.forEach(d=>d.revealed=!0))}}var st=T(9119),at=T(433),wt=T(5593),At=T(5362);function St(p,v){1&p&&f._UZ(0,"img",6)}function Zt(p,v){if(1&p&&f._UZ(0,"span"),2&p){const d=f.oxw(2).$implicit;f.Gre("m-0 p-0 near-bombs-text near-",d.nearBombs,"")}}function qt(p,v){if(1&p&&(f.ynx(0),f.YNc(1,St,1,0,"img",4),f.YNc(2,Zt,1,3,"span",5),f.BQk()),2&p){const d=f.oxw().$implicit;f.xp6(1),f.Q6J("ngIf",d.bomb),f.xp6(1),f.Q6J("ngIf",!d.bomb)}}function ft(p,v){if(1&p){const d=f.EpF();f.TgZ(0,"div",2),f.NdJ("click",function(){const k=f.CHM(d).$implicit,tt=f.oxw(2);return f.KtG(tt.cellClicked.emit(k))}),f.YNc(1,qt,3,2,"ng-container",3),f.qZA()}if(2&p){const d=v.$implicit,A=v.index,E=f.oxw().index;f.ekj("revealed",d.revealed)("empty",d.revealed&&0==d.nearBombs&&!d.bomb)("darker",(E%2+A)%2),f.xp6(1),f.Q6J("ngIf",d.revealed)}}function Gt(p,v){if(1&p&&(f.ynx(0),f.YNc(1,ft,2,7,"div",1),f.BQk()),2&p){const d=v.$implicit;f.xp6(1),f.Q6J("ngForOf",d)}}let Dt=(()=>{class p{constructor(d){this.game=d,this.cellClicked=new f.vpe,this.currentConfig=d.gameConfig.easy,this.matrix=new ot(this.currentConfig)}ngOnInit(){}}return p.\u0275fac=function(d){return new(d||p)(f.Y36(_t))},p.\u0275cmp=f.Xpm({type:p,selectors:[["minesweeper-game-matrix"]],inputs:{matrix:"matrix",currentConfig:"currentConfig"},outputs:{cellClicked:"cellClicked"},decls:2,vars:6,consts:[[4,"ngFor","ngForOf"],["class","matrix-cell",3,"revealed","empty","darker","click",4,"ngFor","ngForOf"],[1,"matrix-cell",3,"click"],[4,"ngIf"],["src","assets/bomb.png","class","bomb-image",4,"ngIf"],[3,"class",4,"ngIf"],["src","assets/bomb.png",1,"bomb-image"]],template:function(d,A){1&d&&(f.TgZ(0,"div"),f.YNc(1,Gt,2,1,"ng-container",0),f.qZA()),2&d&&(f.Gre("matrix-container matrix-sized-",A.currentConfig.size,""),f.Udp("grid-template-columns","repeat("+A.currentConfig.size+",calc(min(700px, 100%) / "+A.currentConfig.size+"))"),f.xp6(1),f.Q6J("ngForOf",A.matrix))},dependencies:[rt.sg,rt.O5],styles:['.matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;justify-content:center;font-weight:bolder}.matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:2rem}.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}@media (max-width: 992px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:7px}}@media (max-width: 768px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0;filter:brightness(.92)}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.darker[_ngcontent-%COMP%]{filter:brightness(.96)}.bomb-image[_ngcontent-%COMP%]{position:absolute;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),p})(),Kt=(()=>{class p{constructor(d,A,E){this.game=d,this.route=A,this.router=E,this.allDifficulties=[...mt],this.selectedDifficulty="easy",this.nextDifficulty=this.selectedDifficulty,this.gameConfig=this.game.gameConfig.easy,this.matrix=new ot(this.gameConfig)}ngOnInit(){this.route.params.subscribe(d=>{mt.includes(d.difficulty)?this.initializeGame(d.difficulty):this.initializeGame(mt[1])})}initializeGame(d){d!=this.selectedDifficulty&&this.router.navigate(["minesweeper","offline",d]),this.selectedDifficulty=d,this.gameConfig=this.game.gameConfig[d],this.matrix=new ot(this.gameConfig)}onCellClicked(d){this.matrix.reveal(d),"game over"===this.matrix.status&&console.log("game over")}}return p.\u0275fac=function(d){return new(d||p)(f.Y36(_t),f.Y36(st.gz),f.Y36(st.F0))},p.\u0275cmp=f.Xpm({type:p,selectors:[["app-offline"]],decls:15,vars:10,consts:[[1,"offline-game-container","py-4","w-100"],[1,"game",3,"matrix","currentConfig","cellClicked"],[1,"side-panel"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Restart",1,"p-button-lg",3,"click"]],template:function(d,A){1&d&&(f.TgZ(0,"div",0)(1,"minesweeper-game-matrix",1),f.NdJ("cellClicked",function(k){return A.onCellClicked(k)}),f.qZA(),f.TgZ(2,"div",2)(3,"div")(4,"h1"),f._uU(5,"Flags used: 7"),f.qZA(),f.TgZ(6,"h3"),f._uU(7," Difficulty "),f.TgZ(8,"span"),f._uU(9),f.ALo(10,"titlecase"),f.qZA()(),f.TgZ(11,"h3"),f._uU(12,"Change difficulty"),f.qZA(),f.TgZ(13,"p-selectButton",3),f.NdJ("ngModelChange",function(k){return A.nextDifficulty=k}),f.qZA(),f.TgZ(14,"button",4),f.NdJ("click",function(){return A.initializeGame(A.nextDifficulty)}),f.qZA()()()()),2&d&&(f.xp6(1),f.Q6J("matrix",A.matrix)("currentConfig",A.gameConfig),f.xp6(7),f.Gre("difficulty-color-",A.selectedDifficulty,""),f.xp6(1),f.Oqu(f.lcZ(10,8,A.selectedDifficulty)),f.xp6(4),f.Q6J("options",A.allDifficulties)("ngModel",A.nextDifficulty))},dependencies:[at.JJ,at.On,wt.Hq,At.UN,Dt,rt.rS],styles:[".offline-game-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:space-evenly}.offline-game-container[_ngcontent-%COMP%]   .game[_ngcontent-%COMP%]{min-height:700px;min-width:700px}"]}),p})();var Yt=T(4247);function ut(p,v){1&p&&f.GkF(0)}function Wt(p,v){1&p&&f.GkF(0)}function Qt(p,v){if(1&p){const d=f.EpF();f.TgZ(0,"div",5)(1,"minesweeper-game-matrix",6),f.NdJ("cellClicked",function(E){const tt=f.CHM(d).matrix;return f.KtG(tt.reveal(E))}),f.qZA()()}if(2&p){const d=v.matrix,A=f.oxw();f.xp6(1),f.Q6J("matrix",d)("currentConfig",A.currentConfig)}}function Xt(p,v){1&p&&(f._uU(0),f.ALo(1,"titlecase")),2&p&&f.hij(" ",f.lcZ(1,1,v.$implicit)," ")}const Vt=function(){return["Multiplayer","Offline"]};function te(p,v){if(1&p){const d=f.EpF();f.TgZ(0,"div",7)(1,"div",8)(2,"p-selectButton",9),f.NdJ("ngModelChange",function(E){f.CHM(d);const k=f.oxw();return f.KtG(k.selectedDifficulty=E)})("onChange",function(){f.CHM(d);const E=f.oxw();return f.KtG(E.difficultyChange())}),f.YNc(3,Xt,2,3,"ng-template"),f.qZA()(),f.TgZ(4,"div",10)(5,"div",11)(6,"h3",12),f._uU(7," Configuration: "),f.TgZ(8,"span",13),f._uU(9),f.ALo(10,"titlecase"),f.qZA()()(),f.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),f._uU(15," Size: "),f.TgZ(16,"span"),f._uU(17),f.qZA()()(),f.TgZ(18,"li")(19,"h4"),f._uU(20," Cells: "),f.TgZ(21,"span"),f._uU(22),f.qZA()()(),f.TgZ(23,"li")(24,"h4"),f._uU(25," Bombs: "),f.TgZ(26,"span"),f._uU(27),f.qZA()()()(),f.TgZ(28,"div",14)(29,"p-selectButton",15),f.NdJ("ngModelChange",function(E){f.CHM(d);const k=f.oxw();return f.KtG(k.networkGamemode=E)}),f.qZA()()(),f.TgZ(30,"div",8)(31,"button",16),f.NdJ("click",function(){f.CHM(d);const E=f.oxw();return f.KtG(E.onPlayButton())}),f.qZA()()()()}if(2&p){const d=f.oxw();f.xp6(2),f.Q6J("options",d.difficultyOptions)("ngModel",d.selectedDifficulty),f.xp6(7),f.Oqu(f.lcZ(10,18,d.selectedDifficulty)),f.xp6(7),f.Gre("difficulty-color-",d.selectedDifficulty,""),f.xp6(1),f.AsE("",d.currentConfig.size," x ",d.currentConfig.size,""),f.xp6(4),f.Gre("difficulty-color-",d.selectedDifficulty,""),f.xp6(1),f.Oqu(d.currentConfig.size*d.currentConfig.size),f.xp6(4),f.Gre("difficulty-color-",d.selectedDifficulty,""),f.xp6(1),f.Oqu(d.currentConfig.bombs),f.xp6(2),f.Q6J("options",f.DdM(20,Vt))("ngModel",d.networkGamemode)}}const Pt=function(p){return{matrix:p}},ne=[{path:"",children:[{path:"",component:(()=>{class p{constructor(){}ngOnInit(){}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275cmp=f.Xpm({type:p,selectors:[["app-lobby"]],decls:2,vars:0,template:function(d,A){1&d&&(f.TgZ(0,"p"),f._uU(1,"lobby works!"),f.qZA())}}),p})()},{path:"create",component:(()=>{class p{constructor(d,A){this.game=d,this.router=A,this.selectedDifficulty="easy",this.difficultyOptions=[...mt],this.networkGamemode="Offline",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new ot(this.currentConfig),this.userMatrix.forEach(d=>d.forEach(A=>{A.bomb&&(A.revealed=!0)}))}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}onPlayButton(){"Offline"==this.networkGamemode?this.router.navigate(["minesweeper","offline",this.selectedDifficulty]):console.log("TODO: redirect to multiplayer")}}return p.\u0275fac=function(d){return new(d||p)(f.Y36(_t),f.Y36(st.F0))},p.\u0275cmp=f.Xpm({type:p,selectors:[["app-difficulty-selector"]],decls:7,vars:5,consts:[[1,"main-double-board","py-5"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["optionMenuTemplate",""],[1,"matrix-container"],[3,"matrix","currentConfig","cellClicked"],[1,"option-menu-container"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"config-manager"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-center"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg",3,"click"]],template:function(d,A){if(1&d&&(f.TgZ(0,"div",0),f.YNc(1,ut,1,0,"ng-container",1),f.YNc(2,Wt,1,0,"ng-container",2),f.qZA(),f.YNc(3,Qt,2,2,"ng-template",null,3,f.W1O),f.YNc(5,te,32,21,"ng-template",null,4,f.W1O)),2&d){const E=f.MAs(4),k=f.MAs(6);f.xp6(1),f.Q6J("ngTemplateOutlet",E)("ngTemplateOutletContext",f.VKq(3,Pt,A.userMatrix)),f.xp6(1),f.Q6J("ngTemplateOutlet",k)}},dependencies:[rt.tP,at.JJ,at.On,wt.Hq,Yt.Z,At.UN,Dt,rt.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;flex-wrap:wrap-reverse}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.matrix-container[_ngcontent-%COMP%]{min-width:700px;margin-right:50px}.option-menu-container[_ngcontent-%COMP%]{min-width:500px}@media (max-width: 768px){.matrix-container[_ngcontent-%COMP%]{min-width:100%;margin-right:0}.option-menu-container[_ngcontent-%COMP%]{min-width:100%}}"]}),p})()},{path:"offline/:difficulty",component:Kt},{path:"offline",redirectTo:"offline/medium"}]}];let re=(()=>{class p{}return p.\u0275fac=function(d){return new(d||p)},p.\u0275mod=f.oAB({type:p}),p.\u0275inj=f.cJS({imports:[st.Bz.forChild(ne),st.Bz]}),p})(),ie=(()=>{class p{}return p.\u0275fac=function(d){return new(d||p)},p.\u0275mod=f.oAB({type:p}),p.\u0275inj=f.cJS({imports:[rt.ez,re,ct.m]}),p})()},5755:function(Ue,Mt){!function(T){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(o){return null!==o&&"object"==typeof o&&o.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ct=function(o,s){return(ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(r[u]=a[u])})(o,s)};function rt(o,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function r(){this.constructor=o}ct(o,s),o.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}function L(o,s,r,a){return new(r||(r=Promise))(function(h,w){function y(N){try{g(a.next(N))}catch(z){w(z)}}function m(N){try{g(a.throw(N))}catch(z){w(z)}}function g(N){N.done?h(N.value):function u(h){return h instanceof r?h:new r(function(w){w(h)})}(N.value).then(y,m)}g((a=a.apply(o,s||[])).next())})}function j(o,s){var a,u,h,w,r={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return w={next:y(0),throw:y(1),return:y(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w;function y(g){return function(N){return function m(g){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,u&&(h=2&g[0]?u.return:g[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,g[1])).done)return h;switch(u=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,u=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(!(h=(h=r.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){r=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){r.label=g[1];break}if(6===g[0]&&r.label<h[1]){r.label=h[1],h=g;break}if(h&&r.label<h[2]){r.label=h[2],r.ops.push(g);break}h[2]&&r.ops.pop(),r.trys.pop();continue}g=s.call(o,r)}catch(N){g=[6,N],u=0}finally{a=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([g,N])}}}function Tt(o,s){s.headers=o.headers||{},s.statusMessage=o.statusText,s.statusCode=o.status,s.data=o.response}function V(o,s,r){return new Promise(function(a,u){r=r||{};var w,y,m,h=new XMLHttpRequest,g=r.body,N=r.headers||{};for(w in r.timeout&&(h.timeout=r.timeout),h.ontimeout=h.onerror=function(z){z.timeout="timeout"==z.type,u(z)},h.open(o,s.href||s),h.onload=function(){for(m=h.getAllResponseHeaders().trim().split(/[\r\n]+/),Tt(h,h);y=m.shift();)y=y.split(": "),h.headers[y.shift().toLowerCase()]=y.join(": ");if((y=h.headers["content-type"])&&~y.indexOf("application/json"))try{h.data=JSON.parse(h.data,r.reviver)}catch(z){return Tt(h,z),u(z)}(h.status>=400?u:a)(h)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(N["content-type"]="application/json",g=JSON.stringify(g)),h.withCredentials=!!r.withCredentials,N)h.setRequestHeader(w,N[w]);h.send(g)})}var f=V.bind(V,"GET"),mt=V.bind(V,"POST"),_t=V.bind(V,"PATCH"),Rt=V.bind(V,"DELETE"),ot=f,st=_t,at=mt,wt=V.bind(V,"PUT"),At=V,St={del:Rt,get:ot,patch:st,post:at,put:wt,send:At},Zt=Object.freeze(Object.assign(Object.create(null),St,{default:St,del:Rt,get:ot,patch:st,post:at,put:wt,send:At})),qt=function(o){function s(r,a){var u=o.call(this,a)||this;return u.name="ServerError",u.code=r,u}return rt(s,o),s}(Error);function ft(o,s){if(this._offset=s,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}function Kt(o,s,r){for(var a=0,u=0,h=r.length;u<h;u++)(a=r.charCodeAt(u))<128?o.setUint8(s++,a):a<2048?(o.setUint8(s++,192|a>>6),o.setUint8(s++,128|63&a)):a<55296||a>=57344?(o.setUint8(s++,224|a>>12),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a)):(u++,a=65536+((1023&a)<<10|1023&r.charCodeAt(u)),o.setUint8(s++,240|a>>18),o.setUint8(s++,128|a>>12&63),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a))}function ut(o,s,r){var a=typeof r,u=0,h=0,w=0,y=0,m=0,g=0;if("string"===a){if((m=function Yt(o){for(var s=0,r=0,a=0,u=o.length;a<u;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r}(r))<32)o.push(160|m),g=1;else if(m<256)o.push(217,m),g=2;else if(m<65536)o.push(218,m>>8,m),g=3;else{if(!(m<4294967296))throw new Error("String too long");o.push(219,m>>24,m>>16,m>>8,m),g=5}return s.push({_str:r,_length:m,_offset:o.length}),g+m}if("number"===a)return Math.floor(r)===r&&isFinite(r)?r>=0?r<128?(o.push(r),1):r<256?(o.push(204,r),2):r<65536?(o.push(205,r>>8,r),3):r<4294967296?(o.push(206,r>>24,r>>16,r>>8,r),5):(w=r/Math.pow(2,32)>>0,o.push(207,w>>24,w>>16,w>>8,w,(y=r>>>0)>>24,y>>16,y>>8,y),9):r>=-32?(o.push(r),1):r>=-128?(o.push(208,r),2):r>=-32768?(o.push(209,r>>8,r),3):r>=-2147483648?(o.push(210,r>>24,r>>16,r>>8,r),5):(w=Math.floor(r/Math.pow(2,32)),o.push(211,w>>24,w>>16,w>>8,w,(y=r>>>0)>>24,y>>16,y>>8,y),9):(o.push(203),s.push({_float:r,_length:8,_offset:o.length}),9);if("object"===a){if(null===r)return o.push(192),1;if(Array.isArray(r)){if((m=r.length)<16)o.push(144|m),g=1;else if(m<65536)o.push(220,m>>8,m),g=3;else{if(!(m<4294967296))throw new Error("Array too large");o.push(221,m>>24,m>>16,m>>8,m),g=5}for(u=0;u<m;u++)g+=ut(o,s,r[u]);return g}if(r instanceof Date){var N=r.getTime();return w=Math.floor(N/Math.pow(2,32)),o.push(215,0,w>>24,w>>16,w>>8,w,(y=N>>>0)>>24,y>>16,y>>8,y),10}if(r instanceof ArrayBuffer){if((m=r.byteLength)<256)o.push(196,m),g=2;else if(m<65536)o.push(197,m>>8,m),g=3;else{if(!(m<4294967296))throw new Error("Buffer too large");o.push(198,m>>24,m>>16,m>>8,m),g=5}return s.push({_bin:r,_length:m,_offset:o.length}),g+m}if("function"==typeof r.toJSON)return ut(o,s,r.toJSON());var z=[],B="",W=Object.keys(r);for(u=0,h=W.length;u<h;u++)"function"!=typeof r[B=W[u]]&&z.push(B);if((m=z.length)<16)o.push(128|m),g=1;else if(m<65536)o.push(222,m>>8,m),g=3;else{if(!(m<4294967296))throw new Error("Object too large");o.push(223,m>>24,m>>16,m>>8,m),g=5}for(u=0;u<m;u++)g+=ut(o,s,B=z[u]),g+=ut(o,s,r[B]);return g}if("boolean"===a)return o.push(r?195:194),1;if("undefined"===a)return o.push(212,0,0),3;throw new Error("Could not encode")}function Wt(o){var s=[],r=[],a=ut(s,r,o),u=new ArrayBuffer(a),h=new DataView(u),w=0,y=0,m=-1;r.length>0&&(m=r[0]._offset);for(var g,N=0,z=0,B=0,W=s.length;B<W;B++)if(h.setUint8(y+B,s[B]),B+1===m){if(N=(g=r[w])._length,z=y+m,g._bin)for(var Nt=new Uint8Array(g._bin),K=0;K<N;K++)h.setUint8(z+K,Nt[K]);else g._str?Kt(h,z,g._str):void 0!==g._float&&h.setFloat64(z,g._float);y+=N,r[++w]&&(m=r[w]._offset)}return u}ft.prototype._array=function(o){for(var s=new Array(o),r=0;r<o;r++)s[r]=this._parse();return s},ft.prototype._map=function(o){for(var r={},a=0;a<o;a++)r[this._parse()]=this._parse();return r},ft.prototype._str=function(o){var s=function Gt(o,s,r){for(var a="",u=0,h=s,w=s+r;h<w;h++){var y=o.getUint8(h);if(0!=(128&y))if(192!=(224&y))if(224!=(240&y)){if(240!=(248&y))throw new Error("Invalid byte "+y.toString(16));(u=(7&y)<<18|(63&o.getUint8(++h))<<12|(63&o.getUint8(++h))<<6|(63&o.getUint8(++h))<<0)>=65536?(u-=65536,a+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):a+=String.fromCharCode(u)}else a+=String.fromCharCode((15&y)<<12|(63&o.getUint8(++h))<<6|(63&o.getUint8(++h))<<0);else a+=String.fromCharCode((31&y)<<6|63&o.getUint8(++h));else a+=String.fromCharCode(y)}return a}(this._view,this._offset,o);return this._offset+=o,s},ft.prototype._bin=function(o){var s=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,s},ft.prototype._parse=function(){var s,o=this._view.getUint8(this._offset++),r=0,a=0,u=0,h=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return r=this._view.getUint8(this._offset),this._offset+=1,this._bin(r);case 197:return r=this._view.getUint16(this._offset),this._offset+=2,this._bin(r);case 198:return r=this._view.getUint32(this._offset),this._offset+=4,this._bin(r);case 199:return r=this._view.getUint8(this._offset),a=this._view.getInt8(this._offset+1),this._offset+=2,[a,this._bin(r)];case 200:return r=this._view.getUint16(this._offset),a=this._view.getInt8(this._offset+2),this._offset+=3,[a,this._bin(r)];case 201:return r=this._view.getUint32(this._offset),a=this._view.getInt8(this._offset+4),this._offset+=5,[a,this._bin(r)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,u+h;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,u+h;case 212:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?void(this._offset+=1):[a,this._bin(1)];case 213:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(2)];case 214:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(4)];case 215:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?(u=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+h)):[a,this._bin(8)];case 216:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(16)];case 217:return r=this._view.getUint8(this._offset),this._offset+=1,this._str(r);case 218:return r=this._view.getUint16(this._offset),this._offset+=2,this._str(r);case 219:return r=this._view.getUint32(this._offset),this._offset+=4,this._str(r);case 220:return r=this._view.getUint16(this._offset),this._offset+=2,this._array(r);case 221:return r=this._view.getUint32(this._offset),this._offset+=4,this._array(r);case 222:return r=this._view.getUint16(this._offset),this._offset+=2,this._map(r);case 223:return r=this._view.getUint32(this._offset),this._offset+=4,this._map(r)}throw new Error("Could not parse")};var o,Xt=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},Vt=function(){function o(s){this.events=s}return o.prototype.send=function(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)},o.prototype.connect=function(s){this.ws=new Xt(s,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},o.prototype.close=function(s,r){this.ws.close(s,r)},o}(),te=function(){function o(){this.events={},this.transport=new Vt(this.events)}return o.prototype.send=function(s){this.transport.send(s)},o.prototype.connect=function(s){this.transport.connect(s)},o.prototype.close=function(s,r){this.transport.close(s,r)},o}(),Pt={};function kt(o,s){Pt[o]=s}function ee(o){var s=Pt[o];if(!s)throw new Error("missing serializer: "+o);return s}T.Protocol=void 0,(o=T.Protocol||(T.Protocol={}))[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",T.ErrorCode=void 0,function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(T.ErrorCode||(T.ErrorCode={}));let ie=()=>({events:{},emit(o,...s){(this.events[o]||[]).forEach(r=>r(...s))},on(o,s){return(this.events[o]=this.events[o]||[]).push(s),()=>this.events[o]=(this.events[o]||[]).filter(r=>r!==s)}});var p=function(){function o(){this.handlers=[]}return o.prototype.register=function(s,r){return this.handlers.push(s),this},o.prototype.invoke=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];this.handlers.forEach(function(u){return u.apply(s,r)})},o.prototype.invokeAsync=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return Promise.all(this.handlers.map(function(u){return u.apply(s,r)}))},o.prototype.remove=function(s){var r=this.handlers.indexOf(s);this.handlers[r]=this.handlers[this.handlers.length-1],this.handlers.pop()},o.prototype.clear=function(){this.handlers=[]},o}();function v(){var o=new p;function s(r){return o.register(r,null===this)}return s.once=function(r){var a=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];r.apply(this,u),o.remove(a)};o.register(a)},s.remove=function(r){return o.remove(r)},s.invoke=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invoke.apply(o,r)},s.invokeAsync=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invokeAsync.apply(o,r)},s.clear=function(){return o.clear()},s}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var tt,E=function A(o){var s={exports:{}};return o(s,s.exports),s.exports}(function(o,s){var a;a=function(r){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(n[c]=i[c])})(e,t)};function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function h(e,t,n,i){var $,c=arguments.length,l=c<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,i);else for(var x=e.length-1;x>=0;x--)($=e[x])&&(l=(c<3?$(l):c>3?$(t,n,l):$(t,n))||l);return c>3&&l&&Object.defineProperty(t,n,l),l}function w(e,t){for(var n=0,i=t.length,c=e.length;n<i;n++,c++)e[c]=t[n];return e}var e,y=255;r.OPERATION=void 0,(e=r.OPERATION||(r.OPERATION={}))[e.ADD=128]="ADD",e[e.REPLACE=0]="REPLACE",e[e.DELETE=64]="DELETE",e[e.DELETE_AND_ADD=192]="DELETE_AND_ADD",e[e.TOUCH=1]="TOUCH",e[e.CLEAR=10]="CLEAR";var g=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(t,n,i){void 0===i&&(i=!0),this.refs.set(t,n),i&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},e.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach(function(n){if(t.refCounts[n]<=0){var i=t.refs.get(n);if(i instanceof q)for(var c in i._definition.schema)"string"!=typeof i._definition.schema[c]&&i[c]&&i[c].$changes&&t.removeRef(i[c].$changes.refId);else{var l=i.$changes.parent._definition;"function"==typeof Object.values(l.schema[l.fieldsByIndex[i.$changes.parentIndex]])[0]&&Array.from(i.values()).forEach(function(x){return t.removeRef(x.$changes.refId)})}t.refs.delete(n),delete t.refCounts[n]}}),this.deletedRefs.clear()},e}(),N=function(){function e(t,n,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(n,i)}return e.prototype.setParent=function(t,n,i){var c=this;if(this.indexes||(this.indexes=this.ref instanceof q?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=i,n)if(this.root=n,this.ref instanceof q){var l=this.ref._definition;for(var $ in l.schema){var x=this.ref[$];x&&x.$changes&&x.$changes.setParent(this.ref,n,l.indexes[$])}}else"object"==typeof this.ref&&this.ref.forEach(function(I,_){I instanceof q&&I.$changes.setParent(c.ref,c.root,c.ref.$changes.indexes[_])})},e.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},e.prototype.change=function(t,n){void 0===n&&(n=r.OPERATION.ADD);var i="number"==typeof t?t:this.indexes[t];this.assertValidIndex(i,t);var c=this.changes.get(i);(!c||c.op===r.OPERATION.DELETE||c.op===r.OPERATION.TOUCH)&&this.changes.set(i,{op:c&&c.op===r.OPERATION.DELETE?r.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},e.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:r.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},e.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},e.prototype.getType=function(t){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[t]];var n=this.parent._definition;return Object.values(n.schema[n.fieldsByIndex[this.parentIndex]])[0]},e.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},e.prototype.getValue=function(t){return this.ref.getByIndex(t)},e.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:r.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+t+" ("+n+")")},e.prototype.discard=function(t,n){var i=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof q||this.changes.forEach(function(c){if(c.op===r.OPERATION.DELETE){var l=i.ref.getIndex(c.index);delete i.indexes[l]}}),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},e.prototype.discardAll=function(){var t=this;this.changes.forEach(function(n){var i=t.getValue(n.index);i&&i.$changes&&i.$changes.discardAll()}),this.discard()},e.prototype.cache=function(t,n){this.caches[t]=n},e.prototype.clone=function(){return new e(this.ref,this.parent,this.root)},e.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},e.prototype.assertValidIndex=function(t,n){if(void 0===t)throw new Error('ChangeTree: missing index for field "'+n+'"')},e}(),z=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function B(e){return e.$proxy=!0,new Proxy(e,{get:function(t,n){return"symbol"==typeof n||isNaN(n)?t[n]:t.at(n)},set:function(t,n,i){if("symbol"==typeof n||isNaN(n))t[n]=i;else{var c=Array.from(t.$items.keys()),l=parseInt(c[n]||n);null==i?t.deleteAt(l):t.setAt(l,i)}return!0},deleteProperty:function(t,n){return"number"==typeof n?t.deleteAt(n):delete t[n],!0}})}var W=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return e.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(e.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),e.prototype.push=function(){for(var t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var c;return n.forEach(function(l){c=t.$refId++,t.setAt(c,l)}),c},e.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var n=this.$items.get(t);return this.$items.delete(t),n}},e.prototype.at=function(t){var n=Array.from(this.$items.keys())[t];return this.$items.get(n)},e.prototype.setAt=function(t,n){var i,c;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var l=null!==(c=null===(i=this.$changes.indexes[t])||void 0===i?void 0:i.op)&&void 0!==c?c:r.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,l)},e.prototype.deleteAt=function(t){var n=Array.from(this.$items.keys())[t];return void 0!==n&&this.$deleteAt(n)},e.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.concat=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(e.bind.apply(e,w([void 0],(t=Array.from(this.$items.values())).concat.apply(t,n))))},e.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},e.prototype.reverse=function(){var t=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(c,l){t.setAt(n[l],c)}),this},e.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var i=this.$items.get(n);return this.$deleteAt(n),i}},e.prototype.slice=function(t,n){return new(e.bind.apply(e,w([void 0],Array.from(this.$items.values()).slice(t,n))))},e.prototype.sort=function(t){var n=this;void 0===t&&(t=z);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach(function(l,$){n.setAt(i[$],l)}),this},e.prototype.splice=function(t,n){void 0===n&&(n=this.length-t);for(var i=[],c=2;c<arguments.length;c++)i[c-2]=arguments[c];for(var l=Array.from(this.$items.keys()),$=[],x=t;x<t+n;x++)$.push(this.$items.get(l[x])),this.$deleteAt(l[x]);return $},e.prototype.unshift=function(){for(var t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var c=this.length,l=n.length,$=Array.from(this.$items.values());return n.forEach(function(x,D){t.setAt(D,x)}),$.forEach(function(x,D){t.setAt(l+D,x)}),c+l},e.prototype.indexOf=function(t,n){return Array.from(this.$items.values()).indexOf(t,n)},e.prototype.lastIndexOf=function(t,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,n)},e.prototype.every=function(t,n){return Array.from(this.$items.values()).every(t,n)},e.prototype.some=function(t,n){return Array.from(this.$items.values()).some(t,n)},e.prototype.forEach=function(t,n){Array.from(this.$items.values()).forEach(t,n)},e.prototype.map=function(t,n){return Array.from(this.$items.values()).map(t,n)},e.prototype.filter=function(t,n){return Array.from(this.$items.values()).filter(t,n)},e.prototype.reduce=function(t,n){return Array.from(this.$items.values()).reduce(t,n)},e.prototype.reduceRight=function(t,n){return Array.from(this.$items.values()).reduceRight(t,n)},e.prototype.find=function(t,n){return Array.from(this.$items.values()).find(t,n)},e.prototype.findIndex=function(t,n){return Array.from(this.$items.values()).findIndex(t,n)},e.prototype.fill=function(t,n,i){throw new Error("ArraySchema#fill() not implemented")},e.prototype.copyWithin=function(t,n,i){throw new Error("ArraySchema#copyWithin() not implemented")},e.prototype.toString=function(){return this.$items.toString()},e.prototype.toLocaleString=function(){return this.$items.toLocaleString()},e.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},e.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},e.prototype.includes=function(t,n){return Array.from(this.$items.values()).includes(t,n)},e.prototype.flatMap=function(t,n){throw new Error("ArraySchema#flatMap() is not supported.")},e.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){return this.toArray().map(function(t){return"function"==typeof t.toJSON?t.toJSON():t})},e.prototype.clone=function(t){return t?new(e.bind.apply(e,w([void 0],Array.from(this.$items.values())))):new(e.bind.apply(e,w([void 0],this.map(function(i){return i.$changes?i.clone():i}))))},e.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},e}();function Nt(e){return e.$proxy=!0,new Proxy(e,{get:function(t,n){return"symbol"!=typeof n&&typeof t[n]>"u"?t.get(n):t[n]},set:function(t,n,i){return"symbol"!=typeof n&&-1===n.indexOf("$")&&"onAdd"!==n&&"onRemove"!==n&&"onChange"!==n?t.set(n,i):t[n]=i,!0},deleteProperty:function(t,n){return t.delete(n),!0}})}var K=function(){function e(t){var n=this;if(this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map)t.forEach(function(c,l){return n.set(l,c)});else for(var i in t)this.set(i,t[i])}return e.is=function(t){return void 0!==t.map},e.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),e.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('"+t+"', "+n+"): trying to set "+n+" value on '"+t+"'.");var i=typeof this.$changes.indexes[t]<"u",c=i?this.$changes.indexes[t]:this.$refId++,l=i?r.OPERATION.REPLACE:r.OPERATION.ADD,$=void 0!==n.$changes;return $&&n.$changes.setParent(this,this.$changes.root,c),i?$&&this.$items.get(t)!==n&&(l=r.OPERATION.ADD):(this.$changes.indexes[t]=c,this.$indexes.set(c,t)),this.$items.set(t,n),this.$changes.change(t,l),this},e.prototype.get=function(t){return this.$items.get(t)},e.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return this.$items.has(t)},e.prototype.forEach=function(t){this.$items.forEach(t)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.keys=function(){return this.$items.keys()},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toJSON=function(){var t={};return this.forEach(function(n,i){t[i]="function"==typeof n.toJSON?n.toJSON():n}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i,c){n.set(c,i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},e}(),we={};function Ot(e,t){we[e]=t}function Ut(e){return we[e]}var ae=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(t,n){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=t,this.indexes[t]=i,this.schema[t]=Array.isArray(n)?{array:n[0]}:n},e.prototype.addFilter=function(t,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=n,this.indexesWithFilters.push(this.indexes[t]),!0},e.prototype.addChildrenFilter=function(t,n){var i=this.indexes[t];if(Ut(Object.keys(this.schema[t])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=n,!0;console.warn("@filterChildren: field '"+t+"' can't have children. Ignoring filter.")},e.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();var Ft=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(t){return this.schemas.has(t)},e.prototype.get=function(t){return this.types[t]},e.prototype.add=function(t,n){void 0===n&&(n=this.schemas.size),t._definition=ae.create(t._definition),t._typeid=n,this.types[n]=t,this.schemas.set(t,n)},e.create=function(t){return void 0===t&&(t=new e),function(n){return et(n,t)}},e}(),Ae=new Ft;function et(e,t){return void 0===t&&(t=Ae),function(n,i){var c=n.constructor;c._context=t,t.has(c)||t.add(c);var l=c._definition;if(l.addField(i,e),l.descriptors[i]){if(l.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+c.name+"'.\nCheck @type() annotation")}catch(O){var $=O.stack.split("\n")[4].trim();throw new Error(O.message+" "+$)}}var x=W.is(e),D=!x&&K.is(e);if("string"!=typeof e&&!q.is(e)){var I=Object.values(e)[0];"string"!=typeof I&&!t.has(I)&&t.add(I)}var _="_"+i;l.descriptors[_]={enumerable:!1,configurable:!1,writable:!0},l.descriptors[i]={get:function(){return this[_]},set:function(O){O!==this[_]&&(null!=O?(x&&!(O instanceof W)&&(O=new(W.bind.apply(W,w([void 0],O)))),D&&!(O instanceof K)&&(O=new K(O)),void 0===O.$proxy&&(D?O=Nt(O):x&&(O=B(O))),this.$changes.change(i),O.$changes&&O.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[_]=O)},enumerable:!0,configurable:!0}}}function Oe(e,t,n){for(var i=0,c=0,l=n.length;c<l;c++)(i=n.charCodeAt(c))<128?e[t++]=i:i<2048?(e[t++]=192|i>>6,e[t++]=128|63&i):i<55296||i>=57344?(e[t++]=224|i>>12,e[t++]=128|i>>6&63,e[t++]=128|63&i):(c++,i=65536+((1023&i)<<10|1023&n.charCodeAt(c)),e[t++]=240|i>>18,e[t++]=128|i>>12&63,e[t++]=128|i>>6&63,e[t++]=128|63&i)}function $e(e,t){e.push(255&t)}function Y(e,t){e.push(255&t)}function Ce(e,t){e.push(255&t),e.push(t>>8&255)}function fe(e,t){e.push(255&t),e.push(t>>8&255)}function $t(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function ht(e,t){var n=t>>24,i=t>>16,c=t>>8;e.push(255&t),e.push(255&c),e.push(255&i),e.push(255&n)}function Ee(e,t){var n=Math.floor(t/Math.pow(2,32));ht(e,t>>>0),ht(e,n)}function be(e,t){var n=t/Math.pow(2,32)>>0;ht(e,t>>>0),ht(e,n)}var Ct=new Int32Array(2),Ve=new Float32Array(Ct.buffer),tn=new Float64Array(Ct.buffer);function Ie(e,t){Ve[0]=t,$t(e,Ct[0])}function ce(e,t){tn[0]=t,$t(e,Ct[0]),$t(e,Ct[1])}function zt(e,t){t||(t="");var n=function We(e){for(var t=0,n=0,i=0,c=e.length;i<c;i++)(t=e.charCodeAt(i))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217),Y(e,n),i=2;else if(n<65536)e.push(218),fe(e,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),ht(e,n),i=5}return Oe(e,e.length,t),i+n}function Q(e,t){return isNaN(t)?Q(e,0):isFinite(t)?t!==(0|t)?(e.push(203),ce(e,t),9):t>=0?t<128?(Y(e,t),1):t<256?(e.push(204),Y(e,t),2):t<65536?(e.push(205),fe(e,t),3):t<4294967296?(e.push(206),ht(e,t),5):(e.push(207),be(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),$e(e,t),2):t>=-32768?(e.push(209),Ce(e,t),3):t>=-2147483648?(e.push(210),$t(e,t),5):(e.push(211),Ee(e,t),9):Q(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var ue=Object.freeze({__proto__:null,utf8Write:Oe,int8:$e,uint8:Y,int16:Ce,uint16:fe,int32:$t,uint32:ht,int64:Ee,uint64:be,float32:function Qe(e,t){Ie(e,t)},float64:function Xe(e,t){ce(e,t)},writeFloat32:Ie,writeFloat64:ce,boolean:function en(e,t){return Y(e,t?1:0)},string:zt,number:Q});function Me(e,t){return Et(e,t)<<24>>24}function Et(e,t){return e[t.offset++]}function Te(e,t){return Lt(e,t)<<16>>16}function Lt(e,t){return e[t.offset++]|e[t.offset++]<<8}function dt(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function yt(e,t){return dt(e,t)>>>0}function Re(e,t){var n=yt(e,t);return dt(e,t)*Math.pow(2,32)+n}function Se(e,t){var n=yt(e,t);return yt(e,t)*Math.pow(2,32)+n}var bt=new Int32Array(2),sn=new Float32Array(bt.buffer),an=new Float64Array(bt.buffer);function he(e,t){return bt[0]=dt(e,t),sn[0]}function de(e,t){return bt[0]=dt(e,t),bt[1]=dt(e,t),an[0]}function De(e,t){var i,n=e[t.offset++];n<192?i=31&n:217===n?i=Et(e,t):218===n?i=Lt(e,t):219===n&&(i=yt(e,t));var c=function nn(e,t,n){for(var i="",c=0,l=t,$=t+n;l<$;l++){var x=e[l];0!=(128&x)?192!=(224&x)?224!=(240&x)?240!=(248&x)?console.error("Invalid byte "+x.toString(16)):(c=(7&x)<<18|(63&e[++l])<<12|(63&e[++l])<<6|(63&e[++l])<<0)>=65536?(c-=65536,i+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):i+=String.fromCharCode(c):i+=String.fromCharCode((15&x)<<12|(63&e[++l])<<6|(63&e[++l])<<0):i+=String.fromCharCode((31&x)<<6|63&e[++l]):i+=String.fromCharCode(x)}return i}(e,t.offset,i);return t.offset+=i,c}function lt(e,t){var n=e[t.offset++];return n<128?n:202===n?he(e,t):203===n?de(e,t):204===n?Et(e,t):205===n?Lt(e,t):206===n?yt(e,t):207===n?Se(e,t):208===n?Me(e,t):209===n?Te(e,t):210===n?dt(e,t):211===n?Re(e,t):n>223?-1*(255-n+1):void 0}function Pe(e,t){return e[t.offset-1]===y&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var ke=Object.freeze({__proto__:null,int8:Me,uint8:Et,int16:Te,uint16:Lt,int32:dt,uint32:yt,float32:function rn(e,t){return he(e,t)},float64:function on(e,t){return de(e,t)},int64:Re,uint64:Se,readFloat32:he,readFloat64:de,boolean:function fn(e,t){return Et(e,t)>0},string:De,stringCheck:function cn(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},number:lt,numberCheck:function un(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},arrayCheck:function hn(e,t){return e[t.offset]<160},switchStructureCheck:Pe}),le=function(){function e(t){var n=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(i){return n.add(i)})}return e.is=function(t){return void 0!==t.collection},e.prototype.add=function(t){var n=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,t),this.$changes.change(n),n},e.prototype.at=function(t){var n=Array.from(this.$items.keys())[t];return this.$items.get(n)},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var i,c,n=this.$items.entries();(c=n.next())&&!c.done;)if(t===c.value[1]){i=c.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){return Array.from(this.$items.values()).some(function(n){return n===t})},e.prototype.forEach=function(t){var n=this;this.$items.forEach(function(i,c,l){return t(i,c,n)})},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach(function(n,i){t.push("function"==typeof n.toJSON?n.toJSON():n)}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},e}(),pe=function(){function e(t){var n=this;this.$changes=new N(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach(function(i){return n.add(i)})}return e.is=function(t){return void 0!==t.set},e.prototype.add=function(t){var n,i;if(this.has(t))return!1;var c=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,c);var l=null!==(i=null===(n=this.$changes.indexes[c])||void 0===n?void 0:n.op)&&void 0!==i?i:r.OPERATION.ADD;return this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,t),this.$changes.change(c,l),c},e.prototype.entries=function(){return this.$items.entries()},e.prototype.delete=function(t){for(var i,c,n=this.$items.entries();(c=n.next())&&!c.done;)if(t===c.value[1]){i=c.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},e.prototype.clear=function(t){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},e.prototype.has=function(t){for(var c,n=this.$items.values(),i=!1;(c=n.next())&&!c.done;)if(t===c.value){i=!0;break}return i},e.prototype.forEach=function(t){var n=this;this.$items.forEach(function(i,c,l){return t(i,c,n)})},e.prototype.values=function(){return this.$items.values()},Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),e.prototype.setIndex=function(t,n){this.$indexes.set(t,n)},e.prototype.getIndex=function(t){return this.$indexes.get(t)},e.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},e.prototype.deleteByIndex=function(t){var n=this.$indexes.get(t);this.$items.delete(n),this.$indexes.delete(t)},e.prototype.toArray=function(){return Array.from(this.$items.values())},e.prototype.toJSON=function(){var t=[];return this.forEach(function(n,i){t.push("function"==typeof n.toJSON?n.toJSON():n)}),t},e.prototype.clone=function(t){var n;return t?n=Object.assign(new e,this):(n=new e,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},e.prototype.triggerAll=function(){q.prototype.triggerAll.apply(this)},e}(),dn=function(){function e(){this.handlers=[]}return e.prototype.register=function(t,n){return this.handlers.push(t),this},e.prototype.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach(function(i){return i.apply(void 0,t)})},e.prototype.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map(function(i){return i.apply(void 0,t)}))},e.prototype.remove=function(t){var n=this.handlers.indexOf(t);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}(),ln=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t}(Error);function Ne(e,t,n,i){if(!(e instanceof t))throw new ge("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function gn(e,t,n,i,c){!function pn(e,t,n,i){var c,l=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(e)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+i);break;case"string":c="string",l=!0;break;case"boolean":return}if(typeof e!==c&&(!l||l&&null!==e)){var $="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new ge("a '"+c+"' was expected, but "+$+" was provided in "+n.constructor.name+"#"+i)}}(n,e,i,c);var l=ue[e];if(!l)throw new ge("a '"+e+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+c);l(t,n)}function mn(e,t,n){return ke[e](t,n)}var q=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new N(this,void 0,new g),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),t[0]&&this.assign(t[0])}return e.onError=function(t){console.error(t)},e.is=function(t){return t._definition&&void 0!==t._definition.schema},e.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(e.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),e.prototype.listen=function(t,n){var i=this;return this.$listeners[t]||(this.$listeners[t]=new dn),this.$listeners[t].register(n),function(){return i.$listeners[t].remove(n)}},e.prototype.decode=function(t,n,i,c){void 0===n&&(n={offset:0}),void 0===i&&(i=this),void 0===c&&(c=new Map);var l=this.$changes.root,$=t.length,x=0,D=[];for(l.refs.set(x,this),c.set(x,D);n.offset<$;){var I=t[n.offset++];if(I!=y){var O=i.$changes,F=void 0!==i._definition,S=F?I>>6<<6:I;if(S!==r.OPERATION.CLEAR){var b=F?I%(S||255):lt(t,n),R=F?i._definition.fieldsByIndex[b]:"",U=O.getType(b),C=void 0,P=void 0,G=void 0;if(F?P=i["_"+R]:(P=i.getByIndex(b),(S&r.OPERATION.ADD)===r.OPERATION.ADD?(G=i instanceof K?De(t,n):b,i.setIndex(b,G)):G=i.getIndex(b)),(S&r.OPERATION.DELETE)===r.OPERATION.DELETE&&(S!==r.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(b),P&&P.$changes&&l.removeRef(P.$changes.refId),C=null),void 0!==R){if(S!==r.OPERATION.DELETE)if(e.is(U)){var J=lt(t,n);if(C=l.refs.get(J),S!==r.OPERATION.REPLACE){var nt=this.getSchemaType(t,n,U);C||((C=this.createTypeInstance(nt)).$changes.refId=J,P&&(C.onChange=P.onChange,C.onRemove=P.onRemove,C.$listeners=P.$listeners,P.$changes.refId&&J!==P.$changes.refId&&l.removeRef(P.$changes.refId))),l.addRef(J,C,C!==P)}}else if("string"==typeof U)C=mn(U,t,n);else{var It=Ut(Object.keys(U)[0]),X=lt(t,n),H=l.refs.has(X)?P||l.refs.get(X):new It.constructor;if((C=H.clone(!0)).$changes.refId=X,P&&(C.onAdd=P.onAdd,C.onRemove=P.onRemove,C.onChange=P.onChange,P.$changes.refId&&X!==P.$changes.refId)){l.removeRef(P.$changes.refId);for(var Z=[],ye=P.entries(),it=void 0;(it=ye.next())&&!it.done;){var jt=it.value;Z.push({op:r.OPERATION.DELETE,field:jt[0],value:void 0,previousValue:jt[1]})}c.set(P.$changes.refId,Z)}l.addRef(X,C,H!==P),It.getProxy&&(C=It.getProxy(C))}var xn=P!==C;if(null!=C)if(C.$changes&&C.$changes.setParent(O.ref,O.root,b),i instanceof e)i[R]=C;else if(i instanceof K)i.$items.set(G,C);else if(i instanceof W)i.setAt(b,C);else if(i instanceof le){var Bt=i.add(C);i.setIndex(b,Bt)}else i instanceof pe&&!1!==(Bt=i.add(C))&&i.setIndex(b,Bt);xn&&D.push({op:S,field:R,dynamicIndex:G,value:C,previousValue:P})}else{console.warn("@colyseus/schema: definition mismatch");for(var M={offset:n.offset};n.offset<$&&(!Pe(t,n)||(M.offset=n.offset+1,!l.refs.has(lt(t,M))));)n.offset++}}else i.clear(!0)}else{x=lt(t,n);var _=l.refs.get(x);if(!_)throw new Error('"refId" not found: '+x);i=_,c.set(x,D=[])}}return this._triggerChanges(c),l.garbageCollectDeletedRefs(),c},e.prototype.encode=function(t,n,i){void 0===t&&(t=!1),void 0===n&&(n=[]),void 0===i&&(i=!1);for(var c=this.$changes,l=new WeakSet,$=[c],x=1,D=0;D<x;D++){var I=$[D],_=I.ref,O=_ instanceof e;I.ensureRefId(),l.add(I),I!==c&&(I.changed||t)&&(Y(n,y),Q(n,I.refId));for(var F=Array.from(t?I.allChanges:I.changes.values()),S=0,b=F.length;S<b;S++){var R=t?{op:r.OPERATION.ADD,index:F[S]}:F[S],U=R.index,C=O?_._definition.fieldsByIndex&&_._definition.fieldsByIndex[U]:U,P=n.length;if(R.op!==r.OPERATION.TOUCH)if(O)Y(n,U|R.op);else{if(Y(n,R.op),R.op===r.OPERATION.CLEAR)continue;Q(n,U)}if(!O&&(R.op&r.OPERATION.ADD)==r.OPERATION.ADD&&_ instanceof K&&zt(n,I.ref.$indexes.get(U)),R.op!==r.OPERATION.DELETE){var M=I.getType(U),J=I.getValue(U);if(J&&J.$changes&&!l.has(J.$changes)&&($.push(J.$changes),J.$changes.ensureRefId(),x++),R.op!==r.OPERATION.TOUCH){if(e.is(M))Ne(J,M,_,C),Q(n,J.$changes.refId),(R.op&r.OPERATION.ADD)===r.OPERATION.ADD&&this.tryEncodeTypeId(n,M,J.constructor);else if("string"==typeof M)gn(M,n,J,_,C);else{var nt=Ut(Object.keys(M)[0]);Ne(_["_"+C],nt.constructor,_,C),Q(n,J.$changes.refId)}i&&I.cache(U,n.slice(P))}}}!t&&!i&&I.discard()}return n},e.prototype.encodeAll=function(t){return this.encode(!0,[],t)},e.prototype.applyFilters=function(t,n){var i,c;void 0===n&&(n=!1);for(var l=this,$=new Set,x=ln.get(t),D=[this.$changes],I=1,_=[],O=function(S){var b=D[S];if($.has(b.refId))return"continue";var R=b.ref,U=R instanceof e;Y(_,y),Q(_,b.refId);var C=x.refIds.has(b),P=n||!C;x.addRefId(b);var G=x.containerIndexes.get(b),M=Array.from(P?b.allChanges:b.changes.values());!n&&U&&R._definition.indexesWithFilters&&R._definition.indexesWithFilters.forEach(function(xt){!G.has(xt)&&b.allChanges.has(xt)&&M.push(P?xt:{op:r.OPERATION.ADD,index:xt})});for(var nt=0,It=M.length;nt<It;nt++){var X=P?{op:r.OPERATION.ADD,index:M[nt]}:M[nt];if(X.op!==r.OPERATION.CLEAR){var H=X.index;if(X.op!==r.OPERATION.DELETE){var Z=b.getValue(H),ye=b.getType(H);if(U){if((it=R._definition.filters&&R._definition.filters[H])&&!it.call(R,t,Z,l)){Z&&Z.$changes&&$.add(Z.$changes.refId);continue}}else{var it,jt=b.parent;if((it=b.getChildrenFilter())&&!it.call(jt,t,R.$indexes.get(H),Z,l)){Z&&Z.$changes&&$.add(Z.$changes.refId);continue}}if(Z.$changes&&(D.push(Z.$changes),I++),X.op!==r.OPERATION.TOUCH)if(X.op===r.OPERATION.ADD||U)_.push.apply(_,null!==(i=b.caches[H])&&void 0!==i?i:[]),G.add(H);else if(G.has(H))_.push.apply(_,null!==(c=b.caches[H])&&void 0!==c?c:[]);else{if(G.add(H),Y(_,r.OPERATION.ADD),Q(_,H),R instanceof K){var gt=b.ref.$indexes.get(H);zt(_,gt)}Z.$changes?Q(_,Z.$changes.refId):ue[ye](_,Z)}else Z.$changes&&!U&&(Y(_,r.OPERATION.ADD),Q(_,H),R instanceof K&&(gt=b.ref.$indexes.get(H),zt(_,gt)),Q(_,Z.$changes.refId))}else U?Y(_,X.op|H):(Y(_,X.op),Q(_,H))}else Y(_,X.op)}},F=0;F<I;F++)O(F);return _},e.prototype.clone=function(){var t=new this.constructor,n=this._definition.schema;for(var i in n)t[i]="object"==typeof this[i]&&"function"==typeof this[i].clone?this[i].clone():this[i];return t},e.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var t=new Map;e.prototype._triggerAllFillChanges.call(this,this,t);try{e.prototype._triggerChanges.call(this,t)}catch(n){e.onError(n)}}},e.prototype.toJSON=function(){var t=this._definition.schema,n=this._definition.deprecated,i={};for(var c in t)!n[c]&&null!==this[c]&&typeof this[c]<"u"&&(i[c]="function"==typeof this[c].toJSON?this[c].toJSON():this["_"+c]);return i},e.prototype.discardAllChanges=function(){this.$changes.discardAll()},e.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},e.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},e.prototype.tryEncodeTypeId=function(t,n,i){n._typeid!==i._typeid&&(Y(t,213),Q(t,i._typeid))},e.prototype.getSchemaType=function(t,n,i){var c;return 213===t[n.offset]&&(n.offset++,c=this.constructor._context.get(lt(t,n))),c||i},e.prototype.createTypeInstance=function(t){var n=new t;return n.$changes.root=this.$changes.root,n},e.prototype._triggerAllFillChanges=function(t,n){if(!n.has(t.$changes.refId)){var i=[];if(n.set(t.$changes.refId||0,i),t instanceof e){var c=t._definition.schema;for(var l in c)void 0!==(x=t["_"+l])&&(i.push({op:r.OPERATION.ADD,field:l,value:x,previousValue:void 0}),void 0!==x.$changes&&e.prototype._triggerAllFillChanges.call(this,x,n))}else for(var D=t.entries(),I=void 0;(I=D.next())&&!I.done;){var x,_=I.value,O=_[0];i.push({op:r.OPERATION.ADD,field:O,dynamicIndex:O,value:x=_[1],previousValue:void 0}),void 0!==x.$changes&&e.prototype._triggerAllFillChanges.call(this,x,n)}}},e.prototype._triggerChanges=function(t){var n=this;t.forEach(function(i,c){var l,$,x,D,I,_,O,F,S,b,R,U;if(i.length>0){for(var C=n.$changes.root.refs.get(c),P=C instanceof e,G=0;G<i.length;G++){var M=i[G],J=C.$listeners&&C.$listeners[M.field];if(P||(M.op===r.OPERATION.ADD&&void 0===M.previousValue?null===($=(l=C).onAdd)||void 0===$||$.call(l,M.value,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field):M.op===r.OPERATION.DELETE?void 0!==M.previousValue&&(null===(I=(D=C).onRemove)||void 0===I||I.call(D,M.previousValue,null!==(_=M.dynamicIndex)&&void 0!==_?_:M.field)):M.op===r.OPERATION.DELETE_AND_ADD?(void 0!==M.previousValue&&(null===(F=(O=C).onRemove)||void 0===F||F.call(O,M.previousValue,M.dynamicIndex)),null===(b=(S=C).onAdd)||void 0===b||b.call(S,M.value,M.dynamicIndex)):(M.op===r.OPERATION.REPLACE||M.value!==M.previousValue)&&(null===(U=(R=C).onChange)||void 0===U||U.call(R,M.value,M.dynamicIndex))),(M.op&r.OPERATION.DELETE)===r.OPERATION.DELETE&&M.previousValue instanceof e&&M.previousValue.onRemove&&M.previousValue.onRemove(),J)try{J.invoke(M.value,M.previousValue)}catch(nt){e.onError(nt)}}if(P&&C.onChange)try{C.onChange(i)}catch(nt){e.onError(nt)}}})},e._definition=ae.create(),e}();var pt=new Ft,me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),h([et("string",pt)],t.prototype,"name",void 0),h([et("string",pt)],t.prototype,"type",void 0),h([et("number",pt)],t.prototype,"referencedType",void 0),t}(q),ve=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.fields=new W,n}return u(t,e),h([et("number",pt)],t.prototype,"id",void 0),h([et([me],pt)],t.prototype,"fields",void 0),t}(q),yn=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.types=new W,n}return u(t,e),t.encode=function(n){var i=n.constructor,c=new t;c.rootType=i._typeid;var l=function(I,_){for(var O in _){var F=new me;F.name=O;var S=void 0;if("string"==typeof _[O])S=_[O];else{var b=_[O],R=void 0;q.is(b)?(S="ref",R=_[O]):"string"==typeof b[S=Object.keys(b)[0]]?S+=":"+b[S]:R=b[S],F.referencedType=R?R._typeid:-1}F.type=S,I.fields.push(F)}c.types.push(I)},$=i._context.types;for(var x in $){var D=new ve;D.id=Number(x),l(D,$[x]._definition.schema)}return c.encodeAll()},t.decode=function(n,i){var c=new Ft,l=new t;l.decode(n,i);var $=l.types.reduce(function(O,F){var S=function(R){function U(){return null!==R&&R.apply(this,arguments)||this}return u(U,R),U}(q),b=F.id;return O[b]=S,c.add(S,b),O},{});l.types.forEach(function(O){var F=$[O.id];O.fields.forEach(function(S){var b;if(void 0!==S.referencedType){var R=S.type,U=$[S.referencedType];if(!U){var C=S.type.split(":");R=C[0],U=C[1]}"ref"===R?et(U,c)(F.prototype,S.name):et(((b={})[R]=U,b),c)(F.prototype,S.name)}else et(S.type,c)(F.prototype,S.name)})});var x=$[l.rootType],D=new x;for(var I in x._definition.schema){var _=x._definition.schema[I];"string"!=typeof _&&(D[I]="function"==typeof _?new _:new(Ut(Object.keys(_)[0]).constructor))}return D},h([et([ve],pt)],t.prototype,"types",void 0),h([et("number",pt)],t.prototype,"rootType",void 0),t}(q);Ot("map",{constructor:K,getProxy:Nt}),Ot("array",{constructor:W,getProxy:B}),Ot("set",{constructor:pe}),Ot("collection",{constructor:le}),r.ArraySchema=W,r.CollectionSchema=le,r.Context=Ft,r.MapSchema=K,r.Reflection=yn,r.ReflectionField=me,r.ReflectionType=ve,r.Schema=q,r.SchemaDefinition=ae,r.SetSchema=pe,r.decode=ke,r.defineTypes=function Ye(e,t,n){for(var i in void 0===n&&(n=e._context||Ae),t)et(t[i],n)(e.prototype,i);return e},r.deprecated=function Ke(e,t){return void 0===e&&(e=!0),function(n,i){var l=n.constructor._definition;l.deprecated[i]=!0,e&&(l.descriptors[i]={get:function(){throw new Error(i+" is deprecated.")},set:function($){},enumerable:!1,configurable:!0})}},r.dumpChanges=function vn(e){for(var t=[e.$changes],i={},c=i,l=function(x){var D=t[x];D.changes.forEach(function(I){var _=D.ref,O=I.index,F=_._definition?_._definition.fieldsByIndex[O]:_.$indexes.get(O);c[F]=D.getValue(O)})},$=0;$<1;$++)l($);return i},r.encode=ue,r.filter=function qe(e){return function(t,n){var i=t.constructor;i._definition.addFilter(n,e)&&(i._context.useFilters=!0)}},r.filterChildren=function Ge(e){return function(t,n){var i=t.constructor;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=!0)}},r.hasFilter=function Ze(e){return e._context&&e._context.useFilters},r.registerType=Ot,r.type=et,Object.defineProperty(r,"__esModule",{value:!0})},a(s)}),k=function(){function o(s,r){var a=this;this.onStateChange=v(),this.onError=v(),this.onLeave=v(),this.onJoin=v(),this.hasJoined=!1,this.onMessageHandlers=ie(),this.id=null,this.name=s,r&&(this.serializer=new(ee("schema")),this.rootSchema=r,this.serializer.state=new r),this.onError(function(u,h){return console.warn("colyseus.js - onError => ("+u+") "+h)}),this.onLeave(function(){return a.removeAllListeners()})}return o.prototype.connect=function(s){var r=this;this.connection=new te,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(a){if(!r.hasJoined)return console.warn("Room connection was closed unexpectedly ("+a.code+"): "+a.reason),void r.onError.invoke(a.code,a.reason);r.onLeave.invoke(a.code),r.destroy()},this.connection.events.onerror=function(a){console.warn("Room, onError ("+a.code+"): "+a.reason),r.onError.invoke(a.code,a.reason)},this.connection.connect(s)},o.prototype.leave=function(s){var r=this;return void 0===s&&(s=!0),new Promise(function(a){r.onLeave(function(u){return a(u)}),r.connection?s?r.connection.send([T.Protocol.LEAVE_ROOM]):r.connection.close():r.onLeave.invoke(4e3)})},o.prototype.onMessage=function(s,r){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),r)},o.prototype.send=function(s,r){var u,a=[T.Protocol.ROOM_DATA];if("string"==typeof s?E.encode.string(a,s):E.encode.number(a,s),void 0!==r){var h=Wt(r);(u=new Uint8Array(a.length+h.byteLength)).set(new Uint8Array(a),0),u.set(new Uint8Array(h),a.length)}else u=new Uint8Array(a);this.connection.send(u.buffer)},Object.defineProperty(o.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),o.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},o.prototype.onMessageCallback=function(s){var r=Array.from(new Uint8Array(s.data)),a=r[0];if(a===T.Protocol.JOIN_ROOM){var u=1;if(this.serializerId=function ne(o,s){for(var r=o[s++],a="",u=0,h=s,w=s+r;h<w;h++){var y=o[h];if(0!=(128&y))if(192!=(224&y))if(224!=(240&y)){if(240!=(248&y))throw new Error("Invalid byte "+y.toString(16));(u=(7&y)<<18|(63&o[++h])<<12|(63&o[++h])<<6|(63&o[++h])<<0)>=65536?(u-=65536,a+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):a+=String.fromCharCode(u)}else a+=String.fromCharCode((15&y)<<12|(63&o[++h])<<6|(63&o[++h])<<0);else a+=String.fromCharCode((31&y)<<6|63&o[++h]);else a+=String.fromCharCode(y)}return a}(r,u),u+=function re(o){void 0===o&&(o="");for(var s=0,r=0,a=0,u=o.length;a<u;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r+1}(this.serializerId),!this.serializer){var h=ee(this.serializerId);this.serializer=new h}r.length>u&&this.serializer.handshake&&this.serializer.handshake(r,{offset:u}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([T.Protocol.JOIN_ROOM])}else if(a===T.Protocol.ERROR){var w={offset:1},y=E.decode.number(r,w),m=E.decode.string(r,w);this.onError.invoke(y,m)}else if(a===T.Protocol.LEAVE_ROOM)this.leave();else if(a===T.Protocol.ROOM_DATA_SCHEMA){var g={offset:1};(m=new(z=this.serializer.getState().constructor._context.get(E.decode.number(r,g)))).decode(r,g),this.dispatchMessage(z,m)}else if(a===T.Protocol.ROOM_STATE)r.shift(),this.setState(r);else if(a===T.Protocol.ROOM_STATE_PATCH)r.shift(),this.patch(r);else if(a===T.Protocol.ROOM_DATA){var B={offset:1},z=E.decode.stringCheck(r,B)?E.decode.string(r,B):E.decode.number(r,B);m=r.length>B.offset?function Dt(o,s){void 0===s&&(s=0);var r=new ft(o,s),a=r._parse();if(r._offset!==o.byteLength)throw new Error(o.byteLength-r._offset+" trailing bytes");return a}(s.data,B.offset):void 0,this.dispatchMessage(z,m)}},o.prototype.setState=function(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.patch=function(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.dispatchMessage=function(s,r){var a=this.getMessageHandlerKey(s);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,r):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,r):console.warn("colyseus.js: onMessage() not registered for type '"+s+"'.")},o.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},o.prototype.getMessageHandlerKey=function(s){switch(typeof s){case"function":return"$"+s._typeid;case"string":return s;case"number":return"i"+s;default:throw new Error("invalid message type.")}},o}();function vt(){return tt||(tt=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(o,s){this.cache[o]=s},getItem:function(o){},removeItem:function(o){delete this.cache[o]}}),tt}var oe="colyseus-auth-token";T.Platform=void 0,function(o){o.ios="ios",o.android="android"}(T.Platform||(T.Platform={}));var se,xe=function(){function o(s){var r=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=s.replace("ws","http"),function Le(o,s){var r=vt().getItem(o);typeof Promise>"u"||!(r instanceof Promise)?s(r):r.then(function(a){return s(a)})}(oe,function(a){return r.token=a})}return Object.defineProperty(o.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),o.prototype.login=function(s){return void 0===s&&(s={}),L(this,void 0,void 0,function(){var r,a,u;return j(this,function(h){switch(h.label){case 0:return r=Object.assign({},s),this.hasToken&&(r.token=this.token),[4,this.request("post","/auth",r)];case 1:for(u in a=h.sent(),this.token=a.token,function Fe(o,s){vt().setItem(o,s)}(oe,this.token),a)this.hasOwnProperty(u)&&(this[u]=a[u]);return this.registerPingService(),[2,this]}})})},o.prototype.save=function(){return L(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return s.sent(),[2,this]}})})},o.prototype.getFriends=function(){return L(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,s.sent()]}})})},o.prototype.getOnlineFriends=function(){return L(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,s.sent()]}})})},o.prototype.getFriendRequests=function(){return L(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,s.sent()]}})})},o.prototype.sendFriendRequest=function(s){return L(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.acceptFriendRequest=function(s){return L(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.declineFriendRequest=function(s){return L(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("del","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.blockUser=function(s){return L(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.unblockUser=function(s){return L(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.request=function(s,r,a,u,h){return void 0===a&&(a={}),void 0===h&&(h={}),L(this,void 0,void 0,function(){var w,y,m,g;return j(this,function(N){switch(N.label){case 0:for(y in h.Accept="application/json",this.hasToken&&(h.Authorization="Bearer "+this.token),w=[],a)w.push(y+"="+a[y]);return m=w.length>0?"?"+w.join("&"):"",g={headers:h},u&&(g.body=u),[4,Zt[s](""+this.endpoint+r+m,g)];case 1:return[2,N.sent().data]}})})},o.prototype.logout=function(){this.token=void 0,function ze(o){vt().removeItem(o)}(oe),this.unregisterPingService()},o.prototype.registerPingService=function(s){var r=this;void 0===s&&(s=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return r.request("get","/auth")},s)},o.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},o}(),je=function(o){function s(r,a){var u=o.call(this,r)||this;return u.code=a,Object.setPrototypeOf(u,s.prototype),u}return rt(s,o),s}(Error),Be=typeof window<"u"&&typeof(null===(se=window?.location)||void 0===se?void 0:se.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",Je=function(){function o(s){void 0===s&&(s=Be),this.endpoint=s}return Object.defineProperty(o.prototype,"auth",{get:function(){return this._auth||(this._auth=new xe(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),o.prototype.joinOrCreate=function(s,r,a){return void 0===r&&(r={}),L(this,void 0,void 0,function(){return j(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",s,r,a)];case 1:return[2,u.sent()]}})})},o.prototype.create=function(s,r,a){return void 0===r&&(r={}),L(this,void 0,void 0,function(){return j(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("create",s,r,a)];case 1:return[2,u.sent()]}})})},o.prototype.join=function(s,r,a){return void 0===r&&(r={}),L(this,void 0,void 0,function(){return j(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("join",s,r,a)];case 1:return[2,u.sent()]}})})},o.prototype.joinById=function(s,r,a){return void 0===r&&(r={}),L(this,void 0,void 0,function(){return j(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,r,a)];case 1:return[2,u.sent()]}})})},o.prototype.reconnect=function(s,r,a){return L(this,void 0,void 0,function(){return j(this,function(u){switch(u.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,{sessionId:r},a)];case 1:return[2,u.sent()]}})})},o.prototype.getAvailableRooms=function(s){return void 0===s&&(s=""),L(this,void 0,void 0,function(){var r;return j(this,function(a){switch(a.label){case 0:return r=this.endpoint.replace("ws","http")+"/matchmake/"+s,[4,ot(r,{headers:{Accept:"application/json"}})];case 1:return[2,a.sent().data]}})})},o.prototype.consumeSeatReservation=function(s,r){return L(this,void 0,void 0,function(){var a;return j(this,function(u){return(a=this.createRoom(s.room.name,r)).id=s.room.roomId,a.sessionId=s.sessionId,a.connect(this.buildEndpoint(s.room,{sessionId:a.sessionId})),[2,new Promise(function(h,w){var y=function(m,g){return w(new qt(m,g))};a.onError.once(y),a.onJoin.once(function(){a.onError.remove(y),h(a)})})]})})},o.prototype.createMatchMakeRequest=function(s,r,a,u){return void 0===a&&(a={}),L(this,void 0,void 0,function(){var h,w;return j(this,function(y){switch(y.label){case 0:return h=this.endpoint.replace("ws","http")+"/matchmake/"+s+"/"+r,this._auth&&this._auth.hasToken&&(a.token=this._auth.token),[4,at(h,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})];case 1:if((w=y.sent().data).error)throw new je(w.error,w.code);return[2,this.consumeSeatReservation(w,u)]}})})},o.prototype.createRoom=function(s,r){return new k(s,r)},o.prototype.buildEndpoint=function(s,r){void 0===r&&(r={});var a=[];for(var u in r)!r.hasOwnProperty(u)||a.push(u+"="+r[u]);return this.endpoint+"/"+s.processId+"/"+s.roomId+"?"+a.join("&")},o}(),_e=function(){function o(){}return o.prototype.setState=function(s){this.state.decode(s)},o.prototype.getState=function(){return this.state},o.prototype.patch=function(s){this.state.decode(s)},o.prototype.teardown=function(){var s,r;null===(r=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===r||r.root.clearRefs()},o.prototype.handshake=function(s,r){this.state?(new E.Reflection).decode(s,r):this.state=E.Reflection.decode(s,r)},o}(),He=function(){function o(){}return o.prototype.setState=function(s){},o.prototype.getState=function(){return null},o.prototype.patch=function(s){},o.prototype.teardown=function(){},o.prototype.handshake=function(s){},o}();kt("schema",_e),kt("none",He),T.Auth=xe,T.Client=Je,T.Room=k,T.SchemaSerializer=_e,T.registerSerializer=kt,Object.defineProperty(T,"__esModule",{value:!0})}(Mt)}}]);