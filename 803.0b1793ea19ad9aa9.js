(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[803],{9803:(Ut,Oe,I)=>{"use strict";I.r(Oe),I.d(Oe,{MinesweeperModule:()=>rt});var se=I(8198),ie=I(6895),z=I(9119),j=I(5755),Ee=I(9386),X=I(2076),h=I(4650);const Be=["easy","medium","hard"];let He=(()=>{class y extends class je{constructor(_){this.roomGame=_,this.client=new j.Client(`ws://${Ee.N.backend_url}`)}joinOrCreate(){return(0,X.D)(this.client.joinOrCreate(this.roomGame))}}{constructor(){super("MinesweeperRoom"),this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return y.\u0275fac=function(g){return new(g||y)},y.\u0275prov=h.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();class Je extends Set{add(_){super.add(_.toString())}has(_){return super.has(_.toString())}}class Ce{constructor({include:_=!0,onlyInteger:g=!0}){this.includeLimits=_,this.onlyInteger=g}returnOutputNumber(_){return this.onlyInteger?Math.round(_):_}between(_,g){let N;return N=this.includeLimits?Math.floor(Math.random()*(g-_+1)+_):Math.floor(Math.random()*(g-_)+_),this.returnOutputNumber(N)}}class me{constructor(_,g){this.row=_,this.column=g,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged=!1}}class Me extends Array{constructor(_,g,N){super(),this.status="playing",this.player=g;for(let F=0;F<_;F++){this[F]=[];for(let R=0;R<_;R++)this[F].push(new me(F,R))}this.generateBombs(N)}generateBombs(_){const g=new Ce({onlyInteger:!0}),N=new Je;for(;N.size<_.bombs;){const F=g.between(0,_.size-1),R=g.between(0,_.size-1);N.has([F,R])||(N.add([F,R]),this[F][R].bomb=!0,this.getCellsArround(this[F][R]).forEach(ne=>{ne.nearBombs++}))}}getCellsArround(_){const g=[],N=_.row,F=_.column,R=(ne,pe)=>(this[ne]&&this[ne][pe]&&g.push(this[ne][pe]),g);return R(N+1,F+1),R(N+1,F-1),R(N+1,F+0),R(N-1,F+1),R(N-1,F-1),R(N-1,F+0),R(N+0,F+1),R(N+0,F-1),g}reveal(_){if(_.bomb)return this.status="game over",void this.revealAllCells();_.revealed=!0,0===_.nearBombs&&this.getCellsArround(_).filter(g=>0==g.revealed).forEach(g=>this.reveal(g))}revealAllCells(){this.forEach(_=>_.forEach(g=>g.revealed=!0))}}var le=I(433),Ie=I(5593),be=I(4247),Te=I(5362);function qe(y,_){1&y&&h.GkF(0)}function Ze(y,_){1&y&&h.GkF(0)}function oe(y,_){1&y&&h._UZ(0,"img",12)}function Ge(y,_){1&y&&h.GkF(0)}const Ke=function(y){return{cell:y}};function We(y,_){if(1&y){const g=h.EpF();h.TgZ(0,"div",10),h.NdJ("click",function(){const R=h.CHM(g).$implicit,ne=h.oxw(2).matrix;return h.KtG(ne.reveal(R))}),h.YNc(1,oe,1,0,"img",11),h.YNc(2,Ge,1,0,"ng-container",2),h.qZA()}if(2&y){const g=_.$implicit;h.oxw(3);const N=h.MAs(7);h.ekj("revealed",g.revealed)("empty",g.revealed&&0==g.nearBombs&&!g.bomb),h.xp6(1),h.Q6J("ngIf",g.bomb),h.xp6(1),h.Q6J("ngTemplateOutlet",N)("ngTemplateOutletContext",h.VKq(7,Ke,g))}}function Ye(y,_){if(1&y&&(h.ynx(0),h.YNc(1,We,3,9,"div",9),h.BQk()),2&y){const g=_.$implicit;h.xp6(1),h.Q6J("ngForOf",g)}}function ae(y,_){if(1&y&&(h.TgZ(0,"div",7)(1,"div"),h.YNc(2,Ye,2,1,"ng-container",8),h.qZA()()),2&y){const g=_.matrix,N=h.oxw();h.xp6(1),h.Gre("matrix-container matrix-sized-",N.currentConfig.size,""),h.Udp("grid-template-columns","repeat("+N.currentConfig.size+",calc(min(700px, 100%) / "+N.currentConfig.size+"))"),h.xp6(1),h.Q6J("ngForOf",g)}}function Qe(y,_){if(1&y&&h._UZ(0,"span"),2&y){const g=h.oxw().cell;h.Gre("m-0 p-0 near-bombs-text near-",g.nearBombs,"")}}function Ve(y,_){if(1&y&&h.YNc(0,Qe,1,3,"span",13),2&y){const g=_.cell;h.Q6J("ngIf",!g.bomb&&g.revealed)}}function Xe(y,_){1&y&&(h._uU(0),h.ALo(1,"titlecase")),2&y&&h.hij(" ",h.lcZ(1,1,_.$implicit)," ")}const et=function(){return["Multiplayer","Offline"]};function tt(y,_){if(1&y){const g=h.EpF();h.TgZ(0,"div",14)(1,"div",15)(2,"p-selectButton",16),h.NdJ("ngModelChange",function(F){h.CHM(g);const R=h.oxw();return h.KtG(R.selectedDifficulty=F)})("onChange",function(){h.CHM(g);const F=h.oxw();return h.KtG(F.difficultyChange())}),h.YNc(3,Xe,2,3,"ng-template"),h.qZA()(),h.TgZ(4,"div")(5,"div",17)(6,"h3"),h._uU(7," Configuration: "),h.TgZ(8,"span",18),h._uU(9),h.ALo(10,"titlecase"),h.qZA()()(),h.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),h._uU(15," Size: "),h.TgZ(16,"span",18),h._uU(17),h.qZA()()(),h.TgZ(18,"li")(19,"h4"),h._uU(20," Cells: "),h.TgZ(21,"span",18),h._uU(22),h.qZA()()(),h.TgZ(23,"li")(24,"h4"),h._uU(25,"Bombs: "),h.TgZ(26,"span",18),h._uU(27),h.qZA()()()(),h.TgZ(28,"div",19)(29,"p-selectButton",20),h.NdJ("ngModelChange",function(F){h.CHM(g);const R=h.oxw();return h.KtG(R.networkGamemode=F)}),h.qZA()()(),h.TgZ(30,"div",15),h._UZ(31,"button",21),h.qZA()()()}if(2&y){const g=h.oxw();h.xp6(2),h.Q6J("options",g.difficultyOptions)("ngModel",g.selectedDifficulty),h.xp6(2),h.Gre("config-manager ",g.selectedDifficulty,""),h.xp6(5),h.Oqu(h.lcZ(10,12,g.selectedDifficulty)),h.xp6(8),h.AsE("",g.currentConfig.size," x ",g.currentConfig.size,""),h.xp6(5),h.Oqu(g.currentConfig.size*g.currentConfig.size),h.xp6(5),h.Oqu(g.currentConfig.bombs),h.xp6(2),h.Q6J("options",h.DdM(14,et))("ngModel",g.networkGamemode)}}const Re=function(y){return{matrix:y}},Pe=[{path:"",children:[{path:"",component:(()=>{class y{constructor(g){this.game=g,this.selectedDifficulty="easy",this.difficultyOptions=[...Be],this.networkGamemode="Offline",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new Me(this.currentConfig.size,"userMatrix",this.currentConfig)}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}}return y.\u0275fac=function(g){return new(g||y)(h.Y36(He))},y.\u0275cmp=h.Xpm({type:y,selectors:[["app-minesweeper"]],decls:10,vars:5,consts:[[1,"main-double-board"],[1,"row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["cellNumber",""],["optionMenuTemplate",""],[1,"matrix-wrapper","col-12","col-md-6","my-3"],[4,"ngFor","ngForOf"],["class","matrix-col",3,"revealed","empty","click",4,"ngFor","ngForOf"],[1,"matrix-col",3,"click"],["src","/assets/bomb.png","class","bomb-image",4,"ngIf"],["src","/assets/bomb.png",1,"bomb-image"],[3,"class",4,"ngIf"],[1,"col-12","col-md-6"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg"]],template:function(g,N){if(1&g&&(h.TgZ(0,"div",0)(1,"div",1),h.YNc(2,qe,1,0,"ng-container",2),h.YNc(3,Ze,1,0,"ng-container",3),h.qZA()(),h.YNc(4,ae,3,6,"ng-template",null,4,h.W1O),h.YNc(6,Ve,1,1,"ng-template",null,5,h.W1O),h.YNc(8,tt,32,15,"ng-template",null,6,h.W1O)),2&g){const F=h.MAs(5),R=h.MAs(9);h.xp6(2),h.Q6J("ngTemplateOutlet",F)("ngTemplateOutletContext",h.VKq(3,Re,N.userMatrix)),h.xp6(1),h.Q6J("ngTemplateOutlet",R)}},dependencies:[ie.sg,ie.O5,ie.tP,le.JJ,le.On,Ie.Hq,be.Z,Te.UN,ie.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.config-manager.easy[_ngcontent-%COMP%]   .text-colored[_ngcontent-%COMP%]{color:var(--green)}.config-manager.medium[_ngcontent-%COMP%]   .text-colored[_ngcontent-%COMP%]{color:var(--orange)}.config-manager.hard[_ngcontent-%COMP%]   .text-colored[_ngcontent-%COMP%]{color:var(--red)}",'.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;font-weight:bolder}.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:25px}.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container[_ngcontent-%COMP%]   .matrix-col[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-wrapper[_ngcontent-%COMP%]   .matrix-container[_ngcontent-%COMP%]   .matrix-col.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0}.bomb-image[_ngcontent-%COMP%]{position:absolute;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),y})()}]}];let nt=(()=>{class y{}return y.\u0275fac=function(g){return new(g||y)},y.\u0275mod=h.oAB({type:y}),y.\u0275inj=h.cJS({imports:[z.Bz.forChild(Pe),z.Bz]}),y})(),rt=(()=>{class y{}return y.\u0275fac=function(g){return new(g||y)},y.\u0275mod=h.oAB({type:y}),y.\u0275inj=h.cJS({imports:[ie.ez,nt,se.m]}),y})()},5755:function(Ut,Oe){!function(I){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(o){return null!==o&&"object"==typeof o&&o.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var se=function(o,s){return(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])})(o,s)};function ie(o,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function r(){this.constructor=o}se(o,s),o.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}function z(o,s,r,a){return new(r||(r=Promise))(function(u,w){function v(D){try{l(a.next(D))}catch(L){w(L)}}function p(D){try{l(a.throw(D))}catch(L){w(L)}}function l(D){D.done?u(D.value):function c(u){return u instanceof r?u:new r(function(w){w(u)})}(D.value).then(v,p)}l((a=a.apply(o,s||[])).next())})}function j(o,s){var a,c,u,w,r={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return w={next:v(0),throw:v(1),return:v(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w;function v(l){return function(D){return function p(l){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,c&&(u=2&l[0]?c.return:l[0]?c.throw||((u=c.return)&&u.call(c),0):c.next)&&!(u=u.call(c,l[1])).done)return u;switch(c=0,u&&(l=[2&l[0],u.value]),l[0]){case 0:case 1:u=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,c=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(u=(u=r.trys).length>0&&u[u.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!u||l[1]>u[0]&&l[1]<u[3])){r.label=l[1];break}if(6===l[0]&&r.label<u[1]){r.label=u[1],u=l;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(l);break}u[2]&&r.ops.pop(),r.trys.pop();continue}l=s.call(o,r)}catch(D){l=[6,D],c=0}finally{a=u=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,D])}}}function Ee(o,s){s.headers=o.headers||{},s.statusMessage=o.statusText,s.statusCode=o.status,s.data=o.response}function X(o,s,r){return new Promise(function(a,c){r=r||{};var w,v,p,u=new XMLHttpRequest,l=r.body,D=r.headers||{};for(w in r.timeout&&(u.timeout=r.timeout),u.ontimeout=u.onerror=function(L){L.timeout="timeout"==L.type,c(L)},u.open(o,s.href||s),u.onload=function(){for(p=u.getAllResponseHeaders().trim().split(/[\r\n]+/),Ee(u,u);v=p.shift();)v=v.split(": "),u.headers[v.shift().toLowerCase()]=v.join(": ");if((v=u.headers["content-type"])&&~v.indexOf("application/json"))try{u.data=JSON.parse(u.data,r.reviver)}catch(L){return Ee(u,L),c(L)}(u.status>=400?c:a)(u)},typeof FormData<"u"&&l instanceof FormData||l&&"object"==typeof l&&(D["content-type"]="application/json",l=JSON.stringify(l)),u.withCredentials=!!r.withCredentials,D)u.setRequestHeader(w,D[w]);u.send(l)})}var je=X.bind(X,"GET"),h=X.bind(X,"POST"),Be=X.bind(X,"PATCH"),Ce=X.bind(X,"DELETE"),me=je,Me=Be,le=h,Ie=X.bind(X,"PUT"),be=X,Te={del:Ce,get:me,patch:Me,post:le,put:Ie,send:be},qe=Object.freeze(Object.assign(Object.create(null),Te,{default:Te,del:Ce,get:me,patch:Me,post:le,put:Ie,send:be})),Ze=function(o){function s(r,a){var c=o.call(this,a)||this;return c.name="ServerError",c.code=r,c}return ie(s,o),s}(Error);function oe(o,s){if(this._offset=s,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}function We(o,s,r){for(var a=0,c=0,u=r.length;c<u;c++)(a=r.charCodeAt(c))<128?o.setUint8(s++,a):a<2048?(o.setUint8(s++,192|a>>6),o.setUint8(s++,128|63&a)):a<55296||a>=57344?(o.setUint8(s++,224|a>>12),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a)):(c++,a=65536+((1023&a)<<10|1023&r.charCodeAt(c)),o.setUint8(s++,240|a>>18),o.setUint8(s++,128|a>>12&63),o.setUint8(s++,128|a>>6&63),o.setUint8(s++,128|63&a))}function ae(o,s,r){var a=typeof r,c=0,u=0,w=0,v=0,p=0,l=0;if("string"===a){if((p=function Ye(o){for(var s=0,r=0,a=0,c=o.length;a<c;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r}(r))<32)o.push(160|p),l=1;else if(p<256)o.push(217,p),l=2;else if(p<65536)o.push(218,p>>8,p),l=3;else{if(!(p<4294967296))throw new Error("String too long");o.push(219,p>>24,p>>16,p>>8,p),l=5}return s.push({_str:r,_length:p,_offset:o.length}),l+p}if("number"===a)return Math.floor(r)===r&&isFinite(r)?r>=0?r<128?(o.push(r),1):r<256?(o.push(204,r),2):r<65536?(o.push(205,r>>8,r),3):r<4294967296?(o.push(206,r>>24,r>>16,r>>8,r),5):(w=r/Math.pow(2,32)>>0,o.push(207,w>>24,w>>16,w>>8,w,(v=r>>>0)>>24,v>>16,v>>8,v),9):r>=-32?(o.push(r),1):r>=-128?(o.push(208,r),2):r>=-32768?(o.push(209,r>>8,r),3):r>=-2147483648?(o.push(210,r>>24,r>>16,r>>8,r),5):(w=Math.floor(r/Math.pow(2,32)),o.push(211,w>>24,w>>16,w>>8,w,(v=r>>>0)>>24,v>>16,v>>8,v),9):(o.push(203),s.push({_float:r,_length:8,_offset:o.length}),9);if("object"===a){if(null===r)return o.push(192),1;if(Array.isArray(r)){if((p=r.length)<16)o.push(144|p),l=1;else if(p<65536)o.push(220,p>>8,p),l=3;else{if(!(p<4294967296))throw new Error("Array too large");o.push(221,p>>24,p>>16,p>>8,p),l=5}for(c=0;c<p;c++)l+=ae(o,s,r[c]);return l}if(r instanceof Date){var D=r.getTime();return w=Math.floor(D/Math.pow(2,32)),o.push(215,0,w>>24,w>>16,w>>8,w,(v=D>>>0)>>24,v>>16,v>>8,v),10}if(r instanceof ArrayBuffer){if((p=r.byteLength)<256)o.push(196,p),l=2;else if(p<65536)o.push(197,p>>8,p),l=3;else{if(!(p<4294967296))throw new Error("Buffer too large");o.push(198,p>>24,p>>16,p>>8,p),l=5}return s.push({_bin:r,_length:p,_offset:o.length}),l+p}if("function"==typeof r.toJSON)return ae(o,s,r.toJSON());var L=[],B="",Y=Object.keys(r);for(c=0,u=Y.length;c<u;c++)"function"!=typeof r[B=Y[c]]&&L.push(B);if((p=L.length)<16)o.push(128|p),l=1;else if(p<65536)o.push(222,p>>8,p),l=3;else{if(!(p<4294967296))throw new Error("Object too large");o.push(223,p>>24,p>>16,p>>8,p),l=5}for(c=0;c<p;c++)l+=ae(o,s,B=L[c]),l+=ae(o,s,r[B]);return l}if("boolean"===a)return o.push(r?195:194),1;if("undefined"===a)return o.push(212,0,0),3;throw new Error("Could not encode")}function Qe(o){var s=[],r=[],a=ae(s,r,o),c=new ArrayBuffer(a),u=new DataView(c),w=0,v=0,p=-1;r.length>0&&(p=r[0]._offset);for(var l,D=0,L=0,B=0,Y=s.length;B<Y;B++)if(u.setUint8(v+B,s[B]),B+1===p){if(D=(l=r[w])._length,L=v+p,l._bin)for(var De=new Uint8Array(l._bin),K=0;K<D;K++)u.setUint8(L+K,De[K]);else l._str?We(u,L,l._str):void 0!==l._float&&u.setFloat64(L,l._float);v+=D,r[++w]&&(p=r[w]._offset)}return c}oe.prototype._array=function(o){for(var s=new Array(o),r=0;r<o;r++)s[r]=this._parse();return s},oe.prototype._map=function(o){for(var r={},a=0;a<o;a++)r[this._parse()]=this._parse();return r},oe.prototype._str=function(o){var s=function Ge(o,s,r){for(var a="",c=0,u=s,w=s+r;u<w;u++){var v=o.getUint8(u);if(0!=(128&v))if(192!=(224&v))if(224!=(240&v)){if(240!=(248&v))throw new Error("Invalid byte "+v.toString(16));(c=(7&v)<<18|(63&o.getUint8(++u))<<12|(63&o.getUint8(++u))<<6|(63&o.getUint8(++u))<<0)>=65536?(c-=65536,a+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):a+=String.fromCharCode(c)}else a+=String.fromCharCode((15&v)<<12|(63&o.getUint8(++u))<<6|(63&o.getUint8(++u))<<0);else a+=String.fromCharCode((31&v)<<6|63&o.getUint8(++u));else a+=String.fromCharCode(v)}return a}(this._view,this._offset,o);return this._offset+=o,s},oe.prototype._bin=function(o){var s=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,s},oe.prototype._parse=function(){var s,o=this._view.getUint8(this._offset++),r=0,a=0,c=0,u=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return r=this._view.getUint8(this._offset),this._offset+=1,this._bin(r);case 197:return r=this._view.getUint16(this._offset),this._offset+=2,this._bin(r);case 198:return r=this._view.getUint32(this._offset),this._offset+=4,this._bin(r);case 199:return r=this._view.getUint8(this._offset),a=this._view.getInt8(this._offset+1),this._offset+=2,[a,this._bin(r)];case 200:return r=this._view.getUint16(this._offset),a=this._view.getInt8(this._offset+2),this._offset+=3,[a,this._bin(r)];case 201:return r=this._view.getUint32(this._offset),a=this._view.getInt8(this._offset+4),this._offset+=5,[a,this._bin(r)];case 202:return s=this._view.getFloat32(this._offset),this._offset+=4,s;case 203:return s=this._view.getFloat64(this._offset),this._offset+=8,s;case 204:return s=this._view.getUint8(this._offset),this._offset+=1,s;case 205:return s=this._view.getUint16(this._offset),this._offset+=2,s;case 206:return s=this._view.getUint32(this._offset),this._offset+=4,s;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,c+u;case 208:return s=this._view.getInt8(this._offset),this._offset+=1,s;case 209:return s=this._view.getInt16(this._offset),this._offset+=2,s;case 210:return s=this._view.getInt32(this._offset),this._offset+=4,s;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,c+u;case 212:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?void(this._offset+=1):[a,this._bin(1)];case 213:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(2)];case 214:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(4)];case 215:return a=this._view.getInt8(this._offset),this._offset+=1,0===a?(c=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+u)):[a,this._bin(8)];case 216:return a=this._view.getInt8(this._offset),this._offset+=1,[a,this._bin(16)];case 217:return r=this._view.getUint8(this._offset),this._offset+=1,this._str(r);case 218:return r=this._view.getUint16(this._offset),this._offset+=2,this._str(r);case 219:return r=this._view.getUint32(this._offset),this._offset+=4,this._str(r);case 220:return r=this._view.getUint16(this._offset),this._offset+=2,this._array(r);case 221:return r=this._view.getUint32(this._offset),this._offset+=4,this._array(r);case 222:return r=this._view.getUint16(this._offset),this._offset+=2,this._map(r);case 223:return r=this._view.getUint32(this._offset),this._offset+=4,this._map(r)}throw new Error("Could not parse")};var o,Xe=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},et=function(){function o(s){this.events=s}return o.prototype.send=function(s){s instanceof ArrayBuffer?this.ws.send(s):Array.isArray(s)&&this.ws.send(new Uint8Array(s).buffer)},o.prototype.connect=function(s){this.ws=new Xe(s,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},o.prototype.close=function(s,r){this.ws.close(s,r)},o}(),tt=function(){function o(){this.events={},this.transport=new et(this.events)}return o.prototype.send=function(s){this.transport.send(s)},o.prototype.connect=function(s){this.transport.connect(s)},o.prototype.close=function(s,r){this.transport.close(s,r)},o}(),Re={};function Se(o,s){Re[o]=s}function Pe(o){var s=Re[o];if(!s)throw new Error("missing serializer: "+o);return s}I.Protocol=void 0,(o=I.Protocol||(I.Protocol={}))[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I.ErrorCode=void 0,function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(I.ErrorCode||(I.ErrorCode={}));let y=()=>({events:{},emit(o,...s){(this.events[o]||[]).forEach(r=>r(...s))},on(o,s){return(this.events[o]=this.events[o]||[]).push(s),()=>this.events[o]=(this.events[o]||[]).filter(r=>r!==s)}});var _=function(){function o(){this.handlers=[]}return o.prototype.register=function(s,r){return this.handlers.push(s),this},o.prototype.invoke=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];this.handlers.forEach(function(c){return c.apply(s,r)})},o.prototype.invokeAsync=function(){for(var s=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return Promise.all(this.handlers.map(function(c){return c.apply(s,r)}))},o.prototype.remove=function(s){var r=this.handlers.indexOf(s);this.handlers[r]=this.handlers[this.handlers.length-1],this.handlers.pop()},o.prototype.clear=function(){this.handlers=[]},o}();function g(){var o=new _;function s(r){return o.register(r,null===this)}return s.once=function(r){var a=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];r.apply(this,c),o.remove(a)};o.register(a)},s.remove=function(r){return o.remove(r)},s.invoke=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invoke.apply(o,r)},s.invokeAsync=function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];return o.invokeAsync.apply(o,r)},s.clear=function(){return o.clear()},s}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var pe,R=function F(o){var s={exports:{}};return o(s,s.exports),s.exports}(function(o,s){var a;a=function(r){var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&(n[f]=i[f])})(t,e)};function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t,e,n,i){var $,f=arguments.length,d=f<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(t,e,n,i);else for(var m=t.length-1;m>=0;m--)($=t[m])&&(d=(f<3?$(d):f>3?$(e,n,d):$(e,n))||d);return f>3&&d&&Object.defineProperty(e,n,d),d}function w(t,e){for(var n=0,i=e.length,f=t.length;n<i;n++,f++)t[f]=e[n];return t}var t,v=255;r.OPERATION=void 0,(t=r.OPERATION||(r.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var l=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(e,n,i){void 0===i&&(i=!0),this.refs.set(e,n),i&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},t.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(n){if(e.refCounts[n]<=0){var i=e.refs.get(n);if(i instanceof Z)for(var f in i._definition.schema)"string"!=typeof i._definition.schema[f]&&i[f]&&i[f].$changes&&e.removeRef(i[f].$changes.refId);else{var d=i.$changes.parent._definition;"function"==typeof Object.values(d.schema[d.fieldsByIndex[i.$changes.parentIndex]])[0]&&Array.from(i.values()).forEach(function(m){return e.removeRef(m.$changes.refId)})}e.refs.delete(n),delete e.refCounts[n]}}),this.deletedRefs.clear()},t}(),D=function(){function t(e,n,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(n,i)}return t.prototype.setParent=function(e,n,i){var f=this;if(this.indexes||(this.indexes=this.ref instanceof Z?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=i,n)if(this.root=n,this.ref instanceof Z){var d=this.ref._definition;for(var $ in d.schema){var m=this.ref[$];m&&m.$changes&&m.$changes.setParent(this.ref,n,d.indexes[$])}}else"object"==typeof this.ref&&this.ref.forEach(function(C,x){C instanceof Z&&C.$changes.setParent(f.ref,f.root,f.ref.$changes.indexes[x])})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(e,n){void 0===n&&(n=r.OPERATION.ADD);var i="number"==typeof e?e:this.indexes[e];this.assertValidIndex(i,e);var f=this.changes.get(i);(!f||f.op===r.OPERATION.DELETE||f.op===r.OPERATION.TOUCH)&&this.changes.set(i,{op:f&&f.op===r.OPERATION.DELETE?r.OPERATION.DELETE_AND_ADD:n,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},t.prototype.touch=function(e){var n="number"==typeof e?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:r.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition)return(n=this.ref._definition).schema[n.fieldsByIndex[e]];var n=this.parent._definition;return Object.values(n.schema[n.fieldsByIndex[this.parentIndex]])[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(e){var n="number"==typeof e?e:this.indexes[e];if(void 0!==n){var i=this.getValue(n);this.changes.set(n,{op:r.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],i&&i.$changes&&(i.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+n+")")},t.prototype.discard=function(e,n){var i=this;void 0===e&&(e=!1),void 0===n&&(n=!1),this.ref instanceof Z||this.changes.forEach(function(f){if(f.op===r.OPERATION.DELETE){var d=i.ref.getIndex(f.index);delete i.indexes[d]}}),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(n){var i=e.getValue(n.index);i&&i.$changes&&i.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,n){this.caches[e]=n},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,n){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+n+'"')},t}(),L=function(t,e){var n=t.toString(),i=e.toString();return n<i?-1:n>i?1:0};function B(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"==typeof n||isNaN(n)?e[n]:e.at(n)},set:function(e,n,i){if("symbol"==typeof n||isNaN(n))e[n]=i;else{var f=Array.from(e.$items.keys()),d=parseInt(f[n]||n);null==i?e.deleteAt(d):e.setAt(d,i)}return!0},deleteProperty:function(e,n){return"number"==typeof n?e.deleteAt(n):delete e[n],!0}})}var Y=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var f;return n.forEach(function(d){f=e.$refId++,e.setAt(f,d)}),f},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var n=this.$items.get(e);return this.$items.delete(e),n}},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.setAt=function(e,n){var i,f;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,e);var d=null!==(f=null===(i=this.$changes.indexes[e])||void 0===i?void 0:i.op)&&void 0!==f?f:r.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,d)},t.prototype.deleteAt=function(e){var n=Array.from(this.$items.keys())[e];return void 0!==n&&this.$deleteAt(n)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(t.bind.apply(t,w([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n))))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,n=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(f,d){e.setAt(n[d],f)}),this},t.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var i=this.$items.get(n);return this.$deleteAt(n),i}},t.prototype.slice=function(e,n){return new(t.bind.apply(t,w([void 0],Array.from(this.$items.values()).slice(e,n))))},t.prototype.sort=function(e){var n=this;void 0===e&&(e=L);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(d,$){n.setAt(i[$],d)}),this},t.prototype.splice=function(e,n){void 0===n&&(n=this.length-e);for(var i=[],f=2;f<arguments.length;f++)i[f-2]=arguments[f];for(var d=Array.from(this.$items.keys()),$=[],m=e;m<e+n;m++)$.push(this.$items.get(d[m])),this.$deleteAt(d[m]);return $},t.prototype.unshift=function(){for(var e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var f=this.length,d=n.length,$=Array.from(this.$items.values());return n.forEach(function(m,S){e.setAt(S,m)}),$.forEach(function(m,S){e.setAt(d+S,m)}),f+d},t.prototype.indexOf=function(e,n){return Array.from(this.$items.values()).indexOf(e,n)},t.prototype.lastIndexOf=function(e,n){return void 0===n&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,n)},t.prototype.every=function(e,n){return Array.from(this.$items.values()).every(e,n)},t.prototype.some=function(e,n){return Array.from(this.$items.values()).some(e,n)},t.prototype.forEach=function(e,n){Array.from(this.$items.values()).forEach(e,n)},t.prototype.map=function(e,n){return Array.from(this.$items.values()).map(e,n)},t.prototype.filter=function(e,n){return Array.from(this.$items.values()).filter(e,n)},t.prototype.reduce=function(e,n){return Array.from(this.$items.values()).reduce(e,n)},t.prototype.reduceRight=function(e,n){return Array.from(this.$items.values()).reduceRight(e,n)},t.prototype.find=function(e,n){return Array.from(this.$items.values()).find(e,n)},t.prototype.findIndex=function(e,n){return Array.from(this.$items.values()).findIndex(e,n)},t.prototype.fill=function(e,n,i){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,n,i){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,n){return Array.from(this.$items.values()).includes(e,n)},t.prototype.flatMap=function(e,n){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},t.prototype.clone=function(e){return e?new(t.bind.apply(t,w([void 0],Array.from(this.$items.values())))):new(t.bind.apply(t,w([void 0],this.map(function(i){return i.$changes?i.clone():i}))))},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}();function De(t){return t.$proxy=!0,new Proxy(t,{get:function(e,n){return"symbol"!=typeof n&&typeof e[n]>"u"?e.get(n):e[n]},set:function(e,n,i){return"symbol"!=typeof n&&-1===n.indexOf("$")&&"onAdd"!==n&&"onRemove"!==n&&"onChange"!==n?e.set(n,i):e[n]=i,!0},deleteProperty:function(e,n){return e.delete(n),!0}})}var K=function(){function t(e){var n=this;if(this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(f,d){return n.set(d,f)});else for(var i in e)this.set(i,e[i])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(e,n){if(null==n)throw new Error("MapSchema#set('"+e+"', "+n+"): trying to set "+n+" value on '"+e+"'.");var i=typeof this.$changes.indexes[e]<"u",f=i?this.$changes.indexes[e]:this.$refId++,d=i?r.OPERATION.REPLACE:r.OPERATION.ADD,$=void 0!==n.$changes;return $&&n.$changes.setParent(this,this.$changes.root,f),i?$&&this.$items.get(e)!==n&&(d=r.OPERATION.ADD):(this.$changes.indexes[e]=f,this.$indexes.set(f,e)),this.$items.set(e,n),this.$changes.change(e,d),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(n,i){e[i]="function"==typeof n.toJSON?n.toJSON():n}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(i,f){n.set(f,i.$changes?i.clone():i)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),wt={};function ye(t,e){wt[t]=e}function Ne(t){return wt[t]}var at=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(e,n){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=e,this.indexes[e]=i,this.schema[e]=Array.isArray(n)?{array:n[0]}:n},t.prototype.addFilter=function(e,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=n,this.indexesWithFilters.push(this.indexes[e]),!0},t.prototype.addChildrenFilter=function(e,n){var i=this.indexes[e];if(Ne(Object.keys(this.schema[e])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=n,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},t.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();var ke=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(e){return this.schemas.has(e)},t.prototype.get=function(e){return this.types[e]},t.prototype.add=function(e,n){void 0===n&&(n=this.schemas.size),e._definition=at.create(e._definition),e._typeid=n,this.types[n]=e,this.schemas.set(e,n)},t.create=function(e){return void 0===e&&(e=new t),function(n){return ee(n,e)}},t}(),At=new ke;function ee(t,e){return void 0===e&&(e=At),function(n,i){var f=n.constructor;f._context=e,e.has(f)||e.add(f);var d=f._definition;if(d.addField(i,t),d.descriptors[i]){if(d.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+f.name+"'.\nCheck @type() annotation")}catch(A){var $=A.stack.split("\n")[4].trim();throw new Error(A.message+" "+$)}}var m=Y.is(t),S=!m&&K.is(t);if("string"!=typeof t&&!Z.is(t)){var C=Object.values(t)[0];"string"!=typeof C&&!e.has(C)&&e.add(C)}var x="_"+i;d.descriptors[x]={enumerable:!1,configurable:!1,writable:!0},d.descriptors[i]={get:function(){return this[x]},set:function(A){A!==this[x]&&(null!=A?(m&&!(A instanceof Y)&&(A=new(Y.bind.apply(Y,w([void 0],A)))),S&&!(A instanceof K)&&(A=new K(A)),void 0===A.$proxy&&(S?A=De(A):m&&(A=B(A))),this.$changes.change(i),A.$changes&&A.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[x]=A)},enumerable:!0,configurable:!0}}}function $t(t,e,n){for(var i=0,f=0,d=n.length;f<d;f++)(i=n.charCodeAt(f))<128?t[e++]=i:i<2048?(t[e++]=192|i>>6,t[e++]=128|63&i):i<55296||i>=57344?(t[e++]=224|i>>12,t[e++]=128|i>>6&63,t[e++]=128|63&i):(f++,i=65536+((1023&i)<<10|1023&n.charCodeAt(f)),t[e++]=240|i>>18,t[e++]=128|i>>12&63,t[e++]=128|i>>6&63,t[e++]=128|63&i)}function Ot(t,e){t.push(255&e)}function W(t,e){t.push(255&e)}function Et(t,e){t.push(255&e),t.push(e>>8&255)}function ft(t,e){t.push(255&e),t.push(e>>8&255)}function _e(t,e){t.push(255&e),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function fe(t,e){var n=e>>24,i=e>>16,f=e>>8;t.push(255&e),t.push(255&f),t.push(255&i),t.push(255&n)}function Ct(t,e){var n=Math.floor(e/Math.pow(2,32));fe(t,e>>>0),fe(t,n)}function Mt(t,e){var n=e/Math.pow(2,32)>>0;fe(t,e>>>0),fe(t,n)}var xe=new Int32Array(2),Xt=new Float32Array(xe.buffer),en=new Float64Array(xe.buffer);function It(t,e){Xt[0]=e,_e(t,xe[0])}function ct(t,e){en[0]=e,_e(t,xe[0]),_e(t,xe[1])}function Ue(t,e){e||(e="");var n=function Yt(t){for(var e=0,n=0,i=0,f=t.length;i<f;i++)(e=t.charCodeAt(i))<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(i++,n+=4);return n}(e),i=0;if(n<32)t.push(160|n),i=1;else if(n<256)t.push(217),W(t,n),i=2;else if(n<65536)t.push(218),ft(t,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");t.push(219),fe(t,n),i=5}return $t(t,t.length,e),i+n}function Q(t,e){return isNaN(e)?Q(t,0):isFinite(e)?e!==(0|e)?(t.push(203),ct(t,e),9):e>=0?e<128?(W(t,e),1):e<256?(t.push(204),W(t,e),2):e<65536?(t.push(205),ft(t,e),3):e<4294967296?(t.push(206),fe(t,e),5):(t.push(207),Mt(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),Ot(t,e),2):e>=-32768?(t.push(209),Et(t,e),3):e>=-2147483648?(t.push(210),_e(t,e),5):(t.push(211),Ct(t,e),9):Q(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var ht=Object.freeze({__proto__:null,utf8Write:$t,int8:Ot,uint8:W,int16:Et,uint16:ft,int32:_e,uint32:fe,int64:Ct,uint64:Mt,float32:function Qt(t,e){It(t,e)},float64:function Vt(t,e){ct(t,e)},writeFloat32:It,writeFloat64:ct,boolean:function tn(t,e){return W(t,e?1:0)},string:Ue,number:Q});function bt(t,e){return we(t,e)<<24>>24}function we(t,e){return t[e.offset++]}function Tt(t,e){return Fe(t,e)<<16>>16}function Fe(t,e){return t[e.offset++]|t[e.offset++]<<8}function ce(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function ge(t,e){return ce(t,e)>>>0}function Rt(t,e){var n=ge(t,e);return ce(t,e)*Math.pow(2,32)+n}function St(t,e){var n=ge(t,e);return ge(t,e)*Math.pow(2,32)+n}var Ae=new Int32Array(2),sn=new Float32Array(Ae.buffer),an=new Float64Array(Ae.buffer);function ut(t,e){return Ae[0]=ce(t,e),sn[0]}function dt(t,e){return Ae[0]=ce(t,e),Ae[1]=ce(t,e),an[0]}function Pt(t,e){var i,n=t[e.offset++];n<192?i=31&n:217===n?i=we(t,e):218===n?i=Fe(t,e):219===n&&(i=ge(t,e));var f=function nn(t,e,n){for(var i="",f=0,d=e,$=e+n;d<$;d++){var m=t[d];0!=(128&m)?192!=(224&m)?224!=(240&m)?240!=(248&m)?console.error("Invalid byte "+m.toString(16)):(f=(7&m)<<18|(63&t[++d])<<12|(63&t[++d])<<6|(63&t[++d])<<0)>=65536?(f-=65536,i+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):i+=String.fromCharCode(f):i+=String.fromCharCode((15&m)<<12|(63&t[++d])<<6|(63&t[++d])<<0):i+=String.fromCharCode((31&m)<<6|63&t[++d]):i+=String.fromCharCode(m)}return i}(t,e.offset,i);return e.offset+=i,f}function he(t,e){var n=t[e.offset++];return n<128?n:202===n?ut(t,e):203===n?dt(t,e):204===n?we(t,e):205===n?Fe(t,e):206===n?ge(t,e):207===n?St(t,e):208===n?bt(t,e):209===n?Tt(t,e):210===n?ce(t,e):211===n?Rt(t,e):n>223?-1*(255-n+1):void 0}function Dt(t,e){return t[e.offset-1]===v&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var Nt=Object.freeze({__proto__:null,int8:bt,uint8:we,int16:Tt,uint16:Fe,int32:ce,uint32:ge,float32:function rn(t,e){return ut(t,e)},float64:function on(t,e){return dt(t,e)},int64:Rt,uint64:St,readFloat32:ut,readFloat64:dt,boolean:function fn(t,e){return we(t,e)>0},string:Pt,stringCheck:function cn(t,e){var n=t[e.offset];return n<192&&n>160||217===n||218===n||219===n},number:he,numberCheck:function hn(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211},arrayCheck:function un(t,e){return t[e.offset]<160},switchStructureCheck:Dt}),lt=function(){function t(e){var n=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(i){return n.add(i)})}return t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var n=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,e),this.$changes.change(n),n},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var i,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(e===f.value[1]){i=f.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(n){return n===e})},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(i,f,d){return e(i,f,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,i){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),pt=function(){function t(e){var n=this;this.$changes=new D(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(i){return n.add(i)})}return t.is=function(e){return void 0!==e.set},t.prototype.add=function(e){var n,i;if(this.has(e))return!1;var f=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,f);var d=null!==(i=null===(n=this.$changes.indexes[f])||void 0===n?void 0:n.op)&&void 0!==i?i:r.OPERATION.ADD;return this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,e),this.$changes.change(f,d),f},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var i,f,n=this.$items.entries();(f=n.next())&&!f.done;)if(e===f.value[1]){i=f.value[0];break}return void 0!==i&&(this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i))},t.prototype.clear=function(e){var n=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(i){n.$changes.root.removeRef(i.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:r.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var f,n=this.$items.values(),i=!1;(f=n.next())&&!f.done;)if(e===f.value){i=!0;break}return i},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(i,f,d){return e(i,f,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,i){e.push("function"==typeof n.toJSON?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(i){n.add(i.$changes?i.clone():i)})),n},t.prototype.triggerAll=function(){Z.prototype.triggerAll.apply(this)},t}(),dn=function(){function t(){this.handlers=[]}return t.prototype.register=function(e,n){return this.handlers.push(e),this},t.prototype.invoke=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.handlers.forEach(function(i){return i.apply(void 0,e)})},t.prototype.invokeAsync=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Promise.all(this.handlers.map(function(i){return i.apply(void 0,e)}))},t.prototype.remove=function(e){var n=this.handlers.indexOf(e);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}(),ln=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return void 0===e.$filterState&&(e.$filterState=new t),e.$filterState},t}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e}(Error);function kt(t,e,n,i){if(!(t instanceof e))throw new gt("a '"+e.name+"' was expected, but '"+t.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function gn(t,e,n,i,f){!function pn(t,e,n,i){var f,d=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":f="number",isNaN(t)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+i);break;case"string":f="string",d=!0;break;case"boolean":return}if(typeof t!==f&&(!d||d&&null!==t)){var $="'"+JSON.stringify(t)+"'"+(t&&t.constructor&&" ("+t.constructor.name+")"||"");throw new gt("a '"+f+"' was expected, but "+$+" was provided in "+n.constructor.name+"#"+i)}}(n,t,i,f);var d=ht[t];if(!d)throw new gt("a '"+t+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+f);d(e,n)}function vn(t,e,n){return Nt[t](e,n)}var Z=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new D(this,void 0,new l),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.listen=function(e,n){var i=this;return this.$listeners[e]||(this.$listeners[e]=new dn),this.$listeners[e].register(n),function(){return i.$listeners[e].remove(n)}},t.prototype.decode=function(e,n,i,f){void 0===n&&(n={offset:0}),void 0===i&&(i=this),void 0===f&&(f=new Map);var d=this.$changes.root,$=e.length,m=0,S=[];for(d.refs.set(m,this),f.set(m,S);n.offset<$;){var C=e[n.offset++];if(C!=v){var A=i.$changes,U=void 0!==i._definition,T=U?C>>6<<6:C;if(T!==r.OPERATION.CLEAR){var E=U?C%(T||255):he(e,n),b=U?i._definition.fieldsByIndex[E]:"",k=A.getType(E),O=void 0,P=void 0,G=void 0;if(U?P=i["_"+b]:(P=i.getByIndex(E),(T&r.OPERATION.ADD)===r.OPERATION.ADD?(G=i instanceof K?Pt(e,n):E,i.setIndex(E,G)):G=i.getIndex(E)),(T&r.OPERATION.DELETE)===r.OPERATION.DELETE&&(T!==r.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(E),P&&P.$changes&&d.removeRef(P.$changes.refId),O=null),void 0!==b){if(T!==r.OPERATION.DELETE)if(t.is(k)){var H=he(e,n);if(O=d.refs.get(H),T!==r.OPERATION.REPLACE){var te=this.getSchemaType(e,n,k);O||((O=this.createTypeInstance(te)).$changes.refId=H,P&&(O.onChange=P.onChange,O.onRemove=P.onRemove,O.$listeners=P.$listeners,P.$changes.refId&&H!==P.$changes.refId&&d.removeRef(P.$changes.refId))),d.addRef(H,O,O!==P)}}else if("string"==typeof k)O=vn(k,e,n);else{var $e=Ne(Object.keys(k)[0]),V=he(e,n),J=d.refs.has(V)?P||d.refs.get(V):new $e.constructor;if((O=J.clone(!0)).$changes.refId=V,P&&(O.onAdd=P.onAdd,O.onRemove=P.onRemove,O.onChange=P.onChange,P.$changes.refId&&V!==P.$changes.refId)){d.removeRef(P.$changes.refId);for(var q=[],yt=P.entries(),re=void 0;(re=yt.next())&&!re.done;){var Le=re.value;q.push({op:r.OPERATION.DELETE,field:Le[0],value:void 0,previousValue:Le[1]})}f.set(P.$changes.refId,q)}d.addRef(V,O,J!==P),$e.getProxy&&(O=$e.getProxy(O))}var _n=P!==O;if(null!=O)if(O.$changes&&O.$changes.setParent(A.ref,A.root,E),i instanceof t)i[b]=O;else if(i instanceof K)i.$items.set(G,O);else if(i instanceof Y)i.setAt(E,O);else if(i instanceof lt){var ze=i.add(O);i.setIndex(E,ze)}else i instanceof pt&&!1!==(ze=i.add(O))&&i.setIndex(E,ze);_n&&S.push({op:T,field:b,dynamicIndex:G,value:O,previousValue:P})}else{console.warn("@colyseus/schema: definition mismatch");for(var M={offset:n.offset};n.offset<$&&(!Dt(e,n)||(M.offset=n.offset+1,!d.refs.has(he(e,M))));)n.offset++}}else i.clear(!0)}else{m=he(e,n);var x=d.refs.get(m);if(!x)throw new Error('"refId" not found: '+m);i=x,f.set(m,S=[])}}return this._triggerChanges(f),d.garbageCollectDeletedRefs(),f},t.prototype.encode=function(e,n,i){void 0===e&&(e=!1),void 0===n&&(n=[]),void 0===i&&(i=!1);for(var f=this.$changes,d=new WeakSet,$=[f],m=1,S=0;S<m;S++){var C=$[S],x=C.ref,A=x instanceof t;C.ensureRefId(),d.add(C),C!==f&&(C.changed||e)&&(W(n,v),Q(n,C.refId));for(var U=Array.from(e?C.allChanges:C.changes.values()),T=0,E=U.length;T<E;T++){var b=e?{op:r.OPERATION.ADD,index:U[T]}:U[T],k=b.index,O=A?x._definition.fieldsByIndex&&x._definition.fieldsByIndex[k]:k,P=n.length;if(b.op!==r.OPERATION.TOUCH)if(A)W(n,k|b.op);else{if(W(n,b.op),b.op===r.OPERATION.CLEAR)continue;Q(n,k)}if(!A&&(b.op&r.OPERATION.ADD)==r.OPERATION.ADD&&x instanceof K&&Ue(n,C.ref.$indexes.get(k)),b.op!==r.OPERATION.DELETE){var M=C.getType(k),H=C.getValue(k);if(H&&H.$changes&&!d.has(H.$changes)&&($.push(H.$changes),H.$changes.ensureRefId(),m++),b.op!==r.OPERATION.TOUCH){if(t.is(M))kt(H,M,x,O),Q(n,H.$changes.refId),(b.op&r.OPERATION.ADD)===r.OPERATION.ADD&&this.tryEncodeTypeId(n,M,H.constructor);else if("string"==typeof M)gn(M,n,H,x,O);else{var te=Ne(Object.keys(M)[0]);kt(x["_"+O],te.constructor,x,O),Q(n,H.$changes.refId)}i&&C.cache(k,n.slice(P))}}}!e&&!i&&C.discard()}return n},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(e,n){var i,f;void 0===n&&(n=!1);for(var d=this,$=new Set,m=ln.get(e),S=[this.$changes],C=1,x=[],A=function(T){var E=S[T];if($.has(E.refId))return"continue";var b=E.ref,k=b instanceof t;W(x,v),Q(x,E.refId);var O=m.refIds.has(E),P=n||!O;m.addRefId(E);var G=m.containerIndexes.get(E),M=Array.from(P?E.allChanges:E.changes.values());!n&&k&&b._definition.indexesWithFilters&&b._definition.indexesWithFilters.forEach(function(ve){!G.has(ve)&&E.allChanges.has(ve)&&M.push(P?ve:{op:r.OPERATION.ADD,index:ve})});for(var te=0,$e=M.length;te<$e;te++){var V=P?{op:r.OPERATION.ADD,index:M[te]}:M[te];if(V.op!==r.OPERATION.CLEAR){var J=V.index;if(V.op!==r.OPERATION.DELETE){var q=E.getValue(J),yt=E.getType(J);if(k){if((re=b._definition.filters&&b._definition.filters[J])&&!re.call(b,e,q,d)){q&&q.$changes&&$.add(q.$changes.refId);continue}}else{var re,Le=E.parent;if((re=E.getChildrenFilter())&&!re.call(Le,e,b.$indexes.get(J),q,d)){q&&q.$changes&&$.add(q.$changes.refId);continue}}if(q.$changes&&(S.push(q.$changes),C++),V.op!==r.OPERATION.TOUCH)if(V.op===r.OPERATION.ADD||k)x.push.apply(x,null!==(i=E.caches[J])&&void 0!==i?i:[]),G.add(J);else if(G.has(J))x.push.apply(x,null!==(f=E.caches[J])&&void 0!==f?f:[]);else{if(G.add(J),W(x,r.OPERATION.ADD),Q(x,J),b instanceof K){var de=E.ref.$indexes.get(J);Ue(x,de)}q.$changes?Q(x,q.$changes.refId):ht[yt](x,q)}else q.$changes&&!k&&(W(x,r.OPERATION.ADD),Q(x,J),b instanceof K&&(de=E.ref.$indexes.get(J),Ue(x,de)),Q(x,q.$changes.refId))}else k?W(x,V.op|J):(W(x,V.op),Q(x,J))}else W(x,V.op)}},U=0;U<C;U++)A(U);return x},t.prototype.clone=function(){var e=new this.constructor,n=this._definition.schema;for(var i in n)e[i]="object"==typeof this[i]&&"function"==typeof this[i].clone?this[i].clone():this[i];return e},t.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;t.prototype._triggerAllFillChanges.call(this,this,e);try{t.prototype._triggerChanges.call(this,e)}catch(n){t.onError(n)}}},t.prototype.toJSON=function(){var e=this._definition.schema,n=this._definition.deprecated,i={};for(var f in e)!n[f]&&null!==this[f]&&typeof this[f]<"u"&&(i[f]="function"==typeof this[f].toJSON?this[f].toJSON():this["_"+f]);return i},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,n,i){n._typeid!==i._typeid&&(W(e,213),Q(e,i._typeid))},t.prototype.getSchemaType=function(e,n,i){var f;return 213===e[n.offset]&&(n.offset++,f=this.constructor._context.get(he(e,n))),f||i},t.prototype.createTypeInstance=function(e){var n=new e;return n.$changes.root=this.$changes.root,n},t.prototype._triggerAllFillChanges=function(e,n){if(!n.has(e.$changes.refId)){var i=[];if(n.set(e.$changes.refId||0,i),e instanceof t){var f=e._definition.schema;for(var d in f)void 0!==(m=e["_"+d])&&(i.push({op:r.OPERATION.ADD,field:d,value:m,previousValue:void 0}),void 0!==m.$changes&&t.prototype._triggerAllFillChanges.call(this,m,n))}else for(var S=e.entries(),C=void 0;(C=S.next())&&!C.done;){var m,x=C.value,A=x[0];i.push({op:r.OPERATION.ADD,field:A,dynamicIndex:A,value:m=x[1],previousValue:void 0}),void 0!==m.$changes&&t.prototype._triggerAllFillChanges.call(this,m,n)}}},t.prototype._triggerChanges=function(e){var n=this;e.forEach(function(i,f){var d,$,m,S,C,x,A,U,T,E,b,k;if(i.length>0){for(var O=n.$changes.root.refs.get(f),P=O instanceof t,G=0;G<i.length;G++){var M=i[G],H=O.$listeners&&O.$listeners[M.field];if(P||(M.op===r.OPERATION.ADD&&void 0===M.previousValue?null===($=(d=O).onAdd)||void 0===$||$.call(d,M.value,null!==(m=M.dynamicIndex)&&void 0!==m?m:M.field):M.op===r.OPERATION.DELETE?void 0!==M.previousValue&&(null===(C=(S=O).onRemove)||void 0===C||C.call(S,M.previousValue,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)):M.op===r.OPERATION.DELETE_AND_ADD?(void 0!==M.previousValue&&(null===(U=(A=O).onRemove)||void 0===U||U.call(A,M.previousValue,M.dynamicIndex)),null===(E=(T=O).onAdd)||void 0===E||E.call(T,M.value,M.dynamicIndex)):(M.op===r.OPERATION.REPLACE||M.value!==M.previousValue)&&(null===(k=(b=O).onChange)||void 0===k||k.call(b,M.value,M.dynamicIndex))),(M.op&r.OPERATION.DELETE)===r.OPERATION.DELETE&&M.previousValue instanceof t&&M.previousValue.onRemove&&M.previousValue.onRemove(),H)try{H.invoke(M.value,M.previousValue)}catch(te){t.onError(te)}}if(P&&O.onChange)try{O.onChange(i)}catch(te){t.onError(te)}}})},t._definition=at.create(),t}();var ue=new ke,vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),u([ee("string",ue)],e.prototype,"name",void 0),u([ee("string",ue)],e.prototype,"type",void 0),u([ee("number",ue)],e.prototype,"referencedType",void 0),e}(Z),mt=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.fields=new Y,n}return c(e,t),u([ee("number",ue)],e.prototype,"id",void 0),u([ee([vt],ue)],e.prototype,"fields",void 0),e}(Z),yn=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.types=new Y,n}return c(e,t),e.encode=function(n){var i=n.constructor,f=new e;f.rootType=i._typeid;var d=function(C,x){for(var A in x){var U=new vt;U.name=A;var T=void 0;if("string"==typeof x[A])T=x[A];else{var E=x[A],b=void 0;Z.is(E)?(T="ref",b=x[A]):"string"==typeof E[T=Object.keys(E)[0]]?T+=":"+E[T]:b=E[T],U.referencedType=b?b._typeid:-1}U.type=T,C.fields.push(U)}f.types.push(C)},$=i._context.types;for(var m in $){var S=new mt;S.id=Number(m),d(S,$[m]._definition.schema)}return f.encodeAll()},e.decode=function(n,i){var f=new ke,d=new e;d.decode(n,i);var $=d.types.reduce(function(A,U){var T=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}return c(k,b),k}(Z),E=U.id;return A[E]=T,f.add(T,E),A},{});d.types.forEach(function(A){var U=$[A.id];A.fields.forEach(function(T){var E;if(void 0!==T.referencedType){var b=T.type,k=$[T.referencedType];if(!k){var O=T.type.split(":");b=O[0],k=O[1]}"ref"===b?ee(k,f)(U.prototype,T.name):ee(((E={})[b]=k,E),f)(U.prototype,T.name)}else ee(T.type,f)(U.prototype,T.name)})});var m=$[d.rootType],S=new m;for(var C in m._definition.schema){var x=m._definition.schema[C];"string"!=typeof x&&(S[C]="function"==typeof x?new x:new(Ne(Object.keys(x)[0]).constructor))}return S},u([ee([mt],ue)],e.prototype,"types",void 0),u([ee("number",ue)],e.prototype,"rootType",void 0),e}(Z);ye("map",{constructor:K,getProxy:De}),ye("array",{constructor:Y,getProxy:B}),ye("set",{constructor:pt}),ye("collection",{constructor:lt}),r.ArraySchema=Y,r.CollectionSchema=lt,r.Context=ke,r.MapSchema=K,r.Reflection=yn,r.ReflectionField=vt,r.ReflectionType=mt,r.Schema=Z,r.SchemaDefinition=at,r.SetSchema=pt,r.decode=Nt,r.defineTypes=function Wt(t,e,n){for(var i in void 0===n&&(n=t._context||At),e)ee(e[i],n)(t.prototype,i);return t},r.deprecated=function Kt(t,e){return void 0===t&&(t=!0),function(n,i){var d=n.constructor._definition;d.deprecated[i]=!0,t&&(d.descriptors[i]={get:function(){throw new Error(i+" is deprecated.")},set:function($){},enumerable:!1,configurable:!0})}},r.dumpChanges=function mn(t){for(var e=[t.$changes],i={},f=i,d=function(m){var S=e[m];S.changes.forEach(function(C){var x=S.ref,A=C.index,U=x._definition?x._definition.fieldsByIndex[A]:x.$indexes.get(A);f[U]=S.getValue(A)})},$=0;$<1;$++)d($);return i},r.encode=ht,r.filter=function Zt(t){return function(e,n){var i=e.constructor;i._definition.addFilter(n,t)&&(i._context.useFilters=!0)}},r.filterChildren=function Gt(t){return function(e,n){var i=e.constructor;i._definition.addChildrenFilter(n,t)&&(i._context.useFilters=!0)}},r.hasFilter=function qt(t){return t._context&&t._context.useFilters},r.registerType=ye,r.type=ee,Object.defineProperty(r,"__esModule",{value:!0})},a(s)}),ne=function(){function o(s,r){var a=this;this.onStateChange=g(),this.onError=g(),this.onLeave=g(),this.onJoin=g(),this.hasJoined=!1,this.onMessageHandlers=y(),this.id=null,this.name=s,r&&(this.serializer=new(Pe("schema")),this.rootSchema=r,this.serializer.state=new r),this.onError(function(c,u){return console.warn("colyseus.js - onError => ("+c+") "+u)}),this.onLeave(function(){return a.removeAllListeners()})}return o.prototype.connect=function(s){var r=this;this.connection=new tt,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(a){if(!r.hasJoined)return console.warn("Room connection was closed unexpectedly ("+a.code+"): "+a.reason),void r.onError.invoke(a.code,a.reason);r.onLeave.invoke(a.code),r.destroy()},this.connection.events.onerror=function(a){console.warn("Room, onError ("+a.code+"): "+a.reason),r.onError.invoke(a.code,a.reason)},this.connection.connect(s)},o.prototype.leave=function(s){var r=this;return void 0===s&&(s=!0),new Promise(function(a){r.onLeave(function(c){return a(c)}),r.connection?s?r.connection.send([I.Protocol.LEAVE_ROOM]):r.connection.close():r.onLeave.invoke(4e3)})},o.prototype.onMessage=function(s,r){return this.onMessageHandlers.on(this.getMessageHandlerKey(s),r)},o.prototype.send=function(s,r){var c,a=[I.Protocol.ROOM_DATA];if("string"==typeof s?R.encode.string(a,s):R.encode.number(a,s),void 0!==r){var u=Qe(r);(c=new Uint8Array(a.length+u.byteLength)).set(new Uint8Array(a),0),c.set(new Uint8Array(u),a.length)}else c=new Uint8Array(a);this.connection.send(c.buffer)},Object.defineProperty(o.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),o.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},o.prototype.onMessageCallback=function(s){var r=Array.from(new Uint8Array(s.data)),a=r[0];if(a===I.Protocol.JOIN_ROOM){var c=1;if(this.serializerId=function nt(o,s){for(var r=o[s++],a="",c=0,u=s,w=s+r;u<w;u++){var v=o[u];if(0!=(128&v))if(192!=(224&v))if(224!=(240&v)){if(240!=(248&v))throw new Error("Invalid byte "+v.toString(16));(c=(7&v)<<18|(63&o[++u])<<12|(63&o[++u])<<6|(63&o[++u])<<0)>=65536?(c-=65536,a+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):a+=String.fromCharCode(c)}else a+=String.fromCharCode((15&v)<<12|(63&o[++u])<<6|(63&o[++u])<<0);else a+=String.fromCharCode((31&v)<<6|63&o[++u]);else a+=String.fromCharCode(v)}return a}(r,c),c+=function rt(o){void 0===o&&(o="");for(var s=0,r=0,a=0,c=o.length;a<c;a++)(s=o.charCodeAt(a))<128?r+=1:s<2048?r+=2:s<55296||s>=57344?r+=3:(a++,r+=4);return r+1}(this.serializerId),!this.serializer){var u=Pe(this.serializerId);this.serializer=new u}r.length>c&&this.serializer.handshake&&this.serializer.handshake(r,{offset:c}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([I.Protocol.JOIN_ROOM])}else if(a===I.Protocol.ERROR){var w={offset:1},v=R.decode.number(r,w),p=R.decode.string(r,w);this.onError.invoke(v,p)}else if(a===I.Protocol.LEAVE_ROOM)this.leave();else if(a===I.Protocol.ROOM_DATA_SCHEMA){var l={offset:1};(p=new(L=this.serializer.getState().constructor._context.get(R.decode.number(r,l)))).decode(r,l),this.dispatchMessage(L,p)}else if(a===I.Protocol.ROOM_STATE)r.shift(),this.setState(r);else if(a===I.Protocol.ROOM_STATE_PATCH)r.shift(),this.patch(r);else if(a===I.Protocol.ROOM_DATA){var B={offset:1},L=R.decode.stringCheck(r,B)?R.decode.string(r,B):R.decode.number(r,B);p=r.length>B.offset?function Ke(o,s){void 0===s&&(s=0);var r=new oe(o,s),a=r._parse();if(r._offset!==o.byteLength)throw new Error(o.byteLength-r._offset+" trailing bytes");return a}(s.data,B.offset):void 0,this.dispatchMessage(L,p)}},o.prototype.setState=function(s){this.serializer.setState(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.patch=function(s){this.serializer.patch(s),this.onStateChange.invoke(this.serializer.getState())},o.prototype.dispatchMessage=function(s,r){var a=this.getMessageHandlerKey(s);this.onMessageHandlers.events[a]?this.onMessageHandlers.emit(a,r):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",s,r):console.warn("colyseus.js: onMessage() not registered for type '"+s+"'.")},o.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},o.prototype.getMessageHandlerKey=function(s){switch(typeof s){case"function":return"$"+s._typeid;case"string":return s;case"number":return"i"+s;default:throw new Error("invalid message type.")}},o}();function it(){return pe||(pe=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(o,s){this.cache[o]=s},getItem:function(o){},removeItem:function(o){delete this.cache[o]}}),pe}var ot="colyseus-auth-token";I.Platform=void 0,function(o){o.ios="ios",o.android="android"}(I.Platform||(I.Platform={}));var st,_t=function(){function o(s){var r=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=s.replace("ws","http"),function zt(o,s){var r=it().getItem(o);typeof Promise>"u"||!(r instanceof Promise)?s(r):r.then(function(a){return s(a)})}(ot,function(a){return r.token=a})}return Object.defineProperty(o.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),o.prototype.login=function(s){return void 0===s&&(s={}),z(this,void 0,void 0,function(){var r,a,c;return j(this,function(u){switch(u.label){case 0:return r=Object.assign({},s),this.hasToken&&(r.token=this.token),[4,this.request("post","/auth",r)];case 1:for(c in a=u.sent(),this.token=a.token,function Ft(o,s){it().setItem(o,s)}(ot,this.token),a)this.hasOwnProperty(c)&&(this[c]=a[c]);return this.registerPingService(),[2,this]}})})},o.prototype.save=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return s.sent(),[2,this]}})})},o.prototype.getFriends=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,s.sent()]}})})},o.prototype.getOnlineFriends=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,s.sent()]}})})},o.prototype.getFriendRequests=function(){return z(this,void 0,void 0,function(){return j(this,function(s){switch(s.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,s.sent()]}})})},o.prototype.sendFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.acceptFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.declineFriendRequest=function(s){return z(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("del","/friends/requests",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.blockUser=function(s){return z(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("post","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.unblockUser=function(s){return z(this,void 0,void 0,function(){return j(this,function(r){switch(r.label){case 0:return[4,this.request("put","/friends/block",{userId:s})];case 1:return[2,r.sent()]}})})},o.prototype.request=function(s,r,a,c,u){return void 0===a&&(a={}),void 0===u&&(u={}),z(this,void 0,void 0,function(){var w,v,p,l;return j(this,function(D){switch(D.label){case 0:for(v in u.Accept="application/json",this.hasToken&&(u.Authorization="Bearer "+this.token),w=[],a)w.push(v+"="+a[v]);return p=w.length>0?"?"+w.join("&"):"",l={headers:u},c&&(l.body=c),[4,qe[s](""+this.endpoint+r+p,l)];case 1:return[2,D.sent().data]}})})},o.prototype.logout=function(){this.token=void 0,function Lt(o){it().removeItem(o)}(ot),this.unregisterPingService()},o.prototype.registerPingService=function(s){var r=this;void 0===s&&(s=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return r.request("get","/auth")},s)},o.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},o}(),jt=function(o){function s(r,a){var c=o.call(this,r)||this;return c.code=a,Object.setPrototypeOf(c,s.prototype),c}return ie(s,o),s}(Error),Bt=typeof window<"u"&&typeof(null===(st=window?.location)||void 0===st?void 0:st.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",Ht=function(){function o(s){void 0===s&&(s=Bt),this.endpoint=s}return Object.defineProperty(o.prototype,"auth",{get:function(){return this._auth||(this._auth=new _t(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),o.prototype.joinOrCreate=function(s,r,a){return void 0===r&&(r={}),z(this,void 0,void 0,function(){return j(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.create=function(s,r,a){return void 0===r&&(r={}),z(this,void 0,void 0,function(){return j(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("create",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.join=function(s,r,a){return void 0===r&&(r={}),z(this,void 0,void 0,function(){return j(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("join",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.joinById=function(s,r,a){return void 0===r&&(r={}),z(this,void 0,void 0,function(){return j(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,r,a)];case 1:return[2,c.sent()]}})})},o.prototype.reconnect=function(s,r,a){return z(this,void 0,void 0,function(){return j(this,function(c){switch(c.label){case 0:return[4,this.createMatchMakeRequest("joinById",s,{sessionId:r},a)];case 1:return[2,c.sent()]}})})},o.prototype.getAvailableRooms=function(s){return void 0===s&&(s=""),z(this,void 0,void 0,function(){var r;return j(this,function(a){switch(a.label){case 0:return r=this.endpoint.replace("ws","http")+"/matchmake/"+s,[4,me(r,{headers:{Accept:"application/json"}})];case 1:return[2,a.sent().data]}})})},o.prototype.consumeSeatReservation=function(s,r){return z(this,void 0,void 0,function(){var a;return j(this,function(c){return(a=this.createRoom(s.room.name,r)).id=s.room.roomId,a.sessionId=s.sessionId,a.connect(this.buildEndpoint(s.room,{sessionId:a.sessionId})),[2,new Promise(function(u,w){var v=function(p,l){return w(new Ze(p,l))};a.onError.once(v),a.onJoin.once(function(){a.onError.remove(v),u(a)})})]})})},o.prototype.createMatchMakeRequest=function(s,r,a,c){return void 0===a&&(a={}),z(this,void 0,void 0,function(){var u,w;return j(this,function(v){switch(v.label){case 0:return u=this.endpoint.replace("ws","http")+"/matchmake/"+s+"/"+r,this._auth&&this._auth.hasToken&&(a.token=this._auth.token),[4,le(u,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})];case 1:if((w=v.sent().data).error)throw new jt(w.error,w.code);return[2,this.consumeSeatReservation(w,c)]}})})},o.prototype.createRoom=function(s,r){return new ne(s,r)},o.prototype.buildEndpoint=function(s,r){void 0===r&&(r={});var a=[];for(var c in r)!r.hasOwnProperty(c)||a.push(c+"="+r[c]);return this.endpoint+"/"+s.processId+"/"+s.roomId+"?"+a.join("&")},o}(),xt=function(){function o(){}return o.prototype.setState=function(s){this.state.decode(s)},o.prototype.getState=function(){return this.state},o.prototype.patch=function(s){this.state.decode(s)},o.prototype.teardown=function(){var s,r;null===(r=null===(s=this.state)||void 0===s?void 0:s.$changes)||void 0===r||r.root.clearRefs()},o.prototype.handshake=function(s,r){this.state?(new R.Reflection).decode(s,r):this.state=R.Reflection.decode(s,r)},o}(),Jt=function(){function o(){}return o.prototype.setState=function(s){},o.prototype.getState=function(){return null},o.prototype.patch=function(s){},o.prototype.teardown=function(){},o.prototype.handshake=function(s){},o}();Se("schema",xt),Se("none",Jt),I.Auth=_t,I.Client=Ht,I.Room=ne,I.SchemaSerializer=xt,I.registerSerializer=Se,Object.defineProperty(I,"__esModule",{value:!0})}(Oe)}}]);