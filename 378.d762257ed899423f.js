(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{9429:(Bt,Te,A)=>{"use strict";A.r(Te),A.d(Te,{MinesweeperModule:()=>pt});var ne=A(5012),z=A(6895),P=A(5755),k=A(9386),ge=A(7579),Y=A(3900),Re=A(2076),a=A(4650),Se=A(3274);const he=["easy","medium","hard"];let ie=(()=>{class r extends class Ye{constructor(o,t,c={}){this.roomGame=o,this.auth=t,this.defaultGameOptions=c,this.stateChanges=new ge.x,this.roomMessages=new ge.x,this.client=new P.Client(`ws://${k.N.backend_url}`)}createRoom(o){return this.auth.user$.pipe((0,Y.w)(t=>(0,Re.D)(this.client.create(this.roomGame,{...this.defaultGameOptions,...o,player:t}).then(c=>{this.currentRoom&&this.currentRoom.leave(),this.currentRoom=c,this.currentRoom.onStateChange(f=>this.stateChanges.next(f)),this.currentRoom.onMessage("*",f=>this.roomMessages.next(f))}).catch(c=>{this.auth.loginWithRedirect()}))))}getAvailableRooms(){return(0,Re.D)(this.client.getAvailableRooms(this.roomGame))}}{constructor(t){super("MinesweeperRoom",t,{maxClients:2}),this.authService=t,this.gameConfig={easy:{bombs:10,size:8},medium:{bombs:40,size:16},hard:{bombs:120,size:30}}}}return r.\u0275fac=function(t){return new(t||r)(a.LFG(Se.e8))},r.\u0275prov=a.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class me extends Set{add(o){super.add(o.toString())}has(o){return super.has(o.toString())}}class De{constructor({include:o=!0,onlyInteger:t=!0}){this.includeLimits=o,this.onlyInteger=t}returnOutputNumber(o){return this.onlyInteger?Math.round(o):o}between(o,t){let c;return c=this.includeLimits?Math.floor(Math.random()*(t-o+1)+o):Math.floor(Math.random()*(t-o)+o),this.returnOutputNumber(c)}}class ve{constructor(o,t){this.row=o,this.column=t,this.bomb=!1,this.revealed=!1,this.nearBombs=0,this.flagged="no"}toggleFlaggedState(){this.flagged="no"!=this.flagged?"flag"===this.flagged?"question":"no":"flag"}}class re extends Array{constructor(o,t="player"){super(),this.status="playing",this.player=t;const c=o?.size;for(let f=0;f<c;f++){this[f]=[];for(let h=0;h<c;h++)this[f].push(new ve(f,h))}o&&this.generateBombs(o)}generateBombs(o){const t=new De({onlyInteger:!0}),c=new me;for(;c.size<o.bombs;){const f=t.between(0,o.size-1),h=t.between(0,o.size-1);c.has([f,h])||(c.add([f,h]),this[f][h].bomb=!0,this.getCellsArround(this[f][h]).forEach(m=>{m.nearBombs++}))}}getCellsArround(o){const t=[],c=o.row,f=o.column,h=(m,g)=>(this[m]&&this[m][g]&&t.push(this[m][g]),t);return h(c+1,f+1),h(c+1,f-1),h(c+1,f+0),h(c-1,f+1),h(c-1,f-1),h(c-1,f+0),h(c+0,f+1),h(c+0,f-1),t}reveal(o){if(o.bomb)return this.status="game over",void this.revealAllCells();o.revealed=!0,0===o.nearBombs&&this.getCellsArround(o).filter(t=>0==t.revealed).forEach(t=>this.reveal(t)),this.checkWinningCondition()}checkWinningCondition(){return"playing"!==this.status?"win"===this.status:0===this.flat(2).filter(c=>!(c.bomb||c.revealed)).length&&(this.status="win",!0)}revealAllCells(){this.forEach(o=>o.forEach(t=>t.revealed=!0))}toggleCellState(o){o.toggleFlaggedState(),this.checkWinningCondition()}getUsedFlags(){let o=0;return this.forEach(t=>t.forEach(c=>{o+="flag"===c.flagged?1:0})),o}}var ee=A(9119),X=A(433),_e=A(5593),Pe=A(5362);function te(r,o){1&r&&a._UZ(0,"img",7)}function Qe(r,o){if(1&r&&a._UZ(0,"span"),2&r){const t=a.oxw(2).$implicit;a.Gre("m-0 p-0 near-bombs-text near-",t.nearBombs,"")}}function Ke(r,o){if(1&r&&(a.ynx(0),a.YNc(1,te,1,0,"img",5),a.YNc(2,Qe,1,3,"span",6),a.BQk()),2&r){const t=a.oxw().$implicit;a.xp6(1),a.Q6J("ngIf",t.bomb),a.xp6(1),a.Q6J("ngIf",!t.bomb)}}function We(r,o){1&r&&a._UZ(0,"img",10)}function Xe(r,o){1&r&&a._UZ(0,"img",11)}function oe(r,o){if(1&r&&(a.ynx(0),a.YNc(1,We,1,0,"img",8),a.YNc(2,Xe,1,0,"img",9),a.BQk()),2&r){const t=a.oxw().$implicit;a.xp6(1),a.Q6J("ngIf","flag"==t.flagged),a.xp6(1),a.Q6J("ngIf","question"==t.flagged)}}function Ve(r,o){if(1&r){const t=a.EpF();a.TgZ(0,"div",3),a.NdJ("click",function(){const h=a.CHM(t).$implicit,m=a.oxw(2);return a.KtG(m.cellClicked.emit(h))})("contextmenu",function(f){const m=a.CHM(t).$implicit,g=a.oxw(2);return a.KtG(g.onRightClick(f,m))}),a.YNc(1,Ke,3,2,"ng-container",4),a.YNc(2,oe,3,2,"ng-container",4),a.qZA()}if(2&r){const t=o.$implicit,c=o.index,f=a.oxw().index;a.ekj("revealed",t.revealed)("empty",t.revealed&&0==t.nearBombs&&!t.bomb)("darker",(f%2+c)%2),a.xp6(1),a.Q6J("ngIf",t.revealed),a.xp6(1),a.Q6J("ngIf",0==t.revealed)}}function et(r,o){if(1&r&&(a.ynx(0),a.YNc(1,Ve,3,8,"div",2),a.BQk()),2&r){const t=o.$implicit;a.xp6(1),a.Q6J("ngForOf",t)}}function tt(r,o){1&r&&a._UZ(0,"img",12),2&r&&a.MGl("src","assets/minesweeper/",o.$implicit,".png",a.LSH)}const nt=function(){return["bomb","red_flag","question_mark"]};let ke=(()=>{class r{constructor(t){this.game=t,this.cellClicked=new a.vpe,this.cellRightClicked=new a.vpe,this.currentConfig=t.gameConfig.easy,this.matrix=new re(this.currentConfig)}ngOnInit(){}onRightClick(t,c){t.preventDefault(),this.cellRightClicked.emit(c)}}return r.\u0275fac=function(t){return new(t||r)(a.Y36(ie))},r.\u0275cmp=a.Xpm({type:r,selectors:[["minesweeper-game-matrix"]],inputs:{matrix:"matrix",currentConfig:"currentConfig"},outputs:{cellClicked:"cellClicked",cellRightClicked:"cellRightClicked"},decls:3,vars:8,consts:[[4,"ngFor","ngForOf"],["class","d-none",3,"src",4,"ngFor","ngForOf"],["class","matrix-cell",3,"revealed","empty","darker","click","contextmenu",4,"ngFor","ngForOf"],[1,"matrix-cell",3,"click","contextmenu"],[4,"ngIf"],["src","assets/minesweeper/bomb.png","class","h-90 cell-image animate__animated animate__bounceIn",4,"ngIf"],[3,"class",4,"ngIf"],["src","assets/minesweeper/bomb.png",1,"h-90","cell-image","animate__animated","animate__bounceIn"],["src","assets/minesweeper/red_flag.png","class","cell-image",4,"ngIf"],["src","assets/minesweeper/question_mark.png","class","cell-image h-75",4,"ngIf"],["src","assets/minesweeper/red_flag.png",1,"cell-image"],["src","assets/minesweeper/question_mark.png",1,"cell-image","h-75"],[1,"d-none",3,"src"]],template:function(t,c){1&t&&(a.TgZ(0,"div"),a.YNc(1,et,2,1,"ng-container",0),a.qZA(),a.YNc(2,tt,1,1,"img",1)),2&t&&(a.Gre("matrix-container matrix-sized-",c.currentConfig.size,""),a.Udp("grid-template-columns","repeat("+c.currentConfig.size+",calc(min(750px, 90vw) / "+c.currentConfig.size+"))"),a.xp6(1),a.Q6J("ngForOf",c.matrix),a.xp6(1),a.Q6J("ngForOf",a.DdM(7,nt)))},dependencies:[z.sg,z.O5],styles:['.matrix-container[_ngcontent-%COMP%]{display:grid;grid-gap:0px;font-size:13px;justify-content:center;font-weight:bolder}.matrix-container.matrix-sized-8[_ngcontent-%COMP%]{font-size:2rem}.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}@media (max-width: 992px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:7px}}@media (max-width: 768px){.matrix-container.matrix-sized-30[_ngcontent-%COMP%]{font-size:9px}}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;cursor:pointer;aspect-ratio:1;position:relative;border:1.5px solid;background-color:#cdd4de;border-top-color:#f5f6f8;border-right-color:#90949b;border-bottom-color:#7b7f85;border-left-color:#f0f2f5}.matrix-container[_ngcontent-%COMP%]   .matrix-cell[_ngcontent-%COMP%]:hover{background-color:currentColor}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.revealed[_ngcontent-%COMP%]{background-color:#c9d0da;border-top:1.5px solid #b9bfc8;border-right:1.5px solid #b9bfc8;border-bottom:1.5px solid #b9bfc8;border-left:1.5px solid #b9bfc8;border-radius:0;filter:brightness(.92)}.matrix-container[_ngcontent-%COMP%]   .matrix-cell.darker[_ngcontent-%COMP%]{filter:brightness(.96)}.cell-image[_ngcontent-%COMP%]{position:absolute;object-fit:scale-down;width:100%;transform:translateY(-2px)}.near-bombs-text.near-1[_ngcontent-%COMP%]{color:#00f}.near-bombs-text.near-1[_ngcontent-%COMP%]:after{content:"1"}.near-bombs-text.near-2[_ngcontent-%COMP%]{color:green}.near-bombs-text.near-2[_ngcontent-%COMP%]:after{content:"2"}.near-bombs-text.near-3[_ngcontent-%COMP%]{color:red}.near-bombs-text.near-3[_ngcontent-%COMP%]:after{content:"3"}.near-bombs-text.near-4[_ngcontent-%COMP%]{color:#00008b}.near-bombs-text.near-4[_ngcontent-%COMP%]:after{content:"4"}.near-bombs-text.near-5[_ngcontent-%COMP%]{color:#8b0000}.near-bombs-text.near-5[_ngcontent-%COMP%]:after{content:"5"}.near-bombs-text.near-6[_ngcontent-%COMP%]{color:teal}.near-bombs-text.near-6[_ngcontent-%COMP%]:after{content:"6"}.near-bombs-text.near-7[_ngcontent-%COMP%]{color:#000}.near-bombs-text.near-7[_ngcontent-%COMP%]:after{content:"7"}.near-bombs-text.near-8[_ngcontent-%COMP%]{color:gray}.near-bombs-text.near-8[_ngcontent-%COMP%]:after{content:"8"}']}),r})();function Ne(r,o){1&r&&(a.TgZ(0,"div",13)(1,"h1",14),a._uU(2,"You win!"),a.qZA()())}function ye(r,o){1&r&&(a.TgZ(0,"div",13)(1,"h1",15),a._uU(2,"You Loose!"),a.qZA()())}let Ue=(()=>{class r{constructor(t,c,f){this.game=t,this.route=c,this.router=f,this.allDifficulties=[...he],this.usedFlags=0,this.selectedDifficulty="easy",this.nextDifficulty=this.selectedDifficulty,this.gameConfig=this.game.gameConfig.easy,this.matrix=new re(this.gameConfig)}ngOnInit(){this.route.params.subscribe(t=>{he.includes(t.difficulty)?this.initializeGame(t.difficulty):this.initializeGame(he[1])})}initializeGame(t){t!=this.selectedDifficulty&&this.router.navigate(["minesweeper","offline",t]),this.selectedDifficulty=t,this.nextDifficulty=t,this.gameConfig=this.game.gameConfig[t],this.matrix=new re(this.gameConfig)}onCellClicked(t){this.matrix.reveal(t)}onCellRightClicked(t){this.matrix.toggleCellState(t),this.usedFlags=this.matrix.getUsedFlags()}}return r.\u0275fac=function(t){return new(t||r)(a.Y36(ie),a.Y36(ee.gz),a.Y36(ee.F0))},r.\u0275cmp=a.Xpm({type:r,selectors:[["app-offline"]],decls:22,vars:18,consts:[[1,"offline-game-container","py-4","w-100"],[1,"game",3,"matrix","currentConfig","cellClicked","cellRightClicked"],[1,"side-panel"],[1,"flags-used","d-flex","mx-2"],["src","assets/minesweeper/red_flag.png","alt","flags-used","width","30px","height","30px"],[1,"mx-2"],[1,"d-flex"],[3,"options","ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Restart",1,"p-button","ml-2",3,"click"],[1,"mt-1","animate__animated","animate__faster",2,"color","var(--yellow)"],[3,"ngSwitch"],[1,""],["class","animate__animated animate__bounceIn",4,"ngSwitchCase"],[1,"animate__animated","animate__bounceIn"],[2,"color","var(--green)"],[2,"color","var(--red)"]],template:function(t,c){1&t&&(a.TgZ(0,"div",0)(1,"minesweeper-game-matrix",1),a.NdJ("cellClicked",function(h){return c.onCellClicked(h)})("cellRightClicked",function(h){return c.onCellRightClicked(h)}),a.qZA(),a.TgZ(2,"div",2)(3,"div",3),a._UZ(4,"img",4),a.TgZ(5,"h3"),a._uU(6),a.qZA()(),a.TgZ(7,"h3",5),a._uU(8," Difficulty: "),a.TgZ(9,"span"),a._uU(10),a.ALo(11,"titlecase"),a.qZA()(),a.TgZ(12,"div",5)(13,"div",6)(14,"p-selectButton",7),a.NdJ("ngModelChange",function(h){return c.nextDifficulty=h}),a.qZA(),a.TgZ(15,"button",8),a.NdJ("click",function(){return c.initializeGame(c.nextDifficulty)}),a.qZA()(),a.TgZ(16,"div",9),a._uU(17," Click restart to change difficulty "),a.qZA()(),a.ynx(18,10),a.TgZ(19,"div",11),a.YNc(20,Ne,3,0,"div",12),a.YNc(21,ye,3,0,"div",12),a.qZA(),a.BQk(),a.qZA()()),2&t&&(a.xp6(1),a.Q6J("matrix",c.matrix)("currentConfig",c.gameConfig),a.xp6(5),a.hij(": ",c.gameConfig.bombs-c.usedFlags,""),a.xp6(3),a.Gre("difficulty-color-",c.selectedDifficulty,""),a.xp6(1),a.Oqu(a.lcZ(11,16,c.selectedDifficulty)),a.xp6(4),a.Q6J("options",c.allDifficulties)("ngModel",c.nextDifficulty),a.xp6(2),a.ekj("animate__fadeIn",c.nextDifficulty!==c.selectedDifficulty)("animate__fadeOut",c.nextDifficulty==c.selectedDifficulty),a.xp6(2),a.Q6J("ngSwitch",c.matrix.status),a.xp6(2),a.Q6J("ngSwitchCase","win"),a.xp6(1),a.Q6J("ngSwitchCase","game over"))},dependencies:[z.RF,z.n9,X.JJ,X.On,_e.Hq,Pe.UN,ke,z.rS],styles:[".offline-game-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:center}.side-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding-left:50px;min-width:350px;flex-grow:0}@media (max-width: 1200px){.side-panel[_ngcontent-%COMP%]{flex-direction:row;min-width:none;justify-content:space-evenly;align-items:center;flex-wrap:wrap;padding:0;width:100%}}"]}),r})();var it=A(4247),rt=A(8625);function ot(r,o){1&r&&a.GkF(0)}function st(r,o){1&r&&a.GkF(0)}function le(r,o){if(1&r){const t=a.EpF();a.TgZ(0,"div",5)(1,"minesweeper-game-matrix",6),a.NdJ("cellClicked",function(f){const m=a.CHM(t).matrix;return a.KtG(m.reveal(f))}),a.qZA()()}if(2&r){const t=o.matrix,c=a.oxw();a.xp6(1),a.Q6J("matrix",t)("currentConfig",c.currentConfig)}}function at(r,o){1&r&&(a._uU(0),a.ALo(1,"titlecase")),2&r&&a.hij(" ",a.lcZ(1,1,o.$implicit)," ")}function ct(r,o){if(1&r){const t=a.EpF();a.TgZ(0,"div",18)(1,"p-password",19),a.NdJ("ngModelChange",function(f){a.CHM(t);const h=a.oxw(2);return a.KtG(h.roomPassword=f)}),a.qZA()()}if(2&r){const t=a.oxw(2);a.xp6(1),a.Q6J("ngModel",t.roomPassword)("feedback",!1)("toggleMask",!0)}}const K=function(){return["Multiplayer","Offline"]};function Fe(r,o){if(1&r){const t=a.EpF();a.TgZ(0,"div",7)(1,"div",8)(2,"p-selectButton",9),a.NdJ("ngModelChange",function(f){a.CHM(t);const h=a.oxw();return a.KtG(h.selectedDifficulty=f)})("onChange",function(){a.CHM(t);const f=a.oxw();return a.KtG(f.difficultyChange())}),a.YNc(3,at,2,3,"ng-template"),a.qZA()(),a.TgZ(4,"div",10)(5,"div",11)(6,"h3",12),a._uU(7," Configuration: "),a.TgZ(8,"span",13),a._uU(9),a.ALo(10,"titlecase"),a.qZA()()(),a.TgZ(11,"p-card")(12,"ul")(13,"li")(14,"h4"),a._uU(15," Size: "),a.TgZ(16,"span"),a._uU(17),a.qZA()()(),a.TgZ(18,"li")(19,"h4"),a._uU(20," Cells: "),a.TgZ(21,"span"),a._uU(22),a.qZA()()(),a.TgZ(23,"li")(24,"h4"),a._uU(25," Bombs: "),a.TgZ(26,"span"),a._uU(27),a.qZA()()()(),a.TgZ(28,"div",14)(29,"p-selectButton",15),a.NdJ("ngModelChange",function(f){a.CHM(t);const h=a.oxw();return a.KtG(h.networkGamemode=f)}),a.qZA()(),a.YNc(30,ct,2,3,"div",16),a.qZA(),a.TgZ(31,"div",8)(32,"button",17),a.NdJ("click",function(){a.CHM(t);const f=a.oxw();return a.KtG(f.onPlayButton())}),a.qZA()()()()}if(2&r){const t=a.oxw();a.xp6(2),a.Q6J("options",t.difficultyOptions)("ngModel",t.selectedDifficulty),a.xp6(7),a.Oqu(a.lcZ(10,19,t.selectedDifficulty)),a.xp6(7),a.Gre("difficulty-color-",t.selectedDifficulty,""),a.xp6(1),a.AsE("",t.currentConfig.size," x ",t.currentConfig.size,""),a.xp6(4),a.Gre("difficulty-color-",t.selectedDifficulty,""),a.xp6(1),a.Oqu(t.currentConfig.size*t.currentConfig.size),a.xp6(4),a.Gre("difficulty-color-",t.selectedDifficulty,""),a.xp6(1),a.Oqu(t.currentConfig.bombs),a.xp6(2),a.Q6J("options",a.DdM(21,K))("ngModel",t.networkGamemode),a.xp6(1),a.Q6J("ngIf","Multiplayer"==t.networkGamemode)}}const xe=function(r){return{matrix:r}};let we=(()=>{class r{constructor(t,c){this.game=t,this.router=c,this.selectedDifficulty="easy",this.difficultyOptions=[...he],this.networkGamemode="Offline",this.roomPassword="",this.initializeMatrices()}ngOnInit(){}initializeMatrices(){this.currentConfig=this.game.gameConfig[this.selectedDifficulty],this.userMatrix=new re(this.currentConfig),this.userMatrix.forEach(t=>t.forEach(c=>{c.bomb&&(c.revealed=!0)}))}difficultyChange(){console.log(this.selectedDifficulty),this.initializeMatrices()}onPlayButton(){"Offline"==this.networkGamemode?this.router.navigate(["minesweeper","offline",this.selectedDifficulty]):this.game.createRoom({password:this.roomPassword}).subscribe(t=>{console.log(t)})}}return r.\u0275fac=function(t){return new(t||r)(a.Y36(ie),a.Y36(ee.F0))},r.\u0275cmp=a.Xpm({type:r,selectors:[["app-difficulty-selector"]],decls:7,vars:5,consts:[[1,"main-double-board","py-5"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"],["matrixTemplate",""],["optionMenuTemplate",""],[1,"matrix-container"],[3,"matrix","currentConfig","cellClicked"],[1,"option-menu-container"],[1,"d-flex","justify-content-center","my-4"],["styleClass","mt-3",3,"options","ngModel","ngModelChange","onChange"],[1,"config-manager"],[1,"options-card-header","my-0","mx-3","p-2"],[1,"text-center"],[1,"text-colored"],[1,"d-flex","justify-content-center"],[3,"options","ngModel","ngModelChange"],["class","d-flex",4,"ngIf"],["pButton","","type","button","icon","pi pi-check","iconPos","left","label","Play!",1,"p-button-lg",3,"click"],[1,"d-flex"],["placeholder","Password for private rooms only","styleClass","password-room-creation w-100",1,"w-100","mt-3","animate__animated","animate__bounceIn","animate__faster",3,"ngModel","feedback","toggleMask","ngModelChange"]],template:function(t,c){if(1&t&&(a.TgZ(0,"div",0),a.YNc(1,ot,1,0,"ng-container",1),a.YNc(2,st,1,0,"ng-container",2),a.qZA(),a.YNc(3,le,2,2,"ng-template",null,3,a.W1O),a.YNc(5,Fe,33,22,"ng-template",null,4,a.W1O)),2&t){const f=a.MAs(4),h=a.MAs(6);a.xp6(1),a.Q6J("ngTemplateOutlet",f)("ngTemplateOutletContext",a.VKq(3,xe,c.userMatrix)),a.xp6(1),a.Q6J("ngTemplateOutlet",h)}},dependencies:[z.O5,z.tP,X.JJ,X.On,_e.Hq,it.Z,rt.ro,Pe.UN,ke,z.rS],styles:[".main-double-board[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;flex-wrap:wrap-reverse}.options-card-header[_ngcontent-%COMP%]{transform:translateY(30px);background-color:var(--surface-section);width:-moz-fit-content;width:fit-content;border:1px solid var(--surface-border);border-radius:var(--border-radius)}.matrix-container[_ngcontent-%COMP%]{min-width:700px;margin-right:50px}.option-menu-container[_ngcontent-%COMP%]{min-width:500px}@media (max-width: 768px){.matrix-container[_ngcontent-%COMP%]{min-width:100%;margin-right:0}.option-menu-container[_ngcontent-%COMP%]{min-width:100%}}[_nghost-%COMP%]     .password-room-creation{width:100%}[_nghost-%COMP%]     .password-room-creation input{width:100%}"]}),r})();var ft=A(805),ut=A(5722);function ht(r,o){if(1&r&&(a.TgZ(0,"div",11)(1,"p",11),a._uU(2),a.ALo(3,"titlecase"),a.qZA()()),2&r){const t=o.$implicit,c=o.index,f=a.oxw(2);a.xp6(2),a.AsE(" ",a.lcZ(3,2,t.difficulty),"",c==f.selectedDificulties.length-1?".":", "," ")}}function Ce(r,o){1&r&&(a.TgZ(0,"div"),a._uU(1," Select a difficulty. "),a.qZA())}function Le(r,o){if(1&r&&(a.YNc(0,ht,4,4,"div",9),a.YNc(1,Ce,2,0,"div",10)),2&r){const t=a.oxw();a.Q6J("ngForOf",t.selectedDificulties),a.xp6(1),a.Q6J("ngIf",0===t.selectedDificulties.length)}}function Ae(r,o){1&r&&(a._uU(0),a.ALo(1,"titlecase")),2&r&&a.hij(" ",a.lcZ(1,1,o.$implicit.difficulty)," ")}function lt(r,o){if(1&r&&(a.TgZ(0,"li"),a._uU(1),a.ALo(2,"json"),a.qZA()),2&r){const t=o.$implicit;a.xp6(1),a.hij(" ",a.lcZ(2,1,t)," ")}}const dt=[{path:"",children:[{path:"",component:(()=>{class r{constructor(t,c){this.auth=t,this.game=c,this.sortMenuItems=[{label:"File",items:[{label:"New",icon:"pi pi-fw pi-plus"},{label:"Download",icon:"pi pi-fw pi-download"}]},{label:"Edit",items:[{label:"Add User",icon:"pi pi-fw pi-user-plus"},{label:"Remove User",icon:"pi pi-fw pi-user-minus"}]}],this.dificulties=[],this.selectedDificulties=[],this.filteredRooms=[],this.loading=!0,this.dificulties=Object.entries(this.game.gameConfig).map(([f,h])=>({difficulty:f,config:h})),this.selectedDificulties=this.dificulties}ngOnInit(){this.getRooms()}getRooms(){this.game.getAvailableRooms().subscribe(t=>{this.filteredRooms=t,this.loading=!1})}onDifficultyChange(){console.log("difficulties",this.selectedDificulties)}}return r.\u0275fac=function(t){return new(t||r)(a.Y36(Se.e8),a.Y36(ie))},r.\u0275cmp=a.Xpm({type:r,selectors:[["app-lobby"]],decls:13,vars:6,consts:[[1,"d-flex","align-items-center","flex-wrap","py-2",2,"background-color","var(--primary)"],["src","assets/minesweeper/bomb.png","alt","minesweeper bomb","height","45px",1,"ml-2"],[1,"m-1"],["optionLabel","difficulty","placeholder","Select a difficulty.",3,"ngModel","options","maxSelectedLabels","filter","showHeader","onChange","ngModelChange"],["pTemplate","selectedItems"],["pTemplate","item"],["pButton","","type","button","icon","pi pi-refresh","iconPos","left","label","Refresh",1,"p-button-warning",3,"click"],["pButton","","type","button",1,"p-button-raised","p-button-primary"],[4,"ngFor","ngForOf"],["class","d-inline",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-inline"]],template:function(t,c){1&t&&(a.TgZ(0,"div",0),a._UZ(1,"img",1),a.TgZ(2,"div",2)(3,"p-multiSelect",3),a.NdJ("onChange",function(){return c.onDifficultyChange()})("ngModelChange",function(h){return c.selectedDificulties=h}),a.YNc(4,Le,2,2,"ng-template",4),a.YNc(5,Ae,2,3,"ng-template",5),a.qZA()(),a.TgZ(6,"div",2)(7,"button",6),a.NdJ("click",function(){return c.getRooms()}),a.qZA()(),a.TgZ(8,"div",2)(9,"button",7),a._uU(10," Create room "),a.qZA()()(),a.TgZ(11,"ul"),a.YNc(12,lt,3,3,"li",8),a.qZA()),2&t&&(a.xp6(3),a.Q6J("ngModel",c.selectedDificulties)("options",c.dificulties)("maxSelectedLabels",0)("filter",!1)("showHeader",!1),a.xp6(9),a.Q6J("ngForOf",c.filteredRooms))},dependencies:[z.sg,z.O5,X.JJ,X.On,_e.Hq,ft.jx,ut.NU,z.Ts,z.rS]}),r})()},{path:"create",component:we},{path:"offline/:difficulty",component:Ue},{path:"offline",redirectTo:"offline/medium"}]}];let ze=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=a.oAB({type:r}),r.\u0275inj=a.cJS({imports:[ee.Bz.forChild(dt),ee.Bz]}),r})(),pt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=a.oAB({type:r}),r.\u0275inj=a.cJS({imports:[z.ez,ze,ne.m]}),r})()},5755:function(Bt,Te){!function(A){"use strict";ArrayBuffer.isView||(ArrayBuffer.isView=function(r){return null!==r&&"object"==typeof r&&r.buffer instanceof ArrayBuffer}),typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var ne=function(r,o){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,c){t.__proto__=c}||function(t,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(t[f]=c[f])})(r,o)};function z(r,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function t(){this.constructor=r}ne(r,o),r.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}function P(r,o,t,c){return new(t||(t=Promise))(function(h,m){function g(T){try{d(c.next(T))}catch(D){m(D)}}function p(T){try{d(c.throw(T))}catch(D){m(D)}}function d(T){T.done?h(T.value):function f(h){return h instanceof t?h:new t(function(m){m(h)})}(T.value).then(g,p)}d((c=c.apply(r,o||[])).next())})}function k(r,o){var c,f,h,m,t={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return m={next:g(0),throw:g(1),return:g(2)},"function"==typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m;function g(d){return function(T){return function p(d){if(c)throw new TypeError("Generator is already executing.");for(;t;)try{if(c=1,f&&(h=2&d[0]?f.return:d[0]?f.throw||((h=f.return)&&h.call(f),0):f.next)&&!(h=h.call(f,d[1])).done)return h;switch(f=0,h&&(d=[2&d[0],h.value]),d[0]){case 0:case 1:h=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,f=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(!(h=(h=t.trys).length>0&&h[h.length-1])&&(6===d[0]||2===d[0])){t=0;continue}if(3===d[0]&&(!h||d[1]>h[0]&&d[1]<h[3])){t.label=d[1];break}if(6===d[0]&&t.label<h[1]){t.label=h[1],h=d;break}if(h&&t.label<h[2]){t.label=h[2],t.ops.push(d);break}h[2]&&t.ops.pop(),t.trys.pop();continue}d=o.call(r,t)}catch(T){d=[6,T],f=0}finally{c=h=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,T])}}}function ge(r,o){o.headers=r.headers||{},o.statusMessage=r.statusText,o.statusCode=r.status,o.data=r.response}function Y(r,o,t){return new Promise(function(c,f){t=t||{};var m,g,p,h=new XMLHttpRequest,d=t.body,T=t.headers||{};for(m in t.timeout&&(h.timeout=t.timeout),h.ontimeout=h.onerror=function(D){D.timeout="timeout"==D.type,f(D)},h.open(r,o.href||o),h.onload=function(){for(p=h.getAllResponseHeaders().trim().split(/[\r\n]+/),ge(h,h);g=p.shift();)g=g.split(": "),h.headers[g.shift().toLowerCase()]=g.join(": ");if((g=h.headers["content-type"])&&~g.indexOf("application/json"))try{h.data=JSON.parse(h.data,t.reviver)}catch(D){return ge(h,D),f(D)}(h.status>=400?f:c)(h)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(T["content-type"]="application/json",d=JSON.stringify(d)),h.withCredentials=!!t.withCredentials,T)h.setRequestHeader(m,T[m]);h.send(d)})}var Re=Y.bind(Y,"GET"),Ye=Y.bind(Y,"POST"),a=Y.bind(Y,"PATCH"),ie=Y.bind(Y,"DELETE"),me=Re,De=a,ve=Ye,re=Y.bind(Y,"PUT"),ee=Y,X={del:ie,get:me,patch:De,post:ve,put:re,send:ee},_e=Object.freeze(Object.assign(Object.create(null),X,{default:X,del:ie,get:me,patch:De,post:ve,put:re,send:ee})),Pe=function(r){function o(t,c){var f=r.call(this,c)||this;return f.name="ServerError",f.code=t,f}return z(o,r),o}(Error);function te(r,o){if(this._offset=o,r instanceof ArrayBuffer)this._buffer=r,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(r))throw new Error("Invalid argument");this._buffer=r.buffer,this._view=new DataView(this._buffer,r.byteOffset,r.byteLength)}}function We(r,o,t){for(var c=0,f=0,h=t.length;f<h;f++)(c=t.charCodeAt(f))<128?r.setUint8(o++,c):c<2048?(r.setUint8(o++,192|c>>6),r.setUint8(o++,128|63&c)):c<55296||c>=57344?(r.setUint8(o++,224|c>>12),r.setUint8(o++,128|c>>6&63),r.setUint8(o++,128|63&c)):(f++,c=65536+((1023&c)<<10|1023&t.charCodeAt(f)),r.setUint8(o++,240|c>>18),r.setUint8(o++,128|c>>12&63),r.setUint8(o++,128|c>>6&63),r.setUint8(o++,128|63&c))}function oe(r,o,t){var c=typeof t,f=0,h=0,m=0,g=0,p=0,d=0;if("string"===c){if((p=function Xe(r){for(var o=0,t=0,c=0,f=r.length;c<f;c++)(o=r.charCodeAt(c))<128?t+=1:o<2048?t+=2:o<55296||o>=57344?t+=3:(c++,t+=4);return t}(t))<32)r.push(160|p),d=1;else if(p<256)r.push(217,p),d=2;else if(p<65536)r.push(218,p>>8,p),d=3;else{if(!(p<4294967296))throw new Error("String too long");r.push(219,p>>24,p>>16,p>>8,p),d=5}return o.push({_str:t,_length:p,_offset:r.length}),d+p}if("number"===c)return Math.floor(t)===t&&isFinite(t)?t>=0?t<128?(r.push(t),1):t<256?(r.push(204,t),2):t<65536?(r.push(205,t>>8,t),3):t<4294967296?(r.push(206,t>>24,t>>16,t>>8,t),5):(m=t/Math.pow(2,32)>>0,r.push(207,m>>24,m>>16,m>>8,m,(g=t>>>0)>>24,g>>16,g>>8,g),9):t>=-32?(r.push(t),1):t>=-128?(r.push(208,t),2):t>=-32768?(r.push(209,t>>8,t),3):t>=-2147483648?(r.push(210,t>>24,t>>16,t>>8,t),5):(m=Math.floor(t/Math.pow(2,32)),r.push(211,m>>24,m>>16,m>>8,m,(g=t>>>0)>>24,g>>16,g>>8,g),9):(r.push(203),o.push({_float:t,_length:8,_offset:r.length}),9);if("object"===c){if(null===t)return r.push(192),1;if(Array.isArray(t)){if((p=t.length)<16)r.push(144|p),d=1;else if(p<65536)r.push(220,p>>8,p),d=3;else{if(!(p<4294967296))throw new Error("Array too large");r.push(221,p>>24,p>>16,p>>8,p),d=5}for(f=0;f<p;f++)d+=oe(r,o,t[f]);return d}if(t instanceof Date){var T=t.getTime();return m=Math.floor(T/Math.pow(2,32)),r.push(215,0,m>>24,m>>16,m>>8,m,(g=T>>>0)>>24,g>>16,g>>8,g),10}if(t instanceof ArrayBuffer){if((p=t.byteLength)<256)r.push(196,p),d=2;else if(p<65536)r.push(197,p>>8,p),d=3;else{if(!(p<4294967296))throw new Error("Buffer too large");r.push(198,p>>24,p>>16,p>>8,p),d=5}return o.push({_bin:t,_length:p,_offset:r.length}),d+p}if("function"==typeof t.toJSON)return oe(r,o,t.toJSON());var D=[],N="",H=Object.keys(t);for(f=0,h=H.length;f<h;f++)"function"!=typeof t[N=H[f]]&&D.push(N);if((p=D.length)<16)r.push(128|p),d=1;else if(p<65536)r.push(222,p>>8,p),d=3;else{if(!(p<4294967296))throw new Error("Object too large");r.push(223,p>>24,p>>16,p>>8,p),d=5}for(f=0;f<p;f++)d+=oe(r,o,N=D[f]),d+=oe(r,o,t[N]);return d}if("boolean"===c)return r.push(t?195:194),1;if("undefined"===c)return r.push(212,0,0),3;throw new Error("Could not encode")}function Ve(r){var o=[],t=[],c=oe(o,t,r),f=new ArrayBuffer(c),h=new DataView(f),m=0,g=0,p=-1;t.length>0&&(p=t[0]._offset);for(var d,T=0,D=0,N=0,H=o.length;N<H;N++)if(h.setUint8(g+N,o[N]),N+1===p){if(T=(d=t[m])._length,D=g+p,d._bin)for(var je=new Uint8Array(d._bin),J=0;J<T;J++)h.setUint8(D+J,je[J]);else d._str?We(h,D,d._str):void 0!==d._float&&h.setFloat64(D,d._float);g+=T,t[++m]&&(p=t[m]._offset)}return f}te.prototype._array=function(r){for(var o=new Array(r),t=0;t<r;t++)o[t]=this._parse();return o},te.prototype._map=function(r){for(var t={},c=0;c<r;c++)t[this._parse()]=this._parse();return t},te.prototype._str=function(r){var o=function Qe(r,o,t){for(var c="",f=0,h=o,m=o+t;h<m;h++){var g=r.getUint8(h);if(0!=(128&g))if(192!=(224&g))if(224!=(240&g)){if(240!=(248&g))throw new Error("Invalid byte "+g.toString(16));(f=(7&g)<<18|(63&r.getUint8(++h))<<12|(63&r.getUint8(++h))<<6|(63&r.getUint8(++h))<<0)>=65536?(f-=65536,c+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):c+=String.fromCharCode(f)}else c+=String.fromCharCode((15&g)<<12|(63&r.getUint8(++h))<<6|(63&r.getUint8(++h))<<0);else c+=String.fromCharCode((31&g)<<6|63&r.getUint8(++h));else c+=String.fromCharCode(g)}return c}(this._view,this._offset,r);return this._offset+=r,o},te.prototype._bin=function(r){var o=this._buffer.slice(this._offset,this._offset+r);return this._offset+=r,o},te.prototype._parse=function(){var o,r=this._view.getUint8(this._offset++),t=0,c=0,f=0,h=0;if(r<192)return r<128?r:r<144?this._map(15&r):r<160?this._array(15&r):this._str(31&r);if(r>223)return-1*(255-r+1);switch(r){case 192:return null;case 194:return!1;case 195:return!0;case 196:return t=this._view.getUint8(this._offset),this._offset+=1,this._bin(t);case 197:return t=this._view.getUint16(this._offset),this._offset+=2,this._bin(t);case 198:return t=this._view.getUint32(this._offset),this._offset+=4,this._bin(t);case 199:return t=this._view.getUint8(this._offset),c=this._view.getInt8(this._offset+1),this._offset+=2,[c,this._bin(t)];case 200:return t=this._view.getUint16(this._offset),c=this._view.getInt8(this._offset+2),this._offset+=3,[c,this._bin(t)];case 201:return t=this._view.getUint32(this._offset),c=this._view.getInt8(this._offset+4),this._offset+=5,[c,this._bin(t)];case 202:return o=this._view.getFloat32(this._offset),this._offset+=4,o;case 203:return o=this._view.getFloat64(this._offset),this._offset+=8,o;case 204:return o=this._view.getUint8(this._offset),this._offset+=1,o;case 205:return o=this._view.getUint16(this._offset),this._offset+=2,o;case 206:return o=this._view.getUint32(this._offset),this._offset+=4,o;case 207:return f=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,f+h;case 208:return o=this._view.getInt8(this._offset),this._offset+=1,o;case 209:return o=this._view.getInt16(this._offset),this._offset+=2,o;case 210:return o=this._view.getInt32(this._offset),this._offset+=4,o;case 211:return f=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,f+h;case 212:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?void(this._offset+=1):[c,this._bin(1)];case 213:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(2)];case 214:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(4)];case 215:return c=this._view.getInt8(this._offset),this._offset+=1,0===c?(f=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(f+h)):[c,this._bin(8)];case 216:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(16)];case 217:return t=this._view.getUint8(this._offset),this._offset+=1,this._str(t);case 218:return t=this._view.getUint16(this._offset),this._offset+=2,this._str(t);case 219:return t=this._view.getUint32(this._offset),this._offset+=4,this._str(t);case 220:return t=this._view.getUint16(this._offset),this._offset+=2,this._array(t);case 221:return t=this._view.getUint32(this._offset),this._offset+=4,this._array(t);case 222:return t=this._view.getUint16(this._offset),this._offset+=2,this._map(t);case 223:return t=this._view.getUint32(this._offset),this._offset+=4,this._map(t)}throw new Error("Could not parse")};var r,tt=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},nt=function(){function r(o){this.events=o}return r.prototype.send=function(o){o instanceof ArrayBuffer?this.ws.send(o):Array.isArray(o)&&this.ws.send(new Uint8Array(o).buffer)},r.prototype.connect=function(o){this.ws=new tt(o,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},r.prototype.close=function(o,t){this.ws.close(o,t)},r}(),ke=function(){function r(){this.events={},this.transport=new nt(this.events)}return r.prototype.send=function(o){this.transport.send(o)},r.prototype.connect=function(o){this.transport.connect(o)},r.prototype.close=function(o,t){this.transport.close(o,t)},r}(),Ne={};function ye(r,o){Ne[r]=o}function Ue(r){var o=Ne[r];if(!o)throw new Error("missing serializer: "+r);return o}A.Protocol=void 0,(r=A.Protocol||(A.Protocol={}))[r.HANDSHAKE=9]="HANDSHAKE",r[r.JOIN_ROOM=10]="JOIN_ROOM",r[r.ERROR=11]="ERROR",r[r.LEAVE_ROOM=12]="LEAVE_ROOM",r[r.ROOM_DATA=13]="ROOM_DATA",r[r.ROOM_STATE=14]="ROOM_STATE",r[r.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",r[r.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",A.ErrorCode=void 0,function(r){r[r.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",r[r.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",r[r.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",r[r.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",r[r.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",r[r.AUTH_FAILED=4215]="AUTH_FAILED",r[r.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(A.ErrorCode||(A.ErrorCode={}));let ot=()=>({events:{},emit(r,...o){(this.events[r]||[]).forEach(t=>t(...o))},on(r,o){return(this.events[r]=this.events[r]||[]).push(o),()=>this.events[r]=(this.events[r]||[]).filter(t=>t!==o)}});var st=function(){function r(){this.handlers=[]}return r.prototype.register=function(o,t){return this.handlers.push(o),this},r.prototype.invoke=function(){for(var o=this,t=[],c=0;c<arguments.length;c++)t[c]=arguments[c];this.handlers.forEach(function(f){return f.apply(o,t)})},r.prototype.invokeAsync=function(){for(var o=this,t=[],c=0;c<arguments.length;c++)t[c]=arguments[c];return Promise.all(this.handlers.map(function(f){return f.apply(o,t)}))},r.prototype.remove=function(o){var t=this.handlers.indexOf(o);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},r.prototype.clear=function(){this.handlers=[]},r}();function le(){var r=new st;function o(t){return r.register(t,null===this)}return o.once=function(t){var c=function(){for(var f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];t.apply(this,f),r.remove(c)};r.register(c)},o.remove=function(t){return r.remove(t)},o.invoke=function(){for(var t=[],c=0;c<arguments.length;c++)t[c]=arguments[c];return r.invoke.apply(r,t)},o.invokeAsync=function(){for(var t=[],c=0;c<arguments.length;c++)t[c]=arguments[c];return r.invokeAsync.apply(r,t)},o.clear=function(){return r.clear()},o}typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"&&self;var xe,K=function ct(r){var o={exports:{}};return r(o,o.exports),o.exports}(function(r,o){var c;c=function(t){var c=function(n,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(i[u]=s[u])})(n,e)};function f(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=n}c(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function h(n,e,i,s){var x,u=arguments.length,l=u<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(n,e,i,s);else for(var v=n.length-1;v>=0;v--)(x=n[v])&&(l=(u<3?x(l):u>3?x(e,i,l):x(e,i))||l);return u>3&&l&&Object.defineProperty(e,i,l),l}function m(n,e){for(var i=0,s=e.length,u=n.length;i<s;i++,u++)n[u]=e[i];return n}var n,g=255;t.OPERATION=void 0,(n=t.OPERATION||(t.OPERATION={}))[n.ADD=128]="ADD",n[n.REPLACE=0]="REPLACE",n[n.DELETE=64]="DELETE",n[n.DELETE_AND_ADD=192]="DELETE_AND_ADD",n[n.TOUCH=1]="TOUCH",n[n.CLEAR=10]="CLEAR";var d=function(){function n(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return n.prototype.getNextUniqueId=function(){return this.nextUniqueId++},n.prototype.addRef=function(e,i,s){void 0===s&&(s=!0),this.refs.set(e,i),s&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},n.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},n.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},n.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(i){if(e.refCounts[i]<=0){var s=e.refs.get(i);if(s instanceof j)for(var u in s._definition.schema)"string"!=typeof s._definition.schema[u]&&s[u]&&s[u].$changes&&e.removeRef(s[u].$changes.refId);else{var l=s.$changes.parent._definition;"function"==typeof Object.values(l.schema[l.fieldsByIndex[s.$changes.parentIndex]])[0]&&Array.from(s.values()).forEach(function(v){return e.removeRef(v.$changes.refId)})}e.refs.delete(i),delete e.refCounts[i]}}),this.deletedRefs.clear()},n}(),T=function(){function n(e,i,s){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(i,s)}return n.prototype.setParent=function(e,i,s){var u=this;if(this.indexes||(this.indexes=this.ref instanceof j?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=s,i)if(this.root=i,this.ref instanceof j){var l=this.ref._definition;for(var x in l.schema){var v=this.ref[x];v&&v.$changes&&v.$changes.setParent(this.ref,i,l.indexes[x])}}else"object"==typeof this.ref&&this.ref.forEach(function(O,_){O instanceof j&&O.$changes.setParent(u.ref,u.root,u.ref.$changes.indexes[_])})},n.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},n.prototype.change=function(e,i){void 0===i&&(i=t.OPERATION.ADD);var s="number"==typeof e?e:this.indexes[e];this.assertValidIndex(s,e);var u=this.changes.get(s);(!u||u.op===t.OPERATION.DELETE||u.op===t.OPERATION.TOUCH)&&this.changes.set(s,{op:u&&u.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:i,index:s}),this.allChanges.add(s),this.changed=!0,this.touchParents()},n.prototype.touch=function(e){var i="number"==typeof e?e:this.indexes[e];this.assertValidIndex(i,e),this.changes.has(i)||this.changes.set(i,{op:t.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},n.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},n.prototype.getType=function(e){if(this.ref._definition)return(i=this.ref._definition).schema[i.fieldsByIndex[e]];var i=this.parent._definition;return Object.values(i.schema[i.fieldsByIndex[this.parentIndex]])[0]},n.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},n.prototype.getValue=function(e){return this.ref.getByIndex(e)},n.prototype.delete=function(e){var i="number"==typeof e?e:this.indexes[e];if(void 0!==i){var s=this.getValue(i);this.changes.set(i,{op:t.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],s&&s.$changes&&(s.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+i+")")},n.prototype.discard=function(e,i){var s=this;void 0===e&&(e=!1),void 0===i&&(i=!1),this.ref instanceof j||this.changes.forEach(function(u){if(u.op===t.OPERATION.DELETE){var l=s.ref.getIndex(u.index);delete s.indexes[l]}}),this.changes.clear(),this.changed=e,i&&this.allChanges.clear(),this.currentCustomOperation=0},n.prototype.discardAll=function(){var e=this;this.changes.forEach(function(i){var s=e.getValue(i.index);s&&s.$changes&&s.$changes.discardAll()}),this.discard()},n.prototype.cache=function(e,i){this.caches[e]=i},n.prototype.clone=function(){return new n(this.ref,this.parent,this.root)},n.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},n.prototype.assertValidIndex=function(e,i){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+i+'"')},n}(),D=function(n,e){var i=n.toString(),s=e.toString();return i<s?-1:i>s?1:0};function N(n){return n.$proxy=!0,new Proxy(n,{get:function(e,i){return"symbol"==typeof i||isNaN(i)?e[i]:e.at(i)},set:function(e,i,s){if("symbol"==typeof i||isNaN(i))e[i]=s;else{var u=Array.from(e.$items.keys()),l=parseInt(u[i]||i);null==s?e.deleteAt(l):e.setAt(l,s)}return!0},deleteProperty:function(e,i){return"number"==typeof i?e.deleteAt(i):delete e[i],!0}})}var H=function(){function n(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return n.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(n.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),n.prototype.push=function(){for(var e=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var u;return i.forEach(function(l){u=e.$refId++,e.setAt(u,l)}),u},n.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var i=this.$items.get(e);return this.$items.delete(e),i}},n.prototype.at=function(e){var i=Array.from(this.$items.keys())[e];return this.$items.get(i)},n.prototype.setAt=function(e,i){var s,u;void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,e);var l=null!==(u=null===(s=this.$changes.indexes[e])||void 0===s?void 0:s.op)&&void 0!==u?u:t.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,i),this.$changes.change(e,l)},n.prototype.deleteAt=function(e){var i=Array.from(this.$items.keys())[e];return void 0!==i&&this.$deleteAt(i)},n.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(s){i.$changes.root.removeRef(s.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.concat=function(){for(var e,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return new(n.bind.apply(n,m([void 0],(e=Array.from(this.$items.values())).concat.apply(e,i))))},n.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},n.prototype.reverse=function(){var e=this,i=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach(function(u,l){e.setAt(i[l],u)}),this},n.prototype.shift=function(){var i=Array.from(this.$items.keys()).shift();if(void 0!==i){var s=this.$items.get(i);return this.$deleteAt(i),s}},n.prototype.slice=function(e,i){return new(n.bind.apply(n,m([void 0],Array.from(this.$items.values()).slice(e,i))))},n.prototype.sort=function(e){var i=this;void 0===e&&(e=D);var s=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach(function(l,x){i.setAt(s[x],l)}),this},n.prototype.splice=function(e,i){void 0===i&&(i=this.length-e);for(var s=[],u=2;u<arguments.length;u++)s[u-2]=arguments[u];for(var l=Array.from(this.$items.keys()),x=[],v=e;v<e+i;v++)x.push(this.$items.get(l[v])),this.$deleteAt(l[v]);return x},n.prototype.unshift=function(){for(var e=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var u=this.length,l=i.length,x=Array.from(this.$items.values());return i.forEach(function(v,M){e.setAt(M,v)}),x.forEach(function(v,M){e.setAt(l+M,v)}),u+l},n.prototype.indexOf=function(e,i){return Array.from(this.$items.values()).indexOf(e,i)},n.prototype.lastIndexOf=function(e,i){return void 0===i&&(i=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,i)},n.prototype.every=function(e,i){return Array.from(this.$items.values()).every(e,i)},n.prototype.some=function(e,i){return Array.from(this.$items.values()).some(e,i)},n.prototype.forEach=function(e,i){Array.from(this.$items.values()).forEach(e,i)},n.prototype.map=function(e,i){return Array.from(this.$items.values()).map(e,i)},n.prototype.filter=function(e,i){return Array.from(this.$items.values()).filter(e,i)},n.prototype.reduce=function(e,i){return Array.from(this.$items.values()).reduce(e,i)},n.prototype.reduceRight=function(e,i){return Array.from(this.$items.values()).reduceRight(e,i)},n.prototype.find=function(e,i){return Array.from(this.$items.values()).find(e,i)},n.prototype.findIndex=function(e,i){return Array.from(this.$items.values()).findIndex(e,i)},n.prototype.fill=function(e,i,s){throw new Error("ArraySchema#fill() not implemented")},n.prototype.copyWithin=function(e,i,s){throw new Error("ArraySchema#copyWithin() not implemented")},n.prototype.toString=function(){return this.$items.toString()},n.prototype.toLocaleString=function(){return this.$items.toLocaleString()},n.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},n.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},n.prototype.includes=function(e,i){return Array.from(this.$items.values()).includes(e,i)},n.prototype.flatMap=function(e,i){throw new Error("ArraySchema#flatMap() is not supported.")},n.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},n.prototype.clone=function(e){return e?new(n.bind.apply(n,m([void 0],Array.from(this.$items.values())))):new(n.bind.apply(n,m([void 0],this.map(function(s){return s.$changes?s.clone():s}))))},n.prototype.triggerAll=function(){j.prototype.triggerAll.apply(this)},n}();function je(n){return n.$proxy=!0,new Proxy(n,{get:function(e,i){return"symbol"!=typeof i&&typeof e[i]>"u"?e.get(i):e[i]},set:function(e,i,s){return"symbol"!=typeof i&&-1===i.indexOf("$")&&"onAdd"!==i&&"onRemove"!==i&&"onChange"!==i?e.set(i,s):e[i]=s,!0},deleteProperty:function(e,i){return e.delete(i),!0}})}var J=function(){function n(e){var i=this;if(this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(u,l){return i.set(l,u)});else for(var s in e)this.set(s,e[s])}return n.is=function(e){return void 0!==e.map},n.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(n.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),n.prototype.set=function(e,i){if(null==i)throw new Error("MapSchema#set('"+e+"', "+i+"): trying to set "+i+" value on '"+e+"'.");var s=typeof this.$changes.indexes[e]<"u",u=s?this.$changes.indexes[e]:this.$refId++,l=s?t.OPERATION.REPLACE:t.OPERATION.ADD,x=void 0!==i.$changes;return x&&i.$changes.setParent(this,this.$changes.root,u),s?x&&this.$items.get(e)!==i&&(l=t.OPERATION.ADD):(this.$changes.indexes[e]=u,this.$indexes.set(u,e)),this.$items.set(e,i),this.$changes.change(e,l),this},n.prototype.get=function(e){return this.$items.get(e)},n.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(s){i.$changes.root.removeRef(s.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){return this.$items.has(e)},n.prototype.forEach=function(e){this.$items.forEach(e)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.keys=function(){return this.$items.keys()},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toJSON=function(){var e={};return this.forEach(function(i,s){e[s]="function"==typeof i.toJSON?i.toJSON():i}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(s,u){i.set(u,s.$changes?s.clone():s)})),i},n.prototype.triggerAll=function(){j.prototype.triggerAll.apply(this)},n}(),Mt={};function Oe(n,e){Mt[n]=e}function Ze(n){return Mt[n]}var gt=function(){function n(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return n.create=function(e){var i=new n;return i.schema=Object.assign({},e&&e.schema||{}),i.indexes=Object.assign({},e&&e.indexes||{}),i.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),i.descriptors=Object.assign({},e&&e.descriptors||{}),i.deprecated=Object.assign({},e&&e.deprecated||{}),i},n.prototype.addField=function(e,i){var s=this.getNextFieldIndex();this.fieldsByIndex[s]=e,this.indexes[e]=s,this.schema[e]=Array.isArray(i)?{array:i[0]}:i},n.prototype.addFilter=function(e,i){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=i,this.indexesWithFilters.push(this.indexes[e]),!0},n.prototype.addChildrenFilter=function(e,i){var s=this.indexes[e];if(Ze(Object.keys(this.schema[e])[0]))return this.childFilters||(this.childFilters={}),this.childFilters[s]=i,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},n.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},n.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},n}();var Je=function(){function n(){this.types={},this.schemas=new Map,this.useFilters=!1}return n.prototype.has=function(e){return this.schemas.has(e)},n.prototype.get=function(e){return this.types[e]},n.prototype.add=function(e,i){void 0===i&&(i=this.schemas.size),e._definition=gt.create(e._definition),e._typeid=i,this.types[i]=e,this.schemas.set(e,i)},n.create=function(e){return void 0===e&&(e=new n),function(i){return Q(i,e)}},n}(),It=new Je;function Q(n,e){return void 0===e&&(e=It),function(i,s){var u=i.constructor;u._context=e,e.has(u)||e.add(u);var l=u._definition;if(l.addField(s,n),l.descriptors[s]){if(l.deprecated[s])return;try{throw new Error("@colyseus/schema: Duplicate '"+s+"' definition on '"+u.name+"'.\nCheck @type() annotation")}catch(y){var x=y.stack.split("\n")[4].trim();throw new Error(y.message+" "+x)}}var v=H.is(n),M=!v&&J.is(n);if("string"!=typeof n&&!j.is(n)){var O=Object.values(n)[0];"string"!=typeof O&&!e.has(O)&&e.add(O)}var _="_"+s;l.descriptors[_]={enumerable:!1,configurable:!1,writable:!0},l.descriptors[s]={get:function(){return this[_]},set:function(y){y!==this[_]&&(null!=y?(v&&!(y instanceof H)&&(y=new(H.bind.apply(H,m([void 0],y)))),M&&!(y instanceof J)&&(y=new J(y)),void 0===y.$proxy&&(M?y=je(y):v&&(y=N(y))),this.$changes.change(s),y.$changes&&y.$changes.setParent(this,this.$changes.root,this._definition.indexes[s])):this.$changes.delete(s),this[_]=y)},enumerable:!0,configurable:!0}}}function Tt(n,e,i){for(var s=0,u=0,l=i.length;u<l;u++)(s=i.charCodeAt(u))<128?n[e++]=s:s<2048?(n[e++]=192|s>>6,n[e++]=128|63&s):s<55296||s>=57344?(n[e++]=224|s>>12,n[e++]=128|s>>6&63,n[e++]=128|63&s):(u++,s=65536+((1023&s)<<10|1023&i.charCodeAt(u)),n[e++]=240|s>>18,n[e++]=128|s>>12&63,n[e++]=128|s>>6&63,n[e++]=128|63&s)}function Rt(n,e){n.push(255&e)}function B(n,e){n.push(255&e)}function St(n,e){n.push(255&e),n.push(e>>8&255)}function mt(n,e){n.push(255&e),n.push(e>>8&255)}function $e(n,e){n.push(255&e),n.push(e>>8&255),n.push(e>>16&255),n.push(e>>24&255)}function se(n,e){var i=e>>24,s=e>>16,u=e>>8;n.push(255&e),n.push(255&u),n.push(255&s),n.push(255&i)}function Dt(n,e){var i=Math.floor(e/Math.pow(2,32));se(n,e>>>0),se(n,i)}function Pt(n,e){var i=e/Math.pow(2,32)>>0;se(n,e>>>0),se(n,i)}var Ee=new Int32Array(2),Vt=new Float32Array(Ee.buffer),en=new Float64Array(Ee.buffer);function kt(n,e){Vt[0]=e,$e(n,Ee[0])}function vt(n,e){en[0]=e,$e(n,Ee[0]),$e(n,Ee[1])}function Be(n,e){e||(e="");var i=function Kt(n){for(var e=0,i=0,s=0,u=n.length;s<u;s++)(e=n.charCodeAt(s))<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(s++,i+=4);return i}(e),s=0;if(i<32)n.push(160|i),s=1;else if(i<256)n.push(217),B(n,i),s=2;else if(i<65536)n.push(218),mt(n,i),s=3;else{if(!(i<4294967296))throw new Error("String too long");n.push(219),se(n,i),s=5}return Tt(n,n.length,e),s+i}function q(n,e){return isNaN(e)?q(n,0):isFinite(e)?e!==(0|e)?(n.push(203),vt(n,e),9):e>=0?e<128?(B(n,e),1):e<256?(n.push(204),B(n,e),2):e<65536?(n.push(205),mt(n,e),3):e<4294967296?(n.push(206),se(n,e),5):(n.push(207),Pt(n,e),9):e>=-32?(n.push(224|e+32),1):e>=-128?(n.push(208),Rt(n,e),2):e>=-32768?(n.push(209),St(n,e),3):e>=-2147483648?(n.push(210),$e(n,e),5):(n.push(211),Dt(n,e),9):q(n,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var _t=Object.freeze({__proto__:null,utf8Write:Tt,int8:Rt,uint8:B,int16:St,uint16:mt,int32:$e,uint32:se,int64:Dt,uint64:Pt,float32:function Wt(n,e){kt(n,e)},float64:function Xt(n,e){vt(n,e)},writeFloat32:kt,writeFloat64:vt,boolean:function tn(n,e){return B(n,e?1:0)},string:Be,number:q});function Nt(n,e){return be(n,e)<<24>>24}function be(n,e){return n[e.offset++]}function Ut(n,e){return He(n,e)<<16>>16}function He(n,e){return n[e.offset++]|n[e.offset++]<<8}function ae(n,e){return n[e.offset++]|n[e.offset++]<<8|n[e.offset++]<<16|n[e.offset++]<<24}function de(n,e){return ae(n,e)>>>0}function Ft(n,e){var i=de(n,e);return ae(n,e)*Math.pow(2,32)+i}function Lt(n,e){var i=de(n,e);return de(n,e)*Math.pow(2,32)+i}var Me=new Int32Array(2),sn=new Float32Array(Me.buffer),an=new Float64Array(Me.buffer);function yt(n,e){return Me[0]=ae(n,e),sn[0]}function xt(n,e){return Me[0]=ae(n,e),Me[1]=ae(n,e),an[0]}function zt(n,e){var s,i=n[e.offset++];i<192?s=31&i:217===i?s=be(n,e):218===i?s=He(n,e):219===i&&(s=de(n,e));var u=function nn(n,e,i){for(var s="",u=0,l=e,x=e+i;l<x;l++){var v=n[l];0!=(128&v)?192!=(224&v)?224!=(240&v)?240!=(248&v)?console.error("Invalid byte "+v.toString(16)):(u=(7&v)<<18|(63&n[++l])<<12|(63&n[++l])<<6|(63&n[++l])<<0)>=65536?(u-=65536,s+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):s+=String.fromCharCode(u):s+=String.fromCharCode((15&v)<<12|(63&n[++l])<<6|(63&n[++l])<<0):s+=String.fromCharCode((31&v)<<6|63&n[++l]):s+=String.fromCharCode(v)}return s}(n,e.offset,s);return e.offset+=s,u}function ce(n,e){var i=n[e.offset++];return i<128?i:202===i?yt(n,e):203===i?xt(n,e):204===i?be(n,e):205===i?He(n,e):206===i?de(n,e):207===i?Lt(n,e):208===i?Nt(n,e):209===i?Ut(n,e):210===i?ae(n,e):211===i?Ft(n,e):i>223?-1*(255-i+1):void 0}function jt(n,e){return n[e.offset-1]===g&&(n[e.offset]<128||n[e.offset]>=202&&n[e.offset]<=211)}var Zt=Object.freeze({__proto__:null,int8:Nt,uint8:be,int16:Ut,uint16:He,int32:ae,uint32:de,float32:function rn(n,e){return yt(n,e)},float64:function on(n,e){return xt(n,e)},int64:Ft,uint64:Lt,readFloat32:yt,readFloat64:xt,boolean:function cn(n,e){return be(n,e)>0},string:zt,stringCheck:function fn(n,e){var i=n[e.offset];return i<192&&i>160||217===i||218===i||219===i},number:ce,numberCheck:function un(n,e){var i=n[e.offset];return i<128||i>=202&&i<=211},arrayCheck:function hn(n,e){return n[e.offset]<160},switchStructureCheck:jt}),wt=function(){function n(e){var i=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(s){return i.add(s)})}return n.is=function(e){return void 0!==e.collection},n.prototype.add=function(e){var i=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,i),this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,e),this.$changes.change(i),i},n.prototype.at=function(e){var i=Array.from(this.$items.keys())[e];return this.$items.get(i)},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(e){for(var s,u,i=this.$items.entries();(u=i.next())&&!u.done;)if(e===u.value[1]){s=u.value[0];break}return void 0!==s&&(this.$changes.delete(s),this.$indexes.delete(s),this.$items.delete(s))},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(s){i.$changes.root.removeRef(s.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){return Array.from(this.$items.values()).some(function(i){return i===e})},n.prototype.forEach=function(e){var i=this;this.$items.forEach(function(s,u,l){return e(s,u,i)})},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var e=[];return this.forEach(function(i,s){e.push("function"==typeof i.toJSON?i.toJSON():i)}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(s){i.add(s.$changes?s.clone():s)})),i},n.prototype.triggerAll=function(){j.prototype.triggerAll.apply(this)},n}(),Ct=function(){function n(e){var i=this;this.$changes=new T(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(s){return i.add(s)})}return n.is=function(e){return void 0!==e.set},n.prototype.add=function(e){var i,s;if(this.has(e))return!1;var u=this.$refId++;void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,u);var l=null!==(s=null===(i=this.$changes.indexes[u])||void 0===i?void 0:i.op)&&void 0!==s?s:t.OPERATION.ADD;return this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,e),this.$changes.change(u,l),u},n.prototype.entries=function(){return this.$items.entries()},n.prototype.delete=function(e){for(var s,u,i=this.$items.entries();(u=i.next())&&!u.done;)if(e===u.value[1]){s=u.value[0];break}return void 0!==s&&(this.$changes.delete(s),this.$indexes.delete(s),this.$items.delete(s))},n.prototype.clear=function(e){var i=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(s){i.$changes.root.removeRef(s.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},n.prototype.has=function(e){for(var u,i=this.$items.values(),s=!1;(u=i.next())&&!u.done;)if(e===u.value){s=!0;break}return s},n.prototype.forEach=function(e){var i=this;this.$items.forEach(function(s,u,l){return e(s,u,i)})},n.prototype.values=function(){return this.$items.values()},Object.defineProperty(n.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),n.prototype.setIndex=function(e,i){this.$indexes.set(e,i)},n.prototype.getIndex=function(e){return this.$indexes.get(e)},n.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},n.prototype.deleteByIndex=function(e){var i=this.$indexes.get(e);this.$items.delete(i),this.$indexes.delete(e)},n.prototype.toArray=function(){return Array.from(this.$items.values())},n.prototype.toJSON=function(){var e=[];return this.forEach(function(i,s){e.push("function"==typeof i.toJSON?i.toJSON():i)}),e},n.prototype.clone=function(e){var i;return e?i=Object.assign(new n,this):(i=new n,this.forEach(function(s){i.add(s.$changes?s.clone():s)})),i},n.prototype.triggerAll=function(){j.prototype.triggerAll.apply(this)},n}(),ln=function(){function n(){this.handlers=[]}return n.prototype.register=function(e,i){return this.handlers.push(e),this},n.prototype.invoke=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.handlers.forEach(function(s){return s.apply(void 0,e)})},n.prototype.invokeAsync=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return Promise.all(this.handlers.map(function(s){return s.apply(void 0,e)}))},n.prototype.remove=function(e){var i=this.handlers.indexOf(e);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()},n.prototype.clear=function(){this.handlers=[]},n}(),dn=function(){function n(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return n.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},n.get=function(e){return void 0===e.$filterState&&(e.$filterState=new n),e.$filterState},n}(),At=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return f(e,n),e}(Error);function Jt(n,e,i,s){if(!(n instanceof e))throw new At("a '"+e.name+"' was expected, but '"+n.constructor.name+"' was provided in "+i.constructor.name+"#"+s)}function gn(n,e,i,s,u){!function pn(n,e,i,s){var u,l=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":u="number",isNaN(n)&&console.log('trying to encode "NaN" in '+i.constructor.name+"#"+s);break;case"string":u="string",l=!0;break;case"boolean":return}if(typeof n!==u&&(!l||l&&null!==n)){var x="'"+JSON.stringify(n)+"'"+(n&&n.constructor&&" ("+n.constructor.name+")"||"");throw new At("a '"+u+"' was expected, but "+x+" was provided in "+i.constructor.name+"#"+s)}}(i,n,s,u);var l=_t[n];if(!l)throw new At("a '"+n+"' was expected, but "+i+" was provided in "+s.constructor.name+"#"+u);l(e,i)}function mn(n,e,i){return Zt[n](e,i)}var j=function(){function n(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];Object.defineProperties(this,{$changes:{value:new T(this,void 0,new d),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var s=this._definition.descriptors;s&&Object.defineProperties(this,s),e[0]&&this.assign(e[0])}return n.onError=function(e){console.error(e)},n.is=function(e){return e._definition&&void 0!==e._definition.schema},n.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(n.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),n.prototype.listen=function(e,i){var s=this;return this.$listeners[e]||(this.$listeners[e]=new ln),this.$listeners[e].register(i),function(){return s.$listeners[e].remove(i)}},n.prototype.decode=function(e,i,s,u){void 0===i&&(i={offset:0}),void 0===s&&(s=this),void 0===u&&(u=new Map);var l=this.$changes.root,x=e.length,v=0,M=[];for(l.refs.set(v,this),u.set(v,M);i.offset<x;){var O=e[i.offset++];if(O!=g){var y=s.$changes,S=void 0!==s._definition,b=S?O>>6<<6:O;if(b!==t.OPERATION.CLEAR){var C=S?O%(b||255):ce(e,i),E=S?s._definition.fieldsByIndex[C]:"",R=y.getType(C),w=void 0,I=void 0,Z=void 0;if(S?I=s["_"+E]:(I=s.getByIndex(C),(b&t.OPERATION.ADD)===t.OPERATION.ADD?(Z=s instanceof J?zt(e,i):C,s.setIndex(C,Z)):Z=s.getIndex(C)),(b&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(b!==t.OPERATION.DELETE_AND_ADD&&s.deleteByIndex(C),I&&I.$changes&&l.removeRef(I.$changes.refId),w=null),void 0!==E){if(b!==t.OPERATION.DELETE)if(n.is(R)){var U=ce(e,i);if(w=l.refs.get(U),b!==t.OPERATION.REPLACE){var W=this.getSchemaType(e,i,R);w||((w=this.createTypeInstance(W)).$changes.refId=U,I&&(w.onChange=I.onChange,w.onRemove=I.onRemove,w.$listeners=I.$listeners,I.$changes.refId&&U!==I.$changes.refId&&l.removeRef(I.$changes.refId))),l.addRef(U,w,w!==I)}}else if("string"==typeof R)w=mn(R,e,i);else{var Ie=Ze(Object.keys(R)[0]),G=ce(e,i),F=l.refs.has(G)?I||l.refs.get(G):new Ie.constructor;if((w=F.clone(!0)).$changes.refId=G,I&&(w.onAdd=I.onAdd,w.onRemove=I.onRemove,w.onChange=I.onChange,I.$changes.refId&&G!==I.$changes.refId)){l.removeRef(I.$changes.refId);for(var L=[],Et=I.entries(),V=void 0;(V=Et.next())&&!V.done;){var qe=V.value;L.push({op:t.OPERATION.DELETE,field:qe[0],value:void 0,previousValue:qe[1]})}u.set(I.$changes.refId,L)}l.addRef(G,w,F!==I),Ie.getProxy&&(w=Ie.getProxy(w))}var yn=I!==w;if(null!=w)if(w.$changes&&w.$changes.setParent(y.ref,y.root,C),s instanceof n)s[E]=w;else if(s instanceof J)s.$items.set(Z,w);else if(s instanceof H)s.setAt(C,w);else if(s instanceof wt){var Ge=s.add(w);s.setIndex(C,Ge)}else s instanceof Ct&&!1!==(Ge=s.add(w))&&s.setIndex(C,Ge);yn&&M.push({op:b,field:E,dynamicIndex:Z,value:w,previousValue:I})}else{console.warn("@colyseus/schema: definition mismatch");for(var $={offset:i.offset};i.offset<x&&(!jt(e,i)||($.offset=i.offset+1,!l.refs.has(ce(e,$))));)i.offset++}}else s.clear(!0)}else{v=ce(e,i);var _=l.refs.get(v);if(!_)throw new Error('"refId" not found: '+v);s=_,u.set(v,M=[])}}return this._triggerChanges(u),l.garbageCollectDeletedRefs(),u},n.prototype.encode=function(e,i,s){void 0===e&&(e=!1),void 0===i&&(i=[]),void 0===s&&(s=!1);for(var u=this.$changes,l=new WeakSet,x=[u],v=1,M=0;M<v;M++){var O=x[M],_=O.ref,y=_ instanceof n;O.ensureRefId(),l.add(O),O!==u&&(O.changed||e)&&(B(i,g),q(i,O.refId));for(var S=Array.from(e?O.allChanges:O.changes.values()),b=0,C=S.length;b<C;b++){var E=e?{op:t.OPERATION.ADD,index:S[b]}:S[b],R=E.index,w=y?_._definition.fieldsByIndex&&_._definition.fieldsByIndex[R]:R,I=i.length;if(E.op!==t.OPERATION.TOUCH)if(y)B(i,R|E.op);else{if(B(i,E.op),E.op===t.OPERATION.CLEAR)continue;q(i,R)}if(!y&&(E.op&t.OPERATION.ADD)==t.OPERATION.ADD&&_ instanceof J&&Be(i,O.ref.$indexes.get(R)),E.op!==t.OPERATION.DELETE){var $=O.getType(R),U=O.getValue(R);if(U&&U.$changes&&!l.has(U.$changes)&&(x.push(U.$changes),U.$changes.ensureRefId(),v++),E.op!==t.OPERATION.TOUCH){if(n.is($))Jt(U,$,_,w),q(i,U.$changes.refId),(E.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(i,$,U.constructor);else if("string"==typeof $)gn($,i,U,_,w);else{var W=Ze(Object.keys($)[0]);Jt(_["_"+w],W.constructor,_,w),q(i,U.$changes.refId)}s&&O.cache(R,i.slice(I))}}}!e&&!s&&O.discard()}return i},n.prototype.encodeAll=function(e){return this.encode(!0,[],e)},n.prototype.applyFilters=function(e,i){var s,u;void 0===i&&(i=!1);for(var l=this,x=new Set,v=dn.get(e),M=[this.$changes],O=1,_=[],y=function(b){var C=M[b];if(x.has(C.refId))return"continue";var E=C.ref,R=E instanceof n;B(_,g),q(_,C.refId);var w=v.refIds.has(C),I=i||!w;v.addRefId(C);var Z=v.containerIndexes.get(C),$=Array.from(I?C.allChanges:C.changes.values());!i&&R&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach(function(pe){!Z.has(pe)&&C.allChanges.has(pe)&&$.push(I?pe:{op:t.OPERATION.ADD,index:pe})});for(var W=0,Ie=$.length;W<Ie;W++){var G=I?{op:t.OPERATION.ADD,index:$[W]}:$[W];if(G.op!==t.OPERATION.CLEAR){var F=G.index;if(G.op!==t.OPERATION.DELETE){var L=C.getValue(F),Et=C.getType(F);if(R){if((V=E._definition.filters&&E._definition.filters[F])&&!V.call(E,e,L,l)){L&&L.$changes&&x.add(L.$changes.refId);continue}}else{var V,qe=C.parent;if((V=C.getChildrenFilter())&&!V.call(qe,e,E.$indexes.get(F),L,l)){L&&L.$changes&&x.add(L.$changes.refId);continue}}if(L.$changes&&(M.push(L.$changes),O++),G.op!==t.OPERATION.TOUCH)if(G.op===t.OPERATION.ADD||R)_.push.apply(_,null!==(s=C.caches[F])&&void 0!==s?s:[]),Z.add(F);else if(Z.has(F))_.push.apply(_,null!==(u=C.caches[F])&&void 0!==u?u:[]);else{if(Z.add(F),B(_,t.OPERATION.ADD),q(_,F),E instanceof J){var ue=C.ref.$indexes.get(F);Be(_,ue)}L.$changes?q(_,L.$changes.refId):_t[Et](_,L)}else L.$changes&&!R&&(B(_,t.OPERATION.ADD),q(_,F),E instanceof J&&(ue=C.ref.$indexes.get(F),Be(_,ue)),q(_,L.$changes.refId))}else R?B(_,G.op|F):(B(_,G.op),q(_,F))}else B(_,G.op)}},S=0;S<O;S++)y(S);return _},n.prototype.clone=function(){var e=new this.constructor,i=this._definition.schema;for(var s in i)e[s]="object"==typeof this[s]&&"function"==typeof this[s].clone?this[s].clone():this[s];return e},n.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;n.prototype._triggerAllFillChanges.call(this,this,e);try{n.prototype._triggerChanges.call(this,e)}catch(i){n.onError(i)}}},n.prototype.toJSON=function(){var e=this._definition.schema,i=this._definition.deprecated,s={};for(var u in e)!i[u]&&null!==this[u]&&typeof this[u]<"u"&&(s[u]="function"==typeof this[u].toJSON?this[u].toJSON():this["_"+u]);return s},n.prototype.discardAllChanges=function(){this.$changes.discardAll()},n.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},n.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},n.prototype.tryEncodeTypeId=function(e,i,s){i._typeid!==s._typeid&&(B(e,213),q(e,s._typeid))},n.prototype.getSchemaType=function(e,i,s){var u;return 213===e[i.offset]&&(i.offset++,u=this.constructor._context.get(ce(e,i))),u||s},n.prototype.createTypeInstance=function(e){var i=new e;return i.$changes.root=this.$changes.root,i},n.prototype._triggerAllFillChanges=function(e,i){if(!i.has(e.$changes.refId)){var s=[];if(i.set(e.$changes.refId||0,s),e instanceof n){var u=e._definition.schema;for(var l in u)void 0!==(v=e["_"+l])&&(s.push({op:t.OPERATION.ADD,field:l,value:v,previousValue:void 0}),void 0!==v.$changes&&n.prototype._triggerAllFillChanges.call(this,v,i))}else for(var M=e.entries(),O=void 0;(O=M.next())&&!O.done;){var v,_=O.value,y=_[0];s.push({op:t.OPERATION.ADD,field:y,dynamicIndex:y,value:v=_[1],previousValue:void 0}),void 0!==v.$changes&&n.prototype._triggerAllFillChanges.call(this,v,i)}}},n.prototype._triggerChanges=function(e){var i=this;e.forEach(function(s,u){var l,x,v,M,O,_,y,S,b,C,E,R;if(s.length>0){for(var w=i.$changes.root.refs.get(u),I=w instanceof n,Z=0;Z<s.length;Z++){var $=s[Z],U=w.$listeners&&w.$listeners[$.field];if(I||($.op===t.OPERATION.ADD&&void 0===$.previousValue?null===(x=(l=w).onAdd)||void 0===x||x.call(l,$.value,null!==(v=$.dynamicIndex)&&void 0!==v?v:$.field):$.op===t.OPERATION.DELETE?void 0!==$.previousValue&&(null===(O=(M=w).onRemove)||void 0===O||O.call(M,$.previousValue,null!==(_=$.dynamicIndex)&&void 0!==_?_:$.field)):$.op===t.OPERATION.DELETE_AND_ADD?(void 0!==$.previousValue&&(null===(S=(y=w).onRemove)||void 0===S||S.call(y,$.previousValue,$.dynamicIndex)),null===(C=(b=w).onAdd)||void 0===C||C.call(b,$.value,$.dynamicIndex)):($.op===t.OPERATION.REPLACE||$.value!==$.previousValue)&&(null===(R=(E=w).onChange)||void 0===R||R.call(E,$.value,$.dynamicIndex))),($.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&$.previousValue instanceof n&&$.previousValue.onRemove&&$.previousValue.onRemove(),U)try{U.invoke($.value,$.previousValue)}catch(W){n.onError(W)}}if(I&&w.onChange)try{w.onChange(s)}catch(W){n.onError(W)}}})},n._definition=gt.create(),n}();var fe=new Je,Ot=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return f(e,n),h([Q("string",fe)],e.prototype,"name",void 0),h([Q("string",fe)],e.prototype,"type",void 0),h([Q("number",fe)],e.prototype,"referencedType",void 0),e}(j),$t=function(n){function e(){var i=null!==n&&n.apply(this,arguments)||this;return i.fields=new H,i}return f(e,n),h([Q("number",fe)],e.prototype,"id",void 0),h([Q([Ot],fe)],e.prototype,"fields",void 0),e}(j),_n=function(n){function e(){var i=null!==n&&n.apply(this,arguments)||this;return i.types=new H,i}return f(e,n),e.encode=function(i){var s=i.constructor,u=new e;u.rootType=s._typeid;var l=function(O,_){for(var y in _){var S=new Ot;S.name=y;var b=void 0;if("string"==typeof _[y])b=_[y];else{var C=_[y],E=void 0;j.is(C)?(b="ref",E=_[y]):"string"==typeof C[b=Object.keys(C)[0]]?b+=":"+C[b]:E=C[b],S.referencedType=E?E._typeid:-1}S.type=b,O.fields.push(S)}u.types.push(O)},x=s._context.types;for(var v in x){var M=new $t;M.id=Number(v),l(M,x[v]._definition.schema)}return u.encodeAll()},e.decode=function(i,s){var u=new Je,l=new e;l.decode(i,s);var x=l.types.reduce(function(y,S){var b=function(E){function R(){return null!==E&&E.apply(this,arguments)||this}return f(R,E),R}(j),C=S.id;return y[C]=b,u.add(b,C),y},{});l.types.forEach(function(y){var S=x[y.id];y.fields.forEach(function(b){var C;if(void 0!==b.referencedType){var E=b.type,R=x[b.referencedType];if(!R){var w=b.type.split(":");E=w[0],R=w[1]}"ref"===E?Q(R,u)(S.prototype,b.name):Q(((C={})[E]=R,C),u)(S.prototype,b.name)}else Q(b.type,u)(S.prototype,b.name)})});var v=x[l.rootType],M=new v;for(var O in v._definition.schema){var _=v._definition.schema[O];"string"!=typeof _&&(M[O]="function"==typeof _?new _:new(Ze(Object.keys(_)[0]).constructor))}return M},h([Q([$t],fe)],e.prototype,"types",void 0),h([Q("number",fe)],e.prototype,"rootType",void 0),e}(j);Oe("map",{constructor:J,getProxy:je}),Oe("array",{constructor:H,getProxy:N}),Oe("set",{constructor:Ct}),Oe("collection",{constructor:wt}),t.ArraySchema=H,t.CollectionSchema=wt,t.Context=Je,t.MapSchema=J,t.Reflection=_n,t.ReflectionField=Ot,t.ReflectionType=$t,t.Schema=j,t.SchemaDefinition=gt,t.SetSchema=Ct,t.decode=Zt,t.defineTypes=function Qt(n,e,i){for(var s in void 0===i&&(i=n._context||It),e)Q(e[s],i)(n.prototype,s);return n},t.deprecated=function Yt(n,e){return void 0===n&&(n=!0),function(i,s){var l=i.constructor._definition;l.deprecated[s]=!0,n&&(l.descriptors[s]={get:function(){throw new Error(s+" is deprecated.")},set:function(x){},enumerable:!1,configurable:!0})}},t.dumpChanges=function vn(n){for(var e=[n.$changes],s={},u=s,l=function(v){var M=e[v];M.changes.forEach(function(O){var _=M.ref,y=O.index,S=_._definition?_._definition.fieldsByIndex[y]:_.$indexes.get(y);u[S]=M.getValue(y)})},x=0;x<1;x++)l(x);return s},t.encode=_t,t.filter=function qt(n){return function(e,i){var s=e.constructor;s._definition.addFilter(i,n)&&(s._context.useFilters=!0)}},t.filterChildren=function Gt(n){return function(e,i){var s=e.constructor;s._definition.addChildrenFilter(i,n)&&(s._context.useFilters=!0)}},t.hasFilter=function Ht(n){return n._context&&n._context.useFilters},t.registerType=Oe,t.type=Q,Object.defineProperty(t,"__esModule",{value:!0})},c(o)}),Fe=function(){function r(o,t){var c=this;this.onStateChange=le(),this.onError=le(),this.onLeave=le(),this.onJoin=le(),this.hasJoined=!1,this.onMessageHandlers=ot(),this.id=null,this.name=o,t&&(this.serializer=new(Ue("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(function(f,h){return console.warn("colyseus.js - onError => ("+f+") "+h)}),this.onLeave(function(){return c.removeAllListeners()})}return r.prototype.connect=function(o){var t=this;this.connection=new ke,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(c){if(!t.hasJoined)return console.warn("Room connection was closed unexpectedly ("+c.code+"): "+c.reason),void t.onError.invoke(c.code,c.reason);t.onLeave.invoke(c.code),t.destroy()},this.connection.events.onerror=function(c){console.warn("Room, onError ("+c.code+"): "+c.reason),t.onError.invoke(c.code,c.reason)},this.connection.connect(o)},r.prototype.leave=function(o){var t=this;return void 0===o&&(o=!0),new Promise(function(c){t.onLeave(function(f){return c(f)}),t.connection?o?t.connection.send([A.Protocol.LEAVE_ROOM]):t.connection.close():t.onLeave.invoke(4e3)})},r.prototype.onMessage=function(o,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(o),t)},r.prototype.send=function(o,t){var f,c=[A.Protocol.ROOM_DATA];if("string"==typeof o?K.encode.string(c,o):K.encode.number(c,o),void 0!==t){var h=Ve(t);(f=new Uint8Array(c.length+h.byteLength)).set(new Uint8Array(c),0),f.set(new Uint8Array(h),c.length)}else f=new Uint8Array(c);this.connection.send(f.buffer)},Object.defineProperty(r.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),r.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},r.prototype.onMessageCallback=function(o){var t=Array.from(new Uint8Array(o.data)),c=t[0];if(c===A.Protocol.JOIN_ROOM){var f=1;if(this.serializerId=function it(r,o){for(var t=r[o++],c="",f=0,h=o,m=o+t;h<m;h++){var g=r[h];if(0!=(128&g))if(192!=(224&g))if(224!=(240&g)){if(240!=(248&g))throw new Error("Invalid byte "+g.toString(16));(f=(7&g)<<18|(63&r[++h])<<12|(63&r[++h])<<6|(63&r[++h])<<0)>=65536?(f-=65536,c+=String.fromCharCode(55296+(f>>>10),56320+(1023&f))):c+=String.fromCharCode(f)}else c+=String.fromCharCode((15&g)<<12|(63&r[++h])<<6|(63&r[++h])<<0);else c+=String.fromCharCode((31&g)<<6|63&r[++h]);else c+=String.fromCharCode(g)}return c}(t,f),f+=function rt(r){void 0===r&&(r="");for(var o=0,t=0,c=0,f=r.length;c<f;c++)(o=r.charCodeAt(c))<128?t+=1:o<2048?t+=2:o<55296||o>=57344?t+=3:(c++,t+=4);return t+1}(this.serializerId),!this.serializer){var h=Ue(this.serializerId);this.serializer=new h}t.length>f&&this.serializer.handshake&&this.serializer.handshake(t,{offset:f}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([A.Protocol.JOIN_ROOM])}else if(c===A.Protocol.ERROR){var m={offset:1},g=K.decode.number(t,m),p=K.decode.string(t,m);this.onError.invoke(g,p)}else if(c===A.Protocol.LEAVE_ROOM)this.leave();else if(c===A.Protocol.ROOM_DATA_SCHEMA){var d={offset:1};(p=new(D=this.serializer.getState().constructor._context.get(K.decode.number(t,d)))).decode(t,d),this.dispatchMessage(D,p)}else if(c===A.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(c===A.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(c===A.Protocol.ROOM_DATA){var N={offset:1},D=K.decode.stringCheck(t,N)?K.decode.string(t,N):K.decode.number(t,N);p=t.length>N.offset?function Ke(r,o){void 0===o&&(o=0);var t=new te(r,o),c=t._parse();if(t._offset!==r.byteLength)throw new Error(r.byteLength-t._offset+" trailing bytes");return c}(o.data,N.offset):void 0,this.dispatchMessage(D,p)}},r.prototype.setState=function(o){this.serializer.setState(o),this.onStateChange.invoke(this.serializer.getState())},r.prototype.patch=function(o){this.serializer.patch(o),this.onStateChange.invoke(this.serializer.getState())},r.prototype.dispatchMessage=function(o,t){var c=this.getMessageHandlerKey(o);this.onMessageHandlers.events[c]?this.onMessageHandlers.emit(c,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",o,t):console.warn("colyseus.js: onMessage() not registered for type '"+o+"'.")},r.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},r.prototype.getMessageHandlerKey=function(o){switch(typeof o){case"function":return"$"+o._typeid;case"string":return o;case"number":return"i"+o;default:throw new Error("invalid message type.")}},r}();function we(){return xe||(xe=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(r,o){this.cache[r]=o},getItem:function(r){},removeItem:function(r){delete this.cache[r]}}),xe}var Ce="colyseus-auth-token";A.Platform=void 0,function(r){r.ios="ios",r.android="android"}(A.Platform||(A.Platform={}));var Ae,Le=function(){function r(o){var t=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=o.replace("ws","http"),function ht(r,o){var t=we().getItem(r);typeof Promise>"u"||!(t instanceof Promise)?o(t):t.then(function(c){return o(c)})}(Ce,function(c){return t.token=c})}return Object.defineProperty(r.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),r.prototype.login=function(o){return void 0===o&&(o={}),P(this,void 0,void 0,function(){var t,c,f;return k(this,function(h){switch(h.label){case 0:return t=Object.assign({},o),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(f in c=h.sent(),this.token=c.token,function ft(r,o){we().setItem(r,o)}(Ce,this.token),c)this.hasOwnProperty(f)&&(this[f]=c[f]);return this.registerPingService(),[2,this]}})})},r.prototype.save=function(){return P(this,void 0,void 0,function(){return k(this,function(o){switch(o.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return o.sent(),[2,this]}})})},r.prototype.getFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(o){switch(o.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,o.sent()]}})})},r.prototype.getOnlineFriends=function(){return P(this,void 0,void 0,function(){return k(this,function(o){switch(o.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,o.sent()]}})})},r.prototype.getFriendRequests=function(){return P(this,void 0,void 0,function(){return k(this,function(o){switch(o.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,o.sent()]}})})},r.prototype.sendFriendRequest=function(o){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:o})];case 1:return[2,t.sent()]}})})},r.prototype.acceptFriendRequest=function(o){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:o})];case 1:return[2,t.sent()]}})})},r.prototype.declineFriendRequest=function(o){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:o})];case 1:return[2,t.sent()]}})})},r.prototype.blockUser=function(o){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:o})];case 1:return[2,t.sent()]}})})},r.prototype.unblockUser=function(o){return P(this,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:o})];case 1:return[2,t.sent()]}})})},r.prototype.request=function(o,t,c,f,h){return void 0===c&&(c={}),void 0===h&&(h={}),P(this,void 0,void 0,function(){var m,g,p,d;return k(this,function(T){switch(T.label){case 0:for(g in h.Accept="application/json",this.hasToken&&(h.Authorization="Bearer "+this.token),m=[],c)m.push(g+"="+c[g]);return p=m.length>0?"?"+m.join("&"):"",d={headers:h},f&&(d.body=f),[4,_e[o](""+this.endpoint+t+p,d)];case 1:return[2,T.sent().data]}})})},r.prototype.logout=function(){this.token=void 0,function ut(r){we().removeItem(r)}(Ce),this.unregisterPingService()},r.prototype.registerPingService=function(o){var t=this;void 0===o&&(o=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return t.request("get","/auth")},o)},r.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},r}(),lt=function(r){function o(t,c){var f=r.call(this,t)||this;return f.code=c,Object.setPrototypeOf(f,o.prototype),f}return z(o,r),o}(Error),bt=typeof window<"u"&&typeof(null===(Ae=window?.location)||void 0===Ae?void 0:Ae.hostname)<"u"?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",dt=function(){function r(o){void 0===o&&(o=bt),this.endpoint=o}return Object.defineProperty(r.prototype,"auth",{get:function(){return this._auth||(this._auth=new Le(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),r.prototype.joinOrCreate=function(o,t,c){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",o,t,c)];case 1:return[2,f.sent()]}})})},r.prototype.create=function(o,t,c){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.createMatchMakeRequest("create",o,t,c)];case 1:return[2,f.sent()]}})})},r.prototype.join=function(o,t,c){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.createMatchMakeRequest("join",o,t,c)];case 1:return[2,f.sent()]}})})},r.prototype.joinById=function(o,t,c){return void 0===t&&(t={}),P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.createMatchMakeRequest("joinById",o,t,c)];case 1:return[2,f.sent()]}})})},r.prototype.reconnect=function(o,t,c){return P(this,void 0,void 0,function(){return k(this,function(f){switch(f.label){case 0:return[4,this.createMatchMakeRequest("joinById",o,{sessionId:t},c)];case 1:return[2,f.sent()]}})})},r.prototype.getAvailableRooms=function(o){return void 0===o&&(o=""),P(this,void 0,void 0,function(){var t;return k(this,function(c){switch(c.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+o,[4,me(t,{headers:{Accept:"application/json"}})];case 1:return[2,c.sent().data]}})})},r.prototype.consumeSeatReservation=function(o,t){return P(this,void 0,void 0,function(){var c;return k(this,function(f){return(c=this.createRoom(o.room.name,t)).id=o.room.roomId,c.sessionId=o.sessionId,c.connect(this.buildEndpoint(o.room,{sessionId:c.sessionId})),[2,new Promise(function(h,m){var g=function(p,d){return m(new Pe(p,d))};c.onError.once(g),c.onJoin.once(function(){c.onError.remove(g),h(c)})})]})})},r.prototype.createMatchMakeRequest=function(o,t,c,f){return void 0===c&&(c={}),P(this,void 0,void 0,function(){var h,m;return k(this,function(g){switch(g.label){case 0:return h=this.endpoint.replace("ws","http")+"/matchmake/"+o+"/"+t,this._auth&&this._auth.hasToken&&(c.token=this._auth.token),[4,ve(h,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)})];case 1:if((m=g.sent().data).error)throw new lt(m.error,m.code);return[2,this.consumeSeatReservation(m,f)]}})})},r.prototype.createRoom=function(o,t){return new Fe(o,t)},r.prototype.buildEndpoint=function(o,t){void 0===t&&(t={});var c=[];for(var f in t)!t.hasOwnProperty(f)||c.push(f+"="+t[f]);return this.endpoint+"/"+o.processId+"/"+o.roomId+"?"+c.join("&")},r}(),ze=function(){function r(){}return r.prototype.setState=function(o){this.state.decode(o)},r.prototype.getState=function(){return this.state},r.prototype.patch=function(o){this.state.decode(o)},r.prototype.teardown=function(){var o,t;null===(t=null===(o=this.state)||void 0===o?void 0:o.$changes)||void 0===t||t.root.clearRefs()},r.prototype.handshake=function(o,t){this.state?(new K.Reflection).decode(o,t):this.state=K.Reflection.decode(o,t)},r}(),pt=function(){function r(){}return r.prototype.setState=function(o){},r.prototype.getState=function(){return null},r.prototype.patch=function(o){},r.prototype.teardown=function(){},r.prototype.handshake=function(o){},r}();ye("schema",ze),ye("none",pt),A.Auth=Le,A.Client=dt,A.Room=Fe,A.SchemaSerializer=ze,A.registerSerializer=ye,Object.defineProperty(A,"__esModule",{value:!0})}(Te)}}]);